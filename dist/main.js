!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){(function(t,r){var i;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o,s=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="__lodash_hash_undefined__",u=500,c="__lodash_placeholder__",p=1,d=2,f=4,g=1,y=2,M=1,w=2,m=4,v=8,b=16,x=32,S=64,C=128,P=256,_=512,k=30,I="...",B=800,T=16,E=1,D=2,L=1/0,F=9007199254740991,R=17976931348623157e292,O=NaN,A=4294967295,W=A-1,z=A>>>1,j=[["ary",C],["bind",M],["bindKey",w],["curry",v],["curryRight",b],["flip",_],["partial",x],["partialRight",S],["rearg",P]],N="[object Arguments]",H="[object Array]",U="[object AsyncFunction]",K="[object Boolean]",G="[object Date]",V="[object DOMException]",q="[object Error]",$="[object Function]",Y="[object GeneratorFunction]",X="[object Map]",Z="[object Number]",J="[object Null]",Q="[object Object]",tt="[object Proxy]",et="[object RegExp]",nt="[object Set]",rt="[object String]",it="[object Symbol]",ot="[object Undefined]",st="[object WeakMap]",ht="[object WeakSet]",at="[object ArrayBuffer]",lt="[object DataView]",ut="[object Float32Array]",ct="[object Float64Array]",pt="[object Int8Array]",dt="[object Int16Array]",ft="[object Int32Array]",gt="[object Uint8Array]",yt="[object Uint8ClampedArray]",Mt="[object Uint16Array]",wt="[object Uint32Array]",mt=/\b__p \+= '';/g,vt=/\b(__p \+=) '' \+/g,bt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,xt=/&(?:amp|lt|gt|quot|#39);/g,St=/[&<>"']/g,Ct=RegExp(xt.source),Pt=RegExp(St.source),_t=/<%-([\s\S]+?)%>/g,kt=/<%([\s\S]+?)%>/g,It=/<%=([\s\S]+?)%>/g,Bt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Tt=/^\w*$/,Et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Dt=/[\\^$.*+?()[\]{}|]/g,Lt=RegExp(Dt.source),Ft=/^\s+|\s+$/g,Rt=/^\s+/,Ot=/\s+$/,At=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Wt=/\{\n\/\* \[wrapped with (.+)\] \*/,zt=/,? & /,jt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Nt=/\\(\\)?/g,Ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ut=/\w*$/,Kt=/^[-+]0x[0-9a-f]+$/i,Gt=/^0b[01]+$/i,Vt=/^\[object .+?Constructor\]$/,qt=/^0o[0-7]+$/i,$t=/^(?:0|[1-9]\d*)$/,Yt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Xt=/($^)/,Zt=/['\n\r\u2028\u2029\\]/g,Jt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Qt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",te="[\\ud800-\\udfff]",ee="["+Qt+"]",ne="["+Jt+"]",re="\\d+",ie="[\\u2700-\\u27bf]",oe="[a-z\\xdf-\\xf6\\xf8-\\xff]",se="[^\\ud800-\\udfff"+Qt+re+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",he="\\ud83c[\\udffb-\\udfff]",ae="[^\\ud800-\\udfff]",le="(?:\\ud83c[\\udde6-\\uddff]){2}",ue="[\\ud800-\\udbff][\\udc00-\\udfff]",ce="[A-Z\\xc0-\\xd6\\xd8-\\xde]",pe="(?:"+oe+"|"+se+")",de="(?:"+ce+"|"+se+")",fe="(?:"+ne+"|"+he+")"+"?",ge="[\\ufe0e\\ufe0f]?"+fe+("(?:\\u200d(?:"+[ae,le,ue].join("|")+")[\\ufe0e\\ufe0f]?"+fe+")*"),ye="(?:"+[ie,le,ue].join("|")+")"+ge,Me="(?:"+[ae+ne+"?",ne,le,ue,te].join("|")+")",we=RegExp("['’]","g"),me=RegExp(ne,"g"),ve=RegExp(he+"(?="+he+")|"+Me+ge,"g"),be=RegExp([ce+"?"+oe+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[ee,ce,"$"].join("|")+")",de+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[ee,ce+pe,"$"].join("|")+")",ce+"?"+pe+"+(?:['’](?:d|ll|m|re|s|t|ve))?",ce+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",re,ye].join("|"),"g"),xe=RegExp("[\\u200d\\ud800-\\udfff"+Jt+"\\ufe0e\\ufe0f]"),Se=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ce=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Pe=-1,_e={};_e[ut]=_e[ct]=_e[pt]=_e[dt]=_e[ft]=_e[gt]=_e[yt]=_e[Mt]=_e[wt]=!0,_e[N]=_e[H]=_e[at]=_e[K]=_e[lt]=_e[G]=_e[q]=_e[$]=_e[X]=_e[Z]=_e[Q]=_e[et]=_e[nt]=_e[rt]=_e[st]=!1;var ke={};ke[N]=ke[H]=ke[at]=ke[lt]=ke[K]=ke[G]=ke[ut]=ke[ct]=ke[pt]=ke[dt]=ke[ft]=ke[X]=ke[Z]=ke[Q]=ke[et]=ke[nt]=ke[rt]=ke[it]=ke[gt]=ke[yt]=ke[Mt]=ke[wt]=!0,ke[q]=ke[$]=ke[st]=!1;var Ie={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Be=parseFloat,Te=parseInt,Ee="object"==typeof t&&t&&t.Object===Object&&t,De="object"==typeof self&&self&&self.Object===Object&&self,Le=Ee||De||Function("return this")(),Fe=e&&!e.nodeType&&e,Re=Fe&&"object"==typeof r&&r&&!r.nodeType&&r,Oe=Re&&Re.exports===Fe,Ae=Oe&&Ee.process,We=function(){try{var t=Re&&Re.require&&Re.require("util").types;return t||Ae&&Ae.binding&&Ae.binding("util")}catch(t){}}(),ze=We&&We.isArrayBuffer,je=We&&We.isDate,Ne=We&&We.isMap,He=We&&We.isRegExp,Ue=We&&We.isSet,Ke=We&&We.isTypedArray;function Ge(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ve(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var s=t[i];e(r,s,n(s),t)}return r}function qe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function $e(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ye(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Xe(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}function Ze(t,e){return!!(null==t?0:t.length)&&an(t,e,0)>-1}function Je(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function Qe(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function tn(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function en(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function nn(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function rn(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var on=pn("length");function sn(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function hn(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}function an(t,e,n){return e==e?function(t,e,n){var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):hn(t,un,n)}function ln(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return-1}function un(t){return t!=t}function cn(t,e){var n=null==t?0:t.length;return n?gn(t,e)/n:O}function pn(t){return function(e){return null==e?o:e[t]}}function dn(t){return function(e){return null==t?o:t[e]}}function fn(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}function gn(t,e){for(var n,r=-1,i=t.length;++r<i;){var s=e(t[r]);s!==o&&(n=n===o?s:n+s)}return n}function yn(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Mn(t){return function(e){return t(e)}}function wn(t,e){return Qe(e,(function(e){return t[e]}))}function mn(t,e){return t.has(e)}function vn(t,e){for(var n=-1,r=t.length;++n<r&&an(e,t[n],0)>-1;);return n}function bn(t,e){for(var n=t.length;n--&&an(e,t[n],0)>-1;);return n}var xn=dn({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Sn=dn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Cn(t){return"\\"+Ie[t]}function Pn(t){return xe.test(t)}function _n(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function kn(t,e){return function(n){return t(e(n))}}function In(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var s=t[n];s!==e&&s!==c||(t[n]=c,o[i++]=n)}return o}function Bn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function Tn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function En(t){return Pn(t)?function(t){var e=ve.lastIndex=0;for(;ve.test(t);)++e;return e}(t):on(t)}function Dn(t){return Pn(t)?function(t){return t.match(ve)||[]}(t):function(t){return t.split("")}(t)}var Ln=dn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Fn=function t(e){var n,r=(e=null==e?Le:Fn.defaults(Le.Object(),e,Fn.pick(Le,Ce))).Array,i=e.Date,Jt=e.Error,Qt=e.Function,te=e.Math,ee=e.Object,ne=e.RegExp,re=e.String,ie=e.TypeError,oe=r.prototype,se=Qt.prototype,he=ee.prototype,ae=e["__core-js_shared__"],le=se.toString,ue=he.hasOwnProperty,ce=0,pe=(n=/[^.]+$/.exec(ae&&ae.keys&&ae.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",de=he.toString,fe=le.call(ee),ge=Le._,ye=ne("^"+le.call(ue).replace(Dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Me=Oe?e.Buffer:o,ve=e.Symbol,xe=e.Uint8Array,Ie=Me?Me.allocUnsafe:o,Ee=kn(ee.getPrototypeOf,ee),De=ee.create,Fe=he.propertyIsEnumerable,Re=oe.splice,Ae=ve?ve.isConcatSpreadable:o,We=ve?ve.iterator:o,on=ve?ve.toStringTag:o,dn=function(){try{var t=zo(ee,"defineProperty");return t({},"",{}),t}catch(t){}}(),Rn=e.clearTimeout!==Le.clearTimeout&&e.clearTimeout,On=i&&i.now!==Le.Date.now&&i.now,An=e.setTimeout!==Le.setTimeout&&e.setTimeout,Wn=te.ceil,zn=te.floor,jn=ee.getOwnPropertySymbols,Nn=Me?Me.isBuffer:o,Hn=e.isFinite,Un=oe.join,Kn=kn(ee.keys,ee),Gn=te.max,Vn=te.min,qn=i.now,$n=e.parseInt,Yn=te.random,Xn=oe.reverse,Zn=zo(e,"DataView"),Jn=zo(e,"Map"),Qn=zo(e,"Promise"),tr=zo(e,"Set"),er=zo(e,"WeakMap"),nr=zo(ee,"create"),rr=er&&new er,ir={},or=cs(Zn),sr=cs(Jn),hr=cs(Qn),ar=cs(tr),lr=cs(er),ur=ve?ve.prototype:o,cr=ur?ur.valueOf:o,pr=ur?ur.toString:o;function dr(t){if(Ih(t)&&!Mh(t)&&!(t instanceof Mr)){if(t instanceof yr)return t;if(ue.call(t,"__wrapped__"))return ps(t)}return new yr(t)}var fr=function(){function t(){}return function(e){if(!kh(e))return{};if(De)return De(e);t.prototype=e;var n=new t;return t.prototype=o,n}}();function gr(){}function yr(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=o}function Mr(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=A,this.__views__=[]}function wr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function mr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function vr(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function br(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new vr;++e<n;)this.add(t[e])}function xr(t){var e=this.__data__=new mr(t);this.size=e.size}function Sr(t,e){var n=Mh(t),r=!n&&yh(t),i=!n&&!r&&bh(t),o=!n&&!r&&!i&&Oh(t),s=n||r||i||o,h=s?yn(t.length,re):[],a=h.length;for(var l in t)!e&&!ue.call(t,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Vo(l,a))||h.push(l);return h}function Cr(t){var e=t.length;return e?t[bi(0,e-1)]:o}function Pr(t,e){return as(no(t),Fr(e,0,t.length))}function _r(t){return as(no(t))}function kr(t,e,n){(n===o||dh(t[e],n))&&(n!==o||e in t)||Dr(t,e,n)}function Ir(t,e,n){var r=t[e];ue.call(t,e)&&dh(r,n)&&(n!==o||e in t)||Dr(t,e,n)}function Br(t,e){for(var n=t.length;n--;)if(dh(t[n][0],e))return n;return-1}function Tr(t,e,n,r){return zr(t,(function(t,i,o){e(r,t,n(t),o)})),r}function Er(t,e){return t&&ro(e,ia(e),t)}function Dr(t,e,n){"__proto__"==e&&dn?dn(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Lr(t,e){for(var n=-1,i=e.length,s=r(i),h=null==t;++n<i;)s[n]=h?o:Qh(t,e[n]);return s}function Fr(t,e,n){return t==t&&(n!==o&&(t=t<=n?t:n),e!==o&&(t=t>=e?t:e)),t}function Rr(t,e,n,r,i,s){var h,a=e&p,l=e&d,u=e&f;if(n&&(h=i?n(t,r,i,s):n(t)),h!==o)return h;if(!kh(t))return t;var c=Mh(t);if(c){if(h=function(t){var e=t.length,n=new t.constructor(e);e&&"string"==typeof t[0]&&ue.call(t,"index")&&(n.index=t.index,n.input=t.input);return n}(t),!a)return no(t,h)}else{var g=Ho(t),y=g==$||g==Y;if(bh(t))return Xi(t,a);if(g==Q||g==N||y&&!i){if(h=l||y?{}:Ko(t),!a)return l?function(t,e){return ro(t,No(t),e)}(t,function(t,e){return t&&ro(e,oa(e),t)}(h,t)):function(t,e){return ro(t,jo(t),e)}(t,Er(h,t))}else{if(!ke[g])return i?t:{};h=function(t,e,n){var r=t.constructor;switch(e){case at:return Zi(t);case K:case G:return new r(+t);case lt:return function(t,e){var n=e?Zi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case ut:case ct:case pt:case dt:case ft:case gt:case yt:case Mt:case wt:return Ji(t,n);case X:return new r;case Z:case rt:return new r(t);case et:return function(t){var e=new t.constructor(t.source,Ut.exec(t));return e.lastIndex=t.lastIndex,e}(t);case nt:return new r;case it:return i=t,cr?ee(cr.call(i)):{}}var i}(t,g,a)}}s||(s=new xr);var M=s.get(t);if(M)return M;s.set(t,h),Lh(t)?t.forEach((function(r){h.add(Rr(r,e,n,r,t,s))})):Bh(t)&&t.forEach((function(r,i){h.set(i,Rr(r,e,n,i,t,s))}));var w=c?o:(u?l?Do:Eo:l?oa:ia)(t);return qe(w||t,(function(r,i){w&&(r=t[i=r]),Ir(h,i,Rr(r,e,n,i,t,s))})),h}function Or(t,e,n){var r=n.length;if(null==t)return!r;for(t=ee(t);r--;){var i=n[r],s=e[i],h=t[i];if(h===o&&!(i in t)||!s(h))return!1}return!0}function Ar(t,e,n){if("function"!=typeof t)throw new ie(a);return is((function(){t.apply(o,n)}),e)}function Wr(t,e,n,r){var i=-1,o=Ze,h=!0,a=t.length,l=[],u=e.length;if(!a)return l;n&&(e=Qe(e,Mn(n))),r?(o=Je,h=!1):e.length>=s&&(o=mn,h=!1,e=new br(e));t:for(;++i<a;){var c=t[i],p=null==n?c:n(c);if(c=r||0!==c?c:0,h&&p==p){for(var d=u;d--;)if(e[d]===p)continue t;l.push(c)}else o(e,p,r)||l.push(c)}return l}dr.templateSettings={escape:_t,evaluate:kt,interpolate:It,variable:"",imports:{_:dr}},dr.prototype=gr.prototype,dr.prototype.constructor=dr,yr.prototype=fr(gr.prototype),yr.prototype.constructor=yr,Mr.prototype=fr(gr.prototype),Mr.prototype.constructor=Mr,wr.prototype.clear=function(){this.__data__=nr?nr(null):{},this.size=0},wr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},wr.prototype.get=function(t){var e=this.__data__;if(nr){var n=e[t];return n===l?o:n}return ue.call(e,t)?e[t]:o},wr.prototype.has=function(t){var e=this.__data__;return nr?e[t]!==o:ue.call(e,t)},wr.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=nr&&e===o?l:e,this},mr.prototype.clear=function(){this.__data__=[],this.size=0},mr.prototype.delete=function(t){var e=this.__data__,n=Br(e,t);return!(n<0)&&(n==e.length-1?e.pop():Re.call(e,n,1),--this.size,!0)},mr.prototype.get=function(t){var e=this.__data__,n=Br(e,t);return n<0?o:e[n][1]},mr.prototype.has=function(t){return Br(this.__data__,t)>-1},mr.prototype.set=function(t,e){var n=this.__data__,r=Br(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},vr.prototype.clear=function(){this.size=0,this.__data__={hash:new wr,map:new(Jn||mr),string:new wr}},vr.prototype.delete=function(t){var e=Ao(this,t).delete(t);return this.size-=e?1:0,e},vr.prototype.get=function(t){return Ao(this,t).get(t)},vr.prototype.has=function(t){return Ao(this,t).has(t)},vr.prototype.set=function(t,e){var n=Ao(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},br.prototype.add=br.prototype.push=function(t){return this.__data__.set(t,l),this},br.prototype.has=function(t){return this.__data__.has(t)},xr.prototype.clear=function(){this.__data__=new mr,this.size=0},xr.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},xr.prototype.get=function(t){return this.__data__.get(t)},xr.prototype.has=function(t){return this.__data__.has(t)},xr.prototype.set=function(t,e){var n=this.__data__;if(n instanceof mr){var r=n.__data__;if(!Jn||r.length<s-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new vr(r)}return n.set(t,e),this.size=n.size,this};var zr=so(qr),jr=so($r,!0);function Nr(t,e){var n=!0;return zr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function Hr(t,e,n){for(var r=-1,i=t.length;++r<i;){var s=t[r],h=e(s);if(null!=h&&(a===o?h==h&&!Rh(h):n(h,a)))var a=h,l=s}return l}function Ur(t,e){var n=[];return zr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function Kr(t,e,n,r,i){var o=-1,s=t.length;for(n||(n=Go),i||(i=[]);++o<s;){var h=t[o];e>0&&n(h)?e>1?Kr(h,e-1,n,r,i):tn(i,h):r||(i[i.length]=h)}return i}var Gr=ho(),Vr=ho(!0);function qr(t,e){return t&&Gr(t,e,ia)}function $r(t,e){return t&&Vr(t,e,ia)}function Yr(t,e){return Xe(e,(function(e){return Ch(t[e])}))}function Xr(t,e){for(var n=0,r=(e=Vi(e,t)).length;null!=t&&n<r;)t=t[us(e[n++])];return n&&n==r?t:o}function Zr(t,e,n){var r=e(t);return Mh(t)?r:tn(r,n(t))}function Jr(t){return null==t?t===o?ot:J:on&&on in ee(t)?function(t){var e=ue.call(t,on),n=t[on];try{t[on]=o;var r=!0}catch(t){}var i=de.call(t);r&&(e?t[on]=n:delete t[on]);return i}(t):function(t){return de.call(t)}(t)}function Qr(t,e){return t>e}function ti(t,e){return null!=t&&ue.call(t,e)}function ei(t,e){return null!=t&&e in ee(t)}function ni(t,e,n){for(var i=n?Je:Ze,s=t[0].length,h=t.length,a=h,l=r(h),u=1/0,c=[];a--;){var p=t[a];a&&e&&(p=Qe(p,Mn(e))),u=Vn(p.length,u),l[a]=!n&&(e||s>=120&&p.length>=120)?new br(a&&p):o}p=t[0];var d=-1,f=l[0];t:for(;++d<s&&c.length<u;){var g=p[d],y=e?e(g):g;if(g=n||0!==g?g:0,!(f?mn(f,y):i(c,y,n))){for(a=h;--a;){var M=l[a];if(!(M?mn(M,y):i(t[a],y,n)))continue t}f&&f.push(y),c.push(g)}}return c}function ri(t,e,n){var r=null==(t=es(t,e=Vi(e,t)))?t:t[us(Ss(e))];return null==r?o:Ge(r,t,n)}function ii(t){return Ih(t)&&Jr(t)==N}function oi(t,e,n,r,i){return t===e||(null==t||null==e||!Ih(t)&&!Ih(e)?t!=t&&e!=e:function(t,e,n,r,i,s){var h=Mh(t),a=Mh(e),l=h?H:Ho(t),u=a?H:Ho(e),c=(l=l==N?Q:l)==Q,p=(u=u==N?Q:u)==Q,d=l==u;if(d&&bh(t)){if(!bh(e))return!1;h=!0,c=!1}if(d&&!c)return s||(s=new xr),h||Oh(t)?Bo(t,e,n,r,i,s):function(t,e,n,r,i,o,s){switch(n){case lt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case at:return!(t.byteLength!=e.byteLength||!o(new xe(t),new xe(e)));case K:case G:case Z:return dh(+t,+e);case q:return t.name==e.name&&t.message==e.message;case et:case rt:return t==e+"";case X:var h=_n;case nt:var a=r&g;if(h||(h=Bn),t.size!=e.size&&!a)return!1;var l=s.get(t);if(l)return l==e;r|=y,s.set(t,e);var u=Bo(h(t),h(e),r,i,o,s);return s.delete(t),u;case it:if(cr)return cr.call(t)==cr.call(e)}return!1}(t,e,l,n,r,i,s);if(!(n&g)){var f=c&&ue.call(t,"__wrapped__"),M=p&&ue.call(e,"__wrapped__");if(f||M){var w=f?t.value():t,m=M?e.value():e;return s||(s=new xr),i(w,m,n,r,s)}}if(!d)return!1;return s||(s=new xr),function(t,e,n,r,i,s){var h=n&g,a=Eo(t),l=a.length,u=Eo(e).length;if(l!=u&&!h)return!1;var c=l;for(;c--;){var p=a[c];if(!(h?p in e:ue.call(e,p)))return!1}var d=s.get(t);if(d&&s.get(e))return d==e;var f=!0;s.set(t,e),s.set(e,t);var y=h;for(;++c<l;){p=a[c];var M=t[p],w=e[p];if(r)var m=h?r(w,M,p,e,t,s):r(M,w,p,t,e,s);if(!(m===o?M===w||i(M,w,n,r,s):m)){f=!1;break}y||(y="constructor"==p)}if(f&&!y){var v=t.constructor,b=e.constructor;v!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b)&&(f=!1)}return s.delete(t),s.delete(e),f}(t,e,n,r,i,s)}(t,e,n,r,oi,i))}function si(t,e,n,r){var i=n.length,s=i,h=!r;if(null==t)return!s;for(t=ee(t);i--;){var a=n[i];if(h&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){var l=(a=n[i])[0],u=t[l],c=a[1];if(h&&a[2]){if(u===o&&!(l in t))return!1}else{var p=new xr;if(r)var d=r(u,c,l,t,e,p);if(!(d===o?oi(c,u,g|y,r,p):d))return!1}}return!0}function hi(t){return!(!kh(t)||(e=t,pe&&pe in e))&&(Ch(t)?ye:Vt).test(cs(t));var e}function ai(t){return"function"==typeof t?t:null==t?Ta:"object"==typeof t?Mh(t)?fi(t[0],t[1]):di(t):za(t)}function li(t){if(!Zo(t))return Kn(t);var e=[];for(var n in ee(t))ue.call(t,n)&&"constructor"!=n&&e.push(n);return e}function ui(t){if(!kh(t))return function(t){var e=[];if(null!=t)for(var n in ee(t))e.push(n);return e}(t);var e=Zo(t),n=[];for(var r in t)("constructor"!=r||!e&&ue.call(t,r))&&n.push(r);return n}function ci(t,e){return t<e}function pi(t,e){var n=-1,i=mh(t)?r(t.length):[];return zr(t,(function(t,r,o){i[++n]=e(t,r,o)})),i}function di(t){var e=Wo(t);return 1==e.length&&e[0][2]?Qo(e[0][0],e[0][1]):function(n){return n===t||si(n,t,e)}}function fi(t,e){return $o(t)&&Jo(e)?Qo(us(t),e):function(n){var r=Qh(n,t);return r===o&&r===e?ta(n,t):oi(e,r,g|y)}}function gi(t,e,n,r,i){t!==e&&Gr(e,(function(s,h){if(i||(i=new xr),kh(s))!function(t,e,n,r,i,s,h){var a=ns(t,n),l=ns(e,n),u=h.get(l);if(u)return void kr(t,n,u);var c=s?s(a,l,n+"",t,e,h):o,p=c===o;if(p){var d=Mh(l),f=!d&&bh(l),g=!d&&!f&&Oh(l);c=l,d||f||g?Mh(a)?c=a:vh(a)?c=no(a):f?(p=!1,c=Xi(l,!0)):g?(p=!1,c=Ji(l,!0)):c=[]:Eh(l)||yh(l)?(c=a,yh(a)?c=Kh(a):kh(a)&&!Ch(a)||(c=Ko(l))):p=!1}p&&(h.set(l,c),i(c,l,r,s,h),h.delete(l));kr(t,n,c)}(t,e,h,n,gi,r,i);else{var a=r?r(ns(t,h),s,h+"",t,e,i):o;a===o&&(a=s),kr(t,h,a)}}),oa)}function yi(t,e){var n=t.length;if(n)return Vo(e+=e<0?n:0,n)?t[e]:o}function Mi(t,e,n){var r=-1;return e=Qe(e.length?e:[Ta],Mn(Oo())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(pi(t,(function(t,n,i){return{criteria:Qe(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){var r=-1,i=t.criteria,o=e.criteria,s=i.length,h=n.length;for(;++r<s;){var a=Qi(i[r],o[r]);if(a){if(r>=h)return a;var l=n[r];return a*("desc"==l?-1:1)}}return t.index-e.index}(t,e,n)}))}function wi(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var s=e[r],h=Xr(t,s);n(h,s)&&_i(o,Vi(s,t),h)}return o}function mi(t,e,n,r){var i=r?ln:an,o=-1,s=e.length,h=t;for(t===e&&(e=no(e)),n&&(h=Qe(t,Mn(n)));++o<s;)for(var a=0,l=e[o],u=n?n(l):l;(a=i(h,u,a,r))>-1;)h!==t&&Re.call(h,a,1),Re.call(t,a,1);return t}function vi(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;Vo(i)?Re.call(t,i,1):Wi(t,i)}}return t}function bi(t,e){return t+zn(Yn()*(e-t+1))}function xi(t,e){var n="";if(!t||e<1||e>F)return n;do{e%2&&(n+=t),(e=zn(e/2))&&(t+=t)}while(e);return n}function Si(t,e){return os(ts(t,e,Ta),t+"")}function Ci(t){return Cr(da(t))}function Pi(t,e){var n=da(t);return as(n,Fr(e,0,n.length))}function _i(t,e,n,r){if(!kh(t))return t;for(var i=-1,s=(e=Vi(e,t)).length,h=s-1,a=t;null!=a&&++i<s;){var l=us(e[i]),u=n;if(i!=h){var c=a[l];(u=r?r(c,l,a):o)===o&&(u=kh(c)?c:Vo(e[i+1])?[]:{})}Ir(a,l,u),a=a[l]}return t}var ki=rr?function(t,e){return rr.set(t,e),t}:Ta,Ii=dn?function(t,e){return dn(t,"toString",{configurable:!0,enumerable:!1,value:ka(e),writable:!0})}:Ta;function Bi(t){return as(da(t))}function Ti(t,e,n){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var s=r(o);++i<o;)s[i]=t[i+e];return s}function Ei(t,e){var n;return zr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function Di(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=z){for(;r<i;){var o=r+i>>>1,s=t[o];null!==s&&!Rh(s)&&(n?s<=e:s<e)?r=o+1:i=o}return i}return Li(t,e,Ta,n)}function Li(t,e,n,r){e=n(e);for(var i=0,s=null==t?0:t.length,h=e!=e,a=null===e,l=Rh(e),u=e===o;i<s;){var c=zn((i+s)/2),p=n(t[c]),d=p!==o,f=null===p,g=p==p,y=Rh(p);if(h)var M=r||g;else M=u?g&&(r||d):a?g&&d&&(r||!f):l?g&&d&&!f&&(r||!y):!f&&!y&&(r?p<=e:p<e);M?i=c+1:s=c}return Vn(s,W)}function Fi(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var s=t[n],h=e?e(s):s;if(!n||!dh(h,a)){var a=h;o[i++]=0===s?0:s}}return o}function Ri(t){return"number"==typeof t?t:Rh(t)?O:+t}function Oi(t){if("string"==typeof t)return t;if(Mh(t))return Qe(t,Oi)+"";if(Rh(t))return pr?pr.call(t):"";var e=t+"";return"0"==e&&1/t==-L?"-0":e}function Ai(t,e,n){var r=-1,i=Ze,o=t.length,h=!0,a=[],l=a;if(n)h=!1,i=Je;else if(o>=s){var u=e?null:So(t);if(u)return Bn(u);h=!1,i=mn,l=new br}else l=e?[]:a;t:for(;++r<o;){var c=t[r],p=e?e(c):c;if(c=n||0!==c?c:0,h&&p==p){for(var d=l.length;d--;)if(l[d]===p)continue t;e&&l.push(p),a.push(c)}else i(l,p,n)||(l!==a&&l.push(p),a.push(c))}return a}function Wi(t,e){return null==(t=es(t,e=Vi(e,t)))||delete t[us(Ss(e))]}function zi(t,e,n,r){return _i(t,e,n(Xr(t,e)),r)}function ji(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?Ti(t,r?0:o,r?o+1:i):Ti(t,r?o+1:0,r?i:o)}function Ni(t,e){var n=t;return n instanceof Mr&&(n=n.value()),en(e,(function(t,e){return e.func.apply(e.thisArg,tn([t],e.args))}),n)}function Hi(t,e,n){var i=t.length;if(i<2)return i?Ai(t[0]):[];for(var o=-1,s=r(i);++o<i;)for(var h=t[o],a=-1;++a<i;)a!=o&&(s[o]=Wr(s[o]||h,t[a],e,n));return Ai(Kr(s,1),e,n)}function Ui(t,e,n){for(var r=-1,i=t.length,s=e.length,h={};++r<i;){var a=r<s?e[r]:o;n(h,t[r],a)}return h}function Ki(t){return vh(t)?t:[]}function Gi(t){return"function"==typeof t?t:Ta}function Vi(t,e){return Mh(t)?t:$o(t,e)?[t]:ls(Gh(t))}var qi=Si;function $i(t,e,n){var r=t.length;return n=n===o?r:n,!e&&n>=r?t:Ti(t,e,n)}var Yi=Rn||function(t){return Le.clearTimeout(t)};function Xi(t,e){if(e)return t.slice();var n=t.length,r=Ie?Ie(n):new t.constructor(n);return t.copy(r),r}function Zi(t){var e=new t.constructor(t.byteLength);return new xe(e).set(new xe(t)),e}function Ji(t,e){var n=e?Zi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Qi(t,e){if(t!==e){var n=t!==o,r=null===t,i=t==t,s=Rh(t),h=e!==o,a=null===e,l=e==e,u=Rh(e);if(!a&&!u&&!s&&t>e||s&&h&&l&&!a&&!u||r&&h&&l||!n&&l||!i)return 1;if(!r&&!s&&!u&&t<e||u&&n&&i&&!r&&!s||a&&n&&i||!h&&i||!l)return-1}return 0}function to(t,e,n,i){for(var o=-1,s=t.length,h=n.length,a=-1,l=e.length,u=Gn(s-h,0),c=r(l+u),p=!i;++a<l;)c[a]=e[a];for(;++o<h;)(p||o<s)&&(c[n[o]]=t[o]);for(;u--;)c[a++]=t[o++];return c}function eo(t,e,n,i){for(var o=-1,s=t.length,h=-1,a=n.length,l=-1,u=e.length,c=Gn(s-a,0),p=r(c+u),d=!i;++o<c;)p[o]=t[o];for(var f=o;++l<u;)p[f+l]=e[l];for(;++h<a;)(d||o<s)&&(p[f+n[h]]=t[o++]);return p}function no(t,e){var n=-1,i=t.length;for(e||(e=r(i));++n<i;)e[n]=t[n];return e}function ro(t,e,n,r){var i=!n;n||(n={});for(var s=-1,h=e.length;++s<h;){var a=e[s],l=r?r(n[a],t[a],a,n,t):o;l===o&&(l=t[a]),i?Dr(n,a,l):Ir(n,a,l)}return n}function io(t,e){return function(n,r){var i=Mh(n)?Ve:Tr,o=e?e():{};return i(n,t,Oo(r,2),o)}}function oo(t){return Si((function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:o,h=i>2?n[2]:o;for(s=t.length>3&&"function"==typeof s?(i--,s):o,h&&qo(n[0],n[1],h)&&(s=i<3?o:s,i=1),e=ee(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e}))}function so(t,e){return function(n,r){if(null==n)return n;if(!mh(n))return t(n,r);for(var i=n.length,o=e?i:-1,s=ee(n);(e?o--:++o<i)&&!1!==r(s[o],o,s););return n}}function ho(t){return function(e,n,r){for(var i=-1,o=ee(e),s=r(e),h=s.length;h--;){var a=s[t?h:++i];if(!1===n(o[a],a,o))break}return e}}function ao(t){return function(e){var n=Pn(e=Gh(e))?Dn(e):o,r=n?n[0]:e.charAt(0),i=n?$i(n,1).join(""):e.slice(1);return r[t]()+i}}function lo(t){return function(e){return en(Ca(ya(e).replace(we,"")),t,"")}}function uo(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=fr(t.prototype),r=t.apply(n,e);return kh(r)?r:n}}function co(t){return function(e,n,r){var i=ee(e);if(!mh(e)){var s=Oo(n,3);e=ia(e),n=function(t){return s(i[t],t,i)}}var h=t(e,n,r);return h>-1?i[s?e[h]:h]:o}}function po(t){return To((function(e){var n=e.length,r=n,i=yr.prototype.thru;for(t&&e.reverse();r--;){var s=e[r];if("function"!=typeof s)throw new ie(a);if(i&&!h&&"wrapper"==Fo(s))var h=new yr([],!0)}for(r=h?r:n;++r<n;){var l=Fo(s=e[r]),u="wrapper"==l?Lo(s):o;h=u&&Yo(u[0])&&u[1]==(C|v|x|P)&&!u[4].length&&1==u[9]?h[Fo(u[0])].apply(h,u[3]):1==s.length&&Yo(s)?h[l]():h.thru(s)}return function(){var t=arguments,r=t[0];if(h&&1==t.length&&Mh(r))return h.plant(r).value();for(var i=0,o=n?e[i].apply(this,t):r;++i<n;)o=e[i].call(this,o);return o}}))}function fo(t,e,n,i,s,h,a,l,u,c){var p=e&C,d=e&M,f=e&w,g=e&(v|b),y=e&_,m=f?o:uo(t);return function M(){for(var w=arguments.length,v=r(w),b=w;b--;)v[b]=arguments[b];if(g)var x=Ro(M),S=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(v,x);if(i&&(v=to(v,i,s,g)),h&&(v=eo(v,h,a,g)),w-=S,g&&w<c){var C=In(v,x);return bo(t,e,fo,M.placeholder,n,v,C,l,u,c-w)}var P=d?n:this,_=f?P[t]:t;return w=v.length,l?v=function(t,e){var n=t.length,r=Vn(e.length,n),i=no(t);for(;r--;){var s=e[r];t[r]=Vo(s,n)?i[s]:o}return t}(v,l):y&&w>1&&v.reverse(),p&&u<w&&(v.length=u),this&&this!==Le&&this instanceof M&&(_=m||uo(_)),_.apply(P,v)}}function go(t,e){return function(n,r){return function(t,e,n,r){return qr(t,(function(t,i,o){e(r,n(t),i,o)})),r}(n,t,e(r),{})}}function yo(t,e){return function(n,r){var i;if(n===o&&r===o)return e;if(n!==o&&(i=n),r!==o){if(i===o)return r;"string"==typeof n||"string"==typeof r?(n=Oi(n),r=Oi(r)):(n=Ri(n),r=Ri(r)),i=t(n,r)}return i}}function Mo(t){return To((function(e){return e=Qe(e,Mn(Oo())),Si((function(n){var r=this;return t(e,(function(t){return Ge(t,r,n)}))}))}))}function wo(t,e){var n=(e=e===o?" ":Oi(e)).length;if(n<2)return n?xi(e,t):e;var r=xi(e,Wn(t/En(e)));return Pn(e)?$i(Dn(r),0,t).join(""):r.slice(0,t)}function mo(t){return function(e,n,i){return i&&"number"!=typeof i&&qo(e,n,i)&&(n=i=o),e=jh(e),n===o?(n=e,e=0):n=jh(n),function(t,e,n,i){for(var o=-1,s=Gn(Wn((e-t)/(n||1)),0),h=r(s);s--;)h[i?s:++o]=t,t+=n;return h}(e,n,i=i===o?e<n?1:-1:jh(i),t)}}function vo(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=Uh(e),n=Uh(n)),t(e,n)}}function bo(t,e,n,r,i,s,h,a,l,u){var c=e&v;e|=c?x:S,(e&=~(c?S:x))&m||(e&=~(M|w));var p=[t,e,i,c?s:o,c?h:o,c?o:s,c?o:h,a,l,u],d=n.apply(o,p);return Yo(t)&&rs(d,p),d.placeholder=r,ss(d,t,e)}function xo(t){var e=te[t];return function(t,n){if(t=Uh(t),(n=null==n?0:Vn(Nh(n),292))&&Hn(t)){var r=(Gh(t)+"e").split("e");return+((r=(Gh(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var So=tr&&1/Bn(new tr([,-0]))[1]==L?function(t){return new tr(t)}:Ra;function Co(t){return function(e){var n=Ho(e);return n==X?_n(e):n==nt?Tn(e):function(t,e){return Qe(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Po(t,e,n,i,s,h,l,u){var p=e&w;if(!p&&"function"!=typeof t)throw new ie(a);var d=i?i.length:0;if(d||(e&=~(x|S),i=s=o),l=l===o?l:Gn(Nh(l),0),u=u===o?u:Nh(u),d-=s?s.length:0,e&S){var f=i,g=s;i=s=o}var y=p?o:Lo(t),_=[t,e,n,i,s,f,g,h,l,u];if(y&&function(t,e){var n=t[1],r=e[1],i=n|r,o=i<(M|w|C),s=r==C&&n==v||r==C&&n==P&&t[7].length<=e[8]||r==(C|P)&&e[7].length<=e[8]&&n==v;if(!o&&!s)return t;r&M&&(t[2]=e[2],i|=n&M?0:m);var h=e[3];if(h){var a=t[3];t[3]=a?to(a,h,e[4]):h,t[4]=a?In(t[3],c):e[4]}(h=e[5])&&(a=t[5],t[5]=a?eo(a,h,e[6]):h,t[6]=a?In(t[5],c):e[6]);(h=e[7])&&(t[7]=h);r&C&&(t[8]=null==t[8]?e[8]:Vn(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=i}(_,y),t=_[0],e=_[1],n=_[2],i=_[3],s=_[4],!(u=_[9]=_[9]===o?p?0:t.length:Gn(_[9]-d,0))&&e&(v|b)&&(e&=~(v|b)),e&&e!=M)k=e==v||e==b?function(t,e,n){var i=uo(t);return function s(){for(var h=arguments.length,a=r(h),l=h,u=Ro(s);l--;)a[l]=arguments[l];var c=h<3&&a[0]!==u&&a[h-1]!==u?[]:In(a,u);return(h-=c.length)<n?bo(t,e,fo,s.placeholder,o,a,c,o,o,n-h):Ge(this&&this!==Le&&this instanceof s?i:t,this,a)}}(t,e,u):e!=x&&e!=(M|x)||s.length?fo.apply(o,_):function(t,e,n,i){var o=e&M,s=uo(t);return function e(){for(var h=-1,a=arguments.length,l=-1,u=i.length,c=r(u+a),p=this&&this!==Le&&this instanceof e?s:t;++l<u;)c[l]=i[l];for(;a--;)c[l++]=arguments[++h];return Ge(p,o?n:this,c)}}(t,e,n,i);else var k=function(t,e,n){var r=e&M,i=uo(t);return function e(){return(this&&this!==Le&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return ss((y?ki:rs)(k,_),t,e)}function _o(t,e,n,r){return t===o||dh(t,he[n])&&!ue.call(r,n)?e:t}function ko(t,e,n,r,i,s){return kh(t)&&kh(e)&&(s.set(e,t),gi(t,e,o,ko,s),s.delete(e)),t}function Io(t){return Eh(t)?o:t}function Bo(t,e,n,r,i,s){var h=n&g,a=t.length,l=e.length;if(a!=l&&!(h&&l>a))return!1;var u=s.get(t);if(u&&s.get(e))return u==e;var c=-1,p=!0,d=n&y?new br:o;for(s.set(t,e),s.set(e,t);++c<a;){var f=t[c],M=e[c];if(r)var w=h?r(M,f,c,e,t,s):r(f,M,c,t,e,s);if(w!==o){if(w)continue;p=!1;break}if(d){if(!rn(e,(function(t,e){if(!mn(d,e)&&(f===t||i(f,t,n,r,s)))return d.push(e)}))){p=!1;break}}else if(f!==M&&!i(f,M,n,r,s)){p=!1;break}}return s.delete(t),s.delete(e),p}function To(t){return os(ts(t,o,ws),t+"")}function Eo(t){return Zr(t,ia,jo)}function Do(t){return Zr(t,oa,No)}var Lo=rr?function(t){return rr.get(t)}:Ra;function Fo(t){for(var e=t.name+"",n=ir[e],r=ue.call(ir,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function Ro(t){return(ue.call(dr,"placeholder")?dr:t).placeholder}function Oo(){var t=dr.iteratee||Ea;return t=t===Ea?ai:t,arguments.length?t(arguments[0],arguments[1]):t}function Ao(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Wo(t){for(var e=ia(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Jo(i)]}return e}function zo(t,e){var n=function(t,e){return null==t?o:t[e]}(t,e);return hi(n)?n:o}var jo=jn?function(t){return null==t?[]:(t=ee(t),Xe(jn(t),(function(e){return Fe.call(t,e)})))}:Ha,No=jn?function(t){for(var e=[];t;)tn(e,jo(t)),t=Ee(t);return e}:Ha,Ho=Jr;function Uo(t,e,n){for(var r=-1,i=(e=Vi(e,t)).length,o=!1;++r<i;){var s=us(e[r]);if(!(o=null!=t&&n(t,s)))break;t=t[s]}return o||++r!=i?o:!!(i=null==t?0:t.length)&&_h(i)&&Vo(s,i)&&(Mh(t)||yh(t))}function Ko(t){return"function"!=typeof t.constructor||Zo(t)?{}:fr(Ee(t))}function Go(t){return Mh(t)||yh(t)||!!(Ae&&t&&t[Ae])}function Vo(t,e){var n=typeof t;return!!(e=null==e?F:e)&&("number"==n||"symbol"!=n&&$t.test(t))&&t>-1&&t%1==0&&t<e}function qo(t,e,n){if(!kh(n))return!1;var r=typeof e;return!!("number"==r?mh(n)&&Vo(e,n.length):"string"==r&&e in n)&&dh(n[e],t)}function $o(t,e){if(Mh(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Rh(t))||(Tt.test(t)||!Bt.test(t)||null!=e&&t in ee(e))}function Yo(t){var e=Fo(t),n=dr[e];if("function"!=typeof n||!(e in Mr.prototype))return!1;if(t===n)return!0;var r=Lo(n);return!!r&&t===r[0]}(Zn&&Ho(new Zn(new ArrayBuffer(1)))!=lt||Jn&&Ho(new Jn)!=X||Qn&&"[object Promise]"!=Ho(Qn.resolve())||tr&&Ho(new tr)!=nt||er&&Ho(new er)!=st)&&(Ho=function(t){var e=Jr(t),n=e==Q?t.constructor:o,r=n?cs(n):"";if(r)switch(r){case or:return lt;case sr:return X;case hr:return"[object Promise]";case ar:return nt;case lr:return st}return e});var Xo=ae?Ch:Ua;function Zo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||he)}function Jo(t){return t==t&&!kh(t)}function Qo(t,e){return function(n){return null!=n&&(n[t]===e&&(e!==o||t in ee(n)))}}function ts(t,e,n){return e=Gn(e===o?t.length-1:e,0),function(){for(var i=arguments,o=-1,s=Gn(i.length-e,0),h=r(s);++o<s;)h[o]=i[e+o];o=-1;for(var a=r(e+1);++o<e;)a[o]=i[o];return a[e]=n(h),Ge(t,this,a)}}function es(t,e){return e.length<2?t:Xr(t,Ti(e,0,-1))}function ns(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var rs=hs(ki),is=An||function(t,e){return Le.setTimeout(t,e)},os=hs(Ii);function ss(t,e,n){var r=e+"";return os(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(At,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return qe(j,(function(n){var r="_."+n[0];e&n[1]&&!Ze(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(Wt);return e?e[1].split(zt):[]}(r),n)))}function hs(t){var e=0,n=0;return function(){var r=qn(),i=T-(r-n);if(n=r,i>0){if(++e>=B)return arguments[0]}else e=0;return t.apply(o,arguments)}}function as(t,e){var n=-1,r=t.length,i=r-1;for(e=e===o?r:e;++n<e;){var s=bi(n,i),h=t[s];t[s]=t[n],t[n]=h}return t.length=e,t}var ls=function(t){var e=hh(t,(function(t){return n.size===u&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Et,(function(t,n,r,i){e.push(r?i.replace(Nt,"$1"):n||t)})),e}));function us(t){if("string"==typeof t||Rh(t))return t;var e=t+"";return"0"==e&&1/t==-L?"-0":e}function cs(t){if(null!=t){try{return le.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function ps(t){if(t instanceof Mr)return t.clone();var e=new yr(t.__wrapped__,t.__chain__);return e.__actions__=no(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var ds=Si((function(t,e){return vh(t)?Wr(t,Kr(e,1,vh,!0)):[]})),fs=Si((function(t,e){var n=Ss(e);return vh(n)&&(n=o),vh(t)?Wr(t,Kr(e,1,vh,!0),Oo(n,2)):[]})),gs=Si((function(t,e){var n=Ss(e);return vh(n)&&(n=o),vh(t)?Wr(t,Kr(e,1,vh,!0),o,n):[]}));function ys(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Nh(n);return i<0&&(i=Gn(r+i,0)),hn(t,Oo(e,3),i)}function Ms(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return n!==o&&(i=Nh(n),i=n<0?Gn(r+i,0):Vn(i,r-1)),hn(t,Oo(e,3),i,!0)}function ws(t){return(null==t?0:t.length)?Kr(t,1):[]}function ms(t){return t&&t.length?t[0]:o}var vs=Si((function(t){var e=Qe(t,Ki);return e.length&&e[0]===t[0]?ni(e):[]})),bs=Si((function(t){var e=Ss(t),n=Qe(t,Ki);return e===Ss(n)?e=o:n.pop(),n.length&&n[0]===t[0]?ni(n,Oo(e,2)):[]})),xs=Si((function(t){var e=Ss(t),n=Qe(t,Ki);return(e="function"==typeof e?e:o)&&n.pop(),n.length&&n[0]===t[0]?ni(n,o,e):[]}));function Ss(t){var e=null==t?0:t.length;return e?t[e-1]:o}var Cs=Si(Ps);function Ps(t,e){return t&&t.length&&e&&e.length?mi(t,e):t}var _s=To((function(t,e){var n=null==t?0:t.length,r=Lr(t,e);return vi(t,Qe(e,(function(t){return Vo(t,n)?+t:t})).sort(Qi)),r}));function ks(t){return null==t?t:Xn.call(t)}var Is=Si((function(t){return Ai(Kr(t,1,vh,!0))})),Bs=Si((function(t){var e=Ss(t);return vh(e)&&(e=o),Ai(Kr(t,1,vh,!0),Oo(e,2))})),Ts=Si((function(t){var e=Ss(t);return e="function"==typeof e?e:o,Ai(Kr(t,1,vh,!0),o,e)}));function Es(t){if(!t||!t.length)return[];var e=0;return t=Xe(t,(function(t){if(vh(t))return e=Gn(t.length,e),!0})),yn(e,(function(e){return Qe(t,pn(e))}))}function Ds(t,e){if(!t||!t.length)return[];var n=Es(t);return null==e?n:Qe(n,(function(t){return Ge(e,o,t)}))}var Ls=Si((function(t,e){return vh(t)?Wr(t,e):[]})),Fs=Si((function(t){return Hi(Xe(t,vh))})),Rs=Si((function(t){var e=Ss(t);return vh(e)&&(e=o),Hi(Xe(t,vh),Oo(e,2))})),Os=Si((function(t){var e=Ss(t);return e="function"==typeof e?e:o,Hi(Xe(t,vh),o,e)})),As=Si(Es);var Ws=Si((function(t){var e=t.length,n=e>1?t[e-1]:o;return n="function"==typeof n?(t.pop(),n):o,Ds(t,n)}));function zs(t){var e=dr(t);return e.__chain__=!0,e}function js(t,e){return e(t)}var Ns=To((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return Lr(e,t)};return!(e>1||this.__actions__.length)&&r instanceof Mr&&Vo(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:js,args:[i],thisArg:o}),new yr(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(o),t}))):this.thru(i)}));var Hs=io((function(t,e,n){ue.call(t,n)?++t[n]:Dr(t,n,1)}));var Us=co(ys),Ks=co(Ms);function Gs(t,e){return(Mh(t)?qe:zr)(t,Oo(e,3))}function Vs(t,e){return(Mh(t)?$e:jr)(t,Oo(e,3))}var qs=io((function(t,e,n){ue.call(t,n)?t[n].push(e):Dr(t,n,[e])}));var $s=Si((function(t,e,n){var i=-1,o="function"==typeof e,s=mh(t)?r(t.length):[];return zr(t,(function(t){s[++i]=o?Ge(e,t,n):ri(t,e,n)})),s})),Ys=io((function(t,e,n){Dr(t,n,e)}));function Xs(t,e){return(Mh(t)?Qe:pi)(t,Oo(e,3))}var Zs=io((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));var Js=Si((function(t,e){if(null==t)return[];var n=e.length;return n>1&&qo(t,e[0],e[1])?e=[]:n>2&&qo(e[0],e[1],e[2])&&(e=[e[0]]),Mi(t,Kr(e,1),[])})),Qs=On||function(){return Le.Date.now()};function th(t,e,n){return e=n?o:e,e=t&&null==e?t.length:e,Po(t,C,o,o,o,o,e)}function eh(t,e){var n;if("function"!=typeof e)throw new ie(a);return t=Nh(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=o),n}}var nh=Si((function(t,e,n){var r=M;if(n.length){var i=In(n,Ro(nh));r|=x}return Po(t,r,e,n,i)})),rh=Si((function(t,e,n){var r=M|w;if(n.length){var i=In(n,Ro(rh));r|=x}return Po(e,r,t,n,i)}));function ih(t,e,n){var r,i,s,h,l,u,c=0,p=!1,d=!1,f=!0;if("function"!=typeof t)throw new ie(a);function g(e){var n=r,s=i;return r=i=o,c=e,h=t.apply(s,n)}function y(t){var n=t-u;return u===o||n>=e||n<0||d&&t-c>=s}function M(){var t=Qs();if(y(t))return w(t);l=is(M,function(t){var n=e-(t-u);return d?Vn(n,s-(t-c)):n}(t))}function w(t){return l=o,f&&r?g(t):(r=i=o,h)}function m(){var t=Qs(),n=y(t);if(r=arguments,i=this,u=t,n){if(l===o)return function(t){return c=t,l=is(M,e),p?g(t):h}(u);if(d)return Yi(l),l=is(M,e),g(u)}return l===o&&(l=is(M,e)),h}return e=Uh(e)||0,kh(n)&&(p=!!n.leading,s=(d="maxWait"in n)?Gn(Uh(n.maxWait)||0,e):s,f="trailing"in n?!!n.trailing:f),m.cancel=function(){l!==o&&Yi(l),c=0,r=u=i=l=o},m.flush=function(){return l===o?h:w(Qs())},m}var oh=Si((function(t,e){return Ar(t,1,e)})),sh=Si((function(t,e,n){return Ar(t,Uh(e)||0,n)}));function hh(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new ie(a);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=t.apply(this,r);return n.cache=o.set(i,s)||o,s};return n.cache=new(hh.Cache||vr),n}function ah(t){if("function"!=typeof t)throw new ie(a);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}hh.Cache=vr;var lh=qi((function(t,e){var n=(e=1==e.length&&Mh(e[0])?Qe(e[0],Mn(Oo())):Qe(Kr(e,1),Mn(Oo()))).length;return Si((function(r){for(var i=-1,o=Vn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return Ge(t,this,r)}))})),uh=Si((function(t,e){var n=In(e,Ro(uh));return Po(t,x,o,e,n)})),ch=Si((function(t,e){var n=In(e,Ro(ch));return Po(t,S,o,e,n)})),ph=To((function(t,e){return Po(t,P,o,o,o,e)}));function dh(t,e){return t===e||t!=t&&e!=e}var fh=vo(Qr),gh=vo((function(t,e){return t>=e})),yh=ii(function(){return arguments}())?ii:function(t){return Ih(t)&&ue.call(t,"callee")&&!Fe.call(t,"callee")},Mh=r.isArray,wh=ze?Mn(ze):function(t){return Ih(t)&&Jr(t)==at};function mh(t){return null!=t&&_h(t.length)&&!Ch(t)}function vh(t){return Ih(t)&&mh(t)}var bh=Nn||Ua,xh=je?Mn(je):function(t){return Ih(t)&&Jr(t)==G};function Sh(t){if(!Ih(t))return!1;var e=Jr(t);return e==q||e==V||"string"==typeof t.message&&"string"==typeof t.name&&!Eh(t)}function Ch(t){if(!kh(t))return!1;var e=Jr(t);return e==$||e==Y||e==U||e==tt}function Ph(t){return"number"==typeof t&&t==Nh(t)}function _h(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=F}function kh(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Ih(t){return null!=t&&"object"==typeof t}var Bh=Ne?Mn(Ne):function(t){return Ih(t)&&Ho(t)==X};function Th(t){return"number"==typeof t||Ih(t)&&Jr(t)==Z}function Eh(t){if(!Ih(t)||Jr(t)!=Q)return!1;var e=Ee(t);if(null===e)return!0;var n=ue.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&le.call(n)==fe}var Dh=He?Mn(He):function(t){return Ih(t)&&Jr(t)==et};var Lh=Ue?Mn(Ue):function(t){return Ih(t)&&Ho(t)==nt};function Fh(t){return"string"==typeof t||!Mh(t)&&Ih(t)&&Jr(t)==rt}function Rh(t){return"symbol"==typeof t||Ih(t)&&Jr(t)==it}var Oh=Ke?Mn(Ke):function(t){return Ih(t)&&_h(t.length)&&!!_e[Jr(t)]};var Ah=vo(ci),Wh=vo((function(t,e){return t<=e}));function zh(t){if(!t)return[];if(mh(t))return Fh(t)?Dn(t):no(t);if(We&&t[We])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[We]());var e=Ho(t);return(e==X?_n:e==nt?Bn:da)(t)}function jh(t){return t?(t=Uh(t))===L||t===-L?(t<0?-1:1)*R:t==t?t:0:0===t?t:0}function Nh(t){var e=jh(t),n=e%1;return e==e?n?e-n:e:0}function Hh(t){return t?Fr(Nh(t),0,A):0}function Uh(t){if("number"==typeof t)return t;if(Rh(t))return O;if(kh(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=kh(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Ft,"");var n=Gt.test(t);return n||qt.test(t)?Te(t.slice(2),n?2:8):Kt.test(t)?O:+t}function Kh(t){return ro(t,oa(t))}function Gh(t){return null==t?"":Oi(t)}var Vh=oo((function(t,e){if(Zo(e)||mh(e))ro(e,ia(e),t);else for(var n in e)ue.call(e,n)&&Ir(t,n,e[n])})),qh=oo((function(t,e){ro(e,oa(e),t)})),$h=oo((function(t,e,n,r){ro(e,oa(e),t,r)})),Yh=oo((function(t,e,n,r){ro(e,ia(e),t,r)})),Xh=To(Lr);var Zh=Si((function(t,e){t=ee(t);var n=-1,r=e.length,i=r>2?e[2]:o;for(i&&qo(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],h=oa(s),a=-1,l=h.length;++a<l;){var u=h[a],c=t[u];(c===o||dh(c,he[u])&&!ue.call(t,u))&&(t[u]=s[u])}return t})),Jh=Si((function(t){return t.push(o,ko),Ge(ha,o,t)}));function Qh(t,e,n){var r=null==t?o:Xr(t,e);return r===o?n:r}function ta(t,e){return null!=t&&Uo(t,e,ei)}var ea=go((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=de.call(e)),t[e]=n}),ka(Ta)),na=go((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=de.call(e)),ue.call(t,e)?t[e].push(n):t[e]=[n]}),Oo),ra=Si(ri);function ia(t){return mh(t)?Sr(t):li(t)}function oa(t){return mh(t)?Sr(t,!0):ui(t)}var sa=oo((function(t,e,n){gi(t,e,n)})),ha=oo((function(t,e,n,r){gi(t,e,n,r)})),aa=To((function(t,e){var n={};if(null==t)return n;var r=!1;e=Qe(e,(function(e){return e=Vi(e,t),r||(r=e.length>1),e})),ro(t,Do(t),n),r&&(n=Rr(n,p|d|f,Io));for(var i=e.length;i--;)Wi(n,e[i]);return n}));var la=To((function(t,e){return null==t?{}:function(t,e){return wi(t,e,(function(e,n){return ta(t,n)}))}(t,e)}));function ua(t,e){if(null==t)return{};var n=Qe(Do(t),(function(t){return[t]}));return e=Oo(e),wi(t,n,(function(t,n){return e(t,n[0])}))}var ca=Co(ia),pa=Co(oa);function da(t){return null==t?[]:wn(t,ia(t))}var fa=lo((function(t,e,n){return e=e.toLowerCase(),t+(n?ga(e):e)}));function ga(t){return Sa(Gh(t).toLowerCase())}function ya(t){return(t=Gh(t))&&t.replace(Yt,xn).replace(me,"")}var Ma=lo((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),wa=lo((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),ma=ao("toLowerCase");var va=lo((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));var ba=lo((function(t,e,n){return t+(n?" ":"")+Sa(e)}));var xa=lo((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Sa=ao("toUpperCase");function Ca(t,e,n){return t=Gh(t),(e=n?o:e)===o?function(t){return Se.test(t)}(t)?function(t){return t.match(be)||[]}(t):function(t){return t.match(jt)||[]}(t):t.match(e)||[]}var Pa=Si((function(t,e){try{return Ge(t,o,e)}catch(t){return Sh(t)?t:new Jt(t)}})),_a=To((function(t,e){return qe(e,(function(e){e=us(e),Dr(t,e,nh(t[e],t))})),t}));function ka(t){return function(){return t}}var Ia=po(),Ba=po(!0);function Ta(t){return t}function Ea(t){return ai("function"==typeof t?t:Rr(t,p))}var Da=Si((function(t,e){return function(n){return ri(n,t,e)}})),La=Si((function(t,e){return function(n){return ri(t,n,e)}}));function Fa(t,e,n){var r=ia(e),i=Yr(e,r);null!=n||kh(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Yr(e,ia(e)));var o=!(kh(n)&&"chain"in n&&!n.chain),s=Ch(t);return qe(i,(function(n){var r=e[n];t[n]=r,s&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__),i=n.__actions__=no(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,tn([this.value()],arguments))})})),t}function Ra(){}var Oa=Mo(Qe),Aa=Mo(Ye),Wa=Mo(rn);function za(t){return $o(t)?pn(us(t)):function(t){return function(e){return Xr(e,t)}}(t)}var ja=mo(),Na=mo(!0);function Ha(){return[]}function Ua(){return!1}var Ka=yo((function(t,e){return t+e}),0),Ga=xo("ceil"),Va=yo((function(t,e){return t/e}),1),qa=xo("floor");var $a,Ya=yo((function(t,e){return t*e}),1),Xa=xo("round"),Za=yo((function(t,e){return t-e}),0);return dr.after=function(t,e){if("function"!=typeof e)throw new ie(a);return t=Nh(t),function(){if(--t<1)return e.apply(this,arguments)}},dr.ary=th,dr.assign=Vh,dr.assignIn=qh,dr.assignInWith=$h,dr.assignWith=Yh,dr.at=Xh,dr.before=eh,dr.bind=nh,dr.bindAll=_a,dr.bindKey=rh,dr.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Mh(t)?t:[t]},dr.chain=zs,dr.chunk=function(t,e,n){e=(n?qo(t,e,n):e===o)?1:Gn(Nh(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];for(var s=0,h=0,a=r(Wn(i/e));s<i;)a[h++]=Ti(t,s,s+=e);return a},dr.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o)}return i},dr.concat=function(){var t=arguments.length;if(!t)return[];for(var e=r(t-1),n=arguments[0],i=t;i--;)e[i-1]=arguments[i];return tn(Mh(n)?no(n):[n],Kr(e,1))},dr.cond=function(t){var e=null==t?0:t.length,n=Oo();return t=e?Qe(t,(function(t){if("function"!=typeof t[1])throw new ie(a);return[n(t[0]),t[1]]})):[],Si((function(n){for(var r=-1;++r<e;){var i=t[r];if(Ge(i[0],this,n))return Ge(i[1],this,n)}}))},dr.conforms=function(t){return function(t){var e=ia(t);return function(n){return Or(n,t,e)}}(Rr(t,p))},dr.constant=ka,dr.countBy=Hs,dr.create=function(t,e){var n=fr(t);return null==e?n:Er(n,e)},dr.curry=function t(e,n,r){var i=Po(e,v,o,o,o,o,o,n=r?o:n);return i.placeholder=t.placeholder,i},dr.curryRight=function t(e,n,r){var i=Po(e,b,o,o,o,o,o,n=r?o:n);return i.placeholder=t.placeholder,i},dr.debounce=ih,dr.defaults=Zh,dr.defaultsDeep=Jh,dr.defer=oh,dr.delay=sh,dr.difference=ds,dr.differenceBy=fs,dr.differenceWith=gs,dr.drop=function(t,e,n){var r=null==t?0:t.length;return r?Ti(t,(e=n||e===o?1:Nh(e))<0?0:e,r):[]},dr.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?Ti(t,0,(e=r-(e=n||e===o?1:Nh(e)))<0?0:e):[]},dr.dropRightWhile=function(t,e){return t&&t.length?ji(t,Oo(e,3),!0,!0):[]},dr.dropWhile=function(t,e){return t&&t.length?ji(t,Oo(e,3),!0):[]},dr.fill=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&qo(t,e,n)&&(n=0,r=i),function(t,e,n,r){var i=t.length;for((n=Nh(n))<0&&(n=-n>i?0:i+n),(r=r===o||r>i?i:Nh(r))<0&&(r+=i),r=n>r?0:Hh(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},dr.filter=function(t,e){return(Mh(t)?Xe:Ur)(t,Oo(e,3))},dr.flatMap=function(t,e){return Kr(Xs(t,e),1)},dr.flatMapDeep=function(t,e){return Kr(Xs(t,e),L)},dr.flatMapDepth=function(t,e,n){return n=n===o?1:Nh(n),Kr(Xs(t,e),n)},dr.flatten=ws,dr.flattenDeep=function(t){return(null==t?0:t.length)?Kr(t,L):[]},dr.flattenDepth=function(t,e){return(null==t?0:t.length)?Kr(t,e=e===o?1:Nh(e)):[]},dr.flip=function(t){return Po(t,_)},dr.flow=Ia,dr.flowRight=Ba,dr.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},dr.functions=function(t){return null==t?[]:Yr(t,ia(t))},dr.functionsIn=function(t){return null==t?[]:Yr(t,oa(t))},dr.groupBy=qs,dr.initial=function(t){return(null==t?0:t.length)?Ti(t,0,-1):[]},dr.intersection=vs,dr.intersectionBy=bs,dr.intersectionWith=xs,dr.invert=ea,dr.invertBy=na,dr.invokeMap=$s,dr.iteratee=Ea,dr.keyBy=Ys,dr.keys=ia,dr.keysIn=oa,dr.map=Xs,dr.mapKeys=function(t,e){var n={};return e=Oo(e,3),qr(t,(function(t,r,i){Dr(n,e(t,r,i),t)})),n},dr.mapValues=function(t,e){var n={};return e=Oo(e,3),qr(t,(function(t,r,i){Dr(n,r,e(t,r,i))})),n},dr.matches=function(t){return di(Rr(t,p))},dr.matchesProperty=function(t,e){return fi(t,Rr(e,p))},dr.memoize=hh,dr.merge=sa,dr.mergeWith=ha,dr.method=Da,dr.methodOf=La,dr.mixin=Fa,dr.negate=ah,dr.nthArg=function(t){return t=Nh(t),Si((function(e){return yi(e,t)}))},dr.omit=aa,dr.omitBy=function(t,e){return ua(t,ah(Oo(e)))},dr.once=function(t){return eh(2,t)},dr.orderBy=function(t,e,n,r){return null==t?[]:(Mh(e)||(e=null==e?[]:[e]),Mh(n=r?o:n)||(n=null==n?[]:[n]),Mi(t,e,n))},dr.over=Oa,dr.overArgs=lh,dr.overEvery=Aa,dr.overSome=Wa,dr.partial=uh,dr.partialRight=ch,dr.partition=Zs,dr.pick=la,dr.pickBy=ua,dr.property=za,dr.propertyOf=function(t){return function(e){return null==t?o:Xr(t,e)}},dr.pull=Cs,dr.pullAll=Ps,dr.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?mi(t,e,Oo(n,2)):t},dr.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?mi(t,e,o,n):t},dr.pullAt=_s,dr.range=ja,dr.rangeRight=Na,dr.rearg=ph,dr.reject=function(t,e){return(Mh(t)?Xe:Ur)(t,ah(Oo(e,3)))},dr.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=Oo(e,3);++r<o;){var s=t[r];e(s,r,t)&&(n.push(s),i.push(r))}return vi(t,i),n},dr.rest=function(t,e){if("function"!=typeof t)throw new ie(a);return Si(t,e=e===o?e:Nh(e))},dr.reverse=ks,dr.sampleSize=function(t,e,n){return e=(n?qo(t,e,n):e===o)?1:Nh(e),(Mh(t)?Pr:Pi)(t,e)},dr.set=function(t,e,n){return null==t?t:_i(t,e,n)},dr.setWith=function(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:_i(t,e,n,r)},dr.shuffle=function(t){return(Mh(t)?_r:Bi)(t)},dr.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&qo(t,e,n)?(e=0,n=r):(e=null==e?0:Nh(e),n=n===o?r:Nh(n)),Ti(t,e,n)):[]},dr.sortBy=Js,dr.sortedUniq=function(t){return t&&t.length?Fi(t):[]},dr.sortedUniqBy=function(t,e){return t&&t.length?Fi(t,Oo(e,2)):[]},dr.split=function(t,e,n){return n&&"number"!=typeof n&&qo(t,e,n)&&(e=n=o),(n=n===o?A:n>>>0)?(t=Gh(t))&&("string"==typeof e||null!=e&&!Dh(e))&&!(e=Oi(e))&&Pn(t)?$i(Dn(t),0,n):t.split(e,n):[]},dr.spread=function(t,e){if("function"!=typeof t)throw new ie(a);return e=null==e?0:Gn(Nh(e),0),Si((function(n){var r=n[e],i=$i(n,0,e);return r&&tn(i,r),Ge(t,this,i)}))},dr.tail=function(t){var e=null==t?0:t.length;return e?Ti(t,1,e):[]},dr.take=function(t,e,n){return t&&t.length?Ti(t,0,(e=n||e===o?1:Nh(e))<0?0:e):[]},dr.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?Ti(t,(e=r-(e=n||e===o?1:Nh(e)))<0?0:e,r):[]},dr.takeRightWhile=function(t,e){return t&&t.length?ji(t,Oo(e,3),!1,!0):[]},dr.takeWhile=function(t,e){return t&&t.length?ji(t,Oo(e,3)):[]},dr.tap=function(t,e){return e(t),t},dr.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new ie(a);return kh(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),ih(t,e,{leading:r,maxWait:e,trailing:i})},dr.thru=js,dr.toArray=zh,dr.toPairs=ca,dr.toPairsIn=pa,dr.toPath=function(t){return Mh(t)?Qe(t,us):Rh(t)?[t]:no(ls(Gh(t)))},dr.toPlainObject=Kh,dr.transform=function(t,e,n){var r=Mh(t),i=r||bh(t)||Oh(t);if(e=Oo(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:kh(t)&&Ch(o)?fr(Ee(t)):{}}return(i?qe:qr)(t,(function(t,r,i){return e(n,t,r,i)})),n},dr.unary=function(t){return th(t,1)},dr.union=Is,dr.unionBy=Bs,dr.unionWith=Ts,dr.uniq=function(t){return t&&t.length?Ai(t):[]},dr.uniqBy=function(t,e){return t&&t.length?Ai(t,Oo(e,2)):[]},dr.uniqWith=function(t,e){return e="function"==typeof e?e:o,t&&t.length?Ai(t,o,e):[]},dr.unset=function(t,e){return null==t||Wi(t,e)},dr.unzip=Es,dr.unzipWith=Ds,dr.update=function(t,e,n){return null==t?t:zi(t,e,Gi(n))},dr.updateWith=function(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:zi(t,e,Gi(n),r)},dr.values=da,dr.valuesIn=function(t){return null==t?[]:wn(t,oa(t))},dr.without=Ls,dr.words=Ca,dr.wrap=function(t,e){return uh(Gi(e),t)},dr.xor=Fs,dr.xorBy=Rs,dr.xorWith=Os,dr.zip=As,dr.zipObject=function(t,e){return Ui(t||[],e||[],Ir)},dr.zipObjectDeep=function(t,e){return Ui(t||[],e||[],_i)},dr.zipWith=Ws,dr.entries=ca,dr.entriesIn=pa,dr.extend=qh,dr.extendWith=$h,Fa(dr,dr),dr.add=Ka,dr.attempt=Pa,dr.camelCase=fa,dr.capitalize=ga,dr.ceil=Ga,dr.clamp=function(t,e,n){return n===o&&(n=e,e=o),n!==o&&(n=(n=Uh(n))==n?n:0),e!==o&&(e=(e=Uh(e))==e?e:0),Fr(Uh(t),e,n)},dr.clone=function(t){return Rr(t,f)},dr.cloneDeep=function(t){return Rr(t,p|f)},dr.cloneDeepWith=function(t,e){return Rr(t,p|f,e="function"==typeof e?e:o)},dr.cloneWith=function(t,e){return Rr(t,f,e="function"==typeof e?e:o)},dr.conformsTo=function(t,e){return null==e||Or(t,e,ia(e))},dr.deburr=ya,dr.defaultTo=function(t,e){return null==t||t!=t?e:t},dr.divide=Va,dr.endsWith=function(t,e,n){t=Gh(t),e=Oi(e);var r=t.length,i=n=n===o?r:Fr(Nh(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e},dr.eq=dh,dr.escape=function(t){return(t=Gh(t))&&Pt.test(t)?t.replace(St,Sn):t},dr.escapeRegExp=function(t){return(t=Gh(t))&&Lt.test(t)?t.replace(Dt,"\\$&"):t},dr.every=function(t,e,n){var r=Mh(t)?Ye:Nr;return n&&qo(t,e,n)&&(e=o),r(t,Oo(e,3))},dr.find=Us,dr.findIndex=ys,dr.findKey=function(t,e){return sn(t,Oo(e,3),qr)},dr.findLast=Ks,dr.findLastIndex=Ms,dr.findLastKey=function(t,e){return sn(t,Oo(e,3),$r)},dr.floor=qa,dr.forEach=Gs,dr.forEachRight=Vs,dr.forIn=function(t,e){return null==t?t:Gr(t,Oo(e,3),oa)},dr.forInRight=function(t,e){return null==t?t:Vr(t,Oo(e,3),oa)},dr.forOwn=function(t,e){return t&&qr(t,Oo(e,3))},dr.forOwnRight=function(t,e){return t&&$r(t,Oo(e,3))},dr.get=Qh,dr.gt=fh,dr.gte=gh,dr.has=function(t,e){return null!=t&&Uo(t,e,ti)},dr.hasIn=ta,dr.head=ms,dr.identity=Ta,dr.includes=function(t,e,n,r){t=mh(t)?t:da(t),n=n&&!r?Nh(n):0;var i=t.length;return n<0&&(n=Gn(i+n,0)),Fh(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&an(t,e,n)>-1},dr.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Nh(n);return i<0&&(i=Gn(r+i,0)),an(t,e,i)},dr.inRange=function(t,e,n){return e=jh(e),n===o?(n=e,e=0):n=jh(n),function(t,e,n){return t>=Vn(e,n)&&t<Gn(e,n)}(t=Uh(t),e,n)},dr.invoke=ra,dr.isArguments=yh,dr.isArray=Mh,dr.isArrayBuffer=wh,dr.isArrayLike=mh,dr.isArrayLikeObject=vh,dr.isBoolean=function(t){return!0===t||!1===t||Ih(t)&&Jr(t)==K},dr.isBuffer=bh,dr.isDate=xh,dr.isElement=function(t){return Ih(t)&&1===t.nodeType&&!Eh(t)},dr.isEmpty=function(t){if(null==t)return!0;if(mh(t)&&(Mh(t)||"string"==typeof t||"function"==typeof t.splice||bh(t)||Oh(t)||yh(t)))return!t.length;var e=Ho(t);if(e==X||e==nt)return!t.size;if(Zo(t))return!li(t).length;for(var n in t)if(ue.call(t,n))return!1;return!0},dr.isEqual=function(t,e){return oi(t,e)},dr.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:o)?n(t,e):o;return r===o?oi(t,e,o,n):!!r},dr.isError=Sh,dr.isFinite=function(t){return"number"==typeof t&&Hn(t)},dr.isFunction=Ch,dr.isInteger=Ph,dr.isLength=_h,dr.isMap=Bh,dr.isMatch=function(t,e){return t===e||si(t,e,Wo(e))},dr.isMatchWith=function(t,e,n){return n="function"==typeof n?n:o,si(t,e,Wo(e),n)},dr.isNaN=function(t){return Th(t)&&t!=+t},dr.isNative=function(t){if(Xo(t))throw new Jt(h);return hi(t)},dr.isNil=function(t){return null==t},dr.isNull=function(t){return null===t},dr.isNumber=Th,dr.isObject=kh,dr.isObjectLike=Ih,dr.isPlainObject=Eh,dr.isRegExp=Dh,dr.isSafeInteger=function(t){return Ph(t)&&t>=-F&&t<=F},dr.isSet=Lh,dr.isString=Fh,dr.isSymbol=Rh,dr.isTypedArray=Oh,dr.isUndefined=function(t){return t===o},dr.isWeakMap=function(t){return Ih(t)&&Ho(t)==st},dr.isWeakSet=function(t){return Ih(t)&&Jr(t)==ht},dr.join=function(t,e){return null==t?"":Un.call(t,e)},dr.kebabCase=Ma,dr.last=Ss,dr.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return n!==o&&(i=(i=Nh(n))<0?Gn(r+i,0):Vn(i,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,i):hn(t,un,i,!0)},dr.lowerCase=wa,dr.lowerFirst=ma,dr.lt=Ah,dr.lte=Wh,dr.max=function(t){return t&&t.length?Hr(t,Ta,Qr):o},dr.maxBy=function(t,e){return t&&t.length?Hr(t,Oo(e,2),Qr):o},dr.mean=function(t){return cn(t,Ta)},dr.meanBy=function(t,e){return cn(t,Oo(e,2))},dr.min=function(t){return t&&t.length?Hr(t,Ta,ci):o},dr.minBy=function(t,e){return t&&t.length?Hr(t,Oo(e,2),ci):o},dr.stubArray=Ha,dr.stubFalse=Ua,dr.stubObject=function(){return{}},dr.stubString=function(){return""},dr.stubTrue=function(){return!0},dr.multiply=Ya,dr.nth=function(t,e){return t&&t.length?yi(t,Nh(e)):o},dr.noConflict=function(){return Le._===this&&(Le._=ge),this},dr.noop=Ra,dr.now=Qs,dr.pad=function(t,e,n){t=Gh(t);var r=(e=Nh(e))?En(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return wo(zn(i),n)+t+wo(Wn(i),n)},dr.padEnd=function(t,e,n){t=Gh(t);var r=(e=Nh(e))?En(t):0;return e&&r<e?t+wo(e-r,n):t},dr.padStart=function(t,e,n){t=Gh(t);var r=(e=Nh(e))?En(t):0;return e&&r<e?wo(e-r,n)+t:t},dr.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),$n(Gh(t).replace(Rt,""),e||0)},dr.random=function(t,e,n){if(n&&"boolean"!=typeof n&&qo(t,e,n)&&(e=n=o),n===o&&("boolean"==typeof e?(n=e,e=o):"boolean"==typeof t&&(n=t,t=o)),t===o&&e===o?(t=0,e=1):(t=jh(t),e===o?(e=t,t=0):e=jh(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=Yn();return Vn(t+i*(e-t+Be("1e-"+((i+"").length-1))),e)}return bi(t,e)},dr.reduce=function(t,e,n){var r=Mh(t)?en:fn,i=arguments.length<3;return r(t,Oo(e,4),n,i,zr)},dr.reduceRight=function(t,e,n){var r=Mh(t)?nn:fn,i=arguments.length<3;return r(t,Oo(e,4),n,i,jr)},dr.repeat=function(t,e,n){return e=(n?qo(t,e,n):e===o)?1:Nh(e),xi(Gh(t),e)},dr.replace=function(){var t=arguments,e=Gh(t[0]);return t.length<3?e:e.replace(t[1],t[2])},dr.result=function(t,e,n){var r=-1,i=(e=Vi(e,t)).length;for(i||(i=1,t=o);++r<i;){var s=null==t?o:t[us(e[r])];s===o&&(r=i,s=n),t=Ch(s)?s.call(t):s}return t},dr.round=Xa,dr.runInContext=t,dr.sample=function(t){return(Mh(t)?Cr:Ci)(t)},dr.size=function(t){if(null==t)return 0;if(mh(t))return Fh(t)?En(t):t.length;var e=Ho(t);return e==X||e==nt?t.size:li(t).length},dr.snakeCase=va,dr.some=function(t,e,n){var r=Mh(t)?rn:Ei;return n&&qo(t,e,n)&&(e=o),r(t,Oo(e,3))},dr.sortedIndex=function(t,e){return Di(t,e)},dr.sortedIndexBy=function(t,e,n){return Li(t,e,Oo(n,2))},dr.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=Di(t,e);if(r<n&&dh(t[r],e))return r}return-1},dr.sortedLastIndex=function(t,e){return Di(t,e,!0)},dr.sortedLastIndexBy=function(t,e,n){return Li(t,e,Oo(n,2),!0)},dr.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var n=Di(t,e,!0)-1;if(dh(t[n],e))return n}return-1},dr.startCase=ba,dr.startsWith=function(t,e,n){return t=Gh(t),n=null==n?0:Fr(Nh(n),0,t.length),e=Oi(e),t.slice(n,n+e.length)==e},dr.subtract=Za,dr.sum=function(t){return t&&t.length?gn(t,Ta):0},dr.sumBy=function(t,e){return t&&t.length?gn(t,Oo(e,2)):0},dr.template=function(t,e,n){var r=dr.templateSettings;n&&qo(t,e,n)&&(e=o),t=Gh(t),e=$h({},e,r,_o);var i,s,h=$h({},e.imports,r.imports,_o),a=ia(h),l=wn(h,a),u=0,c=e.interpolate||Xt,p="__p += '",d=ne((e.escape||Xt).source+"|"+c.source+"|"+(c===It?Ht:Xt).source+"|"+(e.evaluate||Xt).source+"|$","g"),f="//# sourceURL="+(ue.call(e,"sourceURL")?(e.sourceURL+"").replace(/[\r\n]/g," "):"lodash.templateSources["+ ++Pe+"]")+"\n";t.replace(d,(function(e,n,r,o,h,a){return r||(r=o),p+=t.slice(u,a).replace(Zt,Cn),n&&(i=!0,p+="' +\n__e("+n+") +\n'"),h&&(s=!0,p+="';\n"+h+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=a+e.length,e})),p+="';\n";var g=ue.call(e,"variable")&&e.variable;g||(p="with (obj) {\n"+p+"\n}\n"),p=(s?p.replace(mt,""):p).replace(vt,"$1").replace(bt,"$1;"),p="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var y=Pa((function(){return Qt(a,f+"return "+p).apply(o,l)}));if(y.source=p,Sh(y))throw y;return y},dr.times=function(t,e){if((t=Nh(t))<1||t>F)return[];var n=A,r=Vn(t,A);e=Oo(e),t-=A;for(var i=yn(r,e);++n<t;)e(n);return i},dr.toFinite=jh,dr.toInteger=Nh,dr.toLength=Hh,dr.toLower=function(t){return Gh(t).toLowerCase()},dr.toNumber=Uh,dr.toSafeInteger=function(t){return t?Fr(Nh(t),-F,F):0===t?t:0},dr.toString=Gh,dr.toUpper=function(t){return Gh(t).toUpperCase()},dr.trim=function(t,e,n){if((t=Gh(t))&&(n||e===o))return t.replace(Ft,"");if(!t||!(e=Oi(e)))return t;var r=Dn(t),i=Dn(e);return $i(r,vn(r,i),bn(r,i)+1).join("")},dr.trimEnd=function(t,e,n){if((t=Gh(t))&&(n||e===o))return t.replace(Ot,"");if(!t||!(e=Oi(e)))return t;var r=Dn(t);return $i(r,0,bn(r,Dn(e))+1).join("")},dr.trimStart=function(t,e,n){if((t=Gh(t))&&(n||e===o))return t.replace(Rt,"");if(!t||!(e=Oi(e)))return t;var r=Dn(t);return $i(r,vn(r,Dn(e))).join("")},dr.truncate=function(t,e){var n=k,r=I;if(kh(e)){var i="separator"in e?e.separator:i;n="length"in e?Nh(e.length):n,r="omission"in e?Oi(e.omission):r}var s=(t=Gh(t)).length;if(Pn(t)){var h=Dn(t);s=h.length}if(n>=s)return t;var a=n-En(r);if(a<1)return r;var l=h?$i(h,0,a).join(""):t.slice(0,a);if(i===o)return l+r;if(h&&(a+=l.length-a),Dh(i)){if(t.slice(a).search(i)){var u,c=l;for(i.global||(i=ne(i.source,Gh(Ut.exec(i))+"g")),i.lastIndex=0;u=i.exec(c);)var p=u.index;l=l.slice(0,p===o?a:p)}}else if(t.indexOf(Oi(i),a)!=a){var d=l.lastIndexOf(i);d>-1&&(l=l.slice(0,d))}return l+r},dr.unescape=function(t){return(t=Gh(t))&&Ct.test(t)?t.replace(xt,Ln):t},dr.uniqueId=function(t){var e=++ce;return Gh(t)+e},dr.upperCase=xa,dr.upperFirst=Sa,dr.each=Gs,dr.eachRight=Vs,dr.first=ms,Fa(dr,($a={},qr(dr,(function(t,e){ue.call(dr.prototype,e)||($a[e]=t)})),$a),{chain:!1}),dr.VERSION="4.17.15",qe(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){dr[t].placeholder=dr})),qe(["drop","take"],(function(t,e){Mr.prototype[t]=function(n){n=n===o?1:Gn(Nh(n),0);var r=this.__filtered__&&!e?new Mr(this):this.clone();return r.__filtered__?r.__takeCount__=Vn(n,r.__takeCount__):r.__views__.push({size:Vn(n,A),type:t+(r.__dir__<0?"Right":"")}),r},Mr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),qe(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=n==E||3==n;Mr.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Oo(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),qe(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Mr.prototype[t]=function(){return this[n](1).value()[0]}})),qe(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Mr.prototype[t]=function(){return this.__filtered__?new Mr(this):this[n](1)}})),Mr.prototype.compact=function(){return this.filter(Ta)},Mr.prototype.find=function(t){return this.filter(t).head()},Mr.prototype.findLast=function(t){return this.reverse().find(t)},Mr.prototype.invokeMap=Si((function(t,e){return"function"==typeof t?new Mr(this):this.map((function(n){return ri(n,t,e)}))})),Mr.prototype.reject=function(t){return this.filter(ah(Oo(t)))},Mr.prototype.slice=function(t,e){t=Nh(t);var n=this;return n.__filtered__&&(t>0||e<0)?new Mr(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==o&&(n=(e=Nh(e))<0?n.dropRight(-e):n.take(e-t)),n)},Mr.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Mr.prototype.toArray=function(){return this.take(A)},qr(Mr.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=dr[r?"take"+("last"==e?"Right":""):e],s=r||/^find/.test(e);i&&(dr.prototype[e]=function(){var e=this.__wrapped__,h=r?[1]:arguments,a=e instanceof Mr,l=h[0],u=a||Mh(e),c=function(t){var e=i.apply(dr,tn([t],h));return r&&p?e[0]:e};u&&n&&"function"==typeof l&&1!=l.length&&(a=u=!1);var p=this.__chain__,d=!!this.__actions__.length,f=s&&!p,g=a&&!d;if(!s&&u){e=g?e:new Mr(this);var y=t.apply(e,h);return y.__actions__.push({func:js,args:[c],thisArg:o}),new yr(y,p)}return f&&g?t.apply(this,h):(y=this.thru(c),f?r?y.value()[0]:y.value():y)})})),qe(["pop","push","shift","sort","splice","unshift"],(function(t){var e=oe[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);dr.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Mh(i)?i:[],t)}return this[n]((function(n){return e.apply(Mh(n)?n:[],t)}))}})),qr(Mr.prototype,(function(t,e){var n=dr[e];if(n){var r=n.name+"";ue.call(ir,r)||(ir[r]=[]),ir[r].push({name:e,func:n})}})),ir[fo(o,w).name]=[{name:"wrapper",func:o}],Mr.prototype.clone=function(){var t=new Mr(this.__wrapped__);return t.__actions__=no(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=no(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=no(this.__views__),t},Mr.prototype.reverse=function(){if(this.__filtered__){var t=new Mr(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Mr.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Mh(t),r=e<0,i=n?t.length:0,o=function(t,e,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],s=o.size;switch(o.type){case"drop":t+=s;break;case"dropRight":e-=s;break;case"take":e=Vn(e,t+s);break;case"takeRight":t=Gn(t,e-s)}}return{start:t,end:e}}(0,i,this.__views__),s=o.start,h=o.end,a=h-s,l=r?h:s-1,u=this.__iteratees__,c=u.length,p=0,d=Vn(a,this.__takeCount__);if(!n||!r&&i==a&&d==a)return Ni(t,this.__actions__);var f=[];t:for(;a--&&p<d;){for(var g=-1,y=t[l+=e];++g<c;){var M=u[g],w=M.iteratee,m=M.type,v=w(y);if(m==D)y=v;else if(!v){if(m==E)continue t;break t}}f[p++]=y}return f},dr.prototype.at=Ns,dr.prototype.chain=function(){return zs(this)},dr.prototype.commit=function(){return new yr(this.value(),this.__chain__)},dr.prototype.next=function(){this.__values__===o&&(this.__values__=zh(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?o:this.__values__[this.__index__++]}},dr.prototype.plant=function(t){for(var e,n=this;n instanceof gr;){var r=ps(n);r.__index__=0,r.__values__=o,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e},dr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Mr){var e=t;return this.__actions__.length&&(e=new Mr(this)),(e=e.reverse()).__actions__.push({func:js,args:[ks],thisArg:o}),new yr(e,this.__chain__)}return this.thru(ks)},dr.prototype.toJSON=dr.prototype.valueOf=dr.prototype.value=function(){return Ni(this.__wrapped__,this.__actions__)},dr.prototype.first=dr.prototype.head,We&&(dr.prototype[We]=function(){return this}),dr}();Le._=Fn,(i=function(){return Fn}.call(e,n,e,r))===o||(r.exports=i)}).call(this)}).call(this,n(1),n(5)(t))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){t.exports=function(t){return n(7)('!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),t.default={}}]);',n.p+"29e9d083d776f042ac8d.sharedworker.js",t)}},function(t,e,n){"use strict";var r,i=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.a=function(t,e){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(e)}},function(t,e,n){"use strict";n.r(e),function(t){var e=n(0),r=(n(6),n(2)),i=n.n(r),o=n(3),s=window||self||t,h=new i.a;h.addEventListener("message",(function(t){"load"===t.data.type&&l(t.data.data).then(h.postMessage.bind(h,{type:"sucess",id:t.data.id}))}));var a,l=function(t){return new Promise((function(e,n){var r=document.createElement("script");r.onload=e,r.onerror=n,r.src=t,document.head.appendChild(r)}))},u=function(t){return l("../../Snap/src/"+t).catch((function(e){return l("https://snap.berkeley.edu/snap/src/"+t)}))},c=u("symbols.js").then(e.partial(u,"blocks.js")).then(h.postMessage.bind(h,{type:"loadedBlocks"})).then((function(){return s.SyntaxElementMorph}));(a="squeak.min.js",l("../../ObjectLand.SqueakJS/"+a).catch((function(t){return l("squeak.js.org/"+a)}))).then((function(){return s.SqueakJS}));c.then((function(t){return u("threads.js")})).then(e.partial(u,"objects.js")).then(e.partial(u,"paint.js")).then(e.partial(u,"lists.js")).then(e.partial(u,"byob.js")).then(e.partial(u,"tables.js")).then(e.partial(u,"sketch.js")).then(e.partial(u,"video.js")).then(e.partial(u,"maps.js")).then(e.partial(u,"xml.js")).then(e.partial(u,"locale.js")).then(e.partial(u,"sha512.js")).then(e.partial(u,"FileSaver.min.js")).then(e.partial(o.a,h,s.Morph)).then((function(t){return s.IDE_Morph=t})).then(e.partial(u,"store.js"))}.call(this,n(1))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(module,exports){var morphicVersion="2018-March-19",modules={},useBlurredShadows=getBlurredShadowSupport(),standardSettings={minimumFontHeight:getMinimumFontHeight(),globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:12,bubbleHelpFontSize:10,prompterFontName:"sans-serif",prompterFontSize:12,prompterSliderSize:10,handleSize:15,scrollBarSize:12,mouseScrollAmount:40,useSliderForInput:!1,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1,grabThreshold:5},touchScreenSettings={minimumFontHeight:standardSettings.minimumFontHeight,globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:24,bubbleHelpFontSize:18,prompterFontName:"sans-serif",prompterFontSize:24,prompterSliderSize:20,handleSize:26,scrollBarSize:24,mouseScrollAmount:40,useSliderForInput:!0,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1,grabThreshold:5},MorphicPreferences=standardSettings,Morph,WorldMorph,HandMorph,ShadowMorph,FrameMorph,MenuMorph,HandleMorph,StringFieldMorph,ColorPickerMorph,SliderMorph,ScrollFrameMorph,InspectorMorph,StringMorph,TextMorph,PenMorph,ColorPaletteMorph,GrayPaletteMorph,BlinkerMorph,CursorMorph,BoxMorph,SpeechBubbleMorph,DialMorph,CircleBoxMorph,SliderButtonMorph,MouseSensorMorph,ListMorph,TriggerMorph,MenuItemMorph,MenuItemMorph,BouncerMorph;function nop(){return null}function localize(t){return t}function isNil(t){return null==t}function contains(t,e){return-1!==t.indexOf(e)}function detect(t,e){var n,r=t.length;for(n=0;n<r;n+=1)if(e.call(null,t[n]))return t[n];return null}function sizeOf(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n+=1);return n}function isString(t){return"string"==typeof t||t instanceof String}function isObject(t){return null!==t&&("object"==typeof t||t instanceof Object)}function radians(t){return t*Math.PI/180}function degrees(t){return 180*t/Math.PI}function fontHeight(t){return 1.2*Math.max(t,MorphicPreferences.minimumFontHeight)}function isWordChar(t){return t.match(/[A-zÀ-ÿ0-9]/)}function newCanvas(t,e){var n,r;return r=t||{x:0,y:0},(n=document.createElement("canvas")).width=r.x,n.height=r.y,e&&n.isRetinaEnabled&&(n.isRetinaEnabled=!1),n}function getMinimumFontHeight(){var t,e,n,r,i=document.createElement("canvas");for(i.width=50,i.height=50,(t=i.getContext("2d")).font="1px serif",e=t.measureText("I").width,t.fillStyle="black",t.textBaseline="bottom",t.fillText("I",0,50),r=0;r<50;r+=1)for(n=0;n<e;n+=1)if(0!==t.getImageData(n,r,1,1).data[3])return 50-r+1;return 0}function getBlurredShadowSupport(){var t,e,n;return(t=document.createElement("canvas")).width=10,t.height=10,(n=t.getContext("2d")).fillStyle="rgb(255, 0, 0)",n.beginPath(),n.arc(5,5,5,0,2*Math.PI,!0),n.closePath(),n.fill(),(e=document.createElement("canvas")).width=10,e.height=10,(n=e.getContext("2d")).shadowBlur=10,n.shadowColor="rgba(0, 0, 255, 1)",n.drawImage(t,0,0),!!n.getImageData(0,0,1,1).data[3]}function getDocumentPositionOf(t){var e,n;if(null===t)return{x:0,y:0};for(e={x:t.offsetLeft,y:t.offsetTop},n=t.offsetParent;null!==n;)e.x+=n.offsetLeft,e.y+=n.offsetTop,n!==document.body&&n!==document.documentElement&&(e.x-=n.scrollLeft,e.y-=n.scrollTop),n=n.offsetParent;return e}function copy(t){var e,n,r,i,o,s;if("object"!=typeof t)return t;if(e=t.valueOf(),t!==e)return new t.constructor(e);if(t instanceof t.constructor&&t.constructor!==Object)for(n=Object.create(t.constructor.prototype),o=(i=Object.keys(t)).length,s=0;s<o;s+=1)n[r=i[s]]=t[r];else for(r in n={},t)n[r]=t[r];return n}function enableRetinaSupport(){var t=document.createElement("canvas").getContext("2d"),e=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,n=Math.ceil(window.devicePixelRatio),r=HTMLCanvasElement.prototype,i=CanvasRenderingContext2D.prototype,o={drawImage:i.drawImage,getImageData:i.getImageData,width:Object.getOwnPropertyDescriptor(r,"width"),height:Object.getOwnPropertyDescriptor(r,"height"),shadowOffsetX:Object.getOwnPropertyDescriptor(i,"shadowOffsetX"),shadowOffsetY:Object.getOwnPropertyDescriptor(i,"shadowOffsetY"),shadowBlur:Object.getOwnPropertyDescriptor(i,"shadowBlur")};function s(t){return t.isRetinaEnabled?(n||1)/e:1}e!==n&&(Object.keys(o).some((function(t){var e=o[t];return e.hasOwnProperty("configurable")&&!e.configurable}))||(r._isRetinaEnabled=!0,r._bak=o,Object.defineProperty(r,"isRetinaEnabled",{get:function(){return this._isRetinaEnabled},set:function(t){var e=s(this),n=this.width,r=this.height;this._isRetinaEnabled=t,s(this)!=e&&(this.width=n,this.height=r)},configurable:!0}),Object.defineProperty(r,"width",{get:function(){return o.width.get.call(this)/s(this)},set:function(t){try{var e,n=s(this);o.width.set.call(this,t*n),(e=this.getContext("2d")).restore(),e.save(),e.scale(n,n)}catch(e){console.log("Retina Display Support Problem",e),o.width.set.call(this,t)}}}),Object.defineProperty(r,"height",{get:function(){return o.height.get.call(this)/s(this)},set:function(t){var e,n=s(this);o.height.set.call(this,t*n),(e=this.getContext("2d")).restore(),e.save(),e.scale(n,n)}}),i.drawImage=function(t){var e,n,r,i,h,a,l,u,c=s(t);switch(arguments.length){case 9:e=arguments[1],n=arguments[2],r=arguments[3],i=arguments[4],h=arguments[5],a=arguments[6],l=arguments[7],u=arguments[8];break;case 5:e=0,n=0,r=t.width,i=t.height,h=arguments[1],a=arguments[2],l=arguments[3],u=arguments[4];break;case 3:e=0,n=0,r=t.width,i=t.height,h=arguments[1],a=arguments[2],l=t.width,u=t.height;break;default:throw Error("Called drawImage() with "+arguments.length+" arguments")}o.drawImage.call(this,t,e*c,n*c,r*c,i*c,h,a,l,u)},i.getImageData=function(t,e,n,r){var i=s(this.canvas);return o.getImageData.call(this,t*i,e*i,n*i,r*i)},Object.defineProperty(i,"shadowOffsetX",{get:function(){return o.shadowOffsetX.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);o.shadowOffsetX.set.call(this,t*e)}}),Object.defineProperty(i,"shadowOffsetY",{get:function(){return o.shadowOffsetY.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);o.shadowOffsetY.set.call(this,t*e)}}),Object.defineProperty(i,"shadowBlur",{get:function(){return o.shadowBlur.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);o.shadowBlur.set.call(this,t*e)}})))}function isRetinaSupported(){var t=document.createElement("canvas").getContext("2d"),e=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,n=HTMLCanvasElement.prototype,r=CanvasRenderingContext2D.prototype,i={drawImage:r.drawImage,getImageData:r.getImageData,width:Object.getOwnPropertyDescriptor(n,"width"),height:Object.getOwnPropertyDescriptor(n,"height"),shadowOffsetX:Object.getOwnPropertyDescriptor(r,"shadowOffsetX"),shadowOffsetY:Object.getOwnPropertyDescriptor(r,"shadowOffsetY"),shadowBlur:Object.getOwnPropertyDescriptor(r,"shadowBlur")};return e!==window.devicePixelRatio&&!Object.keys(i).some((function(t){var e=i[t];return e.hasOwnProperty("configurable")&&!e.configurable}))}function isRetinaEnabled(){return HTMLCanvasElement.prototype.hasOwnProperty("_isRetinaEnabled")}function disableRetinaSupport(){var t,e,n;isRetinaEnabled()&&(t=HTMLCanvasElement.prototype,e=CanvasRenderingContext2D.prototype,n=t._bak,Object.defineProperty(t,"width",n.width),Object.defineProperty(t,"height",n.height),e.drawImage=n.drawImage,e.getImageData=n.getImageData,Object.defineProperty(e,"shadowOffsetX",n.shadowOffsetX),Object.defineProperty(e,"shadowOffsetY",n.shadowOffsetY),Object.defineProperty(e,"shadowBlur",n.shadowBlur),delete t._isRetinaEnabled,delete t.isRetinaEnabled,delete t._bak)}function normalizeCanvas(t,e){var n;return t.isRetinaEnabled?((n=newCanvas(new Point(t.width,t.height),!0)).getContext("2d").drawImage(t,0,0),e?n:(t.isRetinaEnabled=!1,t.width=n.width,t.height=n.height,t.getContext("2d").drawImage(n,0,0),t)):t}function Animation(t,e,n,r,i,o){this.setter=t,this.getter=e,this.delta=n||0,this.duration=r||0,this.easing=isString(i)?this.easings[i]||this.easings.sinusoidal:i||this.easings.sinusoidal,this.onComplete=o||null,this.endTime=null,this.destination=null,this.isActive=!1,this.start()}function Color(t,e,n,r){this.r=t||0,this.g=e||0,this.b=n||0,this.a=r||(0===r?0:1)}function Point(t,e){this.x=t||0,this.y=e||0}function Rectangle(t,e,n,r){this.init(new Point(t||0,e||0),new Point(n||0,r||0))}function Node(t,e){this.init(t||null,e||[])}function Morph(){this.init()}function ShadowMorph(){this.init()}function HandleMorph(t,e,n,r,i,o){this.init(t,e,n,r,i,o)}function PenMorph(){this.init()}function ColorPaletteMorph(t,e){this.init(t||null,e||new Point(80,50))}function GrayPaletteMorph(t,e){this.init(t||null,e||new Point(80,10))}function ColorPickerMorph(t){this.init(t||new Color(255,255,255))}function BlinkerMorph(t){this.init(t)}function CursorMorph(t){this.init(t)}function BoxMorph(t,e,n){this.init(t,e,n)}function SpeechBubbleMorph(t,e,n,r,i,o,s){this.init(t,e,n,r,i,o,s)}function DialMorph(t,e,n,r,i){this.init(t,e,n,r,i)}function CircleBoxMorph(t){this.init(t||"vertical")}function SliderButtonMorph(t){this.init(t)}function SliderMorph(t,e,n,r,i,o){this.init(t||1,e||100,n||50,r||10,i||"vertical",o)}function MouseSensorMorph(t,e,n){this.init(t,e,n)}function InspectorMorph(t){this.init(t)}function MenuMorph(t,e,n,r){this.init(t,e,n,r)}function StringMorph(t,e,n,r,i,o,s,h,a,l){this.init(t,e,n,r,i,o,s,h,a,l)}function TextMorph(t,e,n,r,i,o,s,h,a,l){this.init(t,e,n,r,i,o,s,h,a,l)}function TriggerMorph(t,e,n,r,i,o,s,h,a,l,u){this.init(t,e,n,r,i,o,s,h,a,l,u)}function MenuItemMorph(t,e,n,r,i,o,s,h,a,l,u,c){this.shortcutString=c||null,this.shortcut=null,this.init(t,e,n,r,i,o,s,h,a,l,u)}function FrameMorph(t){this.init(t)}function ScrollFrameMorph(t,e,n){this.init(t,e,n)}function ListMorph(t,e,n,r){this.init(t||[],e||function(t){return isString(t)?t:t.toSource?t.toSource():t.toString()},n||[],r)}function StringFieldMorph(t,e,n,r,i,o,s){this.init(t||"",e||100,n||12,r||"sans-serif",i||!1,o||!1,s)}function BouncerMorph(){this.init()}function HandMorph(t){this.init(t)}function WorldMorph(t,e){this.init(t,e)}enableRetinaSupport(),Animation.prototype.easings={linear:function(t){return t},sinusoidal:function(t){return 1-Math.cos(radians(90*t))},quadratic:function(t){return t<.5?2*t*t:(4-2*t)*t-1},cubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},elastic:function(t){return(t-=.5)<0?(.01+.01/t)*Math.sin(50*t):(.02-.01/t)*Math.sin(50*t)+1},sine_in:function(t){return 1-Math.sin(radians(90+90*t))},quad_in:function(t){return t*t},cubic_in:function(t){return t*t*t},elastic_in:function(t){return(.04-.04/t)*Math.sin(25*t)+1},sine_out:function(t){return Math.sin(radians(90*t))},quad_out:function(t){return t*(2-t)},elastic_out:function(t){return.04*t/--t*Math.sin(25*t)}},Animation.prototype.start=function(){this.endTime=Date.now()+this.duration,this.destination=this.getter.call(this)+this.delta,this.isActive=!0},Animation.prototype.step=function(){if(this.isActive){var t=Date.now();t>this.endTime?(this.setter(this.destination),this.isActive=!1,this.onComplete&&this.onComplete()):this.setter(this.destination-this.delta*this.easing((this.endTime-t)/this.duration))}},Color.prototype.toString=function(){return"rgba("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+","+this.a+")"},Color.prototype.toRGBstring=function(){return"rgb("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+")"},Color.fromString=function(t){var e=t.split(/[\(),]/).slice(1,5);return new Color(e[0],e[1],e[2],e[3])},Color.prototype.copy=function(){return new Color(this.r,this.g,this.b,this.a)},Color.prototype.eq=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},Color.prototype.hsv=function(){var t,e,n,r,i,o,s=this.r/255,h=this.g/255,a=this.b/255;if(n=t=Math.max(s,h,a),t,i=t,o=t-(e=Math.min(s,h,a)),r=0===t?0:o/t,t===e)n=0;else{switch(t){case s:n=(h-a)/o+(h<a?6:0);break;case h:n=(a-s)/o+2;break;case a:n=(s-h)/o+4}n/=6}return[n,r,i]},Color.prototype.set_hsv=function(t,e,n){var r,i,o,s,h;switch(o=n*(1-e),s=n*(1-(i=6*t-(r=Math.floor(6*t)))*e),h=n*(1-(1-i)*e),r%6){case 0:this.r=n,this.g=h,this.b=o;break;case 1:this.r=s,this.g=n,this.b=o;break;case 2:this.r=o,this.g=n,this.b=h;break;case 3:this.r=o,this.g=s,this.b=n;break;case 4:this.r=h,this.g=o,this.b=n;break;case 5:this.r=n,this.g=o,this.b=s}this.r*=255,this.g*=255,this.b*=255},Color.prototype.mixed=function(t,e){var n=Math.min(Math.max(t,0),1),r=1-n;return new Color(this.r*n+e.r*r,this.g*n+e.g*r,this.b*n+e.b*r)},Color.prototype.darker=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(0,0,0))},Color.prototype.lighter=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(255,255,255))},Color.prototype.dansDarker=function(){var t=this.hsv(),e=new Color,n=Math.max(t[2]-.16,0);return e.set_hsv(t[0],t[1],n),e},Color.prototype.inverted=function(){return new Color(255-this.r,255-this.g,255-this.b)},Point.prototype.toString=function(){return Math.round(this.x.toString())+"@"+Math.round(this.y.toString())},Point.prototype.copy=function(){return new Point(this.x,this.y)},Point.prototype.eq=function(t){return this.x===t.x&&this.y===t.y},Point.prototype.lt=function(t){return this.x<t.x&&this.y<t.y},Point.prototype.gt=function(t){return this.x>t.x&&this.y>t.y},Point.prototype.ge=function(t){return this.x>=t.x&&this.y>=t.y},Point.prototype.le=function(t){return this.x<=t.x&&this.y<=t.y},Point.prototype.max=function(t){return new Point(Math.max(this.x,t.x),Math.max(this.y,t.y))},Point.prototype.min=function(t){return new Point(Math.min(this.x,t.x),Math.min(this.y,t.y))},Point.prototype.round=function(){return new Point(Math.round(this.x),Math.round(this.y))},Point.prototype.abs=function(){return new Point(Math.abs(this.x),Math.abs(this.y))},Point.prototype.neg=function(){return new Point(-this.x,-this.y)},Point.prototype.mirror=function(){return new Point(this.y,this.x)},Point.prototype.floor=function(){return new Point(Math.max(Math.floor(this.x),0),Math.max(Math.floor(this.y),0))},Point.prototype.ceil=function(){return new Point(Math.ceil(this.x),Math.ceil(this.y))},Point.prototype.add=function(t){return t instanceof Point?new Point(this.x+t.x,this.y+t.y):new Point(this.x+t,this.y+t)},Point.prototype.subtract=function(t){return t instanceof Point?new Point(this.x-t.x,this.y-t.y):new Point(this.x-t,this.y-t)},Point.prototype.multiplyBy=function(t){return t instanceof Point?new Point(this.x*t.x,this.y*t.y):new Point(this.x*t,this.y*t)},Point.prototype.divideBy=function(t){return t instanceof Point?new Point(this.x/t.x,this.y/t.y):new Point(this.x/t,this.y/t)},Point.prototype.floorDivideBy=function(t){return t instanceof Point?new Point(Math.floor(this.x/t.x),Math.floor(this.y/t.y)):new Point(Math.floor(this.x/t),Math.floor(this.y/t))},Point.prototype.r=function(){var t=this.multiplyBy(this);return Math.sqrt(t.x+t.y)},Point.prototype.degrees=function(){var t,e;return 0===this.x?this.y>=0?90:270:(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?degrees(e):360+degrees(e):180+degrees(e))},Point.prototype.theta=function(){var t,e;return 0===this.x?this.y>=0?radians(90):radians(270):(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?e:radians(360)+e:radians(180)+e)},Point.prototype.crossProduct=function(t){return this.multiplyBy(t.mirror())},Point.prototype.distanceTo=function(t){return t.subtract(this).r()},Point.prototype.rotate=function(t,e){var n=this.subtract(e);return"right"===t?new Point(-n.y,n.y).add(e):"left"===t?new Point(n.y,-n.y).add(e):e.subtract(n)},Point.prototype.flip=function(t,e){return"vertical"===t?new Point(this.x,2*e.y-this.y):new Point(2*e.x-this.x,this.y)},Point.prototype.distanceAngle=function(t,e){var n,r,i=e;return i>270?i-=360:i<-270&&(i+=360),-90<=i&&i<=90?(n=Math.sin(radians(i))*t,r=Math.sqrt(t*t-n*n),new Point(n+this.x,this.y-r)):(n=Math.sin(radians(180-i))*t,r=Math.sqrt(t*t-n*n),new Point(n+this.x,this.y+r))},Point.prototype.scaleBy=function(t){return this.multiplyBy(t)},Point.prototype.translateBy=function(t){return this.add(t)},Point.prototype.rotateBy=function(t,e){var n=e||new Point(0,0),r=this.subtract(n),i=r.r(),o=t-r.theta();return new Point(n.x+i*Math.cos(o),n.y-i*Math.sin(o))},Point.prototype.asArray=function(){return[this.x,this.y]},Rectangle.prototype.init=function(t,e){this.origin=t,this.corner=e},Rectangle.prototype.toString=function(){return"["+this.origin.toString()+" | "+this.extent().toString()+"]"},Rectangle.prototype.copy=function(){return new Rectangle(this.left(),this.top(),this.right(),this.bottom())},Point.prototype.corner=function(t){return new Rectangle(this.x,this.y,t.x,t.y)},Point.prototype.rectangle=function(t){var e,n;return e=this.min(t),n=this.max(t),new Rectangle(e.x,e.y,n.x,n.y)},Point.prototype.extent=function(t){var e=this.add(t);return new Rectangle(this.x,this.y,e.x,e.y)},Rectangle.prototype.setTo=function(t,e,n,r){this.origin=new Point(t||(0===t?0:this.left()),e||(0===e?0:this.top())),this.corner=new Point(n||(0===n?0:this.right()),r||(0===r?0:this.bottom()))},Rectangle.prototype.area=function(){var t=this.width();return t<0?0:Math.max(t*this.height(),0)},Rectangle.prototype.bottom=function(){return this.corner.y},Rectangle.prototype.bottomCenter=function(){return new Point(this.center().x,this.bottom())},Rectangle.prototype.bottomLeft=function(){return new Point(this.origin.x,this.corner.y)},Rectangle.prototype.bottomRight=function(){return this.corner.copy()},Rectangle.prototype.boundingBox=function(){return this},Rectangle.prototype.center=function(){return this.origin.add(this.corner.subtract(this.origin).floorDivideBy(2))},Rectangle.prototype.corners=function(){return[this.origin,this.bottomLeft(),this.corner,this.topRight()]},Rectangle.prototype.extent=function(){return this.corner.subtract(this.origin)},Rectangle.prototype.height=function(){return this.corner.y-this.origin.y},Rectangle.prototype.left=function(){return this.origin.x},Rectangle.prototype.leftCenter=function(){return new Point(this.left(),this.center().y)},Rectangle.prototype.right=function(){return this.corner.x},Rectangle.prototype.rightCenter=function(){return new Point(this.right(),this.center().y)},Rectangle.prototype.top=function(){return this.origin.y},Rectangle.prototype.topCenter=function(){return new Point(this.center().x,this.top())},Rectangle.prototype.topLeft=function(){return this.origin},Rectangle.prototype.topRight=function(){return new Point(this.corner.x,this.origin.y)},Rectangle.prototype.width=function(){return this.corner.x-this.origin.x},Rectangle.prototype.position=function(){return this.origin},Rectangle.prototype.eq=function(t){return this.origin.eq(t.origin)&&this.corner.eq(t.corner)},Rectangle.prototype.abs=function(){var t,e;return t=this.origin.abs(),e=this.corner.max(t),t.corner(e)},Rectangle.prototype.insetBy=function(t){var e=new Rectangle;return e.origin=this.origin.add(t),e.corner=this.corner.subtract(t),e},Rectangle.prototype.expandBy=function(t){var e=new Rectangle;return e.origin=this.origin.subtract(t),e.corner=this.corner.add(t),e},Rectangle.prototype.growBy=function(t){var e=new Rectangle;return e.origin=this.origin.copy(),e.corner=this.corner.add(t),e},Rectangle.prototype.intersect=function(t){var e=new Rectangle;return e.origin=this.origin.max(t.origin),e.corner=this.corner.min(t.corner),e},Rectangle.prototype.merge=function(t){var e=new Rectangle;return e.origin=this.origin.min(t.origin),e.corner=this.corner.max(t.corner),e},Rectangle.prototype.mergeWith=function(t){this.origin=this.origin.min(t.origin),this.corner=this.corner.max(t.corner)},Rectangle.prototype.round=function(){return this.origin.round().corner(this.corner.round())},Rectangle.prototype.spread=function(){return this.origin.floor().corner(this.corner.ceil()).expandBy(1)},Rectangle.prototype.amountToTranslateWithin=function(t){var e=0,n=0;return this.right()>t.right()&&(e=t.right()-this.right()),this.bottom()>t.bottom()&&(n=t.bottom()-this.bottom()),this.left()+e<t.left()&&(e=t.left()-this.left()),this.top()+n<t.top()&&(n=t.top()-this.top()),new Point(e,n)},Rectangle.prototype.containsPoint=function(t){return this.origin.le(t)&&t.lt(this.corner)},Rectangle.prototype.containsRectangle=function(t){return t.origin.gt(this.origin)&&t.corner.lt(this.corner)},Rectangle.prototype.intersects=function(t){var e=t.origin,n=t.corner;return n.x>=this.origin.x&&n.y>=this.origin.y&&e.x<=this.corner.x&&e.y<=this.corner.y},Rectangle.prototype.isNearTo=function(t,e){var n=t.origin,r=t.corner,i=e||0;return r.x+i>=this.origin.x&&r.y+i>=this.origin.y&&n.x-i<=this.corner.x&&n.y-i<=this.corner.y},Rectangle.prototype.scaleBy=function(t){var e=this.origin.multiplyBy(t),n=this.corner.multiplyBy(t);return new Rectangle(e.x,e.y,n.x,n.y)},Rectangle.prototype.translateBy=function(t){var e=this.origin.add(t),n=this.corner.add(t);return new Rectangle(e.x,e.y,n.x,n.y)},Rectangle.prototype.asArray=function(){return[this.left(),this.top(),this.right(),this.bottom()]},Rectangle.prototype.asArray_xywh=function(){return[this.left(),this.top(),this.width(),this.height()]},Node.prototype.init=function(t,e){this.parent=t||null,this.children=e||[]},Node.prototype.toString=function(){return"a Node["+this.children.length.toString()+"]"},Node.prototype.addChild=function(t){this.children.push(t),t.parent=this},Node.prototype.addChildFirst=function(t){this.children.splice(0,null,t),t.parent=this},Node.prototype.removeChild=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)},Node.prototype.root=function(){return null===this.parent?this:this.parent.root()},Node.prototype.depth=function(){return null===this.parent?0:this.parent.depth()+1},Node.prototype.allChildren=function(){var t=[this];return this.children.forEach((function(e){t=t.concat(e.allChildren())})),t},Node.prototype.forAllChildren=function(t){this.children.length>0&&this.children.forEach((function(e){e.forAllChildren(t)})),t.call(null,this)},Node.prototype.anyChild=function(t){var e;if(t.call(null,this))return!0;for(e=0;e<this.children.length;e+=1)if(this.children[e].anyChild(t))return!0;return!1},Node.prototype.allLeafs=function(){var t=[];return this.allChildren().forEach((function(e){0===e.children.length&&t.push(e)})),t},Node.prototype.allParents=function(){var t=[this];return null!==this.parent&&(t=t.concat(this.parent.allParents())),t},Node.prototype.siblings=function(){var t=this;return null===this.parent?[]:this.parent.children.filter((function(e){return e!==t}))},Node.prototype.parentThatIsA=function(t){return this instanceof t?this:this.parent?this.parent.parentThatIsA(t):null},Node.prototype.parentThatIsAnyOf=function(t){var e=!1,n=this;return t.forEach((function(t){n.constructor!==t||(e=!0)})),e?this:this.parent?this.parent.parentThatIsAnyOf(t):null},Morph.prototype=new Node,Morph.prototype.constructor=Morph,Morph.uber=Node.prototype,Morph.prototype.trackChanges=!0,Morph.prototype.shadowBlur=4,Morph.prototype.init=function(t){Morph.uber.init.call(this),this.isMorph=!0,this.image=null,this.bounds=new Rectangle(0,0,50,40),this.cachedFullImage=null,this.cachedFullBounds=null,this.color=new Color(80,80,80),this.texture=null,this.cachedTexture=null,this.alpha=1,this.isVisible=!0,this.isDraggable=!1,this.isTemplate=!1,this.acceptsDrops=!1,this.noticesTransparentClick=!1,t||this.drawNew(),this.fps=0,this.customContextMenu=null,this.lastTime=Date.now(),this.onNextStep=null},Morph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+" "+this.children.length.toString()+" "+this.bounds},Morph.prototype.destroy=function(){null!==this.parent&&(this.fullChanged(),this.parent.removeChild(this))},Morph.prototype.stepFrame=function(){if(!this.step)return null;var t,e,n;e=(t=Date.now())-this.lastTime,(this.fps>0?1e3/this.fps-e:0)<1&&(this.lastTime=t,this.onNextStep&&(n=this.onNextStep,this.onNextStep=null,n.call(this)),this.step(),this.children.forEach((function(t){t.stepFrame()})))},Morph.prototype.nextSteps=function(t){var e=t||[],n=e.shift(),r=this;n&&(this.onNextStep=function(){n.call(r),r.nextSteps(e)})},Morph.prototype.step=nop,Morph.prototype.left=function(){return this.bounds.left()},Morph.prototype.right=function(){return this.bounds.right()},Morph.prototype.top=function(){return this.bounds.top()},Morph.prototype.bottom=function(){return this.bounds.bottom()},Morph.prototype.center=function(){return this.bounds.center()},Morph.prototype.bottomCenter=function(){return this.bounds.bottomCenter()},Morph.prototype.bottomLeft=function(){return this.bounds.bottomLeft()},Morph.prototype.bottomRight=function(){return this.bounds.bottomRight()},Morph.prototype.boundingBox=function(){return this.bounds},Morph.prototype.corners=function(){return this.bounds.corners()},Morph.prototype.leftCenter=function(){return this.bounds.leftCenter()},Morph.prototype.rightCenter=function(){return this.bounds.rightCenter()},Morph.prototype.topCenter=function(){return this.bounds.topCenter()},Morph.prototype.topLeft=function(){return this.bounds.topLeft()},Morph.prototype.topRight=function(){return this.bounds.topRight()},Morph.prototype.position=function(){return this.bounds.origin},Morph.prototype.extent=function(){return this.bounds.extent()},Morph.prototype.width=function(){return this.bounds.width()},Morph.prototype.height=function(){return this.bounds.height()},Morph.prototype.fullBounds=function(){var t;return t=this.bounds,this.children.forEach((function(e){e.isVisible&&(t=t.merge(e.fullBounds()))})),t},Morph.prototype.fullBoundsNoShadow=function(){var t;return t=this.bounds,this.children.forEach((function(e){e instanceof ShadowMorph||!e.isVisible||(t=t.merge(e.fullBounds()))})),t},Morph.prototype.visibleBounds=function(){var t=this.bounds;return this.allParents().filter((function(t){return t instanceof FrameMorph})).forEach((function(e){t=t.intersect(e.bounds)})),t},Morph.prototype.moveBy=function(t){this.fullChanged(),this.silentMoveBy(t),this.fullChanged()},Morph.prototype.silentMoveBy=function(t){var e=this.children,n=e.length;for(this.bounds=this.bounds.translateBy(t),this.cachedFullBounds&&(this.cachedFullBounds=this.cachedFullBounds.translateBy(t));n>0;n-=1)e[n-1].silentMoveBy(t)},Morph.prototype.setPosition=function(t){var e=t.subtract(this.topLeft());0===e.x&&0===e.y||this.moveBy(e)},Morph.prototype.silentSetPosition=function(t){var e=t.subtract(this.topLeft());0===e.x&&0===e.y||this.silentMoveBy(e)},Morph.prototype.setLeft=function(t){this.setPosition(new Point(t,this.top()))},Morph.prototype.setRight=function(t){this.setPosition(new Point(t-this.width(),this.top()))},Morph.prototype.setTop=function(t){this.setPosition(new Point(this.left(),t))},Morph.prototype.setBottom=function(t){this.setPosition(new Point(this.left(),t-this.height()))},Morph.prototype.setCenter=function(t){this.setPosition(t.subtract(this.extent().floorDivideBy(2)))},Morph.prototype.setFullCenter=function(t){this.setPosition(t.subtract(this.fullBounds().extent().floorDivideBy(2)))},Morph.prototype.keepWithin=function(t){var e,n,r,i;(n=this.fullBounds().right()-t.right())>0&&this.moveBy(new Point(-n,0)),(e=this.fullBounds().left()-t.left())<0&&this.moveBy(new Point(-e,0)),(i=this.fullBounds().bottom()-t.bottom())>0&&this.moveBy(new Point(0,-i)),(r=this.fullBounds().top()-t.top())<0&&this.moveBy(new Point(0,-r))},Morph.prototype.scrollIntoView=function(){var t,e,n,r,i=this.parentThatIsA(ScrollFrameMorph);i&&((e=Math.min(this.fullBounds().right()-i.right(),i.contents.right()-i.right()))>0&&i.contents.moveBy(new Point(-e,0)),(t=this.fullBounds().left()-i.left())<0&&i.contents.moveBy(new Point(-t,0)),(n=this.fullBounds().top()-i.top())<0&&i.contents.moveBy(new Point(0,-n)),(r=this.fullBounds().bottom()-i.bottom())>0&&i.contents.moveBy(new Point(0,-r)),i.adjustScrollBars())},Morph.prototype.setExtent=function(t,e){e?this.silentSetExtent(t):t.eq(this.extent())||(this.changed(),this.silentSetExtent(t),this.changed(),this.drawNew())},Morph.prototype.silentSetExtent=function(t){var e,n,r;e=t.round(),n=Math.max(e.x,0),r=Math.max(e.y,0),this.bounds.corner=new Point(this.bounds.origin.x+n,this.bounds.origin.y+r)},Morph.prototype.setWidth=function(t){this.setExtent(new Point(t||0,this.height()))},Morph.prototype.silentSetWidth=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.origin.x+e,this.bounds.corner.y)},Morph.prototype.setHeight=function(t){this.setExtent(new Point(this.width(),t||0))},Morph.prototype.silentSetHeight=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.corner.x,this.bounds.origin.y+e)},Morph.prototype.setColor=function(t){t&&(this.color.eq(t)||(this.color=t,this.changed(),this.drawNew()))},Morph.prototype.drawNew=function(){this.image=newCanvas(this.extent());var t=this.image.getContext("2d");t.fillStyle=this.color.toString(),t.fillRect(0,0,this.width(),this.height()),this.cachedTexture?this.drawCachedTexture():this.texture&&this.drawTexture(this.texture)},Morph.prototype.drawTexture=function(t){var e=this;this.cachedTexture=new Image,this.cachedTexture.onload=function(){e.drawCachedTexture()},this.cachedTexture.src=this.texture=t},Morph.prototype.drawCachedTexture=function(){var t,e,n=this.cachedTexture,r=Math.floor(this.image.width/n.width),i=Math.floor(this.image.height/n.height),o=this.image.getContext("2d");for(e=0;e<=i;e+=1)for(t=0;t<=r;t+=1)o.drawImage(n,t*n.width,e*n.height);this.changed()},Morph.prototype.drawOn=function(t,e){var n,r,i,o,s,h,a,l,u=this.cachedFullImage||this.image,c=this.cachedFullBounds||this.bounds;if(!this.isVisible)return null;if((n=(e||c).intersect(c)).extent().gt(new Point(0,0))){if(r=c.position().neg(),i=n.copy().translateBy(r),(o=t.getContext("2d")).globalAlpha=this.alpha,a=i.left(),l=i.top(),s=Math.min(i.width(),u.width-a),h=Math.min(i.height(),u.height-l),s<1||h<1)return null;o.drawImage(u,a,l,s,h,n.left(),n.top(),s,h)}},Morph.prototype.fullDrawOn=function(t,e){var n;if(!this.isVisible)return null;n=e||this.cachedFullBounds||this.fullBounds(),this.drawOn(t,n),this.cachedFullImage||this.children.forEach((function(e){e.fullDrawOn(t,n)}))},Morph.prototype.hide=function(){this.isVisible=!1,this.changed(),this.children.forEach((function(t){t.hide()}))},Morph.prototype.show=function(){this.isVisible=!0,this.changed(),this.children.forEach((function(t){t.show()}))},Morph.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible,this.changed(),this.children.forEach((function(t){t.toggleVisibility()}))},Morph.prototype.fullImageClassic=function(){var t=this.cachedFullBounds||this.fullBounds(),e=newCanvas(t.extent());return e.getContext("2d").translate(-t.origin.x,-t.origin.y),this.fullDrawOn(e,t),e.globalAlpha=this.alpha,e},Morph.prototype.fullImage=function(){var t,e,n;return t=newCanvas(this.fullBounds().extent()),e=t.getContext("2d"),n=this.fullBounds(),this.allChildren().forEach((function(t){t.isVisible&&(e.globalAlpha=t.alpha,t.image.width&&t.image.height&&e.drawImage(t.image,t.bounds.origin.x-n.origin.x,t.bounds.origin.y-n.origin.y))})),t},Morph.prototype.shadowImage=function(t,e){var n,r,i,o,s,h=t||new Point(7,7),a=e||new Color(0,0,0);return n=this.fullBounds().extent(),r=this.fullImage(),(s=(i=newCanvas(n)).getContext("2d")).drawImage(r,0,0),s.globalCompositeOperation="destination-out",s.drawImage(r,-h.x,-h.y),(s=(o=newCanvas(n)).getContext("2d")).drawImage(i,0,0),s.globalCompositeOperation="source-atop",s.fillStyle=a.toString(),s.fillRect(0,0,n.x,n.y),o},Morph.prototype.shadowImageBlurred=function(t,e){var n,r,i,o,s=t||new Point(7,7),h=this.shadowBlur,a=e||new Color(0,0,0);return n=this.fullBounds().extent().add(2*h),r=this.fullImage(),(o=(i=newCanvas(n)).getContext("2d")).shadowOffsetX=s.x,o.shadowOffsetY=s.y,o.shadowBlur=h,o.shadowColor=a.toString(),o.drawImage(r,h-s.x,h-s.y),o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=0,o.globalCompositeOperation="destination-out",o.drawImage(r,h-s.x,h-s.y),i},Morph.prototype.shadow=function(t,e,n){var r=new ShadowMorph,i=t||new Point(7,7),o=e||(0===e?0:.2),s=this.fullBounds();return r.setExtent(s.extent().add(2*this.shadowBlur)),useBlurredShadows&&!MorphicPreferences.isFlat?(r.image=this.shadowImageBlurred(i,n),r.alpha=o,r.setPosition(s.origin.add(i).subtract(this.shadowBlur))):(r.image=this.shadowImage(i,n),r.alpha=o,r.setPosition(s.origin.add(i))),r},Morph.prototype.addShadow=function(t,e,n){var r,i=t||new Point(7,7),o=e||(0===e?0:.2);return r=this.shadow(i,o,n),this.addBack(r),this.fullChanged(),r},Morph.prototype.getShadow=function(){var t;return 0!==(t=this.children.slice(0).reverse().filter((function(t){return t instanceof ShadowMorph}))).length?t[0]:null},Morph.prototype.removeShadow=function(){var t=this.getShadow();null!==t&&(this.fullChanged(),this.removeChild(t))},Morph.prototype.penTrails=function(){return this.image},Morph.prototype.changed=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread())}this.parent&&this.parent.childChanged(this)},Morph.prototype.fullChanged=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push((this.cachedFullBounds||this.fullBounds()).spread())}},Morph.prototype.childChanged=function(){this.parent&&this.parent.childChanged(this)},Morph.prototype.world=function(){var t=this.root();return t instanceof WorldMorph?t:t instanceof HandMorph?t.world:null},Morph.prototype.add=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChild(t)},Morph.prototype.addBack=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChildFirst(t)},Morph.prototype.topMorphAt=function(t){var e,n;if(!this.isVisible)return null;for(e=this.children.length-1;e>=0;e-=1)if(n=this.children[e].topMorphAt(t))return n;return!this.bounds.containsPoint(t)||!this.noticesTransparentClick&&this.isTransparentAt(t)?null:this},Morph.prototype.topMorphSuchThat=function(t){var e;return t.call(null,this)?(e=detect(this.children.slice(0).reverse(),t))?e.topMorphSuchThat(t):this:null},Morph.prototype.overlappedMorphs=function(){var t=this.world(),e=this.fullBounds(),n=this,r=this.allParents(),i=this.allChildren();return t.allChildren().filter((function(o){return o.isVisible&&o!==n&&o!==t&&!contains(r,o)&&!contains(i,o)&&o.fullBounds().intersects(e)}))},Morph.prototype.getPixelColor=function(t){var e,n;return e=t.subtract(this.bounds.origin),new Color((n=this.image.getContext("2d").getImageData(e.x,e.y,1,1)).data[0],n.data[1],n.data[2],n.data[3]/255)},Morph.prototype.isTransparentAt=function(t){var e;return!!this.bounds.containsPoint(t)&&(!this.texture&&(e=t.subtract(this.bounds.origin),0===this.image.getContext("2d").getImageData(Math.floor(e.x),Math.floor(e.y),1,1).data[3]))},Morph.prototype.copy=function(){var t=copy(this);return t.parent=null,t.children=[],t.bounds=this.bounds.copy(),t},Morph.prototype.fullCopy=function(){var t,e=new Map;return(t=this.copyRecordingReferences(e)).forAllChildren((function(t){t.updateReferences(e)})),t},Morph.prototype.copyRecordingReferences=function(t){var e=this.copy();return t.set(this,e),this.children.forEach((function(n){e.add(n.copyRecordingReferences(t))})),e},Morph.prototype.updateReferences=function(t){var e,n,r,i,o=Object.keys(this),s=o.length;for(i=0;i<s;i+=1)(n=this[e=o[i]])&&n.isMorph&&(r=t.get(n))&&(this[e]=r)},Morph.prototype.rootForGrab=function(){return this instanceof ShadowMorph?this.parent.rootForGrab():this.parent instanceof ScrollFrameMorph?this.parent:null===this.parent||this.parent instanceof WorldMorph||this.parent instanceof FrameMorph||!0===this.isDraggable?this:this.parent.rootForGrab()},Morph.prototype.isCorrectingOutsideDrag=function(){return!0},Morph.prototype.wantsDropOf=function(t){return!(t instanceof HandleMorph||t instanceof MenuMorph||t instanceof InspectorMorph)&&this.acceptsDrops},Morph.prototype.pickUp=function(t){var e=t||this.world();this.setPosition(e.hand.position().subtract(this.extent().floorDivideBy(2))),e.hand.grab(this)},Morph.prototype.isPickedUp=function(){return null!==this.parentThatIsA(HandMorph)},Morph.prototype.situation=function(){return this.parent?{origin:this.parent,position:this.position().subtract(this.parent.position())}:null},Morph.prototype.slideBackTo=function(t,e,n,r){var i=t.origin.position().add(t.position),o=this;this.glideTo(i,e,null,(function(){t.origin.add(o),n&&n(),o.justDropped&&o.justDropped(),t.origin.reactToDropOf&&t.origin.reactToDropOf(o),r&&r()}))},Morph.prototype.glideTo=function(t,e,n,r){var i=this.world(),o=this;i.animations.push(new Animation((function(t){o.setLeft(t)}),(function(){return o.left()}),-(this.left()-t.x),e||100,n,r)),i.animations.push(new Animation((function(t){o.setTop(t)}),(function(){return o.top()}),-(this.top()-t.y),e||100,n))},Morph.prototype.fadeTo=function(t,e,n,r){var i=this.world(),o=this,s=this.alpha;this.children.forEach((function(r){r.fadeTo(t,e,n)})),i.animations.push(new Animation((function(t){o.alpha=t,o.changed()}),(function(){return o.alpha}),t-this.alpha,e||200,n,(function(){o.alpha=s,r&&r()})))},Morph.prototype.perish=function(t,e){var n=this;this.fadeTo(0,t||100,null,(function(){n.destroy(),e&&e()}))},Morph.prototype.nop=nop,Morph.prototype.resize=function(){this.world().activeHandle=new HandleMorph(this)},Morph.prototype.move=function(){this.world().activeHandle=new HandleMorph(this,null,null,null,null,"move")},Morph.prototype.moveCenter=function(){this.world().activeHandle=new HandleMorph(this,null,null,null,null,"moveCenter")},Morph.prototype.hint=function(t){var e,n;n=t,t?t.toString&&(n=t.toString()):n="NULL",(e=new MenuMorph(this,n)).isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.inform=function(t){var e,n;n=t,t?t.toString&&(n=t.toString()):n="NULL",(e=new MenuMorph(this,n)).addItem("Ok"),e.isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.prompt=function(t,e,n,r,i,o,s,h){var a,l,u,c;s&&(c=!0),a=new MenuMorph(e||null,t||"",n||null),l=new StringFieldMorph(r||"",i||100,MorphicPreferences.prompterFontSize,MorphicPreferences.prompterFontName,!1,!1,c),a.items.push(l),(s||MorphicPreferences.useSliderForInput)&&((u=new SliderMorph(o||0,s,parseFloat(r),Math.floor((s-o)/4),"horizontal")).alpha=1,u.color=new Color(225,225,225),u.button.color=a.borderColor,u.button.highlightColor=u.button.color.copy(),u.button.highlightColor.b+=100,u.button.pressColor=u.button.color.copy(),u.button.pressColor.b+=150,u.setHeight(MorphicPreferences.prompterSliderSize),u.action=h?function(t){l.changed(),l.text.text=Math.round(t).toString(),l.text.drawNew(),l.text.changed(),l.text.edit()}:function(t){l.changed(),l.text.text=t.toString(),l.text.drawNew(),l.text.changed()},a.items.push(u)),a.addLine(2),a.addItem("Ok",(function(){return l.string()})),a.addItem("Cancel",(function(){return null})),a.isDraggable=!0,a.popUpAtHand(this.world()),l.text.edit()},Morph.prototype.pickColor=function(t,e,n,r){var i,o;i=new MenuMorph(e||null,t||"",n||null),o=new ColorPickerMorph(r),i.items.push(o),i.addLine(2),i.addItem("Ok",(function(){return o.getChoice()})),i.addItem("Cancel",(function(){return null})),i.isDraggable=!0,i.popUpAtHand(this.world())},Morph.prototype.inspect=function(t){var e,n=this.world instanceof Function?this.world():this.root()||this.world,r=this;t&&(r=t),(e=new InspectorMorph(r)).setPosition(n.hand.position()),e.keepWithin(n),n.add(e),e.changed()},Morph.prototype.contextMenu=function(){var t;return this.customContextMenu?this.customContextMenu:(t=this.world instanceof Function?this.world():this.world)&&t.isDevMode?this.parent===t?this.developersMenu():this.hierarchyMenu():this.userMenu()||this.parent&&this.parent.userMenu()},Morph.prototype.hierarchyMenu=function(){var t=this.allParents(),e=this.world instanceof Function?this.world():this.world,n=new MenuMorph(this,null);return t.forEach((function(t){t.developersMenu&&t!==e&&n.addMenu(t.toString().slice(0,50),t.developersMenu())})),n},Morph.prototype.developersMenu=function(){var t=this.world instanceof Function?this.world():this.world,e=this.userMenu()||this.parent&&this.parent.userMenu(),n=new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]);return e&&(n.addMenu("user features",e),n.addLine()),n.addItem("color...",(function(){this.pickColor(n.title+localize("\ncolor:"),this.setColor,this,this.color)}),"choose another color \nfor this morph.js"),n.addItem("transparency...",(function(){this.prompt(n.title+localize("\nalpha\nvalue:"),this.setAlphaScaled,this,(100*this.alpha).toString(),null,1,100,!0)}),"set this morph.js's\nalpha value"),n.addItem("resize...","resize","show a handle\nwhich can be dragged\nto change this morph.js's extent"),n.addLine(),n.addItem("duplicate",(function(){this.fullCopy().pickUp(this.world())}),"make a copy\nand pick it up"),n.addItem("pick up","pickUp","detach and put \ninto the hand"),n.addItem("attach...","attach","stick this morph.js\nto another one"),n.addItem("move...","move","show a handle\nwhich can be dragged\nto move this morph.js"),n.addItem("inspect...","inspect","open a window\non all properties"),n.addItem("pic...",(function(){window.open(this.fullImageClassic().toDataURL())}),"open a new window\nwith a picture of this morph.js"),n.addLine(),this.isDraggable?n.addItem("lock","toggleIsDraggable","make this morph.js\nunmovable"):n.addItem("unlock","toggleIsDraggable","make this morph.js\nmovable"),n.addItem("hide","hide"),n.addItem("delete","destroy"),this instanceof WorldMorph||(n.addLine(),n.addItem("World...",(function(){t.contextMenu().popUpAtHand(t)}),"show the\nWorld's menu")),n},Morph.prototype.userMenu=function(){return null},Morph.prototype.setAlphaScaled=function(t){var e,n;"number"==typeof t?(n=t/100,this.alpha=Math.min(Math.max(n,.1),1)):(e=parseFloat(t),isNaN(e)||(n=e/100,this.alpha=Math.min(Math.max(n,.1),1))),this.changed()},Morph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose new parent:"),n=this;t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){t.add(n),n.isDraggable=!1}))})),t.length>0&&e.popUpAtHand(this.world())},Morph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable},Morph.prototype.colorSetters=function(){return["color"]},Morph.prototype.numericalSetters=function(){return["setLeft","setTop","setWidth","setHeight","setAlphaScaled"]},Morph.prototype.allEntryFields=function(){return this.allChildren().filter((function(t){return t.isEditable&&(t instanceof StringMorph||t instanceof TextMorph)}))},Morph.prototype.nextEntryField=function(t){var e=this.allEntryFields(),n=e.indexOf(t);return-1!==n&&e.length>n+1?e[n+1]:e[0]},Morph.prototype.previousEntryField=function(t){var e=this.allEntryFields(),n=e.indexOf(t);return-1!==n?n>0?e[n-1]:e[e.length-1]:e[0]},Morph.prototype.tab=function(t){this.nextTab?this.nextTab(t):this.parent&&this.parent.tab(t)},Morph.prototype.backTab=function(t){this.previousTab?this.previousTab(t):this.parent&&this.parent.backTab(t)},Morph.prototype.escalateEvent=function(t,e){for(var n=this.parent;!n[t]&&null!==n.parent;)n=n.parent;n[t]&&n[t](e)},Morph.prototype.evaluateString=function(code){var result;try{result=eval(code),this.drawNew(),this.changed()}catch(t){this.inform(t)}return result},Morph.prototype.isTouching=function(t){var e=this.overlappingImage(t);return!(!e.width||!e.height)&&null!==detect(e.getContext("2d").getImageData(1,1,e.width,e.height).data,(function(t){return 0!==t}))},Morph.prototype.overlappingImage=function(t){var e=this.fullBounds(),n=t.fullBounds(),r=e.intersect(n),i=newCanvas(r.extent()),o=i.getContext("2d");return r.width()<1||r.height()<1?newCanvas(new Point(1,1)):(o.drawImage(this.fullImage(),r.origin.x-e.origin.x,r.origin.y-e.origin.y),o.globalCompositeOperation="source-in",o.drawImage(t.fullImage(),n.origin.x-r.origin.x,n.origin.y-r.origin.y),i)},ShadowMorph.prototype=new Morph,ShadowMorph.prototype.constructor=ShadowMorph,ShadowMorph.uber=Morph.prototype,ShadowMorph.prototype.topMorphAt=function(){return null},HandleMorph.prototype=new Morph,HandleMorph.prototype.constructor=HandleMorph,HandleMorph.uber=Morph.prototype,HandleMorph.prototype.init=function(t,e,n,r,i,o){var s=MorphicPreferences.handleSize;this.target=t||null,this.minExtent=new Point(e||0,n||0),this.inset=new Point(r||0,i||r||0),this.type=o||"resize",HandleMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isDraggable=!1,this.noticesTransparentClick=!0,"movePivot"===this.type&&(s*=2),this.setExtent(new Point(s,s))},HandleMorph.prototype.drawNew=function(){this.normalImage=newCanvas(this.extent()),this.highlightImage=newCanvas(this.extent()),"movePivot"===this.type?(this.drawCrosshairsOnCanvas(this.normalImage,.6),this.drawCrosshairsOnCanvas(this.highlightImage,.5)):(this.drawOnCanvas(this.normalImage,this.color,new Color(100,100,100)),this.drawOnCanvas(this.highlightImage,new Color(100,100,255),new Color(255,255,255))),this.image=this.normalImage,this.target&&("moveCenter"===this.type?this.setCenter(this.target.center()):"movePivot"===this.type?this.setCenter(this.target.rotationCenter()):this.setPosition(this.target.bottomRight().subtract(this.extent().add(this.inset))),this.target.add(this),this.target.changed())},HandleMorph.prototype.drawCrosshairsOnCanvas=function(t,e){var n=t.getContext("2d"),r=t.width/2;n.fillStyle="rgba(255, 255, 255, 0.5)",n.arc(r,r,.9*r,radians(0),radians(360),!1),n.fill(),n.strokeStyle="black",n.lineWidth=1,n.beginPath(),n.arc(r,r,r*e,radians(0),radians(360),!1),n.stroke(),n.moveTo(0,r),n.lineTo(t.width,r),n.stroke(),n.moveTo(r,0),n.lineTo(r,t.height),n.stroke()},HandleMorph.prototype.drawOnCanvas=function(t,e,n){var r,i,o,s,h,a=t.getContext("2d"),l=0===this.type.indexOf("move");if(a.lineWidth=1,a.lineCap="round",a.strokeStyle=e.toString(),l)for(i=(r=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),h=0;h<=this.height();h+=6)i.y=r.y-h,s.y=o.y-h,a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke();for(i=(r=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),h=0;h<=this.width();h+=6)i.x=r.x+h,s.x=o.x+h,a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke();if(a.strokeStyle=n.toString(),l)for(i=(r=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),h=-2;h<=this.height();h+=6)i.y=r.y-h,s.y=o.y-h,a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke();for(i=(r=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),h=2;h<=this.width();h+=6)i.x=r.x+h,s.x=o.x+h,a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(s.x,s.y),a.closePath(),a.stroke()},HandleMorph.prototype.step=null,HandleMorph.prototype.mouseDownLeft=function(t){var e,n=this.root(),r=this;if(!this.target)return null;e=0===this.type.indexOf("move")?t.subtract(this.center()):t.subtract(this.bounds.origin),this.step=function(){var t,i;n.hand.mouseButton?(t=n.hand.bounds.origin.copy().subtract(e),"resize"===this.type?(i=(i=t.add(r.extent().add(r.inset)).subtract(r.target.bounds.origin)).max(r.minExtent),r.target.setExtent(i),r.setPosition(r.target.bottomRight().subtract(r.extent().add(r.inset)))):"moveCenter"===this.type?r.target.setCenter(t):"movePivot"===this.type?(r.target.setPivot(t),r.setCenter(this.target.rotationCenter())):r.target.setPosition(t.subtract(this.target.extent()).add(this.extent()))):this.step=null},this.target.step||(this.target.step=function(){nop()})},HandleMorph.prototype.rootForGrab=function(){return this},HandleMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},HandleMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},HandleMorph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),n=this;t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){n.isDraggable=!1,n.target=t,n.drawNew(),n.noticesTransparentClick=!0}))})),t.length>0&&e.popUpAtHand(this.world())},PenMorph.prototype=new Morph,PenMorph.prototype.constructor=PenMorph,PenMorph.uber=Morph.prototype,PenMorph.prototype.init=function(){var t=4*MorphicPreferences.handleSize;this.isWarped=!1,this.heading=0,this.isDown=!0,this.size=1,this.wantsRedraw=!1,this.penPoint="tip",this.penBounds=null,HandleMorph.uber.init.call(this),this.setExtent(new Point(t,t))},PenMorph.prototype.changed=function(){if(!1===this.isWarped){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread()),this.parent&&this.parent.childChanged(this)}},PenMorph.prototype.drawNew=function(t){var e,n,r,i,o,s,h=t||this.heading;this.isWarped?this.wantsRedraw=!0:(this.image=newCanvas(this.extent()),e=this.image.getContext("2d"),s=this.width()/2,n=this.center().subtract(this.bounds.origin),"tip"===this.penPoint?(r=n.distanceAngle(.75*s,h-180),i=n.distanceAngle(s,h+195),o=n.distanceAngle(s,h-195)):(r=n.distanceAngle(.75*s,h),i=n.distanceAngle(.33*s,h+230),o=n.distanceAngle(.33*s,h-230)),this.penBounds=new Rectangle(Math.min(n.x,r.x,i.x,o.x),Math.min(n.y,r.y,i.y,o.y),Math.max(n.x,r.x,i.x,o.x),Math.max(n.y,r.y,i.y,o.y)),e.fillStyle=this.color.toString(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),e.lineTo(r.x,r.y),e.lineTo(o.x,o.y),e.closePath(),e.strokeStyle="white",e.lineWidth=3,e.stroke(),e.strokeStyle="black",e.lineWidth=1,e.stroke(),e.fill())},PenMorph.prototype.setHeading=function(t){this.heading=(+t%360+360)%360,this.drawNew(),this.changed()},PenMorph.prototype.numericalSetters=function(){return["setLeft","setTop","setWidth","setHeight","setAlphaScaled","setHeading"]},PenMorph.prototype.developersMenu=function(){var t=PenMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("set rotation","setRotation","interactively turn this morph.jsk\nusing a dial widget"),t},PenMorph.prototype.setRotation=function(){var t,e,n=this.name||this.constructor.name;n.length>10&&(n=n.slice(0,9)+"..."),t=new MenuMorph(this,n),(e=new DialMorph(null,null,this.heading)).rootForGrab=function(){return this},e.target=this,e.action="setHeading",t.items.push(e),t.addLine(),t.addItem("(90) right",(function(){this.setHeading(90)})),t.addItem("(-90) left",(function(){this.setHeading(-90)})),t.addItem("(0) up",(function(){this.setHeading(0)})),t.addItem("(180) down",(function(){this.setHeading(180)})),t.isDraggable=!0,t.popUpAtHand(this.world())},PenMorph.prototype.drawLine=function(t,e){var n=this.parent.penTrails().getContext("2d"),r=t.subtract(this.parent.bounds.origin),i=e.subtract(this.parent.bounds.origin);this.isDown&&(n.lineWidth=this.size,n.strokeStyle=this.color.toString(),n.lineCap="round",n.lineJoin="round",n.beginPath(),n.moveTo(r.x,r.y),n.lineTo(i.x,i.y),n.stroke(),!1===this.isWarped&&this.world().broken.push(t.rectangle(e).expandBy(Math.max(this.size/2,1)).intersect(this.parent.visibleBounds()).spread()))},PenMorph.prototype.turn=function(t){this.setHeading(this.heading+parseFloat(t))},PenMorph.prototype.forward=function(t){var e,n=this.center(),r=parseFloat(t);e=r>=0?this.position().distanceAngle(r,this.heading):this.position().distanceAngle(Math.abs(r),this.heading-180),this.setPosition(e),this.drawLine(n,this.center())},PenMorph.prototype.down=function(){this.isDown=!0},PenMorph.prototype.up=function(){this.isDown=!1},PenMorph.prototype.clear=function(){this.parent.drawNew(),this.parent.changed()},PenMorph.prototype.startWarp=function(){this.wantsRedraw=!1,this.isWarped=!0},PenMorph.prototype.endWarp=function(){this.isWarped=!1,this.wantsRedraw&&(this.drawNew(),this.wantsRedraw=!1),this.parent.changed()},PenMorph.prototype.warp=function(t){this.startWarp(),t.call(this),this.endWarp()},PenMorph.prototype.warpOp=function(t,e){this.startWarp(),this[t].apply(this,e),this.endWarp()},PenMorph.prototype.warpSierpinski=function(t,e){this.warpOp("sierpinski",[t,e])},PenMorph.prototype.sierpinski=function(t,e){var n;if(t>e)for(n=0;n<3;n+=1)this.sierpinski(.5*t,e),this.turn(120),this.forward(t)},PenMorph.prototype.warpTree=function(t,e,n){this.warpOp("tree",[t,e,n])},PenMorph.prototype.tree=function(t,e,n){t>0&&(this.size=t,this.forward(e),this.turn(n),this.tree(t-1,.75*e,n),this.turn(-2*n),this.tree(t-1,.75*e,n),this.turn(n),this.forward(-e))},ColorPaletteMorph.prototype=new Morph,ColorPaletteMorph.prototype.constructor=ColorPaletteMorph,ColorPaletteMorph.uber=Morph.prototype,ColorPaletteMorph.prototype.init=function(t,e){ColorPaletteMorph.uber.init.call(this),this.target=t,this.targetSetter="color",this.silentSetExtent(e),this.choice=null,this.drawNew()},ColorPaletteMorph.prototype.drawNew=function(){var t,e,n,r,i,o;for(e=this.extent(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.choice=new Color,n=0;n<=e.x;n+=1)for(i=360*n/e.x,r=0;r<=e.y;r+=1)o=100-r/e.y*100,t.fillStyle="hsl("+i+",100%,"+o+"%)",t.fillRect(n,r,1,1)},ColorPaletteMorph.prototype.mouseMove=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.mouseDownLeft=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.updateTarget=function(){this.target instanceof Morph&&null!==this.choice&&(this.target[this.targetSetter]instanceof Function?this.target[this.targetSetter](this.choice):(this.target[this.targetSetter]=this.choice,this.target.drawNew(),this.target.changed()))},ColorPaletteMorph.prototype.developersMenu=function(){var t=ColorPaletteMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("set target","setTarget","choose another morph.jsk\nwhose color property\n will be controlled by this one"),t},ColorPaletteMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),n=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){n.target=t,n.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},ColorPaletteMorph.prototype.setTargetSetter=function(){var t=this.target.colorSetters(),e=new MenuMorph(this,"choose target property:"),n=this;t.forEach((function(t){e.addItem(t,(function(){n.targetSetter=t}))})),1===t.length?this.targetSetter=t[0]:t.length>0&&e.popUpAtHand(this.world())},GrayPaletteMorph.prototype=new ColorPaletteMorph,GrayPaletteMorph.prototype.constructor=GrayPaletteMorph,GrayPaletteMorph.uber=ColorPaletteMorph.prototype,GrayPaletteMorph.prototype.drawNew=function(){var t,e,n;e=this.extent(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.choice=new Color,(n=t.createLinearGradient(0,0,e.x,e.y)).addColorStop(0,"black"),n.addColorStop(1,"white"),t.fillStyle=n,t.fillRect(0,0,e.x,e.y)},ColorPickerMorph.prototype=new Morph,ColorPickerMorph.prototype.constructor=ColorPickerMorph,ColorPickerMorph.uber=Morph.prototype,ColorPickerMorph.prototype.init=function(t){this.choice=t,ColorPickerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.silentSetExtent(new Point(80,80)),this.drawNew()},ColorPickerMorph.prototype.drawNew=function(){ColorPickerMorph.uber.drawNew.call(this),this.buildSubmorphs()},ColorPickerMorph.prototype.buildSubmorphs=function(){var t,e,n,r;this.children.forEach((function(t){t.destroy()})),this.children=[],this.feedback=new Morph,this.feedback.color=this.choice,this.feedback.setExtent(new Point(20,20)),t=new ColorPaletteMorph(this.feedback,new Point(this.width(),50)),e=new GrayPaletteMorph(this.feedback,new Point(this.width(),5)),t.setPosition(this.bounds.origin),this.add(t),e.setPosition(t.bottomLeft()),this.add(e),n=e.left()+Math.floor((e.width()-this.feedback.width())/2),r=e.bottom()+Math.floor((this.bottom()-e.bottom()-this.feedback.height())/2),this.feedback.setPosition(new Point(n,r)),this.add(this.feedback)},ColorPickerMorph.prototype.getChoice=function(){return this.feedback.color},ColorPickerMorph.prototype.rootForGrab=function(){return this},BlinkerMorph.prototype=new Morph,BlinkerMorph.prototype.constructor=BlinkerMorph,BlinkerMorph.uber=Morph.prototype,BlinkerMorph.prototype.init=function(t){BlinkerMorph.uber.init.call(this),this.color=new Color(0,0,0),this.fps=t||2,this.drawNew()},BlinkerMorph.prototype.step=function(){this.toggleVisibility()},CursorMorph.prototype=new BlinkerMorph,CursorMorph.prototype.constructor=CursorMorph,CursorMorph.uber=BlinkerMorph.prototype,CursorMorph.prototype.viewPadding=1,CursorMorph.prototype.init=function(t){var e;this.keyDownEventUsed=!1,this.target=t,this.originalContents=this.target.text,this.originalAlignment=this.target.alignment,this.slot=this.target.text.length,CursorMorph.uber.init.call(this),e=fontHeight(this.target.fontSize),this.setExtent(new Point(Math.max(Math.floor(e/20),1),e)),this.drawNew(),this.image.getContext("2d").font=this.target.font(),this.target instanceof TextMorph&&"left"!==this.target.alignment&&this.target.setAlignmentToLeft(),this.gotoSlot(this.slot),this.initializeClipboardHandler()},CursorMorph.prototype.initializeClipboardHandler=function(){var t=this,e=this.target.world();this.clipboardHandler=document.createElement("textarea"),this.clipboardHandler.style.position="absolute",this.clipboardHandler.style.top=window.outerHeight,this.clipboardHandler.style.right="101%",document.body.appendChild(this.clipboardHandler),this.clipboardHandler.value=this.target.selection(),this.clipboardHandler.focus(),this.clipboardHandler.select(),this.clipboardHandler.addEventListener("keypress",(function(e){t.processKeyPress(e),this.value=t.target.selection(),this.select()}),!1),this.clipboardHandler.addEventListener("keydown",(function(n){t.processKeyDown(n),n.shiftKey&&(e.currentKey=16),this.value=t.target.selection(),this.select(),"U+0009"!==n.key&&"Tab"!==n.key||(t.processKeyPress(n),n.preventDefault())}),!1),this.clipboardHandler.addEventListener("keyup",(function(t){e.currentKey=null}),!1),this.clipboardHandler.addEventListener("input",(function(e){""===this.value&&(t.gotoSlot(t.target.selectionStartSlot()),t.target.deleteSelection())}),!1)},CursorMorph.prototype.processKeyPress=function(t){return this.keyDownEventUsed?(this.keyDownEventUsed=!1,null):40===t.keyCode||40===t.charCode?(this.insert("("),null):37===t.keyCode||37===t.charCode?(this.insert("%"),null):(t.keyCode?t.ctrlKey&&!t.altKey?this.ctrl(t.keyCode,t.shiftKey):t.metaKey?this.cmd(t.keyCode,t.shiftKey):this.insert(String.fromCharCode(t.keyCode),t.shiftKey):t.charCode&&(t.ctrlKey&&!t.altKey?this.ctrl(t.charCode,t.shiftKey):t.metaKey?this.cmd(t.charCode,t.shiftKey):this.insert(String.fromCharCode(t.charCode),t.shiftKey)),void this.target.escalateEvent("reactToKeystroke",t))},CursorMorph.prototype.processKeyDown=function(t){var e=t.shiftKey,n=t.ctrlKey||t.altKey,r=this.target.selection().length>0;switch(this.keyDownEventUsed=!1,t.ctrlKey&&!t.altKey&&(this.ctrl(t.keyCode,t.shiftKey),this.target.escalateEvent("reactToKeystroke",t)),t.metaKey&&(this.cmd(t.keyCode,t.shiftKey),this.target.escalateEvent("reactToKeystroke",t)),t.keyCode){case 37:!r||e||n?this.goLeft(e,n?this.slot-this.target.previousWordFrom(this.slot):1):(this.gotoSlot(Math.min(this.target.startMark,this.target.endMark)),this.target.clearSelection()),this.keyDownEventUsed=!0;break;case 39:!r||e||n?this.goRight(e,n?this.target.nextWordFrom(this.slot)-this.slot:1):(this.gotoSlot(Math.max(this.target.startMark,this.target.endMark)),this.target.clearSelection()),this.keyDownEventUsed=!0;break;case 38:this.goUp(e),this.keyDownEventUsed=!0;break;case 40:this.goDown(e),this.keyDownEventUsed=!0;break;case 36:this.goHome(e),this.keyDownEventUsed=!0;break;case 35:this.goEnd(e),this.keyDownEventUsed=!0;break;case 46:this.deleteRight(),this.keyDownEventUsed=!0;break;case 8:this.deleteLeft(),this.keyDownEventUsed=!0;break;case 13:this.target instanceof StringMorph||e?this.accept():this.insert("\n"),this.keyDownEventUsed=!0;break;case 27:this.cancel(),this.keyDownEventUsed=!0;break;default:nop()}this.target.escalateEvent("reactToKeystroke",t)},CursorMorph.prototype.gotoSlot=function(t){var e,n,r=this.target.text.length,i=this.target.slotPosition(t);this.slot=t<0?0:t>r?r:t,this.parent&&this.target.isScrollable&&(e=this.parent.right()-this.viewPadding,n=this.parent.left()+this.viewPadding,i.x>e&&(this.target.setLeft(this.target.left()+e-i.x),i.x=e),i.x<n&&(n=Math.min(this.parent.left(),n),this.target.setLeft(this.target.left()+n-i.x),i.x=n),this.target.right()<e&&e-this.target.width()<n&&(i.x+=e-this.target.right(),this.target.setRight(e))),this.show(),this.setPosition(i),this.parent&&this.parent.parent instanceof ScrollFrameMorph&&this.target.isScrollable&&this.parent.parent.scrollCursorIntoView(this)},CursorMorph.prototype.goLeft=function(t,e){this.updateSelection(t),this.gotoSlot(this.slot-(e||1)),this.updateSelection(t)},CursorMorph.prototype.goRight=function(t,e){this.updateSelection(t),this.gotoSlot(this.slot+(e||1)),this.updateSelection(t)},CursorMorph.prototype.goUp=function(t){this.updateSelection(t),this.gotoSlot(this.target.upFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goDown=function(t){this.updateSelection(t),this.gotoSlot(this.target.downFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goHome=function(t){this.updateSelection(t),this.gotoSlot(this.target.startOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goEnd=function(t){this.updateSelection(t),this.gotoSlot(this.target.endOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.gotoPos=function(t){this.gotoSlot(this.target.slotAt(t)),this.show()},CursorMorph.prototype.updateSelection=function(t){t?isNil(this.target.endMark)&&isNil(this.target.startMark)?(this.target.startMark=this.slot,this.target.endMark=this.slot):this.target.endMark!==this.slot&&(this.target.endMark=this.slot,this.target.drawNew(),this.target.changed()):this.target.clearSelection()},CursorMorph.prototype.accept=function(){var t=this.root();t&&t.stopEditing(),this.escalateEvent("accept",this)},CursorMorph.prototype.cancel=function(){var t=this.root();this.undo(),t&&t.stopEditing(),this.escalateEvent("cancel",this)},CursorMorph.prototype.undo=function(){this.target.text=this.originalContents,this.target.changed(),this.target.drawNew(),this.target.changed(),this.gotoSlot(0)},CursorMorph.prototype.insert=function(t,e){var n;if("\t"===t)return this.target.escalateEvent("reactToEdit",this.target),e?this.target.backTab(this.target):this.target.tab(this.target);this.target.isNumeric&&isNaN(parseFloat(t))&&!contains(["-","."],t)||(""!==this.target.selection()&&(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()),n=(n=this.target.text).slice(0,this.slot)+t+n.slice(this.slot),this.target.text=n,this.target.drawNew(),this.target.changed(),this.goRight(!1,t.length))},CursorMorph.prototype.ctrl=function(t,e){64===t||65===t&&e?this.insert("@"):65===t?this.target.selectAll():90===t?this.undo():123===t?this.insert("{"):125===t?this.insert("}"):91===t?this.insert("["):93===t?this.insert("]"):isNil(this.target.receiver)||(68===t?this.target.doIt():73===t?this.target.inspectIt():80===t&&this.target.showIt())},CursorMorph.prototype.cmd=function(t,e){64===t||65===t&&e?this.insert("@"):65===t?this.target.selectAll():90===t?this.undo():isNil(this.target.receiver)||(68===t?this.target.doIt():73===t?this.target.inspectIt():80===t&&this.target.showIt())},CursorMorph.prototype.deleteRight=function(){var t;""!==this.target.selection()?(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()):(t=this.target.text,this.target.changed(),t=t.slice(0,this.slot)+t.slice(this.slot+1),this.target.text=t,this.target.drawNew())},CursorMorph.prototype.deleteLeft=function(){var t;if(this.target.selection())return this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection();t=this.target.text,this.target.changed(),this.target.text=t.substring(0,this.slot-1)+t.substr(this.slot),this.target.drawNew(),this.goLeft()},CursorMorph.prototype.destroy=function(){this.target.alignment!==this.originalAlignment&&(this.target.alignment=this.originalAlignment,this.target.drawNew(),this.target.changed()),this.destroyClipboardHandler(),CursorMorph.uber.destroy.call(this)},CursorMorph.prototype.destroyClipboardHandler=function(){var t,e=document.body.children;if(this.clipboardHandler)for(t=0;t<e.length;t+=1)e[t]===this.clipboardHandler&&(document.body.removeChild(this.clipboardHandler),this.clipboardHandler=null)},CursorMorph.prototype.inspectKeyEvent=function(t){this.inform("Key pressed: "+String.fromCharCode(t.charCode)+"\n------------------------\ncharCode: "+t.charCode.toString()+"\nkeyCode: "+t.keyCode.toString()+"\nshiftKey: "+t.shiftKey.toString()+"\naltKey: "+t.altKey.toString()+"\nctrlKey: "+t.ctrlKey.toString()+"\ncmdKey: "+t.metaKey.toString())},BoxMorph.prototype=new Morph,BoxMorph.prototype.constructor=BoxMorph,BoxMorph.uber=Morph.prototype,BoxMorph.prototype.init=function(t,e,n){this.edge=t||4,this.border=e||(0===e?0:2),this.borderColor=n||new Color,BoxMorph.uber.init.call(this)},BoxMorph.prototype.drawNew=function(){var t;if(this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),0===this.edge&&0===this.border)return BoxMorph.uber.drawNew.call(this),null;t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePath(t,Math.max(this.edge-this.border,0),this.border),t.closePath(),t.fill(),this.border>0&&(t.lineWidth=this.border,t.strokeStyle=this.borderColor.toString(),t.beginPath(),this.outlinePath(t,this.edge,this.border/2),t.closePath(),t.stroke())},BoxMorph.prototype.outlinePath=function(t,e,n){var r=e+n,i=this.width(),o=this.height();t.arc(r,r,e,radians(-180),radians(-90),!1),t.arc(i-r,r,e,radians(-90),radians(-0),!1),t.arc(i-r,o-r,e,radians(0),radians(90),!1),t.arc(r,o-r,e,radians(90),radians(180),!1)},BoxMorph.prototype.developersMenu=function(){var t=BoxMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("border width...",(function(){this.prompt(t.title+"\nborder\nwidth:",this.setBorderWidth,this,this.border.toString(),null,0,100,!0)}),"set the border's\nline size"),t.addItem("border color...",(function(){this.pickColor(t.title+"\nborder color:",this.setBorderColor,this,this.borderColor)}),"set the border's\nline color"),t.addItem("corner size...",(function(){this.prompt(t.title+"\ncorner\nsize:",this.setCornerSize,this,this.edge.toString(),null,0,100,!0)}),"set the corner's\nradius"),t},BoxMorph.prototype.setBorderWidth=function(t){var e;"number"==typeof t?this.border=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.border=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.setBorderColor=function(t){t&&(this.borderColor=t,this.drawNew(),this.changed())},BoxMorph.prototype.setCornerSize=function(t){var e;"number"==typeof t?this.edge=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.edge=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.colorSetters=function(){return["color","borderColor"]},BoxMorph.prototype.numericalSetters=function(){var t=BoxMorph.uber.numericalSetters.call(this);return t.push("setBorderWidth","setCornerSize"),t},SpeechBubbleMorph.prototype=new BoxMorph,SpeechBubbleMorph.prototype.constructor=SpeechBubbleMorph,SpeechBubbleMorph.uber=BoxMorph.prototype,SpeechBubbleMorph.prototype.init=function(t,e,n,r,i,o,s){this.isPointingRight=!0,this.contents=t||"",this.padding=o||0,this.isThought=s||!1,this.isClickable=!1,SpeechBubbleMorph.uber.init.call(this,n||6,r||(0===r?0:1),i||new Color(140,140,140)),this.color=e||new Color(230,230,230),this.drawNew()},SpeechBubbleMorph.prototype.popUp=function(t,e,n){this.drawNew(),this.setPosition(e.subtract(new Point(0,this.height()))),this.addShadow(new Point(2,2),80),this.keepWithin(t),t.add(this),this.fullChanged(),t.hand.destroyTemporaries(),t.hand.temporaries.push(this),n?this.isClickable=!0:this.mouseEnter=function(){this.destroy()}},SpeechBubbleMorph.prototype.drawNew=function(){this.contentsMorph&&this.contentsMorph.destroy(),this.contents instanceof Morph?this.contentsMorph=this.contents:isString(this.contents)?this.contentsMorph=new TextMorph(this.contents,MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center"):this.contents instanceof HTMLCanvasElement?(this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(this.contents.width),this.contentsMorph.silentSetHeight(this.contents.height),this.contentsMorph.image=this.contents):this.contentsMorph=new TextMorph(this.contents.toString(),MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center"),this.add(this.contentsMorph),this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge)),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border+2*this.padding+2),SpeechBubbleMorph.uber.drawNew.call(this),this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1)))},SpeechBubbleMorph.prototype.outlinePath=function(t,e,n){var r,i=e+n,o=this.width(),s=this.height();function h(e,n,r){t.moveTo(e+r,n),t.arc(e,n,r,radians(0),radians(360))}t.arc(i,i,e,radians(-180),radians(-90),!1),t.arc(o-i,i,e,radians(-90),radians(-0),!1),t.arc(o-i,s-i-e,e,radians(0),radians(90),!1),this.isThought||(this.isPointingRight?(t.lineTo(i+e,s-i),t.lineTo(e/2+n,s-n)):(t.lineTo(o-(e/2+n),s-n),t.lineTo(o-(i+e),s-i))),t.arc(i,s-i-e,e,radians(90),radians(180),!1),!0===this.isThought&&(t.lineTo(n,i),this.isPointingRight?(h((r=e/4)+n,s-r-n,r),h(2*(r=e/3.2)+n,s-r-2*n,r),h(3*(r=e/2.8)+2*n,s-r-4*n,r)):(h(o-((r=e/4)+n),s-r-n,r),h(o-(2*(r=e/3.2)+n),s-r-2*n,r),h(o-(3*(r=e/2.8)+2*n),s-r-4*n,r)))},SpeechBubbleMorph.prototype.shadowImage=function(t,e){var n,r,i,o,s,h=t||new Point(7,7),a=e||new Color(0,0,0);return n=this.extent(),r=this.image,(s=(i=newCanvas(n)).getContext("2d")).drawImage(r,0,0),s.globalCompositeOperation="destination-out",s.drawImage(r,-h.x,-h.y),(s=(o=newCanvas(n)).getContext("2d")).drawImage(i,0,0),s.globalCompositeOperation="source-atop",s.fillStyle=a.toString(),s.fillRect(0,0,n.x,n.y),o},SpeechBubbleMorph.prototype.shadowImageBlurred=function(t,e){var n,r,i,o,s=t||new Point(7,7),h=this.shadowBlur,a=e||new Color(0,0,0);return n=this.extent().add(2*h),r=this.image,(o=(i=newCanvas(n)).getContext("2d")).shadowOffsetX=s.x,o.shadowOffsetY=s.y,o.shadowBlur=h,o.shadowColor=a.toString(),o.drawImage(r,h-s.x,h-s.y),o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=0,o.globalCompositeOperation="destination-out",o.drawImage(r,h-s.x,h-s.y),i},SpeechBubbleMorph.prototype.fixLayout=function(){this.removeShadow(),this.drawNew(),this.addShadow(new Point(2,2),80)},DialMorph.prototype=new Morph,DialMorph.prototype.constructor=DialMorph,DialMorph.uber=Morph.prototype,DialMorph.prototype.init=function(t,e,n,r,i){this.target=null,this.action=null,this.min=t||0,this.max=e||360,this.value=Math.max(this.min,(n||0)%this.max),this.tick=r||15,this.fillColor=null,DialMorph.uber.init.call(this),this.color=new Color(230,230,230),this.noticesTransparentClick=!0,this.setRadius(i||4*MorphicPreferences.menuFontSize)},DialMorph.prototype.setRadius=function(t){this.radius=t,this.setExtent(new Point(2*this.radius,2*this.radius))},DialMorph.prototype.setValue=function(t,e,n){var r=this.max-this.min;t=t||0,this.value=this.min+(+t%r+r)%r,e&&(this.value<this.tick?this.value=this.min:this.value-=this.value%this.tick%this.value),this.drawNew(),this.changed(),n||this.updateTarget()},DialMorph.prototype.getValueOf=function(t){var e=this.max-this.min,n=this.center(),r=t.x-n.x,i=n.y-t.y;return e*(((Math.abs(r)<.001?i<0?90:270:Math.round((r>=0?0:180)-57.2957795131*Math.atan(i/r)))+90)/360)+this.min},DialMorph.prototype.setExtent=function(t){var e=Math.min(t.x,t.y);this.radius=e/2,DialMorph.uber.setExtent.call(this,new Point(e,e))},DialMorph.prototype.drawNew=function(){var t,e,n,r,i,o,s,h=this.color.lighter().toString(),a=this.max-this.min,l=a/this.tick,u=.75*this.radius,c=.85*u,p=.95*u;for(this.image=newCanvas(this.extent()),(t=this.image.getContext("2d")).fillStyle=h,t.beginPath(),t.arc(this.radius,this.radius,u+Math.min(1,this.radius-u),0,2*Math.PI,!1),t.closePath(),t.fill(),t.fillStyle=this.color.toString(),t.beginPath(),t.arc(this.radius,this.radius,u,0,2*Math.PI,!1),t.closePath(),t.fill(),n=(this.value-this.min)*(2*Math.PI)/a-Math.PI/2,t.fillStyle=(this.fillColor||this.color.darker()).toString(),t.beginPath(),t.arc(this.radius,this.radius,u,Math.PI/-2,n,!1),t.lineTo(this.radius,this.radius),t.closePath(),t.fill(),t.strokeStyle=new Color(35,35,35).toString(),t.lineWidth=1,e=0;e<l;e+=1)n=(e-3)*(2*Math.PI)/l-Math.PI/2,t.beginPath(),r=this.radius+Math.cos(n)*c,i=this.radius+Math.sin(n)*c,o=this.radius+Math.cos(n)*p,s=this.radius+Math.sin(n)*p,t.moveTo(r,i),t.lineTo(o,s),t.stroke();c=.05*u,t.fillStyle="black",t.beginPath(),t.arc(this.radius,this.radius,c,0,2*Math.PI,!1),t.closePath(),t.fill(),t.strokeStyle="black",t.lineWidth=1,n=(this.value-this.min)*(2*Math.PI)/a-Math.PI/2,p=.8*u,r=this.radius+Math.cos(n)*c,i=this.radius+Math.sin(n)*c,o=this.radius+Math.cos(n)*p,s=this.radius+Math.sin(n)*p,t.beginPath(),t.moveTo(r,i),t.lineTo(o,s),t.stroke(),c*=2,o=this.radius+Math.cos(n)*(p+c),s=this.radius+Math.sin(n)*(p+c),t.fillStyle="black",t.beginPath(),t.arc(o,s,c,0,2*Math.PI,!1),t.closePath(),t.stroke(),n=(this.value-this.min)*(2*Math.PI)/a-Math.PI/2,r=this.radius+Math.cos(n)*u,i=this.radius+Math.sin(n)*u,o=this.radius+Math.cos(n)*(this.radius-1),s=this.radius+Math.sin(n)*(this.radius-1),t.beginPath(),t.moveTo(r,i),t.lineTo(o,s),t.lineWidth=3,t.strokeStyle=h,t.stroke(),t.lineWidth=1,t.strokeStyle="black",t.stroke(),n=radians(degrees(n)-4),r=this.radius+Math.cos(n)*this.radius*.9,i=this.radius+Math.sin(n)*this.radius*.9,t.beginPath(),t.moveTo(r,i),n=radians(degrees(n)+8),r=this.radius+Math.cos(n)*this.radius*.9,i=this.radius+Math.sin(n)*this.radius*.9,t.lineTo(r,i),t.lineTo(o,s),t.closePath(),t.lineWidth=3,t.strokeStyle=h,t.stroke(),t.lineWidth=1,t.strokeStyle="black",t.stroke(),t.fill()},DialMorph.prototype.step=null,DialMorph.prototype.mouseDownLeft=function(t){var e,n=this;e=this.root(),this.step=function(){e.hand.mouseButton?n.setValue(n.getValueOf(e.hand.bounds.origin),16!==e.currentKey):this.step=null}},DialMorph.prototype.developersMenu=function(){var t=DialMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("set target","setTarget","select another morph.jsk\nwhose numerical property\nwill be controlled by this one"),t},DialMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),n=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){n.target=t,n.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},DialMorph.prototype.setTargetSetter=function(){var t=this.target.numericalSetters(),e=new MenuMorph(this,"choose target property:"),n=this;t.forEach((function(t){e.addItem(t,(function(){n.action=t}))})),1===t.length?this.action=t[0]:t.length>0&&e.popUpAtHand(this.world())},DialMorph.prototype.updateTarget=function(){this.action&&("function"==typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value))},CircleBoxMorph.prototype=new Morph,CircleBoxMorph.prototype.constructor=CircleBoxMorph,CircleBoxMorph.uber=Morph.prototype,CircleBoxMorph.prototype.init=function(t){CircleBoxMorph.uber.init.call(this),this.orientation=t,this.autoOrient=!0,this.setExtent(new Point(20,100))},CircleBoxMorph.prototype.autoOrientation=function(){this.height()>this.width()?this.orientation="vertical":this.orientation="horizontal"},CircleBoxMorph.prototype.drawNew=function(){var t,e,n,r,i,o,s,h,a=this;this.autoOrient&&this.autoOrientation(),this.image=newCanvas(this.extent()),s=this.image.getContext("2d"),"vertical"===this.orientation?(t=this.width()/2,e=new Point(i=this.center().x,this.top()+t),n=new Point(i,this.bottom()-t),r=this.bounds.origin.add(new Point(0,t)).corner(this.bounds.corner.subtract(new Point(0,t)))):(t=this.height()/2,o=this.center().y,e=new Point(this.left()+t,o),n=new Point(this.right()-t,o),r=this.bounds.origin.add(new Point(t,0)).corner(this.bounds.corner.subtract(new Point(t,0)))),[e.subtract(this.bounds.origin),n.subtract(this.bounds.origin)].forEach((function(e){s.fillStyle=a.color.toString(),s.beginPath(),s.arc(e.x,e.y,t,0,2*Math.PI,!1),s.closePath(),s.fill()})),(h=(r=r.translateBy(this.bounds.origin.neg())).extent()).x>0&&h.y>0&&s.fillRect(r.origin.x,r.origin.y,r.width(),r.height())},CircleBoxMorph.prototype.developersMenu=function(){var t=CircleBoxMorph.uber.developersMenu.call(this);return t.addLine(),"vertical"===this.orientation?t.addItem("horizontal...","toggleOrientation","toggle the\norientation"):t.addItem("vertical...","toggleOrientation","toggle the\norientation"),t},CircleBoxMorph.prototype.toggleOrientation=function(){var t=this.center();this.changed(),"vertical"===this.orientation?this.orientation="horizontal":this.orientation="vertical",this.silentSetExtent(new Point(this.height(),this.width())),this.setCenter(t),this.drawNew(),this.changed()},SliderButtonMorph.prototype=new CircleBoxMorph,SliderButtonMorph.prototype.constructor=SliderButtonMorph,SliderButtonMorph.uber=CircleBoxMorph.prototype,SliderButtonMorph.prototype.init=function(t){this.color=new Color(80,80,80),this.highlightColor=new Color(90,90,140),this.pressColor=new Color(80,80,160),this.is3D=!1,this.hasMiddleDip=!0,SliderButtonMorph.uber.init.call(this,t)},SliderButtonMorph.prototype.autoOrientation=nop,SliderButtonMorph.prototype.drawNew=function(){var t=this.color.copy();SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.normalImage=this.image,this.color=this.highlightColor.copy(),SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.highlightImage=this.image,this.color=this.pressColor.copy(),SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.pressImage=this.image,this.color=t,this.image=this.normalImage},SliderButtonMorph.prototype.drawEdges=function(){var t,e,n=this.image.getContext("2d"),r=this.width(),i=this.height();n.lineJoin="round",n.lineCap="round","vertical"===this.orientation?(n.lineWidth=r/3,(t=n.createLinearGradient(0,0,n.lineWidth,0)).addColorStop(0,"white"),t.addColorStop(1,this.color.toString()),n.strokeStyle=t,n.beginPath(),n.moveTo(.5*n.lineWidth,r/2),n.lineTo(.5*n.lineWidth,i-r/2),n.stroke(),(t=n.createLinearGradient(r-n.lineWidth,0,r,0)).addColorStop(0,this.color.toString()),t.addColorStop(1,"black"),n.strokeStyle=t,n.beginPath(),n.moveTo(r-.5*n.lineWidth,r/2),n.lineTo(r-.5*n.lineWidth,i-r/2),n.stroke(),this.hasMiddleDip&&(e=r/4,(t=n.createLinearGradient(n.lineWidth,0,r-n.lineWidth,0)).addColorStop(0,"black"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,"white"),n.fillStyle=t,n.beginPath(),n.arc(r/2,i/2,e,radians(0),radians(360),!1),n.closePath(),n.fill())):"horizontal"===this.orientation&&(n.lineWidth=i/3,(t=n.createLinearGradient(0,0,0,n.lineWidth)).addColorStop(0,"white"),t.addColorStop(1,this.color.toString()),n.strokeStyle=t,n.beginPath(),n.moveTo(i/2,.5*n.lineWidth),n.lineTo(r-i/2,.5*n.lineWidth),n.stroke(),(t=n.createLinearGradient(0,i-n.lineWidth,0,i)).addColorStop(0,this.color.toString()),t.addColorStop(1,"black"),n.strokeStyle=t,n.beginPath(),n.moveTo(i/2,i-.5*n.lineWidth),n.lineTo(r-i/2,i-.5*n.lineWidth),n.stroke(),this.hasMiddleDip&&(e=i/4,(t=n.createLinearGradient(0,n.lineWidth,0,i-n.lineWidth)).addColorStop(0,"black"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,"white"),n.fillStyle=t,n.beginPath(),n.arc(this.width()/2,this.height()/2,e,radians(0),radians(360),!1),n.closePath(),n.fill()))},SliderButtonMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},SliderButtonMorph.prototype.mouseDownLeft=function(t){this.image=this.pressImage,this.changed(),this.escalateEvent("mouseDownLeft",t)},SliderButtonMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseMove=function(){nop()},SliderMorph.prototype=new CircleBoxMorph,SliderMorph.prototype.constructor=SliderMorph,SliderMorph.uber=CircleBoxMorph.prototype,SliderMorph.prototype.init=function(t,e,n,r,i,o){this.target=null,this.action=null,this.start=t,this.stop=e,this.value=n,this.size=r,this.offset=null,this.button=new SliderButtonMorph,this.button.isDraggable=!1,this.button.color=new Color(200,200,200),this.button.highlightColor=new Color(210,210,255),this.button.pressColor=new Color(180,180,255),SliderMorph.uber.init.call(this,i),this.add(this.button),this.alpha=.3,this.color=o||new Color(0,0,0),this.setExtent(new Point(20,100))},SliderMorph.prototype.autoOrientation=nop,SliderMorph.prototype.rangeSize=function(){return this.stop-this.start},SliderMorph.prototype.ratio=function(){return this.size/(this.rangeSize()+1)},SliderMorph.prototype.unitSize=function(){return"vertical"===this.orientation?(this.height()-this.button.height())/this.rangeSize():(this.width()-this.button.width())/this.rangeSize()},SliderMorph.prototype.drawNew=function(){var t,e,n,r;SliderMorph.uber.drawNew.call(this),this.button.orientation=this.orientation,"vertical"===this.orientation?(t=this.width()-2,e=Math.max(t,Math.round(this.height()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),n=1,r=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.height()-this.button.height())):(e=this.height()-2,t=Math.max(e,Math.round(this.width()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),r=1,n=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.width()-this.button.width())),this.button.setPosition(new Point(n,r).add(this.bounds.origin)),this.button.drawNew(),this.button.changed()},SliderMorph.prototype.updateValue=function(){var t;t="vertical"===this.orientation?this.button.top()-this.top():this.button.left()-this.left(),this.value=Math.round(t/this.unitSize()+this.start),this.updateTarget()},SliderMorph.prototype.updateTarget=function(){this.action&&("function"==typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value))},SliderMorph.prototype.developersMenu=function(){var t=SliderMorph.uber.developersMenu.call(this);return t.addItem("show value...","showValue","display a dialog box\nshowing the selected number"),t.addItem("floor...",(function(){this.prompt(t.title+"\nfloor:",this.setStart,this,this.start.toString(),null,0,this.stop-this.size,!0)}),"set the minimum value\nwhich can be selected"),t.addItem("ceiling...",(function(){this.prompt(t.title+"\nceiling:",this.setStop,this,this.stop.toString(),null,this.start+this.size,100*this.size,!0)}),"set the maximum value\nwhich can be selected"),t.addItem("button size...",(function(){this.prompt(t.title+"\nbutton size:",this.setSize,this,this.size.toString(),null,1,this.stop-this.start,!0)}),"set the range\ncovered by\nthe slider button"),t.addLine(),t.addItem("set target","setTarget","select another morph.jsk\nwhose numerical property\nwill be controlled by this one"),t},SliderMorph.prototype.showValue=function(){this.inform(this.value)},SliderMorph.prototype.userSetStart=function(t){this.start=Math.max(t,this.stop)},SliderMorph.prototype.setStart=function(t,e){var n;"number"==typeof t?this.start=Math.min(t,this.stop-this.size):(n=parseFloat(t),isNaN(n)||(this.start=Math.min(n,this.stop-this.size))),this.value=Math.max(this.value,this.start),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setStop=function(t,e){var n;"number"==typeof t?this.stop=Math.max(t,this.start+this.size):(n=parseFloat(t),isNaN(n)||(this.stop=Math.max(n,this.start+this.size))),this.value=Math.min(this.value,this.stop),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setSize=function(t,e){var n;"number"==typeof t?this.size=Math.min(Math.max(t,1),this.stop-this.start):(n=parseFloat(t),isNaN(n)||(this.size=Math.min(Math.max(n,1),this.stop-this.start))),this.value=Math.min(this.value,this.stop-this.size),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),n=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){n.target=t,n.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.setTargetSetter=function(){var t=this.target.numericalSetters(),e=new MenuMorph(this,"choose target property:"),n=this;t.forEach((function(t){e.addItem(t,(function(){n.action=t}))})),1===t.length?this.action=t[0]:t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.numericalSetters=function(){var t=SliderMorph.uber.numericalSetters.call(this);return t.push("setStart","setStop","setSize"),t},SliderMorph.prototype.step=null,SliderMorph.prototype.mouseDownLeft=function(t){var e,n=this;this.button.bounds.containsPoint(t)?this.offset=t.subtract(this.button.bounds.origin):this.offset=new Point,e=this.root(),this.step=function(){var t,r,i;e.hand.mouseButton?(t=e.hand.bounds.origin,"vertical"===n.orientation?(r=n.button.bounds.origin.x,i=Math.max(Math.min(t.y-n.offset.y,n.bottom()-n.button.height()),n.top())):(i=n.button.bounds.origin.y,r=Math.max(Math.min(t.x-n.offset.x,n.right()-n.button.width()),n.left())),n.button.setPosition(new Point(r,i)),n.updateValue()):this.step=null}},MouseSensorMorph.prototype=new BoxMorph,MouseSensorMorph.prototype.constructor=MouseSensorMorph,MouseSensorMorph.uber=BoxMorph.prototype,MouseSensorMorph.prototype.init=function(t,e,n){MouseSensorMorph.uber.init.call(this),this.edge=t||4,this.border=e||2,this.color=new Color(255,255,255),this.borderColor=n||new Color,this.isTouched=!1,this.upStep=.05,this.downStep=.02,this.noticesTransparentClick=!1,this.drawNew()},MouseSensorMorph.prototype.touch=function(){var t=this;this.isTouched||(this.isTouched=!0,this.alpha=.6,this.step=function(){t.isTouched?t.alpha<1&&(t.alpha=t.alpha+t.upStep):t.alpha>t.downStep?t.alpha=t.alpha-t.downStep:(t.alpha=0,t.step=null),t.changed()})},MouseSensorMorph.prototype.unTouch=function(){this.isTouched=!1},MouseSensorMorph.prototype.mouseEnter=function(){this.touch()},MouseSensorMorph.prototype.mouseLeave=function(){this.unTouch()},MouseSensorMorph.prototype.mouseDownLeft=function(){this.touch()},MouseSensorMorph.prototype.mouseClickLeft=function(){this.unTouch()},InspectorMorph.prototype=new BoxMorph,InspectorMorph.prototype.constructor=InspectorMorph,InspectorMorph.uber=BoxMorph.prototype,InspectorMorph.prototype.init=function(t){this.target=t,this.currentProperty=null,this.showing="attributes",this.markOwnProperties=!1,this.hasUserEditedDetails=!1,InspectorMorph.uber.init.call(this),this.silentSetExtent(new Point(20*MorphicPreferences.handleSize,20*MorphicPreferences.handleSize*2/3)),this.isDraggable=!0,this.border=1,this.edge=MorphicPreferences.isFlat?1:5,this.color=new Color(60,60,60),this.borderColor=new Color(95,95,95),this.fps=25,this.drawNew(),this.label=null,this.list=null,this.detail=null,this.work=null,this.buttonInspect=null,this.buttonClose=null,this.buttonSubset=null,this.buttonEdit=null,this.resizer=null,this.target&&this.buildPanes()},InspectorMorph.prototype.setTarget=function(t){this.target=t,this.currentProperty=null,this.buildPanes()},InspectorMorph.prototype.updateCurrentSelection=function(){var t,e,n,r=this.list.selected,i=this.detail.contents.children[0],o=this.root();o&&o.keyboardReceiver instanceof CursorMorph&&o.keyboardReceiver.target===i?this.hasUserEditedDetails=!0:isNil(r)||this.hasUserEditedDetails||(t=this.target[r],this.currentProperty=t,e=isNil(t)?"NULL":isString(t)?t:t.toString(),i.text!==e&&((n=new TextMorph(e)).isEditable=!0,n.enableSelecting(),n.setReceiver(this.target),this.detail.setContents(n)))},InspectorMorph.prototype.buildPanes=function(){var t,e,n,r,i=[],o=this;for(t in this.children.forEach((function(t){t!==this.work&&t.destroy()})),this.children=[],this.label=new TextMorph(this.target.toString()),this.label.fontSize=MorphicPreferences.menuFontSize,this.label.isBold=!0,this.label.color=new Color(255,255,255),this.label.drawNew(),this.add(this.label),this.target)t&&i.push(t);"attributes"===this.showing?i=i.filter((function(t){return"function"!=typeof o.target[t]})):"methods"===this.showing&&(i=i.filter((function(t){return"function"==typeof o.target[t]}))),r=function(){var t,e;isObject(o.currentProperty)&&(t=o.world(),(e=new InspectorMorph(o.currentProperty)).setPosition(t.hand.position()),e.keepWithin(t),t.add(e),e.changed())},this.list=new ListMorph(this.target instanceof Array?i:i.sort(),null,this.markOwnProperties?[[new Color(0,0,180),function(t){return Object.prototype.hasOwnProperty.call(o.target,t)}]]:null,r),this.list.action=function(){o.hasUserEditedDetails=!1,o.updateCurrentSelection()},this.list.hBar.alpha=.6,this.list.vBar.alpha=.6,this.list.contents.step=null,this.add(this.list),this.detail=new ScrollFrameMorph,this.detail.acceptsDrops=!1,this.detail.contents.acceptsDrops=!1,this.detail.isTextLineWrapping=!0,this.detail.color=new Color(255,255,255),this.detail.hBar.alpha=.6,this.detail.vBar.alpha=.6,(e=new TextMorph("")).isEditable=!0,e.enableSelecting(),e.setReceiver(this.target),this.detail.setContents(e),this.add(this.detail),null===this.work&&(this.work=new ScrollFrameMorph,this.work.acceptsDrops=!1,this.work.contents.acceptsDrops=!1,this.work.isTextLineWrapping=!0,this.work.color=new Color(255,255,255),this.work.hBar.alpha=.6,this.work.vBar.alpha=.6,(n=new TextMorph("")).isEditable=!0,n.enableSelecting(),n.setReceiver(this.target),this.work.setContents(n)),this.add(this.work),this.buttonSubset=new TriggerMorph,this.buttonSubset.labelString="show...",this.buttonSubset.action=function(){var t;(t=new MenuMorph).addItem("attributes",(function(){o.showing="attributes",o.buildPanes()})),t.addItem("methods",(function(){o.showing="methods",o.buildPanes()})),t.addItem("all",(function(){o.showing="all",o.buildPanes()})),t.addLine(),t.addItem(o.markOwnProperties?"un-mark own":"mark own",(function(){o.markOwnProperties=!o.markOwnProperties,o.buildPanes()}),"highlight\n'own' properties"),t.popUpAtHand(o.world())},this.add(this.buttonSubset),this.buttonInspect=new TriggerMorph,this.buttonInspect.labelString="inspect...",this.buttonInspect.action=function(){var t,e,n;isObject(o.currentProperty)?((t=new MenuMorph).addItem("in new inspector...",(function(){e=o.world(),(n=new InspectorMorph(o.currentProperty)).setPosition(e.hand.position()),n.keepWithin(e),e.add(n),n.changed()})),t.addItem("here...",(function(){o.setTarget(o.currentProperty)})),t.popUpAtHand(o.world())):o.inform((null===o.currentProperty?"null":typeof o.currentProperty)+"\nis not inspectable")},this.add(this.buttonInspect),this.buttonEdit=new TriggerMorph,this.buttonEdit.labelString="edit...",this.buttonEdit.action=function(){var t;(t=new MenuMorph(o)).addItem("save","save","accept changes"),t.addLine(),t.addItem("add property...","addProperty"),t.addItem("rename...","renameProperty"),t.addItem("remove...","removeProperty"),t.popUpAtHand(o.world())},this.add(this.buttonEdit),this.buttonClose=new TriggerMorph,this.buttonClose.labelString="close",this.buttonClose.action=function(){o.destroy()},this.add(this.buttonClose),this.resizer=new HandleMorph(this,150,100,this.edge,this.edge),this.fixLayout()},InspectorMorph.prototype.fixLayout=function(){var t,e,n,r;Morph.prototype.trackChanges=!1,t=this.left()+this.edge,e=this.top()+this.edge,n=this.right()-this.edge-t,this.label.setPosition(new Point(t,e)),this.label.setWidth(n),this.label.height()>this.height()-50&&(this.silentSetHeight(this.label.height()+50),this.drawNew(),this.changed(),this.resizer.drawNew()),e=this.label.bottom()+2,n=Math.min(Math.floor(this.width()/3),this.list.listContents.width()),n-=this.edge,r=this.bottom()-2*this.edge-MorphicPreferences.handleSize-e,this.list.setPosition(new Point(t,e)),this.list.setExtent(new Point(n,r)),t=this.list.right()+this.edge,n=this.right()-this.edge-t,this.detail.setPosition(new Point(t,e)),this.detail.setExtent(new Point(n,2*r/3-this.edge)),e=this.detail.bottom()+this.edge,this.work.setPosition(new Point(t,e)),this.work.setExtent(new Point(n,r/3)),t=this.list.left(),e=this.list.bottom()+this.edge,n=this.list.width(),r=MorphicPreferences.handleSize,this.buttonSubset.setPosition(new Point(t,e)),this.buttonSubset.setExtent(new Point(n,r)),t=this.detail.left(),n=(n=this.detail.width()-this.edge-MorphicPreferences.handleSize)/3-this.edge/3,this.buttonInspect.setPosition(new Point(t,e)),this.buttonInspect.setExtent(new Point(n,r)),t=this.buttonInspect.right()+this.edge,this.buttonEdit.setPosition(new Point(t,e)),this.buttonEdit.setExtent(new Point(n,r)),t=this.buttonEdit.right()+this.edge,n=this.detail.right()-this.edge-MorphicPreferences.handleSize-t,this.buttonClose.setPosition(new Point(t,e)),this.buttonClose.setExtent(new Point(n,r)),Morph.prototype.trackChanges=!0,this.changed()},InspectorMorph.prototype.setExtent=function(t){InspectorMorph.uber.setExtent.call(this,t),this.fixLayout()},InspectorMorph.prototype.save=function(){var t=this.detail.contents.children[0].text.toString(),e=this.list.selected;try{this.target.evaluateString("this."+e+" = "+t),this.hasUserEditedDetails=!1,this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(t){this.inform(t)}},InspectorMorph.prototype.addProperty=function(){var t=this;this.prompt("new property name:",(function(e){e&&(t.target[e]=null,t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed()))}),this,"property")},InspectorMorph.prototype.renameProperty=function(){var t=this,e=this.list.selected;this.prompt("property name:",(function(n){try{delete t.target[e],t.target[n]=t.currentProperty}catch(e){t.inform(e)}t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed())}),this,e)},InspectorMorph.prototype.removeProperty=function(){var t=this.list.selected;try{delete this.target[t],this.currentProperty=null,this.buildPanes(),this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(t){this.inform(t)}},InspectorMorph.prototype.step=function(){this.updateCurrentSelection();var t=this.target.toString();this.label.text!==t&&(this.label.text=t,this.label.drawNew(),this.fixLayout())},InspectorMorph.prototype.updateReferences=function(t){var e=this.list.activeIndex();InspectorMorph.uber.updateReferences.call(this,t),this.buildPanes(),this.list.activateIndex(e)},MenuMorph.prototype=new BoxMorph,MenuMorph.prototype.constructor=MenuMorph,MenuMorph.uber=BoxMorph.prototype,MenuMorph.prototype.init=function(t,e,n,r){this.target=t,this.title=e||null,this.environment=n||null,this.fontSize=r||null,this.items=[],this.label=null,this.world=null,this.isListContents=!1,this.hasFocus=!1,this.selection=null,this.submenu=null,MenuMorph.uber.init.call(this),this.isDraggable=!1,this.border=null,this.edge=null},MenuMorph.prototype.addItem=function(t,e,n,r,i,o,s,h){this.items.push([localize(t||"close"),e||nop,n,r,i||!1,o||!1,s,h])},MenuMorph.prototype.addMenu=function(t,e,n){this.addPair(t,e,isNil(n)?"►":n)},MenuMorph.prototype.addPair=function(t,e,n,r){this.addItem(t,e,r,null,null,null,null,n)},MenuMorph.prototype.addLine=function(t){this.items.push([0,t||1])},MenuMorph.prototype.createLabel=function(){var t;null!==this.label&&this.label.destroy(),(t=new TextMorph(localize(this.title),this.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,!0,!1,"center")).alignment="center",t.color=new Color(255,255,255),t.backgroundColor=this.borderColor,t.drawNew(),this.label=new BoxMorph(3,0),MorphicPreferences.isFlat&&(this.label.edge=0),this.label.color=this.borderColor,this.label.borderColor=this.borderColor,this.label.setExtent(t.extent().add(4)),this.label.drawNew(),this.label.add(t),this.label.text=t},MenuMorph.prototype.drawNew=function(){var t,e,n,r,i=this,o=!1;this.children.forEach((function(t){t.destroy()})),this.children=[],this.isListContents||(this.edge=MorphicPreferences.isFlat?0:5,this.border=MorphicPreferences.isFlat?1:2),this.color=new Color(255,255,255),this.borderColor=new Color(60,60,60),this.silentSetExtent(new Point(0,0)),r=2,n=this.left()+4,this.isListContents||(this.title?(this.createLabel(),this.label.setPosition(this.bounds.origin.add(4)),this.add(this.label),r=this.label.bottom()):r=this.top()+4),r+=1,this.items.forEach((function(e){o=!1,e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph||e instanceof DialMorph?t=e:0===e[0]?(o=!0,(t=new Morph).color=i.borderColor,t.setHeight(e[1])):t=new MenuItemMorph(i.target,e[1],e[0],i.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,i.environment,e[2],e[3],e[4],e[5],e[6],e[7]),o&&(r+=1),t.setPosition(new Point(n,r)),i.add(t),r+=t.height(),o&&(r+=1)})),e=this.fullBounds(),this.silentSetExtent(e.extent().add(4)),this.adjustWidths(),MenuMorph.uber.drawNew.call(this)},MenuMorph.prototype.maxWidth=function(){var t=0;return this.parent instanceof FrameMorph&&this.parent.scrollFrame instanceof ScrollFrameMorph&&(t=this.parent.scrollFrame.width()),this.children.forEach((function(e){e instanceof MenuItemMorph?t=Math.max(t,e.label.width()+8+(e.shortcut?e.shortcut.width()+4:0)):(e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph||e instanceof DialMorph)&&(t=Math.max(t,e.width()))})),this.label&&(t=Math.max(t,this.label.width())),t},MenuMorph.prototype.adjustWidths=function(){var t,e=this.maxWidth(),n=this;this.children.forEach((function(r){r instanceof DialMorph||r.silentSetWidth(e),r instanceof MenuItemMorph?(r.fixLayout(),t=r.image===r.pressImage,r.createBackgrounds(),t&&(r.image=r.pressImage)):(r.drawNew(),r===n.label&&r.text.setPosition(r.center().subtract(r.text.extent().floorDivideBy(2))))}))},MenuMorph.prototype.unselectAllItems=function(){this.children.forEach((function(t){t instanceof MenuItemMorph?t.image=t.normalImage:t instanceof ScrollFrameMorph&&t.contents.children.forEach((function(t){t instanceof MenuItemMorph&&(t.image=t.normalImage)}))})),this.changed()},MenuMorph.prototype.popup=function(t,e){var n;this.drawNew(),this.setPosition(e),this.addShadow(new Point(2,2),80),this.keepWithin(t),this.bottom()>t.bottom()&&(this.removeShadow(),n=this.scroll(),this.bounds.corner.y=t.bottom()-2,MenuMorph.uber.drawNew.call(this),this.addShadow(new Point(2,2),80),n.setHeight(t.bottom()-n.top()-6),n.adjustScrollBars()),t.activeMenu&&t.activeMenu.destroy(),this.items.length<1&&!this.title||(t.add(this),t.activeMenu=this,this.world=t,this.fullChanged())},MenuMorph.prototype.scroll=function(){var t=new ScrollFrameMorph,e=this.label?1:0,n=this.children[e];return t.setPosition(n.position()),this.children.slice(e).forEach((function(e){t.addContents(e)})),this.add(t),t.setWidth(n.width()),t},MenuMorph.prototype.popUpAtHand=function(t){var e=t||this.world;this.popup(e,e.hand.position())},MenuMorph.prototype.popUpCenteredAtHand=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.hand.position().subtract(this.extent().floorDivideBy(2)))},MenuMorph.prototype.popUpCenteredInWorld=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.center().subtract(this.extent().floorDivideBy(2)))},MenuMorph.prototype.closeRootMenu=function(){this.parent instanceof MenuMorph?this.parent.closeRootMenu():this.destroy()},MenuMorph.prototype.closeSubmenu=function(){this.submenu&&(this.submenu.destroy(),this.submenu=null,this.unselectAllItems())},MenuMorph.prototype.getFocus=function(){this.world.keyboardReceiver=this,this.selection=null,this.selectFirst(),this.hasFocus=!0},MenuMorph.prototype.processKeyDown=function(t){switch(t.keyCode){case 13:case 32:return void(this.selection&&(this.selection.mouseClickLeft(),this.submenu&&this.submenu.getFocus()));case 27:return this.destroy();case 37:return this.leaveSubmenu();case 38:return this.selectUp();case 39:return this.enterSubmenu();case 40:return this.selectDown();default:nop()}},MenuMorph.prototype.processKeyUp=function(t){nop(t)},MenuMorph.prototype.processKeyPress=function(t){nop(t)},MenuMorph.prototype.selectFirst=function(){var t,e,n;for(e=(t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children,n=0;n<e.length;n+=1)if(e[n]instanceof MenuItemMorph)return void this.select(e[n])},MenuMorph.prototype.selectUp=function(){var t,e,n;e=((t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children).filter((function(t){return t instanceof MenuItemMorph})),this.selection?((n=e.indexOf(this.selection)-1)<0&&(n=e.length-1),this.select(e[n])):e.length&&this.select(e[0])},MenuMorph.prototype.selectDown=function(){var t,e,n;e=((t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children).filter((function(t){return t instanceof MenuItemMorph})),this.selection?((n=e.indexOf(this.selection)+1)>=e.length&&(n=0),this.select(e[n])):e.length&&this.select(e[0])},MenuMorph.prototype.enterSubmenu=function(){this.selection&&this.selection.action instanceof MenuMorph&&(this.selection.popUpSubmenu(),this.submenu&&this.submenu.getFocus())},MenuMorph.prototype.leaveSubmenu=function(){var t=this.parent;this.parent instanceof MenuMorph&&(t.submenu=null,t.hasFocus=!0,this.destroy(),t.world.keyboardReceiver=t)},MenuMorph.prototype.select=function(t){this.unselectAllItems(),t.image=t.highlightImage,t.changed(),t.scrollIntoView(),this.selection=t},MenuMorph.prototype.destroy=function(){this.hasFocus&&(this.world.keyboardReceiver=null),MenuMorph.uber.destroy.call(this)},StringMorph.prototype=new Morph,StringMorph.prototype.constructor=StringMorph,StringMorph.uber=Morph.prototype,StringMorph.prototype.init=function(t,e,n,r,i,o,s,h,a,l){this.text=t||(""===t?"":"StringMorph"),this.fontSize=e||12,this.fontName=l||MorphicPreferences.globalFontFamily,this.fontStyle=n||"sans-serif",this.isBold=r||!1,this.isItalic=i||!1,this.isEditable=!1,this.isNumeric=o||!1,this.isPassword=!1,this.shadowOffset=s||new Point(0,0),this.shadowColor=h||null,this.isShowingBlanks=!1,this.blanksColor=new Color(180,140,140),this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),StringMorph.uber.init.call(this,!0),this.color=a||new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},StringMorph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+'("'+this.text.slice(0,30)+'...")'},StringMorph.prototype.password=function(t,e){var n,r="";for(n=0;n<e;n+=1)r+=t;return r},StringMorph.prototype.font=function(){var t="";return this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+this.fontSize+"px "+(this.fontName?this.fontName+", ":"")+this.fontStyle},StringMorph.prototype.drawNew=function(){var t,e,n,r,i,o,s,h,a,l=this.shadowOffset||new Point,u=this.isPassword?this.password("*",this.text.length):this.text;for(this.image=newCanvas(),(t=this.image.getContext("2d")).font=this.font(),e=Math.max(t.measureText(u).width+Math.abs(l.x),1),this.bounds.corner=this.bounds.origin.add(new Point(e,fontHeight(this.fontSize)+Math.abs(l.y))),this.image.width=e,this.image.height=this.height(),t.font=this.font(),t.textAlign="left",t.textBaseline="bottom",this.shadowColor&&(h=Math.max(l.x,0),a=Math.max(l.y,0),t.fillStyle=this.shadowColor.toString(),t.fillText(u,h,fontHeight(this.fontSize)+a)),h=Math.abs(Math.min(l.x,0)),a=Math.abs(Math.min(l.y,0)),t.fillStyle=this.color.toString(),this.isShowingBlanks?this.renderWithBlanks(t,h,fontHeight(this.fontSize)+a):t.fillText(u,h,fontHeight(this.fontSize)+a),n=Math.min(this.startMark,this.endMark),r=Math.max(this.startMark,this.endMark),i=n;i<r;i+=1)o=this.slotPosition(i).subtract(this.position()),s=u.charAt(i),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(o.x,o.y,t.measureText(s).width+1+h,fontHeight(this.fontSize)+a),t.fillStyle=this.markedTextColor.toString(),t.fillText(s,o.x+h,fontHeight(this.fontSize)+a);this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},StringMorph.prototype.renderWithBlanks=function(t,e,n){var r=t.measureText(" ").width,i=newCanvas(new Point(r,this.height())),o=i.getContext("2d"),s=this.text.split(" "),h=e||0,a=!0;o.fillStyle=this.blanksColor.toString(),o.arc(r/2,i.height/2,r/2,radians(0),radians(360)),o.fill(),s.forEach((function(e){a||(t.drawImage(i,h,0),h+=r),a=!1,""!==e&&(t.fillText(e,h,n),h+=t.measureText(e).width)}))},StringMorph.prototype.slotPosition=function(t){var e,n,r=this.isPassword?this.password("*",this.text.length):this.text,i=Math.min(Math.max(t,0),r.length),o=this.image.getContext("2d");for(e=0,n=0;n<i;n+=1)e+=o.measureText(r[n]).width;return this.pos=i,new Point(this.left()+e,this.top())},StringMorph.prototype.slotAt=function(t){for(var e=this.isPassword?this.password("*",this.text.length):this.text,n=0,r=0,i=this.image.getContext("2d");t.x-this.left()>r;)if(r+=i.measureText(e[n]).width,(n+=1)===e.length&&i.measureText(e).width-i.measureText(e[n-1]).width/2<t.x-this.left())return n;return t.x-this.left()>r-i.measureText(e[n-1]).width/2?n:n-1},StringMorph.prototype.upFrom=function(t){return t},StringMorph.prototype.downFrom=function(t){return t},StringMorph.prototype.startOfLine=function(){return 0},StringMorph.prototype.endOfLine=function(){return this.text.length},StringMorph.prototype.previousWordFrom=function(t){for(var e=t-1;e>0&&!isWordChar(this.text[e]);)e-=1;for(;e>0&&isWordChar(this.text[e-1]);)e-=1;return e},StringMorph.prototype.nextWordFrom=function(t){for(var e=t;e<this.endOfLine()&&!isWordChar(this.text[e]);)e+=1;for(;e<this.endOfLine()&&isWordChar(this.text[e]);)e+=1;return e},StringMorph.prototype.rawHeight=function(){return this.height()/1.2},StringMorph.prototype.developersMenu=function(){var t=StringMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("edit","edit"),t.addItem("font size...",(function(){this.prompt(t.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,500,!0)}),"set this String's\nfont point size"),"serif"!==this.fontStyle&&t.addItem("serif","setSerif"),"sans-serif"!==this.fontStyle&&t.addItem("sans-serif","setSansSerif"),this.isBold?t.addItem("normal weight","toggleWeight"):t.addItem("bold","toggleWeight"),this.isItalic?t.addItem("normal style","toggleItalic"):t.addItem("italic","toggleItalic"),this.isShowingBlanks?t.addItem("hide blanks","toggleShowBlanks"):t.addItem("show blanks","toggleShowBlanks"),this.isPassword?t.addItem("show characters","toggleIsPassword"):t.addItem("hide characters","toggleIsPassword"),t},StringMorph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable,this.isDraggable?this.disableSelecting():this.enableSelecting()},StringMorph.prototype.toggleShowBlanks=function(){this.isShowingBlanks=!this.isShowingBlanks,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleWeight=function(){this.isBold=!this.isBold,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleItalic=function(){this.isItalic=!this.isItalic,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleIsPassword=function(){this.isPassword=!this.isPassword,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSerif=function(){this.fontStyle="serif",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSansSerif=function(){this.fontStyle="sans-serif",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setFontSize=function(t){var e;"number"==typeof t?this.fontSize=Math.round(Math.min(Math.max(t,4),500)):(e=parseFloat(t),isNaN(e)||(this.fontSize=Math.round(Math.min(Math.max(e,4),500)))),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setText=function(t){this.text=Math.round(t).toString(),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.numericalSetters=function(){return["setLeft","setTop","setAlphaScaled","setFontSize","setText"]},StringMorph.prototype.edit=function(){this.root().edit(this)},StringMorph.prototype.selection=function(){var t,e;return t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text.slice(t,e)},StringMorph.prototype.selectionStartSlot=function(){return Math.min(this.startMark,this.endMark)},StringMorph.prototype.clearSelection=function(){!this.currentlySelecting&&isNil(this.startMark)&&isNil(this.endMark)||(this.currentlySelecting=!1,this.startMark=null,this.endMark=null,this.drawNew(),this.changed())},StringMorph.prototype.deleteSelection=function(){var t,e,n;n=this.text,t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text=n.slice(0,t)+n.slice(e),this.changed(),this.clearSelection()},StringMorph.prototype.selectAll=function(){var t;this.isEditable&&(this.startMark=0,(t=this.root().cursor)&&t.gotoSlot(this.text.length),this.endMark=this.text.length,this.drawNew(),this.changed())},StringMorph.prototype.mouseDownLeft=function(t){16===this.world().currentKey?this.shiftClick(t):this.isEditable?this.clearSelection():this.escalateEvent("mouseDownLeft",t)},StringMorph.prototype.shiftClick=function(t){var e=this.root().cursor;e&&(this.startMark||(this.startMark=e.slot),e.gotoPos(t),this.endMark=e.slot,this.drawNew(),this.changed()),this.currentlySelecting=!1,this.escalateEvent("mouseDownLeft",t)},StringMorph.prototype.mouseClickLeft=function(t){var e;this.isEditable?(this.currentlySelecting||this.edit(),(e=this.root().cursor)&&e.gotoPos(t),this.currentlySelecting=!0):this.escalateEvent("mouseClickLeft",t)},StringMorph.prototype.mouseDoubleClick=function(t){var e=this.slotAt(t);this.isEditable?(this.edit(),e===this.text.length&&(e-=1),this.text[e]&&isWordChar(this.text[e])?this.selectWordAt(e):this.text[e]?this.selectBetweenWordsAt(e):this.selectAll()):this.escalateEvent("mouseDoubleClick",t)},StringMorph.prototype.selectWordAt=function(t){var e=this.root().cursor;0===t||isWordChar(this.text[t-1])?(e.gotoSlot(this.previousWordFrom(t)),this.startMark=e.slot,this.endMark=this.nextWordFrom(e.slot)):(e.gotoSlot(t),this.startMark=t,this.endMark=this.nextWordFrom(t)),this.drawNew(),this.changed()},StringMorph.prototype.selectBetweenWordsAt=function(t){var e=this.root().cursor;for(e.gotoSlot(this.nextWordFrom(this.previousWordFrom(t))),this.startMark=e.slot,this.endMark=e.slot;this.endMark<this.text.length&&!isWordChar(this.text[this.endMark]);)this.endMark+=1;this.drawNew(),this.changed()},StringMorph.prototype.enableSelecting=function(){this.mouseDownLeft=function(t){var e=this.root().cursor,n=!!e&&e.target===this;16===this.world().currentKey?this.shiftClick(t):(this.clearSelection(),this.isEditable&&!this.isDraggable&&(this.edit(),this.root().cursor.gotoPos(t),this.startMark=this.slotAt(t),this.endMark=this.startMark,this.currentlySelecting=!0,n||this.escalateEvent("mouseDownLeft",t)))},this.mouseMove=function(t){if(this.isEditable&&this.currentlySelecting&&!this.isDraggable){var e=this.slotAt(t);e!==this.endMark&&(this.endMark=e,this.drawNew(),this.changed())}}},StringMorph.prototype.disableSelecting=function(){this.mouseDownLeft=StringMorph.prototype.mouseDownLeft,delete this.mouseMove},TextMorph.prototype=new Morph,TextMorph.prototype.constructor=TextMorph,TextMorph.uber=Morph.prototype,TextMorph.prototype.init=function(t,e,n,r,i,o,s,h,a,l){this.text=t||(""===t?t:"TextMorph"),this.words=[],this.lines=[],this.lineSlots=[],this.fontSize=e||12,this.fontName=h||MorphicPreferences.globalFontFamily,this.fontStyle=n||"sans-serif",this.isBold=r||!1,this.isItalic=i||!1,this.alignment=o||"left",this.shadowOffset=a||new Point(0,0),this.shadowColor=l||null,this.maxWidth=s||0,this.maxLineWidth=0,this.backgroundColor=null,this.isEditable=!1,this.receiver=null,this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),TextMorph.uber.init.call(this),this.color=new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},TextMorph.prototype.toString=function(){return'a TextMorph("'+this.text.slice(0,30)+'...")'},TextMorph.prototype.font=StringMorph.prototype.font,TextMorph.prototype.parse=function(){var t,e=this,n=this.text.split("\n"),r=newCanvas().getContext("2d"),i="",o=0;r.font=this.font(),this.maxLineWidth=0,this.lines=[],this.lineSlots=[0],this.words=[],n.forEach((function(t){e.words=e.words.concat(t.split(" ")),e.words.push("\n")})),this.words.forEach((function(n){"\n"===n?(e.lines.push(i),e.lineSlots.push(o),e.maxLineWidth=Math.max(e.maxLineWidth,r.measureText(i).width),i=""):(e.maxWidth>0?(t=i+n+" ",r.measureText(t).width>e.maxWidth?(e.lines.push(i),e.lineSlots.push(o),e.maxLineWidth=Math.max(e.maxLineWidth,r.measureText(i).width),i=n+" "):i=t):i=i+n+" ",o+=n.length+1)}))},TextMorph.prototype.drawNew=function(){var t,e,n,r,i,o,s,h,a,l,u,c,p,d,f;if(this.image=newCanvas(),(t=this.image.getContext("2d")).font=this.font(),this.parse(),s=Math.abs(this.shadowOffset.x),o=Math.abs(this.shadowOffset.y),e=this.lines.length*(fontHeight(this.fontSize)+o),0===this.maxWidth?this.bounds=this.bounds.origin.extent(new Point(this.maxLineWidth+s,e)):this.bounds=this.bounds.origin.extent(new Point(this.maxWidth+s,e)),this.image.width=this.width(),this.image.height=this.height(),(t=this.image.getContext("2d")).font=this.font(),t.textAlign="left",t.textBaseline="bottom",this.backgroundColor&&(t.fillStyle=this.backgroundColor.toString(),t.fillRect(0,0,this.width(),this.height())),this.shadowColor)for(h=Math.max(this.shadowOffset.x,0),a=Math.max(this.shadowOffset.y,0),t.fillStyle=this.shadowColor.toString(),n=0;n<this.lines.length;n+=1)r=this.lines[n],i=t.measureText(r).width+s,l="right"===this.alignment?this.width()-i:"center"===this.alignment?(this.width()-i)/2:0,u=(n+1)*(fontHeight(this.fontSize)+o)-o,t.fillText(r,l+h,u+a);for(h=Math.abs(Math.min(this.shadowOffset.x,0)),a=Math.abs(Math.min(this.shadowOffset.y,0)),t.fillStyle=this.color.toString(),n=0;n<this.lines.length;n+=1)r=this.lines[n],i=t.measureText(r).width+s,l="right"===this.alignment?this.width()-i:"center"===this.alignment?(this.width()-i)/2:0,u=(n+1)*(fontHeight(this.fontSize)+o)-o,t.fillText(r,l+h,u+a);for(c=Math.min(this.startMark,this.endMark),p=Math.max(this.startMark,this.endMark),n=c;n<p;n+=1)d=this.slotPosition(n).subtract(this.position()),f=this.text.charAt(n),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(d.x,d.y,t.measureText(f).width+1,fontHeight(this.fontSize)),t.fillStyle=this.markedTextColor.toString(),t.fillText(f,d.x,d.y+fontHeight(this.fontSize));this.parent&&this.parent.layoutChanged&&this.parent.layoutChanged()},TextMorph.prototype.setExtent=function(t){this.maxWidth=Math.max(t.x,0),this.changed(),this.drawNew()},TextMorph.prototype.columnRow=function(t){var e,n,r=0;for(e=0;e<this.lines.length;e+=1)for(r=this.lineSlots[e],n=0;n<this.lines[e].length;n+=1){if(r===t)return new Point(n,e);r+=1}return new Point(this.lines[this.lines.length-1].length-1,this.lines.length-1)},TextMorph.prototype.slotPosition=function(t){var e,n,r=this.columnRow(t),i=this.image.getContext("2d"),o=Math.abs(this.shadowOffset.y),s=0;for(e=r.y*(fontHeight(this.fontSize)+o),n=0;n<r.x;n+=1)s+=i.measureText(this.lines[r.y][n]).width;return new Point(this.left()+s,this.top()+e)},TextMorph.prototype.slotAt=function(t){for(var e=0,n=0,r=0,i=Math.abs(this.shadowOffset.y),o=this.image.getContext("2d");t.y-this.top()>(fontHeight(this.fontSize)+i)*n;)n+=1;for(n=Math.max(n,1);t.x-this.left()>e;)e+=o.measureText(this.lines[n-1][r]).width,r+=1;return t.x-this.left()>e-o.measureText(this.lines[n-1][r]).width/2?this.lineSlots[Math.max(n-1,0)]+r:this.lineSlots[Math.max(n-1,0)]+r-1},TextMorph.prototype.upFrom=function(t){var e,n=this.columnRow(t);return n.y<1?t:(e=this.lines[n.y-1]).length<n.x-1?this.lineSlots[n.y-1]+e.length:this.lineSlots[n.y-1]+n.x},TextMorph.prototype.downFrom=function(t){var e,n=this.columnRow(t);return n.y>this.lines.length-2?t:(e=this.lines[n.y+1]).length<n.x-1?this.lineSlots[n.y+1]+e.length:this.lineSlots[n.y+1]+n.x},TextMorph.prototype.startOfLine=function(t){return this.lineSlots[this.columnRow(t).y]},TextMorph.prototype.endOfLine=function(t){return this.startOfLine(t)+this.lines[this.columnRow(t).y].length-1},TextMorph.prototype.previousWordFrom=StringMorph.prototype.previousWordFrom,TextMorph.prototype.nextWordFrom=StringMorph.prototype.nextWordFrom,TextMorph.prototype.edit=StringMorph.prototype.edit,TextMorph.prototype.selection=StringMorph.prototype.selection,TextMorph.prototype.selectionStartSlot=StringMorph.prototype.selectionStartSlot,TextMorph.prototype.clearSelection=StringMorph.prototype.clearSelection,TextMorph.prototype.deleteSelection=StringMorph.prototype.deleteSelection,TextMorph.prototype.selectAll=StringMorph.prototype.selectAll,TextMorph.prototype.mouseDownLeft=StringMorph.prototype.mouseDownLeft,TextMorph.prototype.shiftClick=StringMorph.prototype.shiftClick,TextMorph.prototype.mouseClickLeft=StringMorph.prototype.mouseClickLeft,TextMorph.prototype.mouseDoubleClick=StringMorph.prototype.mouseDoubleClick,TextMorph.prototype.selectWordAt=StringMorph.prototype.selectWordAt,TextMorph.prototype.selectBetweenWordsAt=StringMorph.prototype.selectBetweenWordsAt,TextMorph.prototype.enableSelecting=StringMorph.prototype.enableSelecting,TextMorph.prototype.disableSelecting=StringMorph.prototype.disableSelecting,TextMorph.prototype.selectAllAndEdit=function(){this.edit(),this.selectAll()},TextMorph.prototype.developersMenu=function(){var t=TextMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("edit","edit"),t.addItem("font size...",(function(){this.prompt(t.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,100,!0)}),"set this Text's\nfont point size"),"left"!==this.alignment&&t.addItem("align left","setAlignmentToLeft"),"right"!==this.alignment&&t.addItem("align right","setAlignmentToRight"),"center"!==this.alignment&&t.addItem("align center","setAlignmentToCenter"),t.addLine(),"serif"!==this.fontStyle&&t.addItem("serif","setSerif"),"sans-serif"!==this.fontStyle&&t.addItem("sans-serif","setSansSerif"),this.isBold?t.addItem("normal weight","toggleWeight"):t.addItem("bold","toggleWeight"),this.isItalic?t.addItem("normal style","toggleItalic"):t.addItem("italic","toggleItalic"),t},TextMorph.prototype.setAlignmentToLeft=function(){this.alignment="left",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToRight=function(){this.alignment="right",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToCenter=function(){this.alignment="center",this.drawNew(),this.changed()},TextMorph.prototype.toggleIsDraggable=StringMorph.prototype.toggleIsDraggable,TextMorph.prototype.toggleWeight=StringMorph.prototype.toggleWeight,TextMorph.prototype.toggleItalic=StringMorph.prototype.toggleItalic,TextMorph.prototype.setSerif=StringMorph.prototype.setSerif,TextMorph.prototype.setSansSerif=StringMorph.prototype.setSansSerif,TextMorph.prototype.setText=StringMorph.prototype.setText,TextMorph.prototype.setFontSize=StringMorph.prototype.setFontSize,TextMorph.prototype.numericalSetters=StringMorph.prototype.numericalSetters,TextMorph.prototype.evaluationMenu=function(){var t=new MenuMorph(this,null);return t.addItem("do it","doIt","evaluate the\nselected expression"),t.addItem("show it","showIt","evaluate the\nselected expression\nand show the result"),t.addItem("inspect it","inspectIt","evaluate the\nselected expression\nand inspect the result"),t.addLine(),t.addItem("select all","selectAllAndEdit"),t},TextMorph.prototype.setReceiver=function(t){this.receiver=t,this.customContextMenu=this.evaluationMenu()},TextMorph.prototype.doIt=function(){this.receiver.evaluateString(this.selection()),this.edit()},TextMorph.prototype.showIt=function(){var t=this.receiver.evaluateString(this.selection());null!==t&&this.inform(t)},TextMorph.prototype.inspectIt=function(){var t,e=this.receiver.evaluateString(this.selection()),n=this.world();isObject(e)&&((t=new InspectorMorph(e)).setPosition(n.hand.position()),t.keepWithin(n),n.add(t),t.changed())},TriggerMorph.prototype=new Morph,TriggerMorph.prototype.constructor=TriggerMorph,TriggerMorph.uber=Morph.prototype,TriggerMorph.prototype.init=function(t,e,n,r,i,o,s,h,a,l,u){this.target=t||null,this.action=e||null,this.doubleClickAction=u||null,this.environment=o||null,this.labelString=n||null,this.label=null,this.hint=s||null,this.schedule=null,this.fontSize=r||MorphicPreferences.menuFontSize,this.fontStyle=i||"sans-serif",this.highlightColor=new Color(192,192,192),this.pressColor=new Color(128,128,128),this.labelColor=h||new Color(0,0,0),this.labelBold=a||!1,this.labelItalic=l||!1,TriggerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.drawNew()},TriggerMorph.prototype.drawNew=function(){this.createBackgrounds(),null!==this.labelString&&this.createLabel()},TriggerMorph.prototype.createBackgrounds=function(){var t,e=this.extent();this.normalImage=newCanvas(e),(t=this.normalImage.getContext("2d")).fillStyle=this.color.toString(),t.fillRect(0,0,e.x,e.y),this.highlightImage=newCanvas(e),(t=this.highlightImage.getContext("2d")).fillStyle=this.highlightColor.toString(),t.fillRect(0,0,e.x,e.y),this.pressImage=newCanvas(e),(t=this.pressImage.getContext("2d")).fillStyle=this.pressColor.toString(),t.fillRect(0,0,e.x,e.y),this.image=this.normalImage},TriggerMorph.prototype.createLabel=function(){null!==this.label&&this.label.destroy(),this.label=new StringMorph(this.labelString,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic,!1,null,null,this.labelColor),this.label.setPosition(this.center().subtract(this.label.extent().floorDivideBy(2))),this.add(this.label)},TriggerMorph.prototype.trigger=function(){this.schedule&&(this.schedule.isActive=!1),"function"==typeof this.target?"function"==typeof this.action?this.target.call(this.environment,this.action.call(),this):this.target.call(this.environment,this.action,this):"function"==typeof this.action?this.action.call(this.target):this.target[this.action]()},TriggerMorph.prototype.triggerDoubleClick=function(){this.doubleClickAction&&(this.schedule&&(this.schedule.isActive=!1),"function"==typeof this.target?"function"==typeof this.doubleClickAction?this.target.call(this.environment,this.doubleClickAction.call(),this):this.target.call(this.environment,this.doubleClickAction,this):"function"==typeof this.doubleClickAction?this.doubleClickAction.call(this.target):this.target[this.doubleClickAction]())},TriggerMorph.prototype.mouseEnter=function(){var t=this.hint instanceof Function?this.hint():this.hint;this.image=this.highlightImage,this.changed(),t&&this.bubbleHelp(t)},TriggerMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed(),this.schedule&&(this.schedule.isActive=!1),this.hint&&this.world().hand.destroyTemporaries()},TriggerMorph.prototype.mouseDownLeft=function(){this.image=this.pressImage,this.changed()},TriggerMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed(),this.trigger()},TriggerMorph.prototype.mouseDoubleClick=function(){this.triggerDoubleClick()},TriggerMorph.prototype.rootForGrab=function(){return this.isDraggable?TriggerMorph.uber.rootForGrab.call(this):null},TriggerMorph.prototype.bubbleHelp=function(t){var e=this.world(),n=this;this.schedule=new Animation(nop,nop,0,500,nop,(function(){n.popUpbubbleHelp(t)})),e.animations.push(this.schedule)},TriggerMorph.prototype.popUpbubbleHelp=function(t){new SpeechBubbleMorph(localize(t),null,null,1).popUp(this.world(),this.rightCenter().add(new Point(-8,0)))},MenuItemMorph.prototype=new TriggerMorph,MenuItemMorph.prototype.constructor=MenuItemMorph,MenuItemMorph.uber=TriggerMorph.prototype,MenuItemMorph.prototype.createLabel=function(){var t,e;this.label&&this.label.destroy(),this.label=this.createLabelPart(this.labelString),this.add(this.label),t=this.label.width(),e=this.label.height(),this.shortcut&&this.shortcut.destroy(),this.shortcutString&&(this.shortcut=this.createLabelPart(this.shortcutString),t+=this.shortcut.width()+4,e=Math.max(e,this.shortcut.height()),this.add(this.shortcut)),this.silentSetExtent(new Point(t+8,e)),this.fixLayout()},MenuItemMorph.prototype.fixLayout=function(){var t=this.center();this.label.setCenter(t),this.label.setLeft(this.left()+4),this.shortcut&&(this.shortcut.setCenter(t),this.shortcut.setRight(this.right()-4))},MenuItemMorph.prototype.createLabelPart=function(t){var e,n,r;return isString(t)?this.createLabelString(t):t instanceof Array?((e=new Morph).alpha=0,n=this.createIcon(t[0]),e.add(n),r=this.createLabelString(t[1]),e.add(r),r.setCenter(n.center()),r.setLeft(n.right()+4),e.bounds=n.bounds.merge(r.bounds),e.drawNew(),e):this.createIcon(t)},MenuItemMorph.prototype.createIcon=function(t){var e,n=new Morph;return n.image=t instanceof Morph?t.fullImage():t,t instanceof Morph&&t.getShadow()&&(e=n.image,n.image=newCanvas(t.fullBounds().extent().subtract(this.shadowBlur*(useBlurredShadows?1:2))),n.image.getContext("2d").drawImage(e,0,0)),n.silentSetWidth(n.image.width),n.silentSetHeight(n.image.height),n},MenuItemMorph.prototype.createLabelString=function(t){var e=new TextMorph(t,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic);return e.setColor(this.labelColor),e},MenuItemMorph.prototype.mouseEnter=function(){var t=this.parentThatIsA(MenuMorph);this.isShowingSubmenu()||(t&&t.closeSubmenu(),this.isListItem()||(this.image=this.highlightImage,this.changed()),this.action instanceof MenuMorph?this.delaySubmenu():this.hint&&this.bubbleHelp(this.hint))},MenuItemMorph.prototype.mouseLeave=function(){this.isListItem()||(this.isShowingSubmenu()?this.image=this.highlightImage:this.image=this.normalImage,this.changed()),this.schedule&&(this.schedule.isActive=!1),this.hint&&this.world().hand.destroyTemporaries()},MenuItemMorph.prototype.mouseDownLeft=function(t){this.isListItem()&&(this.parentThatIsA(MenuMorph).unselectAllItems(),this.escalateEvent("mouseDownLeft",t)),this.image=this.pressImage,this.changed()},MenuItemMorph.prototype.mouseMove=function(){this.isListItem()&&this.escalateEvent("mouseMove")},MenuItemMorph.prototype.mouseClickLeft=function(){this.action instanceof MenuMorph?this.popUpSubmenu():(this.isListItem()||(this.parentThatIsA(MenuMorph).closeRootMenu(),this.world().activeMenu=null),this.trigger())},MenuItemMorph.prototype.isListItem=function(){var t=this.parentThatIsA(MenuMorph);return!!t&&t.isListContents},MenuItemMorph.prototype.isSelectedListItem=function(){return!!this.isListItem()&&this.image===this.pressImage},MenuItemMorph.prototype.isShowingSubmenu=function(){var t=this.parentThatIsA(MenuMorph);return!!(t&&this.action instanceof MenuMorph)&&t.submenu===this.action},MenuItemMorph.prototype.delaySubmenu=function(){var t=this.world(),e=this;this.schedule=new Animation(nop,nop,0,500,nop,(function(){e.popUpSubmenu()})),t.animations.push(this.schedule)},MenuItemMorph.prototype.popUpSubmenu=function(){var t=this.parentThatIsA(MenuMorph);this.action instanceof MenuMorph&&(this.action.drawNew(),this.action.setPosition(this.topRight().subtract(new Point(0,5))),this.action.addShadow(new Point(2,2),80),this.action.keepWithin(this.world()),this.action.items.length<1&&!this.action.title||(t.add(this.action),t.submenu=this.action,t.submenu.world=t.world,this.action.fullChanged()))},FrameMorph.prototype=new Morph,FrameMorph.prototype.constructor=FrameMorph,FrameMorph.uber=Morph.prototype,FrameMorph.prototype.init=function(t){this.scrollFrame=t||null,FrameMorph.uber.init.call(this),this.color=new Color(255,250,245),this.drawNew(),this.acceptsDrops=!0,this.scrollFrame&&(this.isDraggable=!1,this.noticesTransparentClick=!1,this.alpha=0)},FrameMorph.prototype.fullBounds=function(){var t=this.getShadow();return null!==t?this.bounds.merge(t.bounds):this.bounds},FrameMorph.prototype.fullImage=function(){return this.image},FrameMorph.prototype.fullDrawOn=function(t,e){var n,r;return this.isVisible?(n=e||this.fullBounds(),(r=this.bounds.intersect(n)).extent().gt(new Point(0,0))?(this.drawOn(t,r),void this.children.forEach((function(e){e instanceof ShadowMorph?e.fullDrawOn(t,n):e.fullDrawOn(t,r)}))):null):null},FrameMorph.prototype.topMorphAt=function(t){var e,n;if(!this.isVisible||!this.bounds.containsPoint(t))return null;for(e=this.children.length-1;e>=0;e-=1)if(n=this.children[e].topMorphAt(t))return n;return this.noticesTransparentClick||!this.isTransparentAt(t)?this:null},FrameMorph.prototype.submorphBounds=function(){var t=null;return this.children.length>0&&(t=this.children[0].bounds,this.children.forEach((function(e){t=t.merge(e.fullBounds())}))),t},FrameMorph.prototype.keepInScrollFrame=function(){if(null===this.scrollFrame)return null;this.left()>this.scrollFrame.left()&&this.moveBy(new Point(this.scrollFrame.left()-this.left(),0)),this.right()<this.scrollFrame.right()&&this.moveBy(new Point(this.scrollFrame.right()-this.right(),0)),this.top()>this.scrollFrame.top()&&this.moveBy(new Point(0,this.scrollFrame.top()-this.top())),this.bottom()<this.scrollFrame.bottom()&&this.moveBy(0,new Point(this.scrollFrame.bottom()-this.bottom(),0))},FrameMorph.prototype.adjustBounds=function(){var t,e,n=this;if(null===this.scrollFrame)return null;e=(t=this.submorphBounds())&&!this.scrollFrame.isTextLineWrapping?t.expandBy(this.scrollFrame.padding).growBy(this.scrollFrame.growth).merge(this.scrollFrame.bounds):this.scrollFrame.bounds.copy(),this.bounds.eq(e)||(this.bounds=e,this.drawNew(),this.keepInScrollFrame()),this.scrollFrame.isTextLineWrapping&&this.children.forEach((function(t){t instanceof TextMorph&&(t.setWidth(n.width()),n.setHeight(Math.max(t.height(),n.scrollFrame.height())))})),this.scrollFrame.adjustScrollBars()},FrameMorph.prototype.reactToDropOf=function(){this.adjustBounds()},FrameMorph.prototype.reactToGrabOf=function(){this.adjustBounds()},FrameMorph.prototype.developersMenu=function(){var t=FrameMorph.uber.developersMenu.call(this);return this.children.length>0&&(t.addLine(),t.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible")),t},FrameMorph.prototype.keepAllSubmorphsWithin=function(){var t=this;this.children.forEach((function(e){e.keepWithin(t)}))},ScrollFrameMorph.prototype=new FrameMorph,ScrollFrameMorph.prototype.constructor=ScrollFrameMorph,ScrollFrameMorph.uber=FrameMorph.prototype,ScrollFrameMorph.prototype.init=function(t,e,n){var r=this;ScrollFrameMorph.uber.init.call(this),this.scrollBarSize=e||MorphicPreferences.scrollBarSize,this.autoScrollTrigger=null,this.enableAutoScrolling=!0,this.isScrollingByDragging=!0,this.hasVelocity=!0,this.padding=0,this.growth=0,this.isTextLineWrapping=!1,this.contents=t||new FrameMorph(this),this.add(this.contents),this.hBar=new SliderMorph(null,null,null,null,"horizontal",n),this.hBar.setHeight(this.scrollBarSize),this.hBar.action=function(t){r.contents.setPosition(new Point(r.left()-t,r.contents.position().y))},this.hBar.isDraggable=!1,this.add(this.hBar),this.vBar=new SliderMorph(null,null,null,null,"vertical",n),this.vBar.setWidth(this.scrollBarSize),this.vBar.action=function(t){r.contents.setPosition(new Point(r.contents.position().x,r.top()-t))},this.vBar.isDraggable=!1,this.add(this.vBar),this.toolBar=null},ScrollFrameMorph.prototype.adjustScrollBars=function(){var t=this.width()-this.scrollBarSize,e=this.height()-this.scrollBarSize;this.changed(),this.contents.width()>this.width()+MorphicPreferences.scrollBarSize?(this.hBar.show(),this.hBar.width()!==t&&this.hBar.setWidth(t),this.hBar.setPosition(new Point(this.left(),this.bottom()-this.hBar.height())),this.hBar.start=0,this.hBar.stop=this.contents.width()-this.width(),this.hBar.size=this.width()/this.contents.width()*this.hBar.stop,this.hBar.value=this.left()-this.contents.left(),this.hBar.drawNew()):this.hBar.hide(),this.contents.height()>this.height()+this.scrollBarSize?(this.vBar.show(),this.vBar.height()!==e&&this.vBar.setHeight(e),this.vBar.setPosition(new Point(this.right()-this.vBar.width(),this.top())),this.vBar.start=0,this.vBar.stop=this.contents.height()-this.height(),this.vBar.size=this.height()/this.contents.height()*this.vBar.stop,this.vBar.value=this.top()-this.contents.top(),this.vBar.drawNew()):this.vBar.hide(),this.adjustToolBar()},ScrollFrameMorph.prototype.adjustToolBar=function(){this.toolBar&&(this.toolBar.setTop(this.top()+3),this.toolBar.setRight((this.vBar.isVisible?this.vBar.left():this.right())-3))},ScrollFrameMorph.prototype.addContents=function(t){this.contents.add(t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.setContents=function(t){this.contents.children.forEach((function(t){t.destroy()})),this.contents.children=[],t.setPosition(this.position().add(this.padding+2)),this.addContents(t)},ScrollFrameMorph.prototype.setExtent=function(t){this.isTextLineWrapping&&this.contents.setPosition(this.position().copy()),ScrollFrameMorph.uber.setExtent.call(this,t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.scrollX=function(t){var e,n=this.contents.left(),r=this.left(),i=this.contents.width(),o=this.right();(e=n+t)+i<o&&(e=o-i),e>r&&(e=r),e!==n&&this.contents.setLeft(e)},ScrollFrameMorph.prototype.scrollY=function(t){var e,n=this.contents.top(),r=this.top(),i=this.contents.height(),o=this.bottom();(e=n+t)+i<o&&(e=o-i),e>r&&(e=r),e!==n&&this.contents.setTop(e)},ScrollFrameMorph.prototype.step=nop,ScrollFrameMorph.prototype.mouseDownLeft=function(t){if(!this.isScrollingByDragging)return null;var e=this.root().hand,n=t,r=this,i=0,o=0;this.step=function(){var t;if(e.mouseButton&&0===e.children.length&&r.bounds.containsPoint(e.bounds.origin)){if(e.grabPosition&&e.grabPosition.distanceTo(e.position())<=MorphicPreferences.grabThreshold)return null;t=e.bounds.origin,0!==(i=t.x-n.x)&&r.scrollX(i),0!==(o=t.y-n.y)&&r.scrollY(o),n=t}else r.hasVelocity?Math.abs(i)<.5&&Math.abs(o)<.5?r.step=function(){nop()}:(i*=.8,r.scrollX(Math.round(i)),o*=.8,r.scrollY(Math.round(o))):r.step=function(){nop()};this.adjustScrollBars()}},ScrollFrameMorph.prototype.startAutoScrolling=function(){var t,e,n,r=this,i=3*MorphicPreferences.scrollBarSize,o=this.world();if(!o)return null;t=o.hand,this.autoScrollTrigger||(this.autoScrollTrigger=Date.now()),this.step=function(){n=t.bounds.origin,e=r.bounds.insetBy(i),r.bounds.containsPoint(n)&&!e.containsPoint(n)&&t.children.length>0?r.autoScroll(n):(r.step=function(){nop()},r.autoScrollTrigger=null)}},ScrollFrameMorph.prototype.autoScroll=function(t){var e;if(Date.now()-this.autoScrollTrigger<500)return null;e=3*MorphicPreferences.scrollBarSize,this.topLeft().extent(new Point(this.width(),e)).containsPoint(t)&&this.scrollY(e-(t.y-this.top())),this.topLeft().extent(new Point(e,this.height())).containsPoint(t)&&this.scrollX(e-(t.x-this.left())),new Point(this.right()-e,this.top()).extent(new Point(e,this.height())).containsPoint(t)&&this.scrollX(-(e-(this.right()-t.x))),new Point(this.left(),this.bottom()-e).extent(new Point(this.width(),e)).containsPoint(t)&&this.scrollY(-(e-(this.bottom()-t.y))),this.adjustScrollBars()},ScrollFrameMorph.prototype.scrollCursorIntoView=function(t){var e=t.target,n=e.position().subtract(this.contents.position()),r=this.top()+this.padding,i=this.bottom()-this.padding;this.contents.setExtent(e.extent().add(n).add(this.padding)),t.top()<r?(this.contents.setTop(this.contents.top()+r-t.top()),t.setTop(r)):t.bottom()>i&&(this.contents.setBottom(this.contents.bottom()+i-t.bottom()),t.setBottom(i)),this.adjustScrollBars()},ScrollFrameMorph.prototype.mouseScroll=function(t,e){t&&this.scrollY(t*MorphicPreferences.mouseScrollAmount),e&&this.scrollX(e*MorphicPreferences.mouseScrollAmount),this.adjustScrollBars()},ScrollFrameMorph.prototype.updateReferences=function(t){var e=this;ScrollFrameMorph.uber.updateReferences.call(this,t),this.hBar&&(this.hBar.action=function(t){e.contents.setPosition(new Point(e.left()-t,e.contents.position().y))}),this.vBar&&(this.vBar.action=function(t){e.contents.setPosition(new Point(e.contents.position().x,e.top()-t))})},ScrollFrameMorph.prototype.developersMenu=function(){var t=ScrollFrameMorph.uber.developersMenu.call(this);return this.isTextLineWrapping?t.addItem("auto line wrap off...","toggleTextLineWrapping","turn automatic\nline wrapping\noff"):t.addItem("auto line wrap on...","toggleTextLineWrapping","enable automatic\nline wrapping"),t},ScrollFrameMorph.prototype.toggleTextLineWrapping=function(){this.isTextLineWrapping=!this.isTextLineWrapping},ListMorph.prototype=new ScrollFrameMorph,ListMorph.prototype.constructor=ListMorph,ListMorph.uber=ScrollFrameMorph.prototype,ListMorph.prototype.init=function(t,e,n,r){ListMorph.uber.init.call(this),this.contents.acceptsDrops=!1,this.color=new Color(255,255,255),this.hBar.alpha=.6,this.vBar.alpha=.6,this.elements=t||[],this.labelGetter=e,this.format=n,this.listContents=null,this.selected=null,this.active=null,this.action=null,this.doubleClickAction=r||null,this.acceptsDrops=!1,this.buildListContents()},ListMorph.prototype.buildListContents=function(){var t=this;this.listContents&&this.listContents.destroy(),this.listContents=new MenuMorph(this.select,null,this),0===this.elements.length&&(this.elements=["(empty)"]),this.elements.forEach((function(e){var n=null,r=!1,i=!1;t.format.forEach((function(t){t[1].call(null,e)&&("bold"===t[0]?r=!0:"italic"===t[0]?i=!0:n=t[0])})),t.listContents.addItem(t.labelGetter(e),e,null,n,r,i,t.doubleClickAction)})),this.listContents.isListContents=!0,this.listContents.drawNew(),this.listContents.setPosition(this.contents.position()),this.addContents(this.listContents)},ListMorph.prototype.select=function(t,e){isNil(t)||(this.selected=t,this.active=e,this.action&&this.action.call(null,t))},ListMorph.prototype.setExtent=function(t){var e=this.listContents.bounds,n=this.bounds.origin.copy().corner(this.bounds.origin.add(t));n.right()>e.right()&&n.width()<=e.width()&&this.listContents.setRight(n.right()),n.bottom()>e.bottom()&&n.height()<=e.height()&&this.listContents.setBottom(n.bottom()),ListMorph.uber.setExtent.call(this,t)},ListMorph.prototype.activeIndex=function(){return this.listContents.children.indexOf(this.active)},ListMorph.prototype.activateIndex=function(t){var e=this.listContents.children[t];e&&(e.image=e.pressImage,e.changed(),e.trigger())},StringFieldMorph.prototype=new FrameMorph,StringFieldMorph.prototype.constructor=StringFieldMorph,StringFieldMorph.uber=FrameMorph.prototype,StringFieldMorph.prototype.init=function(t,e,n,r,i,o,s){this.defaultContents=t,this.minWidth=e,this.fontSize=n,this.fontStyle=r,this.isBold=i,this.isItalic=o,this.isNumeric=s||!1,this.text=null,StringFieldMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isEditable=!0,this.acceptsDrops=!1,this.drawNew()},StringFieldMorph.prototype.drawNew=function(){var t;t=this.text?this.string():this.defaultContents,this.text=null,this.children.forEach((function(t){t.destroy()})),this.children=[],this.text=new StringMorph(t,this.fontSize,this.fontStyle,this.isBold,this.isItalic,this.isNumeric),this.text.isNumeric=this.isNumeric,this.text.setPosition(this.bounds.origin.copy()),this.text.isEditable=this.isEditable,this.text.isDraggable=!1,this.text.enableSelecting(),this.silentSetExtent(new Point(Math.max(this.width(),this.minWidth),this.text.height())),StringFieldMorph.uber.drawNew.call(this),this.add(this.text)},StringFieldMorph.prototype.string=function(){return this.text.text},StringFieldMorph.prototype.mouseClickLeft=function(t){this.isEditable?this.text.edit():this.escalateEvent("mouseClickLeft",t)},BouncerMorph.prototype=new Morph,BouncerMorph.prototype.constructor=BouncerMorph,BouncerMorph.uber=Morph.prototype,BouncerMorph.prototype.init=function(t,e){BouncerMorph.uber.init.call(this),this.fps=50,this.isStopped=!1,this.type=t||"vertical","vertical"===this.type?this.direction="down":this.direction="right",this.speed=e||1},BouncerMorph.prototype.moveUp=function(){this.moveBy(new Point(0,-this.speed))},BouncerMorph.prototype.moveDown=function(){this.moveBy(new Point(0,this.speed))},BouncerMorph.prototype.moveRight=function(){this.moveBy(new Point(this.speed,0))},BouncerMorph.prototype.moveLeft=function(){this.moveBy(new Point(-this.speed,0))},BouncerMorph.prototype.step=function(){this.isStopped||("vertical"===this.type?("down"===this.direction?this.moveDown():this.moveUp(),this.fullBounds().top()<this.parent.top()&&"up"===this.direction&&(this.direction="down"),this.fullBounds().bottom()>this.parent.bottom()&&"down"===this.direction&&(this.direction="up")):"horizontal"===this.type&&("right"===this.direction?this.moveRight():this.moveLeft(),this.fullBounds().left()<this.parent.left()&&"left"===this.direction&&(this.direction="right"),this.fullBounds().right()>this.parent.right()&&"right"===this.direction&&(this.direction="left")))},HandMorph.prototype=new Morph,HandMorph.prototype.constructor=HandMorph,HandMorph.uber=Morph.prototype,HandMorph.prototype.init=function(t){HandMorph.uber.init.call(this,!0),this.bounds=new Rectangle,this.world=t,this.mouseButton=null,this.mouseOverList=[],this.morphToGrab=null,this.grabPosition=null,this.grabOrigin=null,this.temporaries=[],this.touchHoldTimeout=null,this.contextMenuEnabled=!1},HandMorph.prototype.changed=function(){var t;null!==this.world&&((t=this.fullBounds()).extent().eq(new Point)||this.world.broken.push(t.spread()))},HandMorph.prototype.fullChanged=HandMorph.prototype.changed,HandMorph.prototype.morphAtPointer=function(){return this.world.topMorphAt(this.bounds.origin)||this.world},HandMorph.prototype.allMorphsAtPointer=function(){var t=this.world.allChildren(),e=this;return t.filter((function(t){return t.isVisible&&t.visibleBounds().containsPoint(e.bounds.origin)}))},HandMorph.prototype.dropTargetFor=function(t){for(var e=this.morphAtPointer();!e.wantsDropOf(t);)e=e.parent;return e},HandMorph.prototype.grab=function(t){var e=t.parent;if(t instanceof WorldMorph)return null;0===this.children.length&&(this.world.stopEditing(),this.grabOrigin=t.situation(),t instanceof MenuMorph||t.addShadow(),t.prepareToBeGrabbed&&t.prepareToBeGrabbed(this),t.cachedFullImage=t.fullImageClassic(),t.cachedFullBounds=t.fullBounds(),this.add(t),this.changed(),e&&e.reactToGrabOf&&e.reactToGrabOf(t))},HandMorph.prototype.drop=function(){var t,e;0!==this.children.length&&(e=this.children[0],t=(t=this.dropTargetFor(e)).selectForEdit?t.selectForEdit():t,this.changed(),t.add(e),e.cachedFullImage=null,e.cachedFullBounds=null,e.changed(),e instanceof MenuMorph||e.removeShadow(),this.children=[],this.setExtent(new Point),e.justDropped&&e.justDropped(this),t.reactToDropOf&&t.reactToDropOf(e,this))},HandMorph.prototype.processMouseDown=function(t){var e,n;if(this.destroyTemporaries(),this.contextMenuEnabled=!0,this.morphToGrab=null,this.grabPosition=null,0!==this.children.length)this.drop(),this.mouseButton=null;else{for(e=this.morphAtPointer(),this.world.activeMenu&&(contains(e.allParents(),this.world.activeMenu)?clearInterval(this.touchHoldTimeout):this.world.activeMenu.destroy()),this.world.activeHandle&&e!==this.world.activeHandle&&this.world.activeHandle.destroy(),this.world.cursor&&e!==this.world.cursor.target&&this.world.stopEditing(),e.mouseMove||(this.morphToGrab=e.rootForGrab(),this.grabPosition=this.bounds.origin.copy()),2===t.button||t.ctrlKey?(this.mouseButton="right",n="mouseDownRight"):(this.mouseButton="left",n="mouseDownLeft");!e[n];)e=e.parent;e[n](this.bounds.origin)}},HandMorph.prototype.processTouchStart=function(t){var e=this;MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),1===t.touches.length&&(this.touchHoldTimeout=setInterval((function(){e.processMouseDown({button:2}),e.processMouseUp({button:2}),t.preventDefault(),clearInterval(e.touchHoldTimeout)}),400),this.processMouseMove(t.touches[0]),this.processMouseDown({button:0}),t.preventDefault())},HandMorph.prototype.processTouchMove=function(t){if(MorphicPreferences.isTouchDevice=!0,1===t.touches.length){var e=t.touches[0];this.processMouseMove(e),clearInterval(this.touchHoldTimeout)}},HandMorph.prototype.processTouchEnd=function(t){MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),nop(t),this.processMouseUp({button:0})},HandMorph.prototype.processMouseUp=function(){var t,e,n,r=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{if("left"===this.mouseButton)n="mouseClickLeft";else if(n="mouseClickRight",this.mouseButton&&this.contextMenuEnabled){for(e=(t=r).contextMenu();!e&&t.parent;)e=(t=t.parent).contextMenu();e&&e.popUpAtHand(this.world)}for(;!r[n];)r=r.parent;r[n](this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processDoubleClick=function(){var t=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{for(;t&&!t.mouseDoubleClick;)t=t.parent;t&&t.mouseDoubleClick(this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processMouseMove=function(t){var e,n,r,i,o=getDocumentPositionOf(this.world.worldCanvas),s=this;e=new Point(t.pageX-o.x,t.pageY-o.y),this.setPosition(e),n=this.morphAtPointer().allParents(),!this.children.length&&this.mouseButton&&(r=(i=this.morphAtPointer()).rootForGrab(),i.mouseMove&&(i.mouseMove(e,this.mouseButton),"right"===this.mouseButton&&(this.contextMenuEnabled=!1)),"left"===this.mouseButton&&this.morphToGrab&&this.grabPosition.distanceTo(this.bounds.origin)>MorphicPreferences.grabThreshold&&(this.setPosition(this.grabPosition),this.morphToGrab.isDraggable?(r=this.morphToGrab.selectForEdit?this.morphToGrab.selectForEdit():this.morphToGrab,this.grab(r)):this.morphToGrab.isTemplate&&(this.world.stopEditing(),(r=this.morphToGrab.fullCopy()).isTemplate=!1,r.isDraggable=!0,r.reactToTemplateCopy&&r.reactToTemplateCopy(),this.grab(r),this.grabOrigin=this.morphToGrab.situation()),this.setPosition(e))),this.mouseOverList.forEach((function(t){contains(n,t)||(t.mouseLeave&&t.mouseLeave(),t.mouseLeaveDragging&&s.mouseButton&&t.mouseLeaveDragging())})),n.forEach((function(t){contains(s.mouseOverList,t)||(t.mouseEnter&&t.mouseEnter(),t.mouseEnterDragging&&s.mouseButton&&t.mouseEnterDragging()),s.children.length>0&&t instanceof ScrollFrameMorph&&t.enableAutoScrolling&&t.contents.allChildren().some((function(t){return t.wantsDropOf(s.children[0])}))&&(t.bounds.insetBy(3*MorphicPreferences.scrollBarSize).containsPoint(s.bounds.origin)||t.startAutoScrolling())})),this.mouseOverList=n},HandMorph.prototype.processMouseScroll=function(t){for(var e=this.morphAtPointer();e&&!e.mouseScroll;)e=e.parent;e&&e.mouseScroll(t.detail/-3||(Object.prototype.hasOwnProperty.call(t,"wheelDeltaY")?t.wheelDeltaY/120:t.wheelDelta/120),t.wheelDeltaX/120||0)},HandMorph.prototype.processDrop=function(t){var e,n,r,i,o,s=t instanceof FileList?t:t.target.files||t.dataTransfer.files,h=t.dataTransfer?t.dataTransfer.getData("URL"):null,a=t.dataTransfer?t.dataTransfer.getData("Text/HTML"):null,l=this.morphAtPointer(),u=new Image;function c(t){for(var e=new Image,n=new FileReader;!l.droppedSVG;)l=l.parent;e.onload=function(){l.droppedSVG(e,t.name)},(n=new FileReader).onloadend=function(t){e.src=t.target.result},n.readAsDataURL(t)}function p(t){for(var e=new Image,n=new FileReader;!l.droppedImage;)l=l.parent;e.onload=function(){(i=newCanvas(new Point(e.width,e.height),!0)).getContext("2d").drawImage(e,0,0),l.droppedImage(i,t.name)},(n=new FileReader).onloadend=function(t){e.src=t.target.result},n.readAsDataURL(t)}function d(t){for(var e=new Audio,n=new FileReader;!l.droppedAudio;)l=l.parent;n.onloadend=function(n){e.src=n.target.result,l.droppedAudio(e,t.name)},n.readAsDataURL(t)}function f(t){for(var e=new FileReader;!l.droppedText;)l=l.parent;e.onloadend=function(e){l.droppedText(e.target.result,t.name)},e.readAsText(t)}function g(t){for(var e=new FileReader;!l.droppedBinary;)l=l.parent;e.onloadend=function(e){l.droppedBinary(e.target.result,t.name)},e.readAsArrayBuffer(t)}if(s.length>0)for(o=0;o<s.length;o+=1)-1===(e=s[o]).type.indexOf("svg")||MorphicPreferences.rasterizeSVGs?0===e.type.indexOf("image")?p(e):0===e.type.indexOf("audio")?d(e):0===e.type.indexOf("text")?f(e):g(e):c(e);else if(h){if(contains(["gif","png","jpg","jpeg","bmp"],n=h.slice(h.lastIndexOf(".")+1).toLowerCase())){for(;!l.droppedImage;)l=l.parent;(u=new Image).onload=function(){(i=newCanvas(new Point(u.width,u.height),!0)).getContext("2d").drawImage(u,0,0),l.droppedImage(i)},u.src=h}else if("svg"===n&&!MorphicPreferences.rasterizeSVGs){for(;!l.droppedSVG;)l=l.parent;!function(t,e){var n=new XMLHttpRequest;n.open("GET",t),n.onreadystatechange=function(){if(4===n.readyState){if(!n.responseText)throw new Error("unable to retrieve "+t);e(n.responseText)}},n.send()}(h,(function(t){var e=new Image;e.onload=function(){l.droppedSVG(e,h.slice(h.lastIndexOf("/")+1,h.lastIndexOf(".")))},e.src="data:image/svg+xml;utf8,"+encodeURIComponent(t)}))}}else if(a){for(;!l.droppedImage;)l=l.parent;(u=new Image).onload=function(){(i=newCanvas(new Point(u.width,u.height),!0)).getContext("2d").drawImage(u,0,0),l.droppedImage(i)},(r=function(t){var e,n,r="",i=t.indexOf('<img src="');if(-1===i)return null;for(e=i+=10;e<t.length;e+=1){if('"'===(n=t[e]))return r;r=r.concat(n)}return null}(a))&&(u.src=r)}},HandMorph.prototype.destroyTemporaries=function(){var t=this;this.temporaries.forEach((function(e){e.isClickable&&e.bounds.containsPoint(t.position())||(e.destroy(),t.temporaries.splice(t.temporaries.indexOf(e),1))}))},WorldMorph.prototype=new FrameMorph,WorldMorph.prototype.constructor=WorldMorph,WorldMorph.uber=FrameMorph.prototype,WorldMorph.prototype.init=function(t,e){for(WorldMorph.uber.init.call(this),this.color=new Color(205,205,205),this.alpha=1,this.bounds=new Rectangle(0,0,t.width,t.height),this.drawNew(),this.isVisible=!0,this.isDraggable=!1,this.currentKey=null,this.worldCanvas=t,this.noticesTransparentClick=!0,this.stamp=Date.now();this.stamp===Date.now();)nop();this.stamp=Date.now(),this.useFillPage=e,void 0===this.useFillPage&&(this.useFillPage=!0),this.isDevMode=!1,this.broken=[],this.animations=[],this.hand=new HandMorph(this),this.keyboardReceiver=null,this.cursor=null,this.lastEditedText=null,this.activeMenu=null,this.activeHandle=null,this.virtualKeyboard=null,this.initEventListeners()},WorldMorph.prototype.brokenFor=function(t){var e=t.fullBounds();return this.broken.filter((function(t){return t.intersects(e)}))},WorldMorph.prototype.fullDrawOn=function(t,e){WorldMorph.uber.fullDrawOn.call(this,t,e),this.hand.fullDrawOn(t,e)},WorldMorph.prototype.updateBroken=function(){var t=this;this.condenseDamages(),this.broken.forEach((function(e){e.extent().gt(new Point(0,0))&&t.fullDrawOn(t.worldCanvas,e)})),this.broken=[]},WorldMorph.prototype.stepAnimations=function(){this.animations.forEach((function(t){t.step()})),this.animations=this.animations.filter((function(t){return t.isActive}))},WorldMorph.prototype.condenseDamages=function(){function t(t){var e,n=[];return t.forEach((function(t){(e=detect(n,(function(e){return e.isNearTo(t,20)})))?e.mergeWith(t):n.push(t)})),n}for(var e=!0,n=this.broken.length;e;)this.broken=t(this.broken),e=this.broken.length<n,n=this.broken.length},WorldMorph.prototype.doOneCycle=function(){this.stepFrame(),this.stepAnimations(),this.updateBroken()},WorldMorph.prototype.fillPage=function(){var t=window.innerHeight,e=window.innerWidth,n=this;this.worldCanvas.style.position="absolute",this.worldCanvas.style.left="0px",this.worldCanvas.style.right="0px",this.worldCanvas.style.width="100%",this.worldCanvas.style.height="100%",document.documentElement.scrollTop&&(t=document.documentElement.clientHeight),document.documentElement.scrollLeft&&(e=document.documentElement.clientWidth),this.worldCanvas.width!==e&&(this.worldCanvas.width=e,this.setWidth(e)),this.worldCanvas.height!==t&&(this.worldCanvas.height=t,this.setHeight(t)),this.children.forEach((function(t){t.reactToWorldResize&&t.reactToWorldResize(n.bounds.copy())}))},WorldMorph.prototype.getGlobalPixelColor=function(t){return this.hand.morphAtPointer().getPixelColor(this.hand.position())},WorldMorph.prototype.initVirtualKeyboard=function(){var t=this;this.virtualKeyboard&&(document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard=document.createElement("input"),this.virtualKeyboard.type="text",this.virtualKeyboard.style.color="transparent",this.virtualKeyboard.style.backgroundColor="transparent",this.virtualKeyboard.style.border="none",this.virtualKeyboard.style.outline="none",this.virtualKeyboard.style.position="absolute",this.virtualKeyboard.style.top="0px",this.virtualKeyboard.style.left="0px",this.virtualKeyboard.style.width="0px",this.virtualKeyboard.style.height="0px",this.virtualKeyboard.autocapitalize="none",document.body.appendChild(this.virtualKeyboard),this.virtualKeyboard.addEventListener("keydown",(function(e){t.currentKey=e.keyCode,t.keyboardReceiver&&t.keyboardReceiver.processKeyDown(e),8===e.keyCode&&e.preventDefault(),9===e.keyCode&&(t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault())}),!1),this.virtualKeyboard.addEventListener("keyup",(function(e){t.currentKey=null,t.keyboardReceiver&&t.keyboardReceiver.processKeyUp&&t.keyboardReceiver.processKeyUp(e),e.preventDefault()}),!1),this.virtualKeyboard.addEventListener("keypress",(function(e){t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault()}),!1))},WorldMorph.prototype.initEventListeners=function(){var t=this.worldCanvas,e=this;e.useFillPage?e.fillPage():this.changed(),t.addEventListener("mousedown",(function(n){n.preventDefault(),t.focus(),e.hand.processMouseDown(n)}),!1),t.addEventListener("touchstart",(function(t){e.hand.processTouchStart(t)}),!1),t.addEventListener("mouseup",(function(t){t.preventDefault(),e.hand.processMouseUp(t)}),!1),t.addEventListener("dblclick",(function(t){t.preventDefault(),e.hand.processDoubleClick(t)}),!1),t.addEventListener("touchend",(function(t){e.hand.processTouchEnd(t)}),!1),t.addEventListener("mousemove",(function(t){e.hand.processMouseMove(t)}),!1),t.addEventListener("touchmove",(function(t){e.hand.processTouchMove(t)}),!1),t.addEventListener("contextmenu",(function(t){t.preventDefault()}),!1),t.addEventListener("keydown",(function(t){e.currentKey=t.keyCode,e.keyboardReceiver&&e.keyboardReceiver.processKeyDown(t),8===t.keyCode&&t.preventDefault(),9===t.keyCode&&(e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault()),(t.ctrlKey&&!t.altKey||t.metaKey)&&86!==t.keyCode&&t.preventDefault()}),!1),t.addEventListener("keyup",(function(t){e.currentKey=null,e.keyboardReceiver&&e.keyboardReceiver.processKeyUp&&e.keyboardReceiver.processKeyUp(t),t.preventDefault()}),!1),t.addEventListener("keypress",(function(t){e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault()}),!1),t.addEventListener("mousewheel",(function(t){e.hand.processMouseScroll(t),t.preventDefault()}),!1),t.addEventListener("DOMMouseScroll",(function(t){e.hand.processMouseScroll(t),t.preventDefault()}),!1),document.body.addEventListener("paste",(function(t){var n=t.clipboardData.getData("Text");n&&e.cursor&&e.cursor.insert(n)}),!1),window.addEventListener("dragover",(function(t){t.preventDefault()}),!1),window.addEventListener("drop",(function(t){e.hand.processDrop(t),t.preventDefault()}),!1),window.addEventListener("resize",(function(){e.useFillPage&&e.fillPage()}),!1),window.onbeforeunload=function(t){var e=t||window.event,n="Are you sure you want to leave?";return e&&(e.returnValue=n),n}},WorldMorph.prototype.mouseDownLeft=nop,WorldMorph.prototype.mouseClickLeft=nop,WorldMorph.prototype.mouseDownRight=nop,WorldMorph.prototype.mouseClickRight=nop,WorldMorph.prototype.wantsDropOf=function(){return this.acceptsDrops},WorldMorph.prototype.droppedImage=function(){return null},WorldMorph.prototype.droppedSVG=function(){return null},WorldMorph.prototype.nextTab=function(t){var e=this.nextEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.previousTab=function(t){var e=this.previousEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.contextMenu=function(){var t;return t=this.isDevMode?new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]):new MenuMorph(this,"Morphic"),this.isDevMode&&(t.addItem("demo...","userCreateMorph","sample morphs"),t.addLine(),t.addItem("hide all...","hideAll"),t.addItem("show all...","showAllHiddens"),t.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible"),t.addItem("inspect...","inspect","open a window on\nall properties"),t.addItem("screenshot...",(function(){window.open(this.fullImageClassic().toDataURL())}),"open a new window\nwith a picture of this morph.jsk"),t.addLine(),t.addItem("restore display","changed","redraw the\nscreen once"),t.addItem("fill page...","fillPage","let the World automatically\nadjust to browser resizing"),useBlurredShadows?t.addItem("sharp shadows...","toggleBlurredShadows","sharp drop shadows\nuse for old browsers"):t.addItem("blurred shadows...","toggleBlurredShadows","blurry shades,\n use for new browsers"),t.addItem("color...",(function(){this.pickColor(t.title+localize("\ncolor:"),this.setColor,this,this.color)}),"choose the World's\nbackground color"),MorphicPreferences===standardSettings?t.addItem("touch screen settings","togglePreferences","bigger menu fonts\nand sliders"):t.addItem("standard settings","togglePreferences","smaller menu fonts\nand sliders"),t.addLine()),this.isDevMode?t.addItem("user mode...","toggleDevMode","disable developers'\ncontext menus"):t.addItem("development mode...","toggleDevMode"),t.addItem("about morphic.js...","about"),t},WorldMorph.prototype.userCreateMorph=function(){var t,e,n=this;function r(t){t.isDraggable=!0,t.pickUp(n)}(t=new MenuMorph(this,"make a morph.jsk")).addItem("rectangle",(function(){r(new Morph)})),t.addItem("box",(function(){r(new BoxMorph)})),t.addItem("circle box",(function(){r(new CircleBoxMorph)})),t.addLine(),t.addItem("slider",(function(){r(new SliderMorph)})),t.addItem("dial",(function(){(e=new DialMorph).pickUp(this)})),t.addItem("frame",(function(){(e=new FrameMorph).setExtent(new Point(350,250)),r(e)})),t.addItem("scroll frame",(function(){(e=new ScrollFrameMorph).contents.acceptsDrops=!0,e.contents.adjustBounds(),e.setExtent(new Point(350,250)),r(e)})),t.addItem("handle",(function(){r(new HandleMorph)})),t.addLine(),t.addItem("string",(function(){(e=new StringMorph("Hello, World!")).isEditable=!0,r(e)})),t.addItem("text",(function(){(e=new TextMorph("Ich weiß nicht, was soll es bedeuten, dass ich so traurig bin, ein Märchen aus uralten Zeiten, das kommt mir nicht aus dem Sinn. Die Luft ist kühl und es dunkelt, und ruhig fließt der Rhein; der Gipfel des Berges funkelt im Abendsonnenschein. Die schönste Jungfrau sitzet dort oben wunderbar, ihr gold'nes Geschmeide blitzet, sie kämmt ihr goldenes Haar, sie kämmt es mit goldenem Kamme, und singt ein Lied dabei; das hat eine wundersame, gewalt'ge Melodei. Den Schiffer im kleinen Schiffe, ergreift es mit wildem Weh; er schaut nicht die Felsenriffe, er schaut nur hinauf in die Höh'. Ich glaube, die Wellen verschlingen am Ende Schiffer und Kahn, und das hat mit ihrem Singen, die Loreley getan.")).isEditable=!0,e.maxWidth=300,e.drawNew(),r(e)})),t.addItem("speech bubble",(function(){r(e=new SpeechBubbleMorph("Hello, World!"))})),t.addLine(),t.addItem("gray scale palette",(function(){r(new GrayPaletteMorph)})),t.addItem("color palette",(function(){r(new ColorPaletteMorph)})),t.addItem("color picker",(function(){r(new ColorPickerMorph)})),t.addLine(),t.addItem("sensor demo",(function(){(e=new MouseSensorMorph).setColor(new Color(230,200,100)),e.edge=35,e.border=15,e.borderColor=new Color(200,100,50),e.alpha=.2,e.setExtent(new Point(100,100)),r(e)})),t.addItem("animation demo",(function(){var t,e,n,i,o;(t=new BouncerMorph).setPosition(new Point(50,20)),t.setExtent(new Point(300,200)),t.alpha=.9,t.speed=3,(e=new BouncerMorph).setColor(new Color(50,50,50)),e.setPosition(new Point(80,80)),e.setExtent(new Point(80,250)),e.type="horizontal",e.direction="right",e.alpha=.9,e.speed=5,(n=new BouncerMorph).setColor(new Color(20,20,20)),n.setPosition(new Point(90,140)),n.setExtent(new Point(40,30)),n.type="horizontal",n.direction="right",n.speed=3,(i=new BouncerMorph).setColor(new Color(200,20,20)),i.setPosition(new Point(90,140)),i.setExtent(new Point(20,20)),i.type="vertical",i.direction="up",i.speed=8,(o=new BouncerMorph).setColor(new Color(20,200,20)),o.setPosition(new Point(120,140)),o.setExtent(new Point(20,20)),o.type="vertical",o.direction="down",o.speed=4,e.add(i),e.add(n),t.add(o),t.add(e),r(t)})),t.addItem("pen",(function(){r(new PenMorph)})),n.customMorphs&&(t.addLine(),n.customMorphs().forEach((function(e){t.addItem(e.toString(),(function(){r(e)}))}))),t.popUpAtHand(this)},WorldMorph.prototype.toggleDevMode=function(){this.isDevMode=!this.isDevMode},WorldMorph.prototype.hideAll=function(){this.children.forEach((function(t){t.hide()}))},WorldMorph.prototype.showAllHiddens=function(){this.forAllChildren((function(t){t.isVisible||t.show()}))},WorldMorph.prototype.about=function(){var t,e="";for(t in modules)Object.prototype.hasOwnProperty.call(modules,t)&&(e+="\n"+t+" ("+modules[t]+")");""!==e&&(e="\n\nmodules:\n\nmorphic ("+morphicVersion+")"+e),this.inform("morphic.js\n\na lively Web GUI\ninspired by Squeak\n"+morphicVersion+"\n\nwritten by Jens Mönig\njens@moenig.org"+e)},WorldMorph.prototype.edit=function(t){var e=getDocumentPositionOf(this.worldCanvas);if(!t.isEditable)return null;this.cursor&&this.cursor.destroy(),this.cursor=new CursorMorph(t),t.parent.add(this.cursor),this.keyboardReceiver=this.cursor,this.initVirtualKeyboard(),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard.style.top=this.cursor.top()+e.y+"px",this.virtualKeyboard.style.left=this.cursor.left()+e.x+"px",this.virtualKeyboard.focus()),MorphicPreferences.useSliderForInput&&(t.parentThatIsA(MenuMorph)||this.slide(t)),this.lastEditedText!==t&&t.escalateEvent("freshTextEdit",t),this.lastEditedText=t},WorldMorph.prototype.slide=function(t){var e,n,r=parseFloat(t.text);isNaN(r)&&(r=0),e=new MenuMorph,(n=new SliderMorph(r-25,r+25,r,10,"horizontal")).alpha=1,n.color=new Color(225,225,225),n.button.color=e.borderColor,n.button.highlightColor=n.button.color.copy(),n.button.highlightColor.b+=100,n.button.pressColor=n.button.color.copy(),n.button.pressColor.b+=150,n.silentSetHeight(MorphicPreferences.scrollBarSize),n.silentSetWidth(10*MorphicPreferences.menuFontSize),n.drawNew(),n.action=function(e){t.changed(),t.text=Math.round(e).toString(),t.drawNew(),t.changed(),t.escalateEvent("reactToSliderEdit",t)},e.items.push(n),e.popup(this,t.bottomLeft().add(new Point(0,5)))},WorldMorph.prototype.stopEditing=function(){this.cursor&&(this.cursor.target.escalateEvent("reactToEdit",this.cursor.target),this.cursor.target.clearSelection(),this.cursor.destroy(),this.cursor=null),this.keyboardReceiver&&this.keyboardReceiver.stopEditing&&this.keyboardReceiver.stopEditing(),this.keyboardReceiver=null,this.virtualKeyboard&&(this.virtualKeyboard.blur(),document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),this.lastEditedText=null,this.worldCanvas.focus()},WorldMorph.prototype.toggleBlurredShadows=function(){useBlurredShadows=!useBlurredShadows},WorldMorph.prototype.togglePreferences=function(){MorphicPreferences=MorphicPreferences===standardSettings?touchScreenSettings:standardSettings}},function(t,e){var n=window.URL||window.webkitURL;t.exports=function(t,e,r){try{try{var i;try{(i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),i=i.getBlob()}catch(e){i=new Blob([t])}return new SharedWorker(n.createObjectURL(i),r)}catch(e){return new SharedWorker("data:application/javascript,"+encodeURIComponent(t),r)}}catch(t){return new SharedWorker(e,r)}}}]);