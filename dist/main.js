!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=53)}([function(t,e,r){"use strict";var i=r(23),n=r(19),o=r(7),s=r(3),a=Object(i.a)((function(t,e){var r=Object(s.a)(e,Object(o.a)(a));return Object(n.a)(t,32,void 0,e,r)}));a.placeholder={},e.a=a},function(t,e,r){"use strict";var i=r(32),n="object"==typeof self&&self&&self.Object===Object&&self,o=i.a||n||Function("return this")();e.a=o},function(t,e,r){"use strict";e.a=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,r){"use strict";var i="__lodash_placeholder__";e.a=function(t,e){for(var r=-1,n=t.length,o=0,s=[];++r<n;){var a=t[r];a!==e&&a!==i||(t[r]=i,s[o++]=r)}return s}},function(t,e,r){!function(){"use strict";var e=document,r=window,i=e.documentElement,n=e.createElement.bind(e),o=n("div"),s=n("table"),a=n("tbody"),h=n("tr"),c=Array.isArray,l=Array.prototype,u=l.filter,p=l.indexOf,d=l.map,f=l.push,g=l.slice,_=l.some,v=l.splice,y=/^#[\w-]*$/,m=/^\.[\w-]*$/,b=/<.+>/,S=/^\w+$/;function w(t,r){return void 0===r&&(r=e),(i=r)&&9===i.nodeType||A(r)?m.test(t)?r.getElementsByClassName(t.slice(1)):S.test(t)?r.getElementsByTagName(t):r.querySelectorAll(t):[];var i}var C=function(){function t(t,i){if(void 0===i&&(i=e),t){if(L(t))return t;var n=t;if(R(t)){var o=L(i)?i[0]:i;if(!(n=y.test(t)?o.getElementById(t.slice(1)):b.test(t)?St(t):w(t,o)))return}else if(D(t))return this.ready(t);(n.nodeType||n===r)&&(n=[n]),this.length=n.length;for(var s=0,a=this.length;s<a;s++)this[s]=n[s]}}return t.prototype.init=function(e,r){return new t(e,r)},t}(),M=C.prototype,E=M.init;E.fn=E.prototype=M,M.length=0,M.splice=v,"function"==typeof Symbol&&(M[Symbol.iterator]=l[Symbol.iterator]),M.map=function(t){return E(d.call(this,(function(e,r){return t.call(e,r,e)})))},M.slice=function(t,e){return E(g.call(this,t,e))};var x=/-([a-z])/g;function P(t){return t.replace(x,(function(t,e){return e.toUpperCase()}))}function k(t,e,r){if(r){for(var i=t.length;i--;)if(!1===e.call(t[i],i,t[i]))return t}else{i=0;for(var n=t.length;i<n;i++)if(!1===e.call(t[i],i,t[i]))return t}return t}function T(t,e){var r=t&&(t.matches||t.webkitMatchesSelector||t.msMatchesSelector);return!!r&&r.call(t,e)}function L(t){return t instanceof C}function I(t){return!!t&&t===t.window}function A(t){return!!t&&1===t.nodeType}function D(t){return"function"==typeof t}function R(t){return"string"==typeof t}function O(t){return void 0===t}function B(t){return null===t}function H(t){return!isNaN(parseFloat(t))&&isFinite(t)}function F(t){return R(t)?function(e,r){return T(r,t)}:D(t)?t:L(t)?function(e,r){return t.is(r)}:t?function(e,r){return r===t}:function(){return!1}}function j(t,e){return e?t.filter(e):t}E.camelCase=P,E.each=k,M.each=function(t){return k(this,t)},M.removeProp=function(t){return this.each((function(e,r){delete r[t]}))},E.extend=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var i=arguments.length,n=i<2?0:1;n<i;n++)for(var o in arguments[n])t[o]=arguments[n][o];return t},M.extend=function(t){return E.extend(M,t)},E.guid=1,E.matches=T,E.isWindow=I,E.isFunction=D,E.isString=R,E.isNumeric=H,E.isArray=c,M.prop=function(t,e){if(t){if(R(t))return arguments.length<2?this[0]&&this[0][t]:this.each((function(r,i){i[t]=e}));for(var r in t)this.prop(r,t[r]);return this}},M.get=function(t){return O(t)?g.call(this):this[t<0?t+this.length:t]},M.eq=function(t){return E(this.get(t))},M.first=function(){return this.eq(0)},M.last=function(){return this.eq(-1)},M.filter=function(t){var e=F(t);return E(u.call(this,(function(t,r){return e.call(t,r,t)})))};var N=/\S+/g;function W(t){return R(t)&&t.match(N)||[]}function U(t,e,r){for(var i=[],n=D(e),o=0,s=t.length;o<s;o++)if(n){var a=e(t[o]);a.length&&f.apply(i,a)}else for(var h=t[o][e];null!=h;)i.push(h),h=r?h[e]:null;return i}function z(t){return t.length>1?u.call(t,(function(t,e,r){return p.call(r,t)===e})):t}function q(t,e,i){if(A(t)&&e){var n=r.getComputedStyle(t,null);return e?i?n.getPropertyValue(e)||void 0:n[e]:n}}function K(t,e){return parseInt(q(t,e),10)||0}M.hasClass=function(t){return!!t&&_.call(this,(function(e){return e.classList.contains(t)}))},M.removeAttr=function(t){var e=W(t);return this.each((function(t,r){k(e,(function(t,e){r.removeAttribute(e)}))}))},M.attr=function(t,e){if(t){if(R(t)){if(arguments.length<2){if(!this[0])return;var r=this[0].getAttribute(t);return B(r)?void 0:r}return O(e)?this:B(e)?this.removeAttr(t):this.each((function(r,i){i.setAttribute(t,e)}))}for(var i in t)this.attr(i,t[i]);return this}},M.toggleClass=function(t,e){var r=W(t),i=!O(e);return this.each((function(t,n){k(r,(function(t,r){i?e?n.classList.add(r):n.classList.remove(r):n.classList.toggle(r)}))}))},M.addClass=function(t){return this.toggleClass(t,!0)},M.removeClass=function(t){return arguments.length?this.toggleClass(t,!1):this.attr("class","")},E.unique=z,M.add=function(t,e){return E(z(this.get().concat(E(t,e).get())))};var G=/^--/;function V(t){return G.test(t)}var Y={},X=o.style,J=["webkit","moz","ms"];function Z(t,e){if(void 0===e&&(e=V(t)),e)return t;if(!Y[t]){var r=P(t),i=""+r[0].toUpperCase()+r.slice(1);k((r+" "+J.join(i+" ")+i).split(" "),(function(e,r){if(r in X)return Y[t]=r,!1}))}return Y[t]}E.prefixedProp=Z;var $={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function Q(t,e,r){return void 0===r&&(r=V(t)),r||$[t]||!H(e)?e:e+"px"}function tt(t,e){var r=t.dataset[e]||t.dataset[P(e)];try{return JSON.parse(r)}catch(t){}return r}function et(t,e){return K(t,"border"+(e?"Left":"Top")+"Width")+K(t,"padding"+(e?"Left":"Top"))+K(t,"padding"+(e?"Right":"Bottom"))+K(t,"border"+(e?"Right":"Bottom")+"Width")}M.css=function(t,e){if(R(t)){var r=V(t);return t=Z(t,r),arguments.length<2?this[0]&&q(this[0],t,r):t?(e=Q(t,e,r),this.each((function(i,n){A(n)&&(r?n.style.setProperty(t,e):n.style[t]=e)}))):this}for(var i in t)this.css(i,t[i]);return this},M.data=function(t,e){if(!t){if(!this[0])return;var r={};for(var i in this[0].dataset)r[i]=tt(this[0],i);return r}if(R(t))return arguments.length<2?this[0]&&tt(this[0],t):this.each((function(r,i){!function(t,e,r){try{r=JSON.stringify(r)}catch(t){}t.dataset[P(e)]=r}(i,t,e)}));for(var i in t)this.data(i,t[i]);return this},k([!0,!1],(function(t,e){k(["Width","Height"],(function(t,i){var n=(e?"outer":"inner")+i;M[n]=function(o){if(this[0])return I(this[0])?r[n]:this[0][(e?"offset":"client")+i]+(o&&e?K(this[0],"margin"+(t?"Top":"Left"))+K(this[0],"margin"+(t?"Bottom":"Right")):0)}}))})),k(["width","height"],(function(t,e){M[e]=function(r){if(!this[0])return O(r)?void 0:this;if(!arguments.length)return I(this[0])?this[0][P("outer-"+e)]:this[0].getBoundingClientRect()[e]-et(this[0],!t);var i=parseInt(r,10);return this.each((function(r,n){if(A(n)){var o=q(n,"boxSizing");n.style[e]=Q(e,i+("border-box"===o?et(n,!t):0))}}))}}));var rt={};function it(t){return"none"===q(t,"display")}function nt(t,e){return!e||!_.call(e,(function(e){return t.indexOf(e)<0}))}M.toggle=function(t){return this.each((function(r,i){(O(t)?it(i):t)?(i.style.display=i.___cd||"",it(i)&&(i.style.display=function(t){if(rt[t])return rt[t];var r=n(t);e.body.insertBefore(r,null);var i=q(r,"display");return e.body.removeChild(r),rt[t]="none"!==i?i:"block"}(i.tagName))):(i.___cd=q(i,"display"),i.style.display="none")}))},M.hide=function(){return this.toggle(!1)},M.show=function(){return this.toggle(!0)};var ot="___ce",st=".",at={focus:"focusin",blur:"focusout"},ht={mouseenter:"mouseover",mouseleave:"mouseout"},ct=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function lt(t){return ht[t]||at[t]||t}function ut(t){return t[ot]=t[ot]||{}}function pt(t){var e=t.split(st);return[e[0],e.slice(1).sort()]}function dt(t,e,r,i,n){var o=ut(t);if(e)o[e]&&(o[e]=o[e].filter((function(o){var s=o[0],a=o[1],h=o[2];if(n&&h.guid!==n.guid||!nt(s,r)||i&&i!==a)return!0;t.removeEventListener(e,h)})));else for(e in o)dt(t,e,r,i,n)}function ft(t){return t.multiple&&t.options?U(u.call(t.options,(function(t){return t.selected&&!t.disabled&&!t.parentNode.disabled})),"value"):t.value||""}M.off=function(t,e,r){var i=this;if(O(t))this.each((function(t,e){dt(e)}));else if(R(t))D(e)&&(r=e,e=""),k(W(t),(function(t,n){var o=pt(lt(n)),s=o[0],a=o[1];i.each((function(t,i){dt(i,s,a,e,r)}))}));else for(var n in t)this.off(n,t[n]);return this},M.on=function(t,e,r,i){var n=this;if(!R(t)){for(var o in t)this.on(o,e,t[o]);return this}return D(e)&&(r=e,e=""),k(W(t),(function(t,o){var s=pt(lt(o)),a=s[0],h=s[1];n.each((function(t,n){var o=function t(o){if(!o.namespace||nt(h,o.namespace.split(st))){var s=n;if(e){for(var c=o.target;!T(c,e);){if(c===n)return;if(!(c=c.parentNode))return}s=c,o.___cd=!0}o.___cd&&Object.defineProperty(o,"currentTarget",{configurable:!0,get:function(){return s}});var l=r.call(s,o,o.data);i&&dt(n,a,h,e,t),!1===l&&(o.preventDefault(),o.stopPropagation())}};o.guid=r.guid=r.guid||E.guid++,function(t,e,r,i,n){n.guid=n.guid||E.guid++;var o=ut(t);o[e]=o[e]||[],o[e].push([r,i,n]),t.addEventListener(e,n)}(n,a,h,e,o)}))})),this},M.one=function(t,e,r){return this.on(t,e,r,!0)},M.ready=function(t){return"loading"!==e.readyState?t(E):e.addEventListener("DOMContentLoaded",(function(){t(E)})),this},M.trigger=function(t,r){if(R(t)){var i=pt(t),n=i[0],o=i[1],s=ct.test(n)?"MouseEvents":"HTMLEvents";(t=e.createEvent(s)).initEvent(n,!0,!0),t.namespace=o.join(st)}t.data=r;var a=t.type in at;return this.each((function(e,r){a&&D(r[t.type])?r[t.type]():r.dispatchEvent(t)}))};var gt=/%20/g;var _t=/file|reset|submit|button|image/i,vt=/radio|checkbox/i;M.serialize=function(){var t="";return this.each((function(e,r){k(r.elements||[r],(function(e,r){if(!(r.disabled||!r.name||"FIELDSET"===r.tagName||_t.test(r.type)||vt.test(r.type)&&!r.checked)){var i=ft(r);if(!O(i))k(c(i)?i:[i],(function(e,i){t+=function(t,e){return"&"+encodeURIComponent(t)+"="+encodeURIComponent(e).replace(gt,"+")}(r.name,i)}))}}))})),t.slice(1)},M.val=function(t){return O(t)?this[0]&&ft(this[0]):this.each((function(e,r){if("SELECT"===r.tagName){var i=c(t)?t:B(t)?[]:[t];k(r.options,(function(t,e){e.selected=i.indexOf(e.value)>=0}))}else r.value=B(t)?"":t}))},M.clone=function(){return this.map((function(t,e){return e.cloneNode(!0)}))},M.detach=function(){return this.each((function(t,e){e.parentNode&&e.parentNode.removeChild(e)}))};var yt=/^\s*<(\w+)[^>]*>/,mt=/^\s*<(\w+)\s*\/?>(?:<\/\1>)?\s*$/,bt={"*":o,tr:a,td:h,th:h,thead:s,tbody:s,tfoot:s};function St(t){if(!R(t))return[];if(mt.test(t))return[n(RegExp.$1)];var e=yt.test(t)&&RegExp.$1,r=bt[e]||bt["*"];return r.innerHTML=t,E(r.childNodes).detach().get()}E.parseHTML=St,M.empty=function(){return this.each((function(t,e){for(;e.firstChild;)e.removeChild(e.firstChild)}))},M.html=function(t){return O(t)?this[0]&&this[0].innerHTML:this.each((function(e,r){r.innerHTML=t}))},M.remove=function(){return this.detach().off()},M.text=function(t){return O(t)?this[0]?this[0].textContent:"":this.each((function(e,r){r.textContent=t}))},M.unwrap=function(){return this.parent().each((function(t,e){var r=E(e);r.replaceWith(r.children())})),this},M.offset=function(){var t=this[0];if(t){var e=t.getBoundingClientRect();return{top:e.top+r.pageYOffset-i.clientTop,left:e.left+r.pageXOffset-i.clientLeft}}},M.offsetParent=function(){return E(this[0]&&this[0].offsetParent)},M.position=function(){var t=this[0];if(t)return{left:t.offsetLeft,top:t.offsetTop}},M.children=function(t){return j(E(z(U(this,(function(t){return t.children})))),t)},M.contents=function(){return E(z(U(this,(function(t){return"IFRAME"===t.tagName?[t.contentDocument]:t.childNodes}))))},M.find=function(t){return E(z(U(this,(function(e){return w(t,e)}))))};var wt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ct=/^$|^module$|\/(java|ecma)script/i,Mt=["type","src","nonce","noModule"];function Et(t,e,r,o){o?t.insertBefore(e,r?t.firstElementChild:null):t.parentNode.insertBefore(e,r?t:t.nextElementSibling),function(t,e){var r=E(t);r.filter("script").add(r.find("script")).each((function(t,r){if(Ct.test(r.type)&&i.contains(r)){var o=n("script");o.text=r.textContent.replace(wt,""),k(Mt,(function(t,e){r[e]&&(o[e]=r[e])})),e.head.insertBefore(o,null),e.head.removeChild(o)}}))}(e,t.ownerDocument)}function xt(t,e,r,i,n,o,s,a){return k(t,(function(t,o){k(E(o),(function(t,o){k(E(e),(function(t,e){var s=r?e:o;Et(r?o:e,t?s.cloneNode(!0):s,i,n)}),a)}),s)}),o),e}M.after=function(){return xt(arguments,this,!1,!1,!1,!0,!0)},M.append=function(){return xt(arguments,this,!1,!1,!0)},M.appendTo=function(t){return xt(arguments,this,!0,!1,!0)},M.before=function(){return xt(arguments,this,!1,!0)},M.insertAfter=function(t){return xt(arguments,this,!0,!1,!1,!1,!1,!0)},M.insertBefore=function(t){return xt(arguments,this,!0,!0)},M.prepend=function(){return xt(arguments,this,!1,!0,!0,!0,!0)},M.prependTo=function(t){return xt(arguments,this,!0,!0,!0,!1,!1,!0)},M.replaceWith=function(t){return this.before(t).remove()},M.replaceAll=function(t){return E(t).replaceWith(this),this},M.wrapAll=function(t){for(var e=E(t),r=e[0];r.children.length;)r=r.firstElementChild;return this.first().before(e),this.appendTo(r)},M.wrap=function(t){return this.each((function(e,r){var i=E(t)[0];E(r).wrapAll(e?i.cloneNode(!0):i)}))},M.wrapInner=function(t){return this.each((function(e,r){var i=E(r),n=i.contents();n.length?n.wrapAll(t):i.append(t)}))},M.has=function(t){var e=R(t)?function(e,r){return w(t,r).length}:function(e,r){return r.contains(t)};return this.filter(e)},M.is=function(t){var e=F(t);return _.call(this,(function(t,r){return e.call(t,r,t)}))},M.next=function(t,e){return j(E(z(U(this,"nextElementSibling",e))),t)},M.nextAll=function(t){return this.next(t,!0)},M.not=function(t){var e=F(t);return this.filter((function(t,r){return!e.call(r,t,r)}))},M.parent=function(t){return j(E(z(U(this,"parentNode"))),t)},M.index=function(t){var e=t?E(t)[0]:this[0],r=t?this:E(e).parent().children();return p.call(r,e)},M.closest=function(t){var e=this.filter(t);if(e.length)return e;var r=this.parent();return r.length?r.closest(t):e},M.parents=function(t){return j(E(z(U(this,"parentElement",!0))),t)},M.prev=function(t,e){return j(E(z(U(this,"previousElementSibling",e))),t)},M.prevAll=function(t){return this.prev(t,!0)},M.siblings=function(t){return j(E(z(U(this,(function(t){return E(t).parent().children().not(t)})))),t)},t.exports=E}()},function(t,e,r){"use strict";var i=r(58);t.exports=function(t,e){return function(r,n){return n.type.slice(0,t.length)===t?e(r,i(n,{type:n.type.slice(t.length)})):e(r,{})}}},function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return a}));var i=r(28),n=function(){return Math.random().toString(36).substring(7).split("").join(".")},o={INIT:"@@redux/INIT"+n(),REPLACE:"@@redux/REPLACE"+n(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+n()}};function s(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function a(t,e,r){var n;if("function"==typeof e&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof e&&void 0===r&&(r=e,e=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(a)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var h=t,c=e,l=[],u=l,p=!1;function d(){u===l&&(u=l.slice())}function f(){if(p)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return c}function g(t){if("function"!=typeof t)throw new Error("Expected the listener to be a function.");if(p)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var e=!0;return d(),u.push(t),function(){if(e){if(p)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");e=!1,d();var r=u.indexOf(t);u.splice(r,1)}}}function _(t){if(!s(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(p)throw new Error("Reducers may not dispatch actions.");try{p=!0,c=h(c,t)}finally{p=!1}for(var e=l=u,r=0;r<e.length;r++){(0,e[r])()}return t}return _({type:o.INIT}),(n={dispatch:_,subscribe:g,getState:f,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");h=t,_({type:o.REPLACE})}})[i.a]=function(){var t,e=g;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");function r(){t.next&&t.next(f())}return r(),{unsubscribe:e(r)}}})[i.a]=function(){return this},t},n}function h(t,e){var r=e&&e.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function c(t){for(var e=Object.keys(t),r={},i=0;i<e.length;i++){var n=e[i];0,"function"==typeof t[n]&&(r[n]=t[n])}var s,a=Object.keys(r);try{!function(t){Object.keys(t).forEach((function(e){var r=t[e];if(void 0===r(void 0,{type:o.INIT}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:o.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+o.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(t){s=t}return function(t,e){if(void 0===t&&(t={}),s)throw s;for(var i=!1,n={},o=0;o<a.length;o++){var c=a[o],l=r[c],u=t[c],p=l(u,e);if(void 0===p){var d=h(c,e);throw new Error(d)}n[c]=p,i=i||p!==u}return i?n:t}}},function(t,e,r){"use strict";e.a=function(t){return t.placeholder}},function(t,e,r){"use strict";var i=function(){function t(t){this._m=t}return t.prototype.getFramework=function(){return this._m},t}();e.a=i},function(t,e,r){"use strict";e.a=function(t){return t}},function(t,e,r){"use strict";e.a=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}},function(t,e,r){"use strict";var i=r(12),n=1/0,o=17976931348623157e292;var s=function(t){return t?(t=Object(i.a)(t))===n||t===-n?(t<0?-1:1)*o:t==t?t:0:0===t?t:0};e.a=function(t){var e=s(t),r=e%1;return e==e?r?e-r:e:0}},function(t,e,r){"use strict";var i=r(2),n=r(21),o=r(17),s="[object Symbol]";var a=function(t){return"symbol"==typeof t||Object(o.a)(t)&&Object(n.a)(t)==s},h=NaN,c=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,p=/^0o[0-7]+$/i,d=parseInt;e.a=function(t){if("number"==typeof t)return t;if(a(t))return h;if(Object(i.a)(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Object(i.a)(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(c,"");var r=u.test(t);return r||p.test(t)?d(t.slice(2),r?2:8):l.test(t)?h:+t}},function(t,e,r){"use strict";e.a=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var i="function"!=typeof e[0]&&e.shift(),n=e;if(void 0===i)throw new TypeError("The initial state may not be undefined. If you do not want to set a value for this reducer, you can use null instead of undefined.");return function(t,e){for(var r=arguments.length,o=Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];var a=void 0===t,h=void 0===e;return a&&h&&i?i:n.reduce((function(t,r,i){if(void 0===r)throw new TypeError("An undefined reducer was passed in at index "+i);return r.apply(void 0,[t,e].concat(o))}),a&&!h&&i?i:t)}}},,function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var i=800,n=16,o=Date.now;e.a=function(t){var e=0,r=0;return function(){var s=o(),a=n-(s-r);if(r=s,a>0){if(++e>=i)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,r){"use strict";e.a=function(t){return null!=t&&"object"==typeof t}},function(t,e,r){"use strict";function i(){return new Array(10).map((function(t){return String.fromCharCode(128*Math.random()+20)})).reduce((function(t,e){return t?t+e:e}))}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";var i=r(9),n=r(20),o=r(1),s=Object(n.a)(o.a,"WeakMap"),a=s&&new s,h=a?function(t,e){return a.set(t,e),t}:i.a,c=r(2),l=Object.create,u=function(){function t(){}return function(e){if(!Object(c.a)(e))return{};if(l)return l(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();var p=function(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var r=u(t.prototype),i=t.apply(r,e);return Object(c.a)(i)?i:r}},d=1;var f=function(t,e,r){var i=e&d,n=p(t);return function e(){return(this&&this!==o.a&&this instanceof e?n:t).apply(i?r:this,arguments)}},g=r(10),_=Math.max;var v=function(t,e,r,i){for(var n=-1,o=t.length,s=r.length,a=-1,h=e.length,c=_(o-s,0),l=Array(h+c),u=!i;++a<h;)l[a]=e[a];for(;++n<s;)(u||n<o)&&(l[r[n]]=t[n]);for(;c--;)l[a++]=t[n++];return l},y=Math.max;var m=function(t,e,r,i){for(var n=-1,o=t.length,s=-1,a=r.length,h=-1,c=e.length,l=y(o-a,0),u=Array(l+c),p=!i;++n<l;)u[n]=t[n];for(var d=n;++h<c;)u[d+h]=e[h];for(;++s<a;)(p||n<o)&&(u[d+r[s]]=t[n++]);return u};var b=function(t,e){for(var r=t.length,i=0;r--;)t[r]===e&&++i;return i};var S=function(){},w=4294967295;function C(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=w,this.__views__=[]}C.prototype=u(S.prototype),C.prototype.constructor=C;var M=C;var E=a?function(t){return a.get(t)}:function(){},x={},P=Object.prototype.hasOwnProperty;var k=function(t){for(var e=t.name+"",r=x[e],i=P.call(x,e)?r.length:0;i--;){var n=r[i],o=n.func;if(null==o||o==t)return n.name}return e};function T(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}T.prototype=u(S.prototype),T.prototype.constructor=T;var L=T,I=Array.isArray,A=r(17);var D=function(t,e){var r=-1,i=t.length;for(e||(e=Array(i));++r<i;)e[r]=t[r];return e};var R=function(t){if(t instanceof M)return t.clone();var e=new L(t.__wrapped__,t.__chain__);return e.__actions__=D(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e},O=Object.prototype.hasOwnProperty;function B(t){if(Object(A.a)(t)&&!I(t)&&!(t instanceof M)){if(t instanceof L)return t;if(O.call(t,"__wrapped__"))return R(t)}return new L(t)}B.prototype=S.prototype,B.prototype.constructor=B;var H=B;var F=function(t){var e=k(t),r=H[e];if("function"!=typeof r||!(e in M.prototype))return!1;if(t===r)return!0;var i=E(r);return!!i&&t===i[0]},j=r(16),N=Object(j.a)(h),W=/\{\n\/\* \[wrapped with (.+)\] \*/,U=/,? & /;var z=function(t){var e=t.match(W);return e?e[1].split(U):[]},q=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;var K=function(t,e){var r=e.length;if(!r)return t;var i=r-1;return e[i]=(r>1?"& ":"")+e[i],e=e.join(r>2?", ":" "),t.replace(q,"{\n/* [wrapped with "+e+"] */\n")},G=r(22);var V=function(t,e){for(var r=-1,i=null==t?0:t.length;++r<i&&!1!==e(t[r],r,t););return t};var Y=function(t,e,r,i){for(var n=t.length,o=r+(i?1:-1);i?o--:++o<n;)if(e(t[o],o,t))return o;return-1};var X=function(t){return t!=t};var J=function(t,e,r){for(var i=r-1,n=t.length;++i<n;)if(t[i]===e)return i;return-1};var Z=function(t,e,r){return e==e?J(t,e,r):Y(t,X,r)};var $=function(t,e){return!!(null==t?0:t.length)&&Z(t,e,0)>-1},Q=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]];var tt=function(t,e){return V(Q,(function(r){var i="_."+r[0];e&r[1]&&!$(t,i)&&t.push(i)})),t.sort()};var et=function(t,e,r){var i=e+"";return Object(G.a)(t,K(i,tt(z(i),r)))},rt=1,it=2,nt=4,ot=8,st=32,at=64;var ht=function(t,e,r,i,n,o,s,a,h,c){var l=e&ot;e|=l?st:at,(e&=~(l?at:st))&nt||(e&=~(rt|it));var u=[t,e,n,l?o:void 0,l?s:void 0,l?void 0:o,l?void 0:s,a,h,c],p=r.apply(void 0,u);return F(t)&&N(p,u),p.placeholder=i,et(p,t,e)},ct=r(7),lt=9007199254740991,ut=/^(?:0|[1-9]\d*)$/;var pt=function(t,e){var r=typeof t;return!!(e=null==e?lt:e)&&("number"==r||"symbol"!=r&&ut.test(t))&&t>-1&&t%1==0&&t<e},dt=Math.min;var ft=function(t,e){for(var r=t.length,i=dt(e.length,r),n=D(t);i--;){var o=e[i];t[i]=pt(o,r)?n[o]:void 0}return t},gt=r(3),_t=1,vt=2,yt=8,mt=16,bt=128,St=512;var wt=function t(e,r,i,n,s,a,h,c,l,u){var d=r&bt,f=r&_t,g=r&vt,_=r&(yt|mt),y=r&St,S=g?void 0:p(e);return function w(){for(var C=arguments.length,M=Array(C),E=C;E--;)M[E]=arguments[E];if(_)var x=Object(ct.a)(w),P=b(M,x);if(n&&(M=v(M,n,s,_)),a&&(M=m(M,a,h,_)),C-=P,_&&C<u){var k=Object(gt.a)(M,x);return ht(e,r,t,w.placeholder,i,M,k,c,l,u-C)}var T=f?i:this,L=g?T[e]:e;return C=M.length,c?M=ft(M,c):y&&C>1&&M.reverse(),d&&l<C&&(M.length=l),this&&this!==o.a&&this instanceof w&&(L=S||p(L)),L.apply(T,M)}};var Ct=function(t,e,r){var i=p(t);return function n(){for(var s=arguments.length,a=Array(s),h=s,c=Object(ct.a)(n);h--;)a[h]=arguments[h];var l=s<3&&a[0]!==c&&a[s-1]!==c?[]:Object(gt.a)(a,c);if((s-=l.length)<r)return ht(t,e,wt,n.placeholder,void 0,a,l,void 0,void 0,r-s);var u=this&&this!==o.a&&this instanceof n?i:t;return Object(g.a)(u,this,a)}},Mt=1;var Et=function(t,e,r,i){var n=e&Mt,s=p(t);return function e(){for(var a=-1,h=arguments.length,c=-1,l=i.length,u=Array(l+h),p=this&&this!==o.a&&this instanceof e?s:t;++c<l;)u[c]=i[c];for(;h--;)u[c++]=arguments[++a];return Object(g.a)(p,n?r:this,u)}},xt="__lodash_placeholder__",Pt=1,kt=2,Tt=4,Lt=8,It=128,At=256,Dt=Math.min;var Rt=function(t,e){var r=t[1],i=e[1],n=r|i,o=n<(Pt|kt|It),s=i==It&&r==Lt||i==It&&r==At&&t[7].length<=e[8]||i==(It|At)&&e[7].length<=e[8]&&r==Lt;if(!o&&!s)return t;i&Pt&&(t[2]=e[2],n|=r&Pt?0:Tt);var a=e[3];if(a){var h=t[3];t[3]=h?v(h,a,e[4]):a,t[4]=h?Object(gt.a)(t[3],xt):e[4]}return(a=e[5])&&(h=t[5],t[5]=h?m(h,a,e[6]):a,t[6]=h?Object(gt.a)(t[5],xt):e[6]),(a=e[7])&&(t[7]=a),i&It&&(t[8]=null==t[8]?e[8]:Dt(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=n,t},Ot=r(11),Bt="Expected a function",Ht=1,Ft=2,jt=8,Nt=16,Wt=32,Ut=64,zt=Math.max;e.a=function(t,e,r,i,n,o,s,a){var c=e&Ft;if(!c&&"function"!=typeof t)throw new TypeError(Bt);var l=i?i.length:0;if(l||(e&=~(Wt|Ut),i=n=void 0),s=void 0===s?s:zt(Object(Ot.a)(s),0),a=void 0===a?a:Object(Ot.a)(a),l-=n?n.length:0,e&Ut){var u=i,p=n;i=n=void 0}var d=c?void 0:E(t),g=[t,e,r,i,n,u,p,o,s,a];if(d&&Rt(g,d),t=g[0],e=g[1],r=g[2],i=g[3],n=g[4],!(a=g[9]=void 0===g[9]?c?0:t.length:zt(g[9]-l,0))&&e&(jt|Nt)&&(e&=~(jt|Nt)),e&&e!=Ht)_=e==jt||e==Nt?Ct(t,e,a):e!=Wt&&e!=(Ht|Wt)||n.length?wt.apply(void 0,g):Et(t,e,r,i);else var _=f(t,e,r);return et((d?h:N)(_,g),t,e)}},function(t,e,r){"use strict";var i=r(21),n=r(2),o="[object AsyncFunction]",s="[object Function]",a="[object GeneratorFunction]",h="[object Proxy]";var c,l=function(t){if(!Object(n.a)(t))return!1;var e=Object(i.a)(t);return e==s||e==a||e==o||e==h},u=r(1).a["__core-js_shared__"],p=(c=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+c:"";var d=function(t){return!!p&&p in t},f=Function.prototype.toString;var g=function(t){if(null!=t){try{return f.call(t)}catch(t){}try{return t+""}catch(t){}}return""},_=/^\[object .+?Constructor\]$/,v=Function.prototype,y=Object.prototype,m=v.toString,b=y.hasOwnProperty,S=RegExp("^"+m.call(b).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var w=function(t){return!(!Object(n.a)(t)||d(t))&&(l(t)?S:_).test(g(t))};var C=function(t,e){return null==t?void 0:t[e]};e.a=function(t,e){var r=C(t,e);return w(r)?r:void 0}},function(t,e,r){"use strict";var i=r(1).a.Symbol,n=Object.prototype,o=n.hasOwnProperty,s=n.toString,a=i?i.toStringTag:void 0;var h=function(t){var e=o.call(t,a),r=t[a];try{t[a]=void 0;var i=!0}catch(t){}var n=s.call(t);return i&&(e?t[a]=r:delete t[a]),n},c=Object.prototype.toString;var l=function(t){return c.call(t)},u="[object Null]",p="[object Undefined]",d=i?i.toStringTag:void 0;e.a=function(t){return null==t?void 0===t?p:u:d&&d in Object(t)?h(t):l(t)}},function(t,e,r){"use strict";var i=function(t){return function(){return t}},n=r(20),o=function(){try{var t=Object(n.a)(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),s=r(9),a=o?function(t,e){return o(t,"toString",{configurable:!0,enumerable:!1,value:i(e),writable:!0})}:s.a,h=r(16),c=Object(h.a)(a);e.a=c},function(t,e,r){"use strict";var i=r(9),n=r(10),o=Math.max;var s=function(t,e,r){return e=o(void 0===e?t.length-1:e,0),function(){for(var i=arguments,s=-1,a=o(i.length-e,0),h=Array(a);++s<a;)h[s]=i[e+s];s=-1;for(var c=Array(e+1);++s<e;)c[s]=i[s];return c[e]=r(h),Object(n.a)(t,this,c)}},a=r(22);e.a=function(t,e){return Object(a.a)(s(t,e,i.a),t+"")}},function(t,e,r){var i;!function(r){"use strict";function n(){if(n.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(n.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._nrpnBuffer=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]],this._nrpnEventsEnabled=!0,this._nrpnTypes=["entry","increment","decrement"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,nrpn:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_NRPN_MESSAGES:{value:{entrymsb:6,entrylsb:38,increment:96,decrement:97,paramlsb:98,parammsb:99,nullactiveparameter:127},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},nrpnEventsEnabled:{enumerable:!0,get:function(){return!!this._nrpnEventsEnabled}.bind(this),set:function(t){return this._nrpnEventsEnabled=t,this._nrpnEventsEnabled}},nrpnTypes:{enumerable:!0,get:function(){return this._nrpnTypes}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}var o=new n;function s(t){var e=this;this._userHandlers={channel:{},system:{}},this._midiInput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return e._midiInput.connection}},id:{enumerable:!0,get:function(){return e._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return e._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return e._midiInput.name}},state:{enumerable:!0,get:function(){return e._midiInput.state}},type:{enumerable:!0,get:function(){return e._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function a(t){var e=this;this._midiOutput=t,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return e._midiOutput.connection}},id:{enumerable:!0,get:function(){return e._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return e._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return e._midiOutput.name}},state:{enumerable:!0,get:function(){return e._midiOutput.state}},type:{enumerable:!0,get:function(){return e._midiOutput.type}}})}n.prototype.enable=function(t,e){this.enabled||(this.supported?navigator.requestMIDIAccess({sysex:e}).then(function(e){var r,i=[],n=[];this.interface=e,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(t){i.push(t)};for(var o=e.inputs.values(),s=o.next();s&&!s.done;s=o.next())n.push(s.value.open());for(var a=e.outputs.values(),h=a.next();h&&!h.done;h=a.next())n.push(h.value.open());function c(){clearTimeout(r),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof t&&t.call(this),i.forEach(function(t){this._onInterfaceStateChange(t)}.bind(this))}r=setTimeout(c.bind(this),200),Promise&&Promise.all(n).catch((function(t){})).then(c.bind(this))}.bind(this),function(e){"function"==typeof t&&t.call(this,e)}.bind(this)):"function"==typeof t&&t(new Error("The Web MIDI API is not supported by your browser.")))},n.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._nrpnEventsEnabled=!0,this._resetInterfaceUserHandlers()},n.prototype.addListener=function(t,e){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof e)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[t].push(e),this},n.prototype.hasListener=function(t,e){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof e)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(t)))throw new TypeError("The specified event type is not supported.");for(var r=0;r<this._userHandlers[t].length;r++)if(this._userHandlers[t][r]===e)return!0;return!1},n.prototype.removeListener=function(t,e){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==e&&"function"!=typeof e)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(t))if(e)for(var r=0;r<this._userHandlers[t].length;r++)this._userHandlers[t][r]===e&&this._userHandlers[t].splice(r,1);else this._userHandlers[t]=[];else{if(void 0!==t)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},n.prototype.toMIDIChannels=function(t){var e;if("all"===t||void 0===t)e=["all"];else{if("none"===t)return[];e=Array.isArray(t)?t:[t]}return-1<e.indexOf("all")&&(e=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),e.map((function(t){return parseInt(t)})).filter((function(t){return 1<=t&&t<=16}))},n.prototype.getInputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].id===t)return this.inputs[e];return!1},n.prototype.getOutputById=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");t=String(t);for(var e=0;e<this.outputs.length;e++)if(this.outputs[e].id===t)return this.outputs[e];return!1},n.prototype.getInputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var e=0;e<this.inputs.length;e++)if(~this.inputs[e].name.indexOf(t))return this.inputs[e];return!1},n.prototype.getOctave=function(t){if(null!=t&&0<=t&&t<=127)return Math.floor(Math.floor(t)/12-1)+Math.floor(o.octaveOffset)},n.prototype.getOutputByName=function(t){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var e=0;e<this.outputs.length;e++)if(~this.outputs[e].name.indexOf(t))return this.outputs[e];return!1},n.prototype.guessNoteNumber=function(t){var e=!1;if(t&&t.toFixed&&0<=t&&t<=127?e=Math.round(t):0<=parseInt(t)&&parseInt(t)<=127?e=parseInt(t):("string"==typeof t||t instanceof String)&&(e=this.noteNameToNumber(t)),!1===e)throw new Error("Invalid input value ("+t+").");return e},n.prototype.noteNameToNumber=function(t){"string"!=typeof t&&(t="");var e=t.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!e)throw new RangeError("Invalid note name.");var r=o._semitones[e[1].toUpperCase()],i=12*(parseInt(e[3])+1-Math.floor(o.octaveOffset))+r;if(-1<e[2].toLowerCase().indexOf("b")?i-=e[2].length:-1<e[2].toLowerCase().indexOf("#")&&(i+=e[2].length),i<0||127<i)throw new RangeError("Invalid note name or note outside valid range.");return i},n.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},n.prototype._updateInputs=function(){for(var t=0;t<this._inputs.length;t++){for(var e=!0,r=this.interface.inputs.values(),i=r.next();i&&!i.done;i=r.next())if(this._inputs[t]._midiInput===i.value){e=!1;break}e&&this._inputs.splice(t,1)}this.interface&&this.interface.inputs.forEach(function(t){for(var e=!0,r=0;r<this._inputs.length;r++)this._inputs[r]._midiInput===t&&(e=!1);e&&this._inputs.push(new s(t))}.bind(this))},n.prototype._updateOutputs=function(){for(var t=0;t<this._outputs.length;t++){for(var e=!0,r=this.interface.outputs.values(),i=r.next();i&&!i.done;i=r.next())if(this._outputs[t]._midiOutput===i.value){e=!1;break}e&&this._outputs.splice(t,1)}this.interface&&this.interface.outputs.forEach(function(t){for(var e=!0,r=0;r<this._outputs.length;r++)this._outputs[r]._midiOutput===t&&(e=!1);e&&this._outputs.push(new a(t))}.bind(this))},n.prototype._onInterfaceStateChange=function(t){this._updateInputsAndOutputs();var e={timestamp:t.timeStamp,type:t.port.state};this.interface&&"connected"===t.port.state?"output"===t.port.type?e.port=this.getOutputById(t.port.id):"input"===t.port.type&&(e.port=this.getInputById(t.port.id)):e.port={connection:"closed",id:t.port.id,manufacturer:t.port.manufacturer,name:t.port.name,state:t.port.state,type:t.port.type},this._userHandlers[t.port.state].forEach((function(t){t(e)}))},n.prototype._resetInterfaceUserHandlers=function(){for(var t=0;t<this._midiInterfaceEvents.length;t++)this._userHandlers[this._midiInterfaceEvents[t]]=[]},s.prototype.on=s.prototype.addListener=function(t,e,r){var i=this;if(void 0===e&&(e="all"),Array.isArray(e)||(e=[e]),e.forEach((function(t){if("all"!==t&&!(1<=t&&t<=16))throw new RangeError("The 'channel' parameter is invalid.")})),"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==o.MIDI_SYSTEM_MESSAGES[t])this._userHandlers.system[t]||(this._userHandlers.system[t]=[]),this._userHandlers.system[t].push(r);else{if(void 0===o.MIDI_CHANNEL_MESSAGES[t])throw new TypeError("The specified event type is not supported.");if(-1<e.indexOf("all")){e=[];for(var n=1;n<=16;n++)e.push(n)}this._userHandlers.channel[t]||(this._userHandlers.channel[t]=[]),e.forEach((function(e){i._userHandlers.channel[t][e]||(i._userHandlers.channel[t][e]=[]),i._userHandlers.channel[t][e].push(r)}))}return this},s.prototype.hasListener=function(t,e,r){var i=this;if("function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===e&&(e="all"),e.constructor!==Array&&(e=[e]),void 0!==o.MIDI_SYSTEM_MESSAGES[t]){for(var n=0;n<this._userHandlers.system[t].length;n++)if(this._userHandlers.system[t][n]===r)return!0}else if(void 0!==o.MIDI_CHANNEL_MESSAGES[t]){if(-1<e.indexOf("all")){e=[];for(var s=1;s<=16;s++)e.push(s)}return!!this._userHandlers.channel[t]&&e.every((function(e){var n=i._userHandlers.channel[t][e];return n&&-1<n.indexOf(r)}))}return!1},s.prototype.removeListener=function(t,e,r){var i=this;if(void 0!==r&&"function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===e&&(e="all"),e.constructor!==Array&&(e=[e]),void 0!==o.MIDI_SYSTEM_MESSAGES[t])if(void 0===r)this._userHandlers.system[t]=[];else for(var n=0;n<this._userHandlers.system[t].length;n++)this._userHandlers.system[t][n]===r&&this._userHandlers.system[t].splice(n,1);else if(void 0!==o.MIDI_CHANNEL_MESSAGES[t]){if(-1<e.indexOf("all")){e=[];for(var s=1;s<=16;s++)e.push(s)}if(!this._userHandlers.channel[t])return this;e.forEach((function(e){var n=i._userHandlers.channel[t][e];if(n)if(void 0===r)i._userHandlers.channel[t][e]=[];else for(var o=0;o<n.length;o++)n[o]===r&&n.splice(o,1)}))}else{if(void 0!==t)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},s.prototype._initializeUserHandlers=function(){for(var t in o.MIDI_CHANNEL_MESSAGES)o.MIDI_CHANNEL_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.channel[t]={});for(var e in o.MIDI_SYSTEM_MESSAGES)o.MIDI_SYSTEM_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.system[e]=[])},s.prototype._onMidiMessage=function(t){if(0<this._userHandlers.system.midimessage.length){var e={target:this,data:t.data,timestamp:t.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach((function(t){t(e)}))}t.data[0]<240?(this._parseChannelEvent(t),this._parseNrpnEvent(t)):t.data[0]<=255&&this._parseSystemEvent(t)},s.prototype._parseNrpnEvent=function(t){var e,r,i=t.data[0]>>4,n=15&t.data[0],s=1+n;if(1<t.data.length&&(e=t.data[1],r=2<t.data.length?t.data[2]:void 0),o.nrpnEventsEnabled&&i===o.MIDI_CHANNEL_MESSAGES.controlchange&&(e>=o.MIDI_NRPN_MESSAGES.increment&&e<=o.MIDI_NRPN_MESSAGES.parammsb||e===o.MIDI_NRPN_MESSAGES.entrymsb||e===o.MIDI_NRPN_MESSAGES.entrylsb)){var a={target:this,type:"controlchange",data:t.data,timestamp:t.timeStamp,channel:s,controller:{number:e,name:this.getCcNameByNumber(e)},value:r};if(a.controller.number===o.MIDI_NRPN_MESSAGES.parammsb&&a.value!=o.MIDI_NRPN_MESSAGES.nullactiveparameter)o._nrpnBuffer[n]=[],o._nrpnBuffer[n][0]=a;else if(1===o._nrpnBuffer[n].length&&a.controller.number===o.MIDI_NRPN_MESSAGES.paramlsb)o._nrpnBuffer[n].push(a);else if(2!==o._nrpnBuffer[n].length||a.controller.number!==o.MIDI_NRPN_MESSAGES.increment&&a.controller.number!==o.MIDI_NRPN_MESSAGES.decrement&&a.controller.number!==o.MIDI_NRPN_MESSAGES.entrymsb)if(3===o._nrpnBuffer[n].length&&o._nrpnBuffer[n][2].number===o.MIDI_NRPN_MESSAGES.entrymsb&&a.controller.number===o.MIDI_NRPN_MESSAGES.entrylsb)o._nrpnBuffer[n].push(a);else if(3<=o._nrpnBuffer[n].length&&o._nrpnBuffer[n].length<=4&&a.controller.number===o.MIDI_NRPN_MESSAGES.parammsb&&a.value===o.MIDI_NRPN_MESSAGES.nullactiveparameter)o._nrpnBuffer[n].push(a);else if(4<=o._nrpnBuffer[n].length&&o._nrpnBuffer[n].length<=5&&a.controller.number===o.MIDI_NRPN_MESSAGES.paramlsb&&a.value===o.MIDI_NRPN_MESSAGES.nullactiveparameter){o._nrpnBuffer[n].push(a);var h=[];o._nrpnBuffer[n].forEach((function(t){h.push(t.data)}));var c=o._nrpnBuffer[n][0].value<<7|o._nrpnBuffer[n][1].value,l=o._nrpnBuffer[n][2].value;6===o._nrpnBuffer[n].length&&(l=o._nrpnBuffer[n][2].value<<7|o._nrpnBuffer[n][3].value);var u="";switch(o._nrpnBuffer[n][2].controller.number){case o.MIDI_NRPN_MESSAGES.entrymsb:u=o._nrpnTypes[0];break;case o.MIDI_NRPN_MESSAGES.increment:u=o._nrpnTypes[1];break;case o.MIDI_NRPN_MESSAGES.decrement:u=o._nrpnTypes[2];break;default:throw new Error("The NPRN type was unidentifiable.")}var p={timestamp:a.timestamp,channel:a.channel,type:"nrpn",data:h,controller:{number:c,type:u,name:"Non-Registered Parameter "+c},value:l};o._nrpnBuffer[n]=[],this._userHandlers.channel[p.type]&&this._userHandlers.channel[p.type][p.channel]&&this._userHandlers.channel[p.type][p.channel].forEach((function(t){t(p)}))}else o._nrpnBuffer[n]=[];else o._nrpnBuffer[n].push(a)}},s.prototype._parseChannelEvent=function(t){var e,r,i=t.data[0]>>4,n=1+(15&t.data[0]);1<t.data.length&&(e=t.data[1],r=2<t.data.length?t.data[2]:void 0);var s={target:this,data:t.data,timestamp:t.timeStamp,channel:n};i===o.MIDI_CHANNEL_MESSAGES.noteoff||i===o.MIDI_CHANNEL_MESSAGES.noteon&&0===r?(s.type="noteoff",s.note={number:e,name:o._notes[e%12],octave:o.getOctave(e)},s.velocity=r/127,s.rawVelocity=r):i===o.MIDI_CHANNEL_MESSAGES.noteon?(s.type="noteon",s.note={number:e,name:o._notes[e%12],octave:o.getOctave(e)},s.velocity=r/127,s.rawVelocity=r):i===o.MIDI_CHANNEL_MESSAGES.keyaftertouch?(s.type="keyaftertouch",s.note={number:e,name:o._notes[e%12],octave:o.getOctave(e)},s.value=r/127):i===o.MIDI_CHANNEL_MESSAGES.controlchange&&0<=e&&e<=119?(s.type="controlchange",s.controller={number:e,name:this.getCcNameByNumber(e)},s.value=r):i===o.MIDI_CHANNEL_MESSAGES.channelmode&&120<=e&&e<=127?(s.type="channelmode",s.controller={number:e,name:this.getChannelModeByNumber(e)},s.value=r):i===o.MIDI_CHANNEL_MESSAGES.programchange?(s.type="programchange",s.value=e):i===o.MIDI_CHANNEL_MESSAGES.channelaftertouch?(s.type="channelaftertouch",s.value=e/127):i===o.MIDI_CHANNEL_MESSAGES.pitchbend?(s.type="pitchbend",s.value=((r<<7)+e-8192)/8192):s.type="unknownchannelmessage",this._userHandlers.channel[s.type]&&this._userHandlers.channel[s.type][n]&&this._userHandlers.channel[s.type][n].forEach((function(t){t(s)}))},s.prototype.getCcNameByNumber=function(t){if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var e in o.MIDI_CONTROL_CHANGE_MESSAGES)if(o.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(e)&&t===o.MIDI_CONTROL_CHANGE_MESSAGES[e])return e},s.prototype.getChannelModeByNumber=function(t){if(!(120<=(t=Math.floor(t))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var e in o.MIDI_CHANNEL_MODE_MESSAGES)if(o.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(e)&&t===o.MIDI_CHANNEL_MODE_MESSAGES[e])return e},s.prototype._parseSystemEvent=function(t){var e=t.data[0],r={target:this,data:t.data,timestamp:t.timeStamp};e===o.MIDI_SYSTEM_MESSAGES.sysex?r.type="sysex":e===o.MIDI_SYSTEM_MESSAGES.timecode?r.type="timecode":e===o.MIDI_SYSTEM_MESSAGES.songposition?r.type="songposition":e===o.MIDI_SYSTEM_MESSAGES.songselect?(r.type="songselect",r.song=t.data[1]):e===o.MIDI_SYSTEM_MESSAGES.tuningrequest?r.type="tuningrequest":e===o.MIDI_SYSTEM_MESSAGES.clock?r.type="clock":e===o.MIDI_SYSTEM_MESSAGES.start?r.type="start":e===o.MIDI_SYSTEM_MESSAGES.continue?r.type="continue":e===o.MIDI_SYSTEM_MESSAGES.stop?r.type="stop":e===o.MIDI_SYSTEM_MESSAGES.activesensing?r.type="activesensing":e===o.MIDI_SYSTEM_MESSAGES.reset?r.type="reset":r.type="unknownsystemmessage",this._userHandlers.system[r.type]&&this._userHandlers.system[r.type].forEach((function(t){t(r)}))},a.prototype.send=function(t,e,r){if(!(128<=t&&t<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===e&&(e=[]),Array.isArray(e)||(e=[e]);var i=[];return e.forEach((function(t){var e=Math.floor(t);if(!(0<=e&&e<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");i.push(e)})),this._midiOutput.send([t].concat(i),parseFloat(r)||0),this},a.prototype.sendSysex=function(t,e,r){if(!o.sysexEnabled)throw new Error("Sysex message support must first be activated.");return r=r||{},t=[].concat(t),e.forEach((function(t){if(t<0||127<t)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")})),e=t.concat(e,o.MIDI_SYSTEM_MESSAGES.sysexend),this.send(o.MIDI_SYSTEM_MESSAGES.sysex,e,this._parseTimeParameter(r.time)),this},a.prototype.sendTimecodeQuarterFrame=function(t,e){return e=e||{},this.send(o.MIDI_SYSTEM_MESSAGES.timecode,t,this._parseTimeParameter(e.time)),this},a.prototype.sendSongPosition=function(t,e){e=e||{};var r=(t=Math.floor(t)||0)>>7&127,i=127&t;return this.send(o.MIDI_SYSTEM_MESSAGES.songposition,[r,i],this._parseTimeParameter(e.time)),this},a.prototype.sendSongSelect=function(t,e){if(e=e||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(o.MIDI_SYSTEM_MESSAGES.songselect,[t],this._parseTimeParameter(e.time)),this},a.prototype.sendTuningRequest=function(t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(t.time)),this},a.prototype.sendClock=function(t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(t.time)),this},a.prototype.sendStart=function(t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(t.time)),this},a.prototype.sendContinue=function(t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(t.time)),this},a.prototype.sendStop=function(t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(t.time)),this},a.prototype.sendActiveSensing=function(t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(t.time)),this},a.prototype.sendReset=function(t){return t=t||{},this.send(o.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(t.time)),this},a.prototype.stopNote=function(t,e,r){if("all"===t)return this.sendChannelMode("allnotesoff",0,e,r);var i=64;return(r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(i=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(i=127*r.velocity),this._convertNoteToArray(t).forEach(function(t){o.toMIDIChannels(e).forEach(function(e){this.send((o.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(e-1),[t,Math.round(i)],this._parseTimeParameter(r.time))}.bind(this))}.bind(this)),this},a.prototype.playNote=function(t,e,r){var i,n=64;if((r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(n=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(n=127*r.velocity),i=this._parseTimeParameter(r.time),this._convertNoteToArray(t).forEach(function(t){o.toMIDIChannels(e).forEach(function(e){this.send((o.MIDI_CHANNEL_MESSAGES.noteon<<4)+(e-1),[t,Math.round(n)],i)}.bind(this))}.bind(this)),!isNaN(r.duration)){r.duration<=0&&(r.duration=0);var s=64;r.rawVelocity?!isNaN(r.release)&&0<=r.release&&r.release<=127&&(s=r.release):!isNaN(r.release)&&0<=r.release&&r.release<=1&&(s=127*r.release),this._convertNoteToArray(t).forEach(function(t){o.toMIDIChannels(e).forEach(function(e){this.send((o.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(e-1),[t,Math.round(s)],(i||o.time)+r.duration)}.bind(this))}.bind(this))}return this},a.prototype.sendKeyAftertouch=function(t,e,r,i){var n=this;if(i=i||{},e<1||16<e)throw new RangeError("The channel must be between 1 and 16.");(isNaN(r)||r<0||1<r)&&(r=.5);var s=Math.round(127*r);return this._convertNoteToArray(t).forEach((function(t){o.toMIDIChannels(e).forEach((function(e){n.send((o.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(e-1),[t,s],n._parseTimeParameter(i.time))}))})),this},a.prototype.sendControlChange=function(t,e,r,i){if(i=i||{},"string"==typeof t){if(void 0===(t=o.MIDI_CONTROL_CHANGE_MESSAGES[t]))throw new TypeError("Invalid controller name.")}else if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("Controller value must be between 0 and 127.");return o.toMIDIChannels(r).forEach(function(r){this.send((o.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(r-1),[t,e],this._parseTimeParameter(i.time))}.bind(this)),this},a.prototype._selectRegisteredParameter=function(t,e,r){var i=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return o.toMIDIChannels(e).forEach((function(){i.sendControlChange(101,t[0],e,{time:r}),i.sendControlChange(100,t[1],e,{time:r})})),this},a.prototype._selectNonRegisteredParameter=function(t,e,r){var i=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return o.toMIDIChannels(e).forEach((function(){i.sendControlChange(99,t[0],e,{time:r}),i.sendControlChange(98,t[1],e,{time:r})})),this},a.prototype._setCurrentRegisteredParameter=function(t,e,r){var i=this;if((t=[].concat(t))[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return o.toMIDIChannels(e).forEach((function(){i.sendControlChange(6,t[0],e,{time:r})})),t[1]=Math.floor(t[1]),0<=t[1]&&t[1]<=127&&o.toMIDIChannels(e).forEach((function(){i.sendControlChange(38,t[1],e,{time:r})})),this},a.prototype._deselectRegisteredParameter=function(t,e){var r=this;return o.toMIDIChannels(t).forEach((function(){r.sendControlChange(101,127,t,{time:e}),r.sendControlChange(100,127,t,{time:e})})),this},a.prototype.setRegisteredParameter=function(t,e,r,i){var n=this;if(i=i||{},!Array.isArray(t)){if(!o.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=o.MIDI_REGISTERED_PARAMETER[t]}return o.toMIDIChannels(r).forEach((function(){n._selectRegisteredParameter(t,r,i.time),n._setCurrentRegisteredParameter(e,r,i.time),n._deselectRegisteredParameter(r,i.time)})),this},a.prototype.setNonRegisteredParameter=function(t,e,r,i){var n=this;if(i=i||{},!(0<=t[0]&&t[0]<=127&&0<=t[1]&&t[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return e=[].concat(e),o.toMIDIChannels(r).forEach((function(){n._selectNonRegisteredParameter(t,r,i.time),n._setCurrentRegisteredParameter(e,r,i.time),n._deselectRegisteredParameter(r,i.time)})),this},a.prototype.incrementRegisteredParameter=function(t,e,r){var i=this;if(r=r||{},!Array.isArray(t)){if(!o.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=o.MIDI_REGISTERED_PARAMETER[t]}return o.toMIDIChannels(e).forEach((function(){i._selectRegisteredParameter(t,e,r.time),i.sendControlChange(96,0,e,{time:r.time}),i._deselectRegisteredParameter(e,r.time)})),this},a.prototype.decrementRegisteredParameter=function(t,e,r){if(r=r||{},!Array.isArray(t)){if(!o.MIDI_REGISTERED_PARAMETER[t])throw new TypeError("The specified parameter is not available.");t=o.MIDI_REGISTERED_PARAMETER[t]}return o.toMIDIChannels(e).forEach(function(){this._selectRegisteredParameter(t,e,r.time),this.sendControlChange(97,0,e,{time:r.time}),this._deselectRegisteredParameter(e,r.time)}.bind(this)),this},a.prototype.setPitchBendRange=function(t,e,r,i){var n=this;if(i=i||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The cents value must be between 0 and 127");return o.toMIDIChannels(r).forEach((function(){n.setRegisteredParameter("pitchbendrange",[t,e],r,{time:i.time})})),this},a.prototype.setModulationRange=function(t,e,r,i){var n=this;if(i=i||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(e=Math.floor(e)||0)&&e<=127))throw new RangeError("The cents value must be between 0 and 127");return o.toMIDIChannels(r).forEach((function(){n.setRegisteredParameter("modulationrange",[t,e],r,{time:i.time})})),this},a.prototype.setMasterTuning=function(t,e,r){var i=this;if(r=r||{},(t=parseFloat(t)||0)<=-65||64<=t)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var n=Math.floor(t)+64,s=t-Math.floor(t),a=(s=Math.round((s+1)/2*16383))>>7&127,h=127&s;return o.toMIDIChannels(e).forEach((function(){i.setRegisteredParameter("channelcoarsetuning",n,e,{time:r.time}),i.setRegisteredParameter("channelfinetuning",[a,h],e,{time:r.time})})),this},a.prototype.setTuningProgram=function(t,e,r){var i=this;if(r=r||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The program value must be between 0 and 127");return o.toMIDIChannels(e).forEach((function(){i.setRegisteredParameter("tuningprogram",t,e,{time:r.time})})),this},a.prototype.setTuningBank=function(t,e,r){var i=this;if(r=r||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The bank value must be between 0 and 127");return o.toMIDIChannels(e).forEach((function(){i.setRegisteredParameter("tuningbank",t,e,{time:r.time})})),this},a.prototype.sendChannelMode=function(t,e,r,i){if(i=i||{},"string"==typeof t){if(!(t=o.MIDI_CHANNEL_MODE_MESSAGES[t]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(t=Math.floor(t))&&t<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((e=Math.floor(e)||0)<0||127<e)throw new RangeError("Value must be an integer between 0 and 127.");return o.toMIDIChannels(r).forEach(function(r){this.send((o.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(r-1),[t,e],this._parseTimeParameter(i.time))}.bind(this)),this},a.prototype.sendProgramChange=function(t,e,r){var i=this;if(r=r||{},t=Math.floor(t),isNaN(t)||t<0||127<t)throw new RangeError("Program numbers must be between 0 and 127.");return o.toMIDIChannels(e).forEach((function(e){i.send((o.MIDI_CHANNEL_MESSAGES.programchange<<4)+(e-1),[t],i._parseTimeParameter(r.time))})),this},a.prototype.sendChannelAftertouch=function(t,e,r){var i=this;r=r||{},t=parseFloat(t),(isNaN(t)||t<0||1<t)&&(t=.5);var n=Math.round(127*t);return o.toMIDIChannels(e).forEach((function(t){i.send((o.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(t-1),[n],i._parseTimeParameter(r.time))})),this},a.prototype.sendPitchBend=function(t,e,r){var i=this;if(r=r||{},isNaN(t)||t<-1||1<t)throw new RangeError("Pitch bend value must be between -1 and 1.");var n=Math.round((t+1)/2*16383),s=n>>7&127,a=127&n;return o.toMIDIChannels(e).forEach((function(t){i.send((o.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(t-1),[a,s],i._parseTimeParameter(r.time))})),this},a.prototype._parseTimeParameter=function(t){var e,r=parseFloat(t);return"string"==typeof t&&"+"===t.substring(0,1)?r&&0<r&&(e=o.time+r):r>o.time&&(e=r),e},a.prototype._convertNoteToArray=function(t){var e=[];return Array.isArray(t)||(t=[t]),t.forEach((function(t){e.push(o.guessNoteNumber(t))})),e},void 0===(i=function(){return o}.apply(e,[]))||(t.exports=i)}()},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var i=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=e.reduce((function(t,e){return function(r){return e(t(r))}}),(function(t){return t}));return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return i(t.apply(void 0,e))}}},function(t,e,r){window,t.exports=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=33)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(14);e.IBufferService=i.createDecorator("BufferService"),e.ICoreMouseService=i.createDecorator("CoreMouseService"),e.ICoreService=i.createDecorator("CoreService"),e.IDirtyRowService=i.createDecorator("DirtyRowService"),e.IInstantiationService=i.createDecorator("InstantiationService"),e.ILogService=i.createDecorator("LogService"),e.IOptionsService=i.createDecorator("OptionsService")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._listeners=[],this._disposed=!1}return Object.defineProperty(t.prototype,"event",{get:function(){var t=this;return this._event||(this._event=function(e){return t._listeners.push(e),{dispose:function(){if(!t._disposed)for(var r=0;r<t._listeners.length;r++)if(t._listeners[r]===e)return void t._listeners.splice(r,1)}}}),this._event},enumerable:!0,configurable:!0}),t.prototype.fire=function(t){for(var e=[],r=0;r<this._listeners.length;r++)e.push(this._listeners[r]);for(r=0;r<e.length;r++)e[r].call(void 0,t)},t.prototype.dispose=function(){this._listeners&&(this._listeners.length=0),this._disposed=!0},t}();e.EventEmitter=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._disposables=[],this._isDisposed=!1}return t.prototype.dispose=function(){this._isDisposed=!0,this._disposables.forEach((function(t){return t.dispose()})),this._disposables.length=0},t.prototype.register=function(t){this._disposables.push(t)},t.prototype.unregister=function(t){var e=this._disposables.indexOf(t);-1!==e&&this._disposables.splice(e,1)},t}();e.Disposable=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_COLOR=256,e.DEFAULT_ATTR=256|e.DEFAULT_COLOR<<9,e.CHAR_DATA_ATTR_INDEX=0,e.CHAR_DATA_CHAR_INDEX=1,e.CHAR_DATA_WIDTH_INDEX=2,e.CHAR_DATA_CODE_INDEX=3,e.NULL_CELL_CHAR="",e.NULL_CELL_WIDTH=1,e.NULL_CELL_CODE=0,e.WHITESPACE_CELL_CHAR=" ",e.WHITESPACE_CELL_WIDTH=1,e.WHITESPACE_CELL_CODE=32},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(14);e.ICharSizeService=i.createDecorator("CharSizeService"),e.ICoreBrowserService=i.createDecorator("CoreBrowserService"),e.IMouseService=i.createDecorator("MouseService"),e.IRenderService=i.createDecorator("RenderService"),e.ISelectionService=i.createDecorator("SelectionService"),e.ISoundService=i.createDecorator("SoundService")},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(8),s=r(3),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.content=0,e.fg=0,e.bg=0,e.combinedData="",e}return n(e,t),e.fromCharData=function(t){var r=new e;return r.setFromCharData(t),r},e.prototype.isCombined=function(){return 2097152&this.content},e.prototype.getWidth=function(){return this.content>>22},e.prototype.getChars=function(){return 2097152&this.content?this.combinedData:2097151&this.content?o.stringFromCodePoint(2097151&this.content):""},e.prototype.getCode=function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content},e.prototype.setFromCharData=function(t){this.fg=t[s.CHAR_DATA_ATTR_INDEX],this.bg=0;var e=!1;if(t[s.CHAR_DATA_CHAR_INDEX].length>2)e=!0;else if(2===t[s.CHAR_DATA_CHAR_INDEX].length){var r=t[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=r&&r<=56319){var i=t[s.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=i&&i<=57343?this.content=1024*(r-55296)+i-56320+65536|t[s.CHAR_DATA_WIDTH_INDEX]<<22:e=!0}else e=!0}else this.content=t[s.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[s.CHAR_DATA_WIDTH_INDEX]<<22;e&&(this.combinedData=t[s.CHAR_DATA_CHAR_INDEX],this.content=2097152|t[s.CHAR_DATA_WIDTH_INDEX]<<22)},e.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},e}(r(6).AttributeData);e.CellData=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.fg=0,this.bg=0}return t.toColorRGB=function(t){return[t>>>16&255,t>>>8&255,255&t]},t.fromColorRGB=function(t){return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},t.prototype.clone=function(){var e=new t;return e.fg=this.fg,e.bg=this.bg,e},t.prototype.isInverse=function(){return 67108864&this.fg},t.prototype.isBold=function(){return 134217728&this.fg},t.prototype.isUnderline=function(){return 268435456&this.fg},t.prototype.isBlink=function(){return 536870912&this.fg},t.prototype.isInvisible=function(){return 1073741824&this.fg},t.prototype.isItalic=function(){return 67108864&this.bg},t.prototype.isDim=function(){return 134217728&this.bg},t.prototype.getFgColorMode=function(){return 50331648&this.fg},t.prototype.getBgColorMode=function(){return 50331648&this.bg},t.prototype.isFgRGB=function(){return 50331648==(50331648&this.fg)},t.prototype.isBgRGB=function(){return 50331648==(50331648&this.bg)},t.prototype.isFgPalette=function(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)},t.prototype.isBgPalette=function(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)},t.prototype.isFgDefault=function(){return 0==(50331648&this.fg)},t.prototype.isBgDefault=function(){return 0==(50331648&this.bg)},t.prototype.getFgColor=function(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}},t.prototype.getBgColor=function(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}},t}();e.AttributeData=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addDisposableDomListener=function(t,e,r,i){return t.addEventListener(e,r,i),{dispose:function(){r&&t.removeEventListener(e,r,i)}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.stringFromCodePoint=function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):String.fromCharCode(t)},e.utf32ToString=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=t.length);for(var i="",n=e;n<r;++n){var o=t[n];o>65535?(o-=65536,i+=String.fromCharCode(55296+(o>>10))+String.fromCharCode(o%1024+56320)):i+=String.fromCharCode(o)}return i};var i=function(){function t(){this._interim=0}return t.prototype.clear=function(){this._interim=0},t.prototype.decode=function(t,e){var r=t.length;if(!r)return 0;var i=0,n=0;this._interim&&(56320<=(a=t.charCodeAt(n++))&&a<=57343?e[i++]=1024*(this._interim-55296)+a-56320+65536:(e[i++]=this._interim,e[i++]=a),this._interim=0);for(var o=n;o<r;++o){var s=t.charCodeAt(o);if(55296<=s&&s<=56319){if(++o>=r)return this._interim=s,i;var a;56320<=(a=t.charCodeAt(o))&&a<=57343?e[i++]=1024*(s-55296)+a-56320+65536:(e[i++]=s,e[i++]=a)}else e[i++]=s}return i},t}();e.StringToUtf32=i;var n=function(){function t(){this.interim=new Uint8Array(3)}return t.prototype.clear=function(){this.interim.fill(0)},t.prototype.decode=function(t,e){var r=t.length;if(!r)return 0;var i,n,o,s,a=0,h=0,c=0;if(this.interim[0]){var l=!1,u=this.interim[0];u&=192==(224&u)?31:224==(240&u)?15:7;for(var p=0,d=void 0;(d=63&this.interim[++p])&&p<4;)u<<=6,u|=d;for(var f=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,g=f-p;c<g;){if(c>=r)return 0;if(128!=(192&(d=t[c++]))){c--,l=!0;break}this.interim[p++]=d,u<<=6,u|=63&d}l||(2===f?u<128?c--:e[a++]=u:3===f?u<2048||u>=55296&&u<=57343||(e[a++]=u):u<65536||u>1114111||(e[a++]=u)),this.interim.fill(0)}for(var _=r-4,v=c;v<r;){for(;!(!(v<_)||128&(i=t[v])||128&(n=t[v+1])||128&(o=t[v+2])||128&(s=t[v+3]));)e[a++]=i,e[a++]=n,e[a++]=o,e[a++]=s,v+=4;if((i=t[v++])<128)e[a++]=i;else if(192==(224&i)){if(v>=r)return this.interim[0]=i,a;if(128!=(192&(n=t[v++]))){v--;continue}if((h=(31&i)<<6|63&n)<128){v--;continue}e[a++]=h}else if(224==(240&i)){if(v>=r)return this.interim[0]=i,a;if(128!=(192&(n=t[v++]))){v--;continue}if(v>=r)return this.interim[0]=i,this.interim[1]=n,a;if(128!=(192&(o=t[v++]))){v--;continue}if((h=(15&i)<<12|(63&n)<<6|63&o)<2048||h>=55296&&h<=57343)continue;e[a++]=h}else if(240==(248&i)){if(v>=r)return this.interim[0]=i,a;if(128!=(192&(n=t[v++]))){v--;continue}if(v>=r)return this.interim[0]=i,this.interim[1]=n,a;if(128!=(192&(o=t[v++]))){v--;continue}if(v>=r)return this.interim[0]=i,this.interim[1]=n,this.interim[2]=o,a;if(128!=(192&(s=t[v++]))){v--;continue}if((h=(7&i)<<18|(63&n)<<12|(63&o)<<6|63&s)<65536||h>1114111)continue;e[a++]=h}}return a},t}();e.Utf8ToUtf32=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.INVERTED_DEFAULT_COLOR=257,e.DIM_OPACITY=.5,e.CHAR_ATLAS_CELL_SPACING=1},function(t,e,r){"use strict";function i(t){var e=t.toString(16);return e.length<2?"0"+e:e}function n(t,e,r,n){return void 0!==n?"#"+i(t)+i(e)+i(r)+i(n):"#"+i(t)+i(e)+i(r)}function o(t,e,r,i){return void 0===i&&(i=255),(t<<24|e<<16|r<<8|i)>>>0}function s(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}function a(t){return h(t>>16&255,t>>8&255,255&t)}function h(t,e,r){var i=t/255,n=e/255,o=r/255;return.2126*(i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))}function c(t,e){return t<e?(e+.05)/(t+.05):(t+.05)/(e+.05)}function l(t,e,r){return{css:n(t,e,r),rgba:o(t,e,r)}}function u(t,e,r){var i=a(t>>8),n=a(e>>8);if(c(i,n)<r)return n<i?p(t,e,r):d(t,e,r)}function p(t,e,r){for(var i=t>>24&255,n=t>>16&255,o=t>>8&255,s=e>>24&255,a=e>>16&255,l=e>>8&255,u=c(h(s,l,a),h(i,n,o));u<r&&(s>0||a>0||l>0);)s-=Math.max(0,Math.ceil(.1*s)),a-=Math.max(0,Math.ceil(.1*a)),u=c(h(s,l-=Math.max(0,Math.ceil(.1*l)),a),h(i,n,o));return(s<<24|a<<16|l<<8|255)>>>0}function d(t,e,r){for(var i=t>>24&255,n=t>>16&255,o=t>>8&255,s=e>>24&255,a=e>>16&255,l=e>>8&255,u=c(h(s,l,a),h(i,n,o));u<r&&(s<255||a<255||l<255);)s=Math.min(255,s+Math.ceil(.1*(255-s))),a=Math.min(255,a+Math.ceil(.1*(255-a))),u=c(h(s,l=Math.min(255,l+Math.ceil(.1*(255-l))),a),h(i,n,o));return(s<<24|a<<16|l<<8|255)>>>0}Object.defineProperty(e,"__esModule",{value:!0}),e.blend=function(t,e){var r=(255&e.rgba)/255;if(1===r)return{css:e.css,rgba:e.rgba};var i=e.rgba>>24&255,s=e.rgba>>16&255,a=e.rgba>>8&255,h=t.rgba>>24&255,c=t.rgba>>16&255,l=t.rgba>>8&255,u=h+Math.round((i-h)*r),p=c+Math.round((s-c)*r),d=l+Math.round((a-l)*r);return{css:n(u,p,d),rgba:o(u,p,d)}},e.fromCss=function(t){return{css:t,rgba:(parseInt(t.slice(1),16)<<8|255)>>>0}},e.toPaddedHex=i,e.toCss=n,e.toRgba=o,e.fromRgba=s,e.opaque=function(t){var e=(255|t.rgba)>>>0,r=s(e);return{css:n(r[0],r[1],r[2]),rgba:e}},e.rgbRelativeLuminance=a,e.rgbRelativeLuminance2=h,e.contrastRatio=c,e.rgbaToColor=l,e.ensureContrastRatioRgba=u,e.ensureContrastRatio=function(t,e,r){var i=u(t.rgba,e.rgba,r);if(i)return l(i>>24&255,i>>16&255,i>>8&255)},e.reduceLuminance=p,e.increaseLuminance=d},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="undefined"==typeof navigator,n=i?"node":navigator.userAgent,o=i?"node":navigator.platform;function s(t,e){return t.indexOf(e)>=0}e.isFirefox=!!~n.indexOf("Firefox"),e.isSafari=/^((?!chrome|android).)*safari/i.test(n),e.isMac=s(["Macintosh","MacIntel","MacPPC","Mac68K"],o),e.isIpad="iPad"===o,e.isIphone="iPhone"===o,e.isWindows=s(["Windows","Win16","Win32","WinCE"],o),e.isLinux=o.indexOf("Linux")>=0},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.NUL="\0",t.SOH="",t.STX="",t.ETX="",t.EOT="",t.ENQ="",t.ACK="",t.BEL="",t.BS="\b",t.HT="\t",t.LF="\n",t.VT="\v",t.FF="\f",t.CR="\r",t.SO="",t.SI="",t.DLE="",t.DC1="",t.DC2="",t.DC3="",t.DC4="",t.NAK="",t.SYN="",t.ETB="",t.CAN="",t.EM="",t.SUB="",t.ESC="",t.FS="",t.GS="",t.RS="",t.US="",t.SP=" ",t.DEL=""}(e.C0||(e.C0={})),function(t){t.PAD="",t.HOP="",t.BPH="",t.NBH="",t.IND="",t.NEL="",t.SSA="",t.ESA="",t.HTS="",t.HTJ="",t.VTS="",t.PLD="",t.PLU="",t.RI="",t.SS2="",t.SS3="",t.DCS="",t.PU1="",t.PU2="",t.STS="",t.CCH="",t.MW="",t.SPA="",t.EPA="",t.SOS="",t.SGCI="",t.SCI="",t.CSI="",t.ST="",t.OSC="",t.PM="",t.APC=""}(e.C1||(e.C1={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3),n=r(9),o=r(24),s=r(6),a=r(27),h=r(10),c=function(){function t(t,e,r,i,n,o,s,a){this._container=t,this._alpha=i,this._colors=n,this._rendererId=o,this._bufferService=s,this._optionsService=a,this._scaledCharWidth=0,this._scaledCharHeight=0,this._scaledCellWidth=0,this._scaledCellHeight=0,this._scaledCharLeft=0,this._scaledCharTop=0,this._currentGlyphIdentifier={chars:"",code:0,bg:0,fg:0,bold:!1,dim:!1,italic:!1},this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-"+e+"-layer"),this._canvas.style.zIndex=r.toString(),this._initCanvas(),this._container.appendChild(this._canvas)}return t.prototype.dispose=function(){var t;this._container.removeChild(this._canvas),null===(t=this._charAtlas)||void 0===t||t.dispose()},t.prototype._initCanvas=function(){this._ctx=a.throwIfFalsy(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()},t.prototype.onOptionsChanged=function(){},t.prototype.onBlur=function(){},t.prototype.onFocus=function(){},t.prototype.onCursorMove=function(){},t.prototype.onGridChanged=function(t,e){},t.prototype.onSelectionChanged=function(t,e,r){void 0===r&&(r=!1)},t.prototype.setColors=function(t){this._refreshCharAtlas(t)},t.prototype._setTransparency=function(t){if(t!==this._alpha){var e=this._canvas;this._alpha=t,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,e),this._refreshCharAtlas(this._colors),this.onGridChanged(0,this._bufferService.rows-1)}},t.prototype._refreshCharAtlas=function(t){this._scaledCharWidth<=0&&this._scaledCharHeight<=0||(this._charAtlas=o.acquireCharAtlas(this._optionsService.options,this._rendererId,t,this._scaledCharWidth,this._scaledCharHeight),this._charAtlas.warmUp())},t.prototype.resize=function(t){this._scaledCellWidth=t.scaledCellWidth,this._scaledCellHeight=t.scaledCellHeight,this._scaledCharWidth=t.scaledCharWidth,this._scaledCharHeight=t.scaledCharHeight,this._scaledCharLeft=t.scaledCharLeft,this._scaledCharTop=t.scaledCharTop,this._canvas.width=t.scaledCanvasWidth,this._canvas.height=t.scaledCanvasHeight,this._canvas.style.width=t.canvasWidth+"px",this._canvas.style.height=t.canvasHeight+"px",this._alpha||this._clearAll(),this._refreshCharAtlas(this._colors)},t.prototype._fillCells=function(t,e,r,i){this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,r*this._scaledCellWidth,i*this._scaledCellHeight)},t.prototype._fillBottomLineAtCells=function(t,e,r){void 0===r&&(r=1),this._ctx.fillRect(t*this._scaledCellWidth,(e+1)*this._scaledCellHeight-window.devicePixelRatio-1,r*this._scaledCellWidth,window.devicePixelRatio)},t.prototype._fillLeftLineAtCell=function(t,e){this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,window.devicePixelRatio,this._scaledCellHeight)},t.prototype._strokeRectAtCell=function(t,e,r,i){this._ctx.lineWidth=window.devicePixelRatio,this._ctx.strokeRect(t*this._scaledCellWidth+window.devicePixelRatio/2,e*this._scaledCellHeight+window.devicePixelRatio/2,r*this._scaledCellWidth-window.devicePixelRatio,i*this._scaledCellHeight-window.devicePixelRatio)},t.prototype._clearAll=function(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))},t.prototype._clearCells=function(t,e,r,i){this._alpha?this._ctx.clearRect(t*this._scaledCellWidth,e*this._scaledCellHeight,r*this._scaledCellWidth,i*this._scaledCellHeight):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,r*this._scaledCellWidth,i*this._scaledCellHeight))},t.prototype._fillCharTrueColor=function(t,e,r){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline="middle",this._clipRow(r),this._ctx.fillText(t.getChars(),e*this._scaledCellWidth+this._scaledCharLeft,r*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight/2)},t.prototype._drawChars=function(t,e,r){var o,s,a=this._getContrastColor(t);a||t.isFgRGB()||t.isBgRGB()?this._drawUncachedChars(t,e,r,a):(t.isInverse()?(o=t.isBgDefault()?n.INVERTED_DEFAULT_COLOR:t.getBgColor(),s=t.isFgDefault()?n.INVERTED_DEFAULT_COLOR:t.getFgColor()):(s=t.isBgDefault()?i.DEFAULT_COLOR:t.getBgColor(),o=t.isFgDefault()?i.DEFAULT_COLOR:t.getFgColor()),o+=this._optionsService.options.drawBoldTextInBrightColors&&t.isBold()&&o<8?8:0,this._currentGlyphIdentifier.chars=t.getChars()||i.WHITESPACE_CELL_CHAR,this._currentGlyphIdentifier.code=t.getCode()||i.WHITESPACE_CELL_CODE,this._currentGlyphIdentifier.bg=s,this._currentGlyphIdentifier.fg=o,this._currentGlyphIdentifier.bold=!!t.isBold(),this._currentGlyphIdentifier.dim=!!t.isDim(),this._currentGlyphIdentifier.italic=!!t.isItalic(),this._charAtlas&&this._charAtlas.draw(this._ctx,this._currentGlyphIdentifier,e*this._scaledCellWidth+this._scaledCharLeft,r*this._scaledCellHeight+this._scaledCharTop)||this._drawUncachedChars(t,e,r))},t.prototype._drawUncachedChars=function(t,e,r,i){if(this._ctx.save(),this._ctx.font=this._getFont(!!t.isBold(),!!t.isItalic()),this._ctx.textBaseline="middle",t.isInverse())if(i)this._ctx.fillStyle=i.css;else if(t.isBgDefault())this._ctx.fillStyle=h.opaque(this._colors.background).css;else if(t.isBgRGB())this._ctx.fillStyle="rgb("+s.AttributeData.toColorRGB(t.getBgColor()).join(",")+")";else{var o=t.getBgColor();this._optionsService.options.drawBoldTextInBrightColors&&t.isBold()&&o<8&&(o+=8),this._ctx.fillStyle=this._colors.ansi[o].css}else if(i)this._ctx.fillStyle=i.css;else if(t.isFgDefault())this._ctx.fillStyle=this._colors.foreground.css;else if(t.isFgRGB())this._ctx.fillStyle="rgb("+s.AttributeData.toColorRGB(t.getFgColor()).join(",")+")";else{var a=t.getFgColor();this._optionsService.options.drawBoldTextInBrightColors&&t.isBold()&&a<8&&(a+=8),this._ctx.fillStyle=this._colors.ansi[a].css}this._clipRow(r),t.isDim()&&(this._ctx.globalAlpha=n.DIM_OPACITY),this._ctx.fillText(t.getChars(),e*this._scaledCellWidth+this._scaledCharLeft,r*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight/2),this._ctx.restore()},t.prototype._clipRow=function(t){this._ctx.beginPath(),this._ctx.rect(0,t*this._scaledCellHeight,this._bufferService.cols*this._scaledCellWidth,this._scaledCellHeight),this._ctx.clip()},t.prototype._getFont=function(t,e){return(e?"italic":"")+" "+(t?this._optionsService.options.fontWeightBold:this._optionsService.options.fontWeight)+" "+this._optionsService.options.fontSize*window.devicePixelRatio+"px "+this._optionsService.options.fontFamily},t.prototype._getContrastColor=function(t){if(1!==this._optionsService.options.minimumContrastRatio){var e=this._colors.contrastCache.getColor(t.bg,t.fg);if(void 0!==e)return e||void 0;var r=t.getFgColor(),i=t.getFgColorMode(),n=t.getBgColor(),o=t.getBgColorMode(),s=!!t.isInverse(),a=!!t.isInverse();if(s){var c=r;r=n,n=c;var l=i;i=o,o=l}var u=this._resolveBackgroundRgba(o,n,s),p=this._resolveForegroundRgba(i,r,s,a),d=h.ensureContrastRatioRgba(u,p,this._optionsService.options.minimumContrastRatio);if(d){var f={css:h.toCss(d>>24&255,d>>16&255,d>>8&255),rgba:d};return this._colors.contrastCache.setColor(t.bg,t.fg,f),f}this._colors.contrastCache.setColor(t.bg,t.fg,null)}},t.prototype._resolveBackgroundRgba=function(t,e,r){switch(t){case 16777216:case 33554432:return this._colors.ansi[e].rgba;case 50331648:return e<<8;case 0:default:return r?this._colors.foreground.rgba:this._colors.background.rgba}},t.prototype._resolveForegroundRgba=function(t,e,r,i){switch(t){case 16777216:case 33554432:return this._optionsService.options.drawBoldTextInBrightColors&&i&&e<8&&(e+=8),this._colors.ansi[e].rgba;case 50331648:return e<<8;case 0:default:return r?this._colors.background.rgba:this._colors.foreground.rgba}},t}();e.BaseRenderLayer=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="di$target",n="di$dependencies";function o(t,e,r){e[i]===e?e[n].push({id:t,index:r}):(e[n]=[{id:t,index:r}],e[i]=e)}e.serviceRegistry=new Map,e.getServiceDependencies=function(t){return t[n]||[]},e.createDecorator=function(t){if(e.serviceRegistry.has(t))return e.serviceRegistry.get(t);var r=function(t,e,i){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");o(r,t,i)};return r.toString=function(){return t},e.serviceRegistry.set(t,r),r}},function(t,e,r){"use strict";function i(t,e,r,i){if(void 0===r&&(r=0),void 0===i&&(i=t.length),r>=t.length)return t;r=(t.length+r)%t.length,i=i>=t.length?t.length:(t.length+i)%t.length;for(var n=r;n<i;++n)t[n]=e;return t}Object.defineProperty(e,"__esModule",{value:!0}),e.fill=function(t,e,r,n){return t.fill?t.fill(e,r,n):i(t,e,r,n)},e.fillFallback=i,e.concat=function(t,e){var r=new t.constructor(t.length+e.length);return r.set(t),r.set(e,t.length),r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(8),n=r(3),o=r(5),s=r(6),a=3;e.DEFAULT_ATTR_DATA=Object.freeze(new s.AttributeData);var h=function(){function t(t,e,r){void 0===r&&(r=!1),this.isWrapped=r,this._combined={},this._data=new Uint32Array(t*a);for(var i=e||o.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]),s=0;s<t;++s)this.setCell(s,i);this.length=t}return t.prototype.get=function(t){var e=this._data[t*a+0],r=2097151&e;return[this._data[t*a+1],2097152&e?this._combined[t]:r?i.stringFromCodePoint(r):"",e>>22,2097152&e?this._combined[t].charCodeAt(this._combined[t].length-1):r]},t.prototype.set=function(t,e){this._data[t*a+1]=e[n.CHAR_DATA_ATTR_INDEX],e[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[t]=e[1],this._data[t*a+0]=2097152|t|e[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[t*a+0]=e[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|e[n.CHAR_DATA_WIDTH_INDEX]<<22},t.prototype.getWidth=function(t){return this._data[t*a+0]>>22},t.prototype.hasWidth=function(t){return 12582912&this._data[t*a+0]},t.prototype.getFg=function(t){return this._data[t*a+1]},t.prototype.getBg=function(t){return this._data[t*a+2]},t.prototype.hasContent=function(t){return 4194303&this._data[t*a+0]},t.prototype.getCodePoint=function(t){var e=this._data[t*a+0];return 2097152&e?this._combined[t].charCodeAt(this._combined[t].length-1):2097151&e},t.prototype.isCombined=function(t){return 2097152&this._data[t*a+0]},t.prototype.getString=function(t){var e=this._data[t*a+0];return 2097152&e?this._combined[t]:2097151&e?i.stringFromCodePoint(2097151&e):""},t.prototype.loadCell=function(t,e){var r=t*a;return e.content=this._data[r+0],e.fg=this._data[r+1],e.bg=this._data[r+2],2097152&e.content&&(e.combinedData=this._combined[t]),e},t.prototype.setCell=function(t,e){2097152&e.content&&(this._combined[t]=e.combinedData),this._data[t*a+0]=e.content,this._data[t*a+1]=e.fg,this._data[t*a+2]=e.bg},t.prototype.setCellFromCodePoint=function(t,e,r,i,n){this._data[t*a+0]=e|r<<22,this._data[t*a+1]=i,this._data[t*a+2]=n},t.prototype.addCodepointToCell=function(t,e){var r=this._data[t*a+0];2097152&r?this._combined[t]+=i.stringFromCodePoint(e):(2097151&r?(this._combined[t]=i.stringFromCodePoint(2097151&r)+i.stringFromCodePoint(e),r&=-2097152,r|=2097152):r=e|1<<22,this._data[t*a+0]=r)},t.prototype.insertCells=function(t,e,r){if(t%=this.length,e<this.length-t){for(var i=new o.CellData,n=this.length-t-e-1;n>=0;--n)this.setCell(t+e+n,this.loadCell(t+n,i));for(n=0;n<e;++n)this.setCell(t+n,r)}else for(n=t;n<this.length;++n)this.setCell(n,r)},t.prototype.deleteCells=function(t,e,r){if(t%=this.length,e<this.length-t){for(var i=new o.CellData,n=0;n<this.length-t-e;++n)this.setCell(t+n,this.loadCell(t+e+n,i));for(n=this.length-e;n<this.length;++n)this.setCell(n,r)}else for(n=t;n<this.length;++n)this.setCell(n,r)},t.prototype.replaceCells=function(t,e,r){for(;t<e&&t<this.length;)this.setCell(t++,r)},t.prototype.resize=function(t,e){if(t!==this.length){if(t>this.length){var r=new Uint32Array(t*a);this.length&&(t*a<this._data.length?r.set(this._data.subarray(0,t*a)):r.set(this._data)),this._data=r;for(var i=this.length;i<t;++i)this.setCell(i,e)}else if(t){(r=new Uint32Array(t*a)).set(this._data.subarray(0,t*a)),this._data=r;var n=Object.keys(this._combined);for(i=0;i<n.length;i++){var o=parseInt(n[i],10);o>=t&&delete this._combined[o]}}else this._data=new Uint32Array(0),this._combined={};this.length=t}},t.prototype.fill=function(t){this._combined={};for(var e=0;e<this.length;++e)this.setCell(e,t)},t.prototype.copyFrom=function(t){for(var e in this.length!==t.length?this._data=new Uint32Array(t._data):this._data.set(t._data),this.length=t.length,this._combined={},t._combined)this._combined[e]=t._combined[e];this.isWrapped=t.isWrapped},t.prototype.clone=function(){var e=new t(0);for(var r in e._data=new Uint32Array(this._data),e.length=this.length,this._combined)e._combined[r]=this._combined[r];return e.isWrapped=this.isWrapped,e},t.prototype.getTrimmedLength=function(){for(var t=this.length-1;t>=0;--t)if(4194303&this._data[t*a+0])return t+(this._data[t*a+0]>>22);return 0},t.prototype.copyCellsFrom=function(t,e,r,i,n){var o=t._data;if(n)for(var s=i-1;s>=0;s--)for(var h=0;h<a;h++)this._data[(r+s)*a+h]=o[(e+s)*a+h];else for(s=0;s<i;s++)for(h=0;h<a;h++)this._data[(r+s)*a+h]=o[(e+s)*a+h];var c=Object.keys(t._combined);for(h=0;h<c.length;h++){var l=parseInt(c[h],10);l>=e&&(this._combined[l-e+r]=t._combined[l])}},t.prototype.translateToString=function(t,e,r){void 0===t&&(t=!1),void 0===e&&(e=0),void 0===r&&(r=this.length),t&&(r=Math.min(r,this.getTrimmedLength()));for(var o="";e<r;){var s=this._data[e*a+0],h=2097151&s;o+=2097152&s?this._combined[e]:h?i.stringFromCodePoint(h):n.WHITESPACE_CELL_CHAR,e+=s>>22||1}return o},t}();e.BufferLine=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.promptLabel="Terminal input",e.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CHARSETS={},e.DEFAULT_CHARSET=e.CHARSETS.B,e.CHARSETS[0]={"`":"◆",a:"▒",b:"\t",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"\v",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},e.CHARSETS.A={"#":"£"},e.CHARSETS.B=null,e.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},e.CHARSETS.C=e.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},e.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},e.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},e.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},e.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},e.CHARSETS.E=e.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},e.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},e.CHARSETS.H=e.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},e.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(15);e.wcwidth=function(t){var e=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],r=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],n=0|t.control,o=new Uint8Array(65536);i.fill(o,1),o[0]=t.nul,i.fill(o,t.control,1,32),i.fill(o,t.control,127,160),i.fill(o,2,4352,4448),o[9001]=2,o[9002]=2,i.fill(o,2,11904,42192),o[12351]=1,i.fill(o,2,44032,55204),i.fill(o,2,63744,64256),i.fill(o,2,65040,65050),i.fill(o,2,65072,65136),i.fill(o,2,65280,65377),i.fill(o,2,65504,65511);for(var s=0;s<e.length;++s)i.fill(o,0,e[s][0],e[s][1]+1);return function(t){return t<32?0|n:t<127?1:t<65536?o[t]:function(t,e){var r,i=0,n=e.length-1;if(t<e[0][0]||t>e[n][1])return!1;for(;n>=i;)if(t>e[r=i+n>>1][1])i=r+1;else{if(!(t<e[r][0]))return!0;n=r-1}return!1}(e=t,r)?0:e>=131072&&e<=196605||e>=196608&&e<=262141?2:1;var e}}({nul:0,control:0}),e.getStringCellWidth=function(t){for(var r=0,i=t.length,n=0;n<i;++n){var o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=i)return r+e.wcwidth(o);var s=t.charCodeAt(n);56320<=s&&s<=57343?o=1024*(o-55296)+s-56320+65536:r+=e.wcwidth(s)}r+=e.wcwidth(o)}return r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=256,n=function(){function t(t,e){if(void 0===t&&(t=32),void 0===e&&(e=32),this.maxLength=t,this.maxSubParamsLength=e,e>i)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(t),this.length=0,this._subParams=new Int32Array(e),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(t),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}return t.fromArray=function(e){var r=new t;if(!e.length)return r;for(var i=e[0]instanceof Array?1:0;i<e.length;++i){var n=e[i];if(n instanceof Array)for(var o=0;o<n.length;++o)r.addSubParam(n[o]);else r.addParam(n)}return r},t.prototype.clone=function(){var e=new t(this.maxLength,this.maxSubParamsLength);return e.params.set(this.params),e.length=this.length,e._subParams.set(this._subParams),e._subParamsLength=this._subParamsLength,e._subParamsIdx.set(this._subParamsIdx),e._rejectDigits=this._rejectDigits,e._rejectSubDigits=this._rejectSubDigits,e._digitIsSub=this._digitIsSub,e},t.prototype.toArray=function(){for(var t=[],e=0;e<this.length;++e){t.push(this.params[e]);var r=this._subParamsIdx[e]>>8,i=255&this._subParamsIdx[e];i-r>0&&t.push(Array.prototype.slice.call(this._subParams,r,i))}return t},t.prototype.reset=function(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1},t.prototype.addParam=function(t){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=t>2147483647?2147483647:t}},t.prototype.addSubParam=function(t){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(t<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=t>2147483647?2147483647:t,this._subParamsIdx[this.length-1]++}},t.prototype.hasSubParams=function(t){return(255&this._subParamsIdx[t])-(this._subParamsIdx[t]>>8)>0},t.prototype.getSubParams=function(t){var e=this._subParamsIdx[t]>>8,r=255&this._subParamsIdx[t];return r-e>0?this._subParams.subarray(e,r):null},t.prototype.getSubParamsAll=function(){for(var t={},e=0;e<this.length;++e){var r=this._subParamsIdx[e]>>8,i=255&this._subParamsIdx[e];i-r>0&&(t[e]=this._subParams.slice(r,i))}return t},t.prototype.addDigit=function(t){var e;if(!(this._rejectDigits||!(e=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)){var r=this._digitIsSub?this._subParams:this.params,i=r[e-1];r[e-1]=~i?Math.min(10*i+t,2147483647):t}},t}();e.Params=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(22),n=r(8),o=function(){function t(){this._state=0,this._id=-1,this._handlers=Object.create(null),this._handlerFb=function(){}}return t.prototype.addHandler=function(t,e){void 0===this._handlers[t]&&(this._handlers[t]=[]);var r=this._handlers[t];return r.push(e),{dispose:function(){var t=r.indexOf(e);-1!==t&&r.splice(t,1)}}},t.prototype.setHandler=function(t,e){this._handlers[t]=[e]},t.prototype.clearHandler=function(t){this._handlers[t]&&delete this._handlers[t]},t.prototype.setHandlerFallback=function(t){this._handlerFb=t},t.prototype.dispose=function(){this._handlers=Object.create(null),this._handlerFb=function(){}},t.prototype.reset=function(){2===this._state&&this.end(!1),this._id=-1,this._state=0},t.prototype._start=function(){var t=this._handlers[this._id];if(t)for(var e=t.length-1;e>=0;e--)t[e].start();else this._handlerFb(this._id,"START")},t.prototype._put=function(t,e,r){var i=this._handlers[this._id];if(i)for(var o=i.length-1;o>=0;o--)i[o].put(t,e,r);else this._handlerFb(this._id,"PUT",n.utf32ToString(t,e,r))},t.prototype._end=function(t){var e=this._handlers[this._id];if(e){for(var r=e.length-1;r>=0&&!1===e[r].end(t);r--);for(r--;r>=0;r--)e[r].end(!1)}else this._handlerFb(this._id,"END",t)},t.prototype.start=function(){this.reset(),this._id=-1,this._state=1},t.prototype.put=function(t,e,r){if(3!==this._state){if(1===this._state)for(;e<r;){var i=t[e++];if(59===i){this._state=2,this._start();break}if(i<48||57<i)return void(this._state=3);-1===this._id&&(this._id=0),this._id=10*this._id+i-48}2===this._state&&r-e>0&&this._put(t,e,r)}},t.prototype.end=function(t){0!==this._state&&(3!==this._state&&(1===this._state&&this._start(),this._end(t)),this._id=-1,this._state=0)},t}();e.OscParser=o;var s=function(){function t(t){this._handler=t,this._data="",this._hitLimit=!1}return t.prototype.start=function(){this._data="",this._hitLimit=!1},t.prototype.put=function(t,e,r){this._hitLimit||(this._data+=n.utf32ToString(t,e,r),this._data.length>i.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))},t.prototype.end=function(t){var e;return this._hitLimit?e=!1:t&&(e=this._handler(this._data)),this._data="",this._hitLimit=!1,e},t}();e.OscHandler=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PAYLOAD_LIMIT=1e7},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(8),n=r(20),o=r(22),s=[],a=function(){function t(){this._handlers=Object.create(null),this._active=s,this._ident=0,this._handlerFb=function(){}}return t.prototype.dispose=function(){this._handlers=Object.create(null),this._handlerFb=function(){}},t.prototype.addHandler=function(t,e){void 0===this._handlers[t]&&(this._handlers[t]=[]);var r=this._handlers[t];return r.push(e),{dispose:function(){var t=r.indexOf(e);-1!==t&&r.splice(t,1)}}},t.prototype.setHandler=function(t,e){this._handlers[t]=[e]},t.prototype.clearHandler=function(t){this._handlers[t]&&delete this._handlers[t]},t.prototype.setHandlerFallback=function(t){this._handlerFb=t},t.prototype.reset=function(){this._active.length&&this.unhook(!1),this._active=s,this._ident=0},t.prototype.hook=function(t,e){if(this.reset(),this._ident=t,this._active=this._handlers[t]||s,this._active.length)for(var r=this._active.length-1;r>=0;r--)this._active[r].hook(e);else this._handlerFb(this._ident,"HOOK",e)},t.prototype.put=function(t,e,r){if(this._active.length)for(var n=this._active.length-1;n>=0;n--)this._active[n].put(t,e,r);else this._handlerFb(this._ident,"PUT",i.utf32ToString(t,e,r))},t.prototype.unhook=function(t){if(this._active.length){for(var e=this._active.length-1;e>=0&&!1===this._active[e].unhook(t);e--);for(e--;e>=0;e--)this._active[e].unhook(!1)}else this._handlerFb(this._ident,"UNHOOK",t);this._active=s,this._ident=0},t}();e.DcsParser=a;var h=function(){function t(t){this._handler=t,this._data="",this._hitLimit=!1}return t.prototype.hook=function(t){this._params=t.clone(),this._data="",this._hitLimit=!1},t.prototype.put=function(t,e,r){this._hitLimit||(this._data+=i.utf32ToString(t,e,r),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))},t.prototype.unhook=function(t){var e;return this._hitLimit?e=!1:t&&(e=this._handler(this._data,this._params?this._params:new n.Params)),this._params=void 0,this._data="",this._hitLimit=!1,e},t}();e.DcsHandler=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(25),n=r(43),o=[];e.acquireCharAtlas=function(t,e,r,s,a){for(var h=i.generateConfig(s,a,t,r),c=0;c<o.length;c++){var l=(u=o[c]).ownedBy.indexOf(e);if(l>=0){if(i.configEquals(u.config,h))return u.atlas;1===u.ownedBy.length?(u.atlas.dispose(),o.splice(c,1)):u.ownedBy.splice(l,1);break}}for(c=0;c<o.length;c++){var u=o[c];if(i.configEquals(u.config,h))return u.ownedBy.push(e),u.atlas}var p={atlas:new n.DynamicCharAtlas(document,h),config:h,ownedBy:[e]};return o.push(p),p.atlas},e.removeTerminalFromCache=function(t){for(var e=0;e<o.length;e++){var r=o[e].ownedBy.indexOf(t);if(-1!==r){1===o[e].ownedBy.length?(o[e].atlas.dispose(),o.splice(e,1)):o[e].ownedBy.splice(r,1);break}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3);e.generateConfig=function(t,e,r,i){var n={foreground:i.foreground,background:i.background,cursor:void 0,cursorAccent:void 0,selection:void 0,ansi:i.ansi.slice(0,16)};return{devicePixelRatio:window.devicePixelRatio,scaledCharWidth:t,scaledCharHeight:e,fontFamily:r.fontFamily,fontSize:r.fontSize,fontWeight:r.fontWeight,fontWeightBold:r.fontWeightBold,allowTransparency:r.allowTransparency,colors:n}},e.configEquals=function(t,e){for(var r=0;r<t.colors.ansi.length;r++)if(t.colors.ansi[r].rgba!==e.colors.ansi[r].rgba)return!1;return t.devicePixelRatio===e.devicePixelRatio&&t.fontFamily===e.fontFamily&&t.fontSize===e.fontSize&&t.fontWeight===e.fontWeight&&t.fontWeightBold===e.fontWeightBold&&t.allowTransparency===e.allowTransparency&&t.scaledCharWidth===e.scaledCharWidth&&t.scaledCharHeight===e.scaledCharHeight&&t.colors.foreground===e.colors.foreground&&t.colors.background===e.colors.background},e.is256Color=function(t){return t<i.DEFAULT_COLOR}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(10),n=r(45),o=i.fromCss("#ffffff"),s=i.fromCss("#000000"),a=i.fromCss("#ffffff"),h=i.fromCss("#000000"),c={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};e.DEFAULT_ANSI_COLORS=function(){for(var t=[i.fromCss("#2e3436"),i.fromCss("#cc0000"),i.fromCss("#4e9a06"),i.fromCss("#c4a000"),i.fromCss("#3465a4"),i.fromCss("#75507b"),i.fromCss("#06989a"),i.fromCss("#d3d7cf"),i.fromCss("#555753"),i.fromCss("#ef2929"),i.fromCss("#8ae234"),i.fromCss("#fce94f"),i.fromCss("#729fcf"),i.fromCss("#ad7fa8"),i.fromCss("#34e2e2"),i.fromCss("#eeeeec")],e=[0,95,135,175,215,255],r=0;r<216;r++){var n=e[r/36%6|0],o=e[r/6%6|0],s=e[r%6];t.push({css:i.toCss(n,o,s),rgba:i.toRgba(n,o,s)})}for(r=0;r<24;r++){var a=8+10*r;t.push({css:i.toCss(a,a,a),rgba:i.toRgba(a,a,a)})}return t}();var l=function(){function t(t,r){this.allowTransparency=r;var l=t.createElement("canvas");l.width=1,l.height=1;var u=l.getContext("2d");if(!u)throw new Error("Could not get rendering context");this._ctx=u,this._ctx.globalCompositeOperation="copy",this._litmusColor=this._ctx.createLinearGradient(0,0,1,1),this._contrastCache=new n.ColorContrastCache,this.colors={foreground:o,background:s,cursor:a,cursorAccent:h,selection:c,selectionOpaque:i.blend(s,c),ansi:e.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache}}return t.prototype.onOptionsChange=function(t){"minimumContrastRatio"===t&&this._contrastCache.clear()},t.prototype.setTheme=function(t){void 0===t&&(t={}),this.colors.foreground=this._parseColor(t.foreground,o),this.colors.background=this._parseColor(t.background,s),this.colors.cursor=this._parseColor(t.cursor,a,!0),this.colors.cursorAccent=this._parseColor(t.cursorAccent,h,!0),this.colors.selection=this._parseColor(t.selection,c,!0),this.colors.selectionOpaque=i.blend(this.colors.background,this.colors.selection),this.colors.ansi[0]=this._parseColor(t.black,e.DEFAULT_ANSI_COLORS[0]),this.colors.ansi[1]=this._parseColor(t.red,e.DEFAULT_ANSI_COLORS[1]),this.colors.ansi[2]=this._parseColor(t.green,e.DEFAULT_ANSI_COLORS[2]),this.colors.ansi[3]=this._parseColor(t.yellow,e.DEFAULT_ANSI_COLORS[3]),this.colors.ansi[4]=this._parseColor(t.blue,e.DEFAULT_ANSI_COLORS[4]),this.colors.ansi[5]=this._parseColor(t.magenta,e.DEFAULT_ANSI_COLORS[5]),this.colors.ansi[6]=this._parseColor(t.cyan,e.DEFAULT_ANSI_COLORS[6]),this.colors.ansi[7]=this._parseColor(t.white,e.DEFAULT_ANSI_COLORS[7]),this.colors.ansi[8]=this._parseColor(t.brightBlack,e.DEFAULT_ANSI_COLORS[8]),this.colors.ansi[9]=this._parseColor(t.brightRed,e.DEFAULT_ANSI_COLORS[9]),this.colors.ansi[10]=this._parseColor(t.brightGreen,e.DEFAULT_ANSI_COLORS[10]),this.colors.ansi[11]=this._parseColor(t.brightYellow,e.DEFAULT_ANSI_COLORS[11]),this.colors.ansi[12]=this._parseColor(t.brightBlue,e.DEFAULT_ANSI_COLORS[12]),this.colors.ansi[13]=this._parseColor(t.brightMagenta,e.DEFAULT_ANSI_COLORS[13]),this.colors.ansi[14]=this._parseColor(t.brightCyan,e.DEFAULT_ANSI_COLORS[14]),this.colors.ansi[15]=this._parseColor(t.brightWhite,e.DEFAULT_ANSI_COLORS[15]),this._contrastCache.clear()},t.prototype._parseColor=function(t,e,r){if(void 0===r&&(r=this.allowTransparency),void 0===t)return e;if(this._ctx.fillStyle=this._litmusColor,this._ctx.fillStyle=t,"string"!=typeof this._ctx.fillStyle)return console.warn("Color: "+t+" is invalid using fallback "+e.css),e;this._ctx.fillRect(0,0,1,1);var n=this._ctx.getImageData(0,0,1,1).data;if(255!==n[3]){if(!r)return console.warn("Color: "+t+" is using transparency, but allowTransparency is false. Using fallback "+e.css+"."),e;var o=void 0,s=void 0,a=void 0,h=void 0,c=void 0;if(5===t.length){var l=parseInt(t.substr(1),16);o=16*(l>>12&15),s=16*(l>>8&15),a=16*(l>>4&15),h=16*(15&l),c=i.toRgba(o,s,a,h)}else o=(c=parseInt(t.substr(1),16))>>24&255,s=c>>16&255,a=c>>8&255,h=255&c;return{rgba:c,css:i.toCss(o,s,a,h)}}return{css:t,rgba:i.toRgba(n[0],n[1],n[2],n[3])}},t}();e.ColorManager=l},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.throwIfFalsy=function(t){if(!t)throw new Error("value must not be falsy");return t}},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(6),s=r(3),a=r(5),h=function(t){function e(e,r,i){var n=t.call(this)||this;return n.content=0,n.combinedData="",n.fg=e.fg,n.bg=e.bg,n.combinedData=r,n._width=i,n}return n(e,t),e.prototype.isCombined=function(){return 2097152},e.prototype.getWidth=function(){return this._width},e.prototype.getChars=function(){return this.combinedData},e.prototype.getCode=function(){return 2097151},e.prototype.setFromCharData=function(t){throw new Error("not implemented")},e.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},e}(o.AttributeData);e.JoinedCellData=h;var c=function(){function t(t){this._bufferService=t,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new a.CellData}return t.prototype.registerCharacterJoiner=function(t){var e={id:this._nextCharacterJoinerId++,handler:t};return this._characterJoiners.push(e),e.id},t.prototype.deregisterCharacterJoiner=function(t){for(var e=0;e<this._characterJoiners.length;e++)if(this._characterJoiners[e].id===t)return this._characterJoiners.splice(e,1),!0;return!1},t.prototype.getJoinedCharacters=function(t){if(0===this._characterJoiners.length)return[];var e=this._bufferService.buffer.lines.get(t);if(!e||0===e.length)return[];for(var r=[],i=e.translateToString(!0),n=0,o=0,a=0,h=e.getFg(0),c=e.getBg(0),l=0;l<e.getTrimmedLength();l++)if(e.loadCell(l,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==h||this._workCell.bg!==c){if(l-n>1)for(var u=this._getJoinedRanges(i,a,o,e,n),p=0;p<u.length;p++)r.push(u[p]);n=l,a=o,h=this._workCell.fg,c=this._workCell.bg}o+=this._workCell.getChars().length||s.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-n>1)for(u=this._getJoinedRanges(i,a,o,e,n),p=0;p<u.length;p++)r.push(u[p]);return r},t.prototype._getJoinedRanges=function(e,r,i,n,o){for(var s=e.substring(r,i),a=this._characterJoiners[0].handler(s),h=1;h<this._characterJoiners.length;h++)for(var c=this._characterJoiners[h].handler(s),l=0;l<c.length;l++)t._mergeRanges(a,c[l]);return this._stringRangesToCellRanges(a,n,o),a},t.prototype._stringRangesToCellRanges=function(t,e,r){var i=0,n=!1,o=0,a=t[i];if(a){for(var h=r;h<this._bufferService.cols;h++){var c=e.getWidth(h),l=e.getString(h).length||s.WHITESPACE_CELL_CHAR.length;if(0!==c){if(!n&&a[0]<=o&&(a[0]=h,n=!0),a[1]<=o){if(a[1]=h,!(a=t[++i]))break;a[0]<=o?(a[0]=h,n=!0):n=!1}o+=l}}a&&(a[1]=this._bufferService.cols)}},t._mergeRanges=function(t,e){for(var r=!1,i=0;i<t.length;i++){var n=t[i];if(r){if(e[1]<=n[0])return t[i-1][1]=e[1],t;if(e[1]<=n[1])return t[i-1][1]=Math.max(e[1],n[1]),t.splice(i,1),t;t.splice(i,1),i--}else{if(e[1]<=n[0])return t.splice(i,0,e),t;if(e[1]<=n[1])return n[0]=Math.min(e[0],n[0]),t;e[0]<n[1]&&(n[0]=Math.min(e[0],n[0]),r=!0)}}return r?t[t.length-1][1]=e[1]:t.push(e),t},t}();e.CharacterJoinerRegistry=c},function(t,e,r){"use strict";function i(t,e){var r=e.getBoundingClientRect();return[t.clientX-r.left,t.clientY-r.top]}Object.defineProperty(e,"__esModule",{value:!0}),e.getCoordsRelativeToElement=i,e.getCoords=function(t,e,r,n,o,s,a,h){if(o){var c=i(t,e);if(c)return c[0]=Math.ceil((c[0]+(h?s/2:0))/s),c[1]=Math.ceil(c[1]/a),c[0]=Math.min(Math.max(c[0],1),r+(h?1:0)),c[1]=Math.min(Math.max(c[1],1),n),c}},e.getRawByteCoords=function(t){if(t)return{x:t[0]+32,y:t[1]+32}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._renderCallback=t}return t.prototype.dispose=function(){this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},t.prototype.refresh=function(t,e,r){var i=this;this._rowCount=r,t=void 0!==t?t:0,e=void 0!==e?e:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,t):t,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,e):e,this._animationFrame||(this._animationFrame=window.requestAnimationFrame((function(){return i._innerRefresh()})))},t.prototype._innerRefresh=function(){void 0!==this._rowStart&&void 0!==this._rowEnd&&void 0!==this._rowCount&&(this._rowStart=Math.max(this._rowStart,0),this._rowEnd=Math.min(this._rowEnd,this._rowCount-1),this._renderCallback(this._rowStart,this._rowEnd),this._rowStart=void 0,this._rowEnd=void 0,this._animationFrame=void 0)},t}();e.RenderDebouncer=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._currentDevicePixelRatio=window.devicePixelRatio,e}return n(e,t),e.prototype.setListener=function(t){var e=this;this._listener&&this.clearListener(),this._listener=t,this._outerListener=function(){e._listener&&(e._listener(window.devicePixelRatio,e._currentDevicePixelRatio),e._updateDpr())},this._updateDpr()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.clearListener()},e.prototype._updateDpr=function(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._currentDevicePixelRatio=window.devicePixelRatio,this._resolutionMediaMatchList=window.matchMedia("screen and (resolution: "+window.devicePixelRatio+"dppx)"),this._resolutionMediaMatchList.addListener(this._outerListener))},e.prototype.clearListener=function(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)},e}(r(2).Disposable);e.ScreenDprMonitor=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clone=function t(e,r){if(void 0===r&&(r=5),"object"!=typeof e)return e;var i=Array.isArray(e)?[]:{};for(var n in e)i[n]=r<=1?e[n]:e[n]?t(e[n],r-1):e[n];return i}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(34),n=r(17),o=r(78),s=function(){function t(t){this._core=new i.Terminal(t),this._addonManager=new o.AddonManager}return Object.defineProperty(t.prototype,"onCursorMove",{get:function(){return this._core.onCursorMove},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onLineFeed",{get:function(){return this._core.onLineFeed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSelectionChange",{get:function(){return this._core.onSelectionChange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onData",{get:function(){return this._core.onData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBinary",{get:function(){return this._core.onBinary},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTitleChange",{get:function(){return this._core.onTitleChange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onScroll",{get:function(){return this._core.onScroll},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onKey",{get:function(){return this._core.onKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRender",{get:function(){return this._core.onRender},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onResize",{get:function(){return this._core.onResize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._core.element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parser",{get:function(){return this._parser||(this._parser=new l(this._core)),this._parser},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textarea",{get:function(){return this._core.textarea},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._core.rows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cols",{get:function(){return this._core.cols},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return new a(this._core.buffer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"markers",{get:function(){return this._core.markers},enumerable:!0,configurable:!0}),t.prototype.blur=function(){this._core.blur()},t.prototype.focus=function(){this._core.focus()},t.prototype.resize=function(t,e){this._verifyIntegers(t,e),this._core.resize(t,e)},t.prototype.open=function(t){this._core.open(t)},t.prototype.attachCustomKeyEventHandler=function(t){this._core.attachCustomKeyEventHandler(t)},t.prototype.registerLinkMatcher=function(t,e,r){return this._core.registerLinkMatcher(t,e,r)},t.prototype.deregisterLinkMatcher=function(t){this._core.deregisterLinkMatcher(t)},t.prototype.registerCharacterJoiner=function(t){return this._core.registerCharacterJoiner(t)},t.prototype.deregisterCharacterJoiner=function(t){this._core.deregisterCharacterJoiner(t)},t.prototype.addMarker=function(t){return this._verifyIntegers(t),this._core.addMarker(t)},t.prototype.hasSelection=function(){return this._core.hasSelection()},t.prototype.select=function(t,e,r){this._verifyIntegers(t,e,r),this._core.select(t,e,r)},t.prototype.getSelection=function(){return this._core.getSelection()},t.prototype.getSelectionPosition=function(){return this._core.getSelectionPosition()},t.prototype.clearSelection=function(){this._core.clearSelection()},t.prototype.selectAll=function(){this._core.selectAll()},t.prototype.selectLines=function(t,e){this._verifyIntegers(t,e),this._core.selectLines(t,e)},t.prototype.dispose=function(){this._addonManager.dispose(),this._core.dispose()},t.prototype.scrollLines=function(t){this._verifyIntegers(t),this._core.scrollLines(t)},t.prototype.scrollPages=function(t){this._verifyIntegers(t),this._core.scrollPages(t)},t.prototype.scrollToTop=function(){this._core.scrollToTop()},t.prototype.scrollToBottom=function(){this._core.scrollToBottom()},t.prototype.scrollToLine=function(t){this._verifyIntegers(t),this._core.scrollToLine(t)},t.prototype.clear=function(){this._core.clear()},t.prototype.write=function(t,e){this._core.write(t,e)},t.prototype.writeUtf8=function(t,e){this._core.write(t,e)},t.prototype.writeln=function(t,e){this._core.write(t),this._core.write("\r\n",e)},t.prototype.paste=function(t){this._core.paste(t)},t.prototype.getOption=function(t){return this._core.optionsService.getOption(t)},t.prototype.setOption=function(t,e){this._core.optionsService.setOption(t,e)},t.prototype.refresh=function(t,e){this._verifyIntegers(t,e),this._core.refresh(t,e)},t.prototype.reset=function(){this._core.reset()},t.prototype.loadAddon=function(t){return this._addonManager.loadAddon(this,t)},Object.defineProperty(t,"strings",{get:function(){return n},enumerable:!0,configurable:!0}),t.prototype._verifyIntegers=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.forEach((function(t){if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}))},t}();e.Terminal=s;var a=function(){function t(t){this._buffer=t}return Object.defineProperty(t.prototype,"cursorY",{get:function(){return this._buffer.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursorX",{get:function(){return this._buffer.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewportY",{get:function(){return this._buffer.ydisp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseY",{get:function(){return this._buffer.ybase},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._buffer.lines.length},enumerable:!0,configurable:!0}),t.prototype.getLine=function(t){var e=this._buffer.lines.get(t);if(e)return new h(e)},t}(),h=function(){function t(t){this._line=t}return Object.defineProperty(t.prototype,"isWrapped",{get:function(){return this._line.isWrapped},enumerable:!0,configurable:!0}),t.prototype.getCell=function(t){if(!(t<0||t>=this._line.length))return new c(this._line,t)},t.prototype.translateToString=function(t,e,r){return this._line.translateToString(t,e,r)},t}(),c=function(){function t(t,e){this._line=t,this._x=e}return Object.defineProperty(t.prototype,"char",{get:function(){return this._line.getString(this._x)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._line.getWidth(this._x)},enumerable:!0,configurable:!0}),t}(),l=function(){function t(t){this._core=t}return t.prototype.addCsiHandler=function(t,e){return this._core.addCsiHandler(t,(function(t){return e(t.toArray())}))},t.prototype.addDcsHandler=function(t,e){return this._core.addDcsHandler(t,(function(t,r){return e(t,r.toArray())}))},t.prototype.addEscHandler=function(t,e){return this._core.addEscHandler(t,e)},t.prototype.addOscHandler=function(t,e){return this._core.addOscHandler(t,e)},t}()},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(35),s=r(36),a=r(37),h=r(12),c=r(38),l=r(40),u=r(50),p=r(51),d=r(11),f=r(7),g=r(17),_=r(54),v=r(55),y=r(56),m=r(57),b=r(59),S=r(1),w=r(16),C=r(60),M=r(26),E=r(61),x=r(0),P=r(62),k=r(4),T=r(63),L=r(64),I=r(2),A=r(70),D=r(71),R=r(72),O=r(73),B=r(74),H=r(75),F=r(76),j=r(77),N="undefined"!=typeof window?window.document:null,W=function(t){function e(e){void 0===e&&(e={});var r=t.call(this)||this;return r.browser=d,r.mouseEvents=0,r._keyDownHandled=!1,r._blankLine=null,r._onCursorMove=new S.EventEmitter,r._onData=new S.EventEmitter,r._onBinary=new S.EventEmitter,r._onKey=new S.EventEmitter,r._onLineFeed=new S.EventEmitter,r._onRender=new S.EventEmitter,r._onResize=new S.EventEmitter,r._onScroll=new S.EventEmitter,r._onSelectionChange=new S.EventEmitter,r._onTitleChange=new S.EventEmitter,r._onFocus=new S.EventEmitter,r._onBlur=new S.EventEmitter,r.onA11yCharEmitter=new S.EventEmitter,r.onA11yTabEmitter=new S.EventEmitter,r._instantiationService=new B.InstantiationService,r.optionsService=new P.OptionsService(e),r._instantiationService.setService(x.IOptionsService,r.optionsService),r._bufferService=r._instantiationService.createInstance(L.BufferService),r._instantiationService.setService(x.IBufferService,r._bufferService),r._logService=r._instantiationService.createInstance(R.LogService),r._instantiationService.setService(x.ILogService,r._logService),r._coreService=r._instantiationService.createInstance(D.CoreService,(function(){return r.scrollToBottom()})),r._instantiationService.setService(x.ICoreService,r._coreService),r._coreService.onData((function(t){return r._onData.fire(t)})),r._coreService.onBinary((function(t){return r._onBinary.fire(t)})),r._coreMouseService=r._instantiationService.createInstance(H.CoreMouseService),r._instantiationService.setService(x.ICoreMouseService,r._coreMouseService),r._dirtyRowService=r._instantiationService.createInstance(O.DirtyRowService),r._instantiationService.setService(x.IDirtyRowService,r._dirtyRowService),r._setupOptionsListeners(),r._setup(),r._writeBuffer=new F.WriteBuffer((function(t){return r._inputHandler.parse(t)})),r}return n(e,t),Object.defineProperty(e.prototype,"options",{get:function(){return this.optionsService.options},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cols",{get:function(){return this._bufferService.cols},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._bufferService.rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onData",{get:function(){return this._onData.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBinary",{get:function(){return this._onBinary.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onKey",{get:function(){return this._onKey.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onResize",{get:function(){return this._onResize.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onTitleChange",{get:function(){return this._onTitleChange.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onFocus",{get:function(){return this._onFocus.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBlur",{get:function(){return this._onBlur.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onA11yChar",{get:function(){return this.onA11yCharEmitter.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onA11yTab",{get:function(){return this.onA11yTabEmitter.event},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e,r,i,n;this._isDisposed||(t.prototype.dispose.call(this),null===(e=this._windowsMode)||void 0===e||e.dispose(),this._windowsMode=void 0,null===(r=this._renderService)||void 0===r||r.dispose(),this._customKeyEventHandler=null,this.write=function(){},null===(n=null===(i=this.element)||void 0===i?void 0:i.parentNode)||void 0===n||n.removeChild(this.element))},e.prototype._setup=function(){var t=this;this._parent=N?N.body:null,this._customKeyEventHandler=null,this.applicationKeypad=!1,this.originMode=!1,this.insertMode=!1,this.wraparoundMode=!0,this.bracketedPasteMode=!1,this.charset=null,this.gcharset=null,this.glevel=0,this.charsets=[null],this.curAttrData=w.DEFAULT_ATTR_DATA.clone(),this._eraseAttrData=w.DEFAULT_ATTR_DATA.clone(),this.params=[],this.currentParam=0,this._userScrolling=!1,this._inputHandler=new c.InputHandler(this,this._bufferService,this._coreService,this._dirtyRowService,this._logService,this.optionsService,this._coreMouseService),this._inputHandler.onCursorMove((function(){return t._onCursorMove.fire()})),this._inputHandler.onLineFeed((function(){return t._onLineFeed.fire()})),this.register(this._inputHandler),this.linkifier=this.linkifier||new u.Linkifier(this._bufferService,this._logService),this.options.windowsMode&&this._enableWindowsMode()},e.prototype._enableWindowsMode=function(){this._windowsMode||(this._windowsMode=this.onLineFeed(C.handleWindowsModeLineFeed.bind(null,this._bufferService)))},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.buffers.active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{get:function(){return this._bufferService.buffers},enumerable:!0,configurable:!0}),e.prototype.eraseAttrData=function(){return this._eraseAttrData.bg&=-67108864,this._eraseAttrData.bg|=67108863&this.curAttrData.bg,this._eraseAttrData},e.prototype.focus=function(){this.textarea&&this.textarea.focus({preventScroll:!0})},e.prototype._setupOptionsListeners=function(){var t=this;this.optionsService.onOptionChange((function(e){var r,i,n,o,s;switch(e){case"fontFamily":case"fontSize":null===(r=t._renderService)||void 0===r||r.clear(),null===(i=t._charSizeService)||void 0===i||i.measure();break;case"drawBoldTextInBrightColors":case"letterSpacing":case"lineHeight":case"fontWeight":case"fontWeightBold":case"minimumContrastRatio":t._renderService&&(t._renderService.clear(),t._renderService.onResize(t.cols,t.rows),t.refresh(0,t.rows-1));break;case"rendererType":t._renderService&&(t._renderService.setRenderer(t._createRenderer()),t._renderService.onResize(t.cols,t.rows));break;case"scrollback":t.buffers.resize(t.cols,t.rows),null===(n=t.viewport)||void 0===n||n.syncScrollArea();break;case"screenReaderMode":t.optionsService.options.screenReaderMode?!t._accessibilityManager&&t._renderService&&(t._accessibilityManager=new y.AccessibilityManager(t,t._renderService)):(null===(o=t._accessibilityManager)||void 0===o||o.dispose(),t._accessibilityManager=null);break;case"tabStopWidth":t.buffers.setupTabStops();break;case"theme":t._setTheme(t.optionsService.options.theme);break;case"windowsMode":t.optionsService.options.windowsMode?t._enableWindowsMode():(null===(s=t._windowsMode)||void 0===s||s.dispose(),t._windowsMode=void 0)}}))},e.prototype._onTextAreaFocus=function(t){this.sendFocus&&this._coreService.triggerDataEvent(h.C0.ESC+"[I"),this.updateCursorStyle(t),this.element.classList.add("focus"),this.showCursor(),this._onFocus.fire()},e.prototype.blur=function(){return this.textarea.blur()},e.prototype._onTextAreaBlur=function(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.sendFocus&&this._coreService.triggerDataEvent(h.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()},e.prototype._initGlobal=function(){var t=this;this._bindKeys(),this.register(f.addDisposableDomListener(this.element,"copy",(function(e){t.hasSelection()&&a.copyHandler(e,t._selectionService)})));var e=function(e){return a.handlePasteEvent(e,t.textarea,t.bracketedPasteMode,t._coreService)};this.register(f.addDisposableDomListener(this.textarea,"paste",e)),this.register(f.addDisposableDomListener(this.element,"paste",e)),d.isFirefox?this.register(f.addDisposableDomListener(this.element,"mousedown",(function(e){2===e.button&&a.rightClickHandler(e,t.textarea,t.screenElement,t._selectionService,t.options.rightClickSelectsWord)}))):this.register(f.addDisposableDomListener(this.element,"contextmenu",(function(e){a.rightClickHandler(e,t.textarea,t.screenElement,t._selectionService,t.options.rightClickSelectsWord)}))),d.isLinux&&this.register(f.addDisposableDomListener(this.element,"auxclick",(function(e){1===e.button&&a.moveTextAreaUnderMouseCursor(e,t.textarea,t.screenElement)})))},e.prototype._bindKeys=function(){var t=this;this.register(f.addDisposableDomListener(this.textarea,"keyup",(function(e){return t._keyUp(e)}),!0)),this.register(f.addDisposableDomListener(this.textarea,"keydown",(function(e){return t._keyDown(e)}),!0)),this.register(f.addDisposableDomListener(this.textarea,"keypress",(function(e){return t._keyPress(e)}),!0)),this.register(f.addDisposableDomListener(this.textarea,"compositionstart",(function(){return t._compositionHelper.compositionstart()}))),this.register(f.addDisposableDomListener(this.textarea,"compositionupdate",(function(e){return t._compositionHelper.compositionupdate(e)}))),this.register(f.addDisposableDomListener(this.textarea,"compositionend",(function(){return t._compositionHelper.compositionend()}))),this.register(this.onRender((function(){return t._compositionHelper.updateCompositionElements()}))),this.register(this.onRender((function(e){return t._queueLinkification(e.start,e.end)})))},e.prototype.open=function(t){var e=this;if(this._parent=t||this._parent,!this._parent)throw new Error("Terminal requires a parent element.");N.body.contains(t)||this._logService.warn("Terminal.open was called on an element that was not attached to the DOM"),this._document=this._parent.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),this.element.setAttribute("tabindex","0"),this._parent.appendChild(this.element);var r=N.createDocumentFragment();this._viewportElement=N.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),r.appendChild(this._viewportElement),this._viewportScrollArea=N.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=N.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=N.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),r.appendChild(this.screenElement),this.textarea=N.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",g.promptLabel),this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this.register(f.addDisposableDomListener(this.textarea,"focus",(function(t){return e._onTextAreaFocus(t)}))),this.register(f.addDisposableDomListener(this.textarea,"blur",(function(){return e._onTextAreaBlur()}))),this._helperContainer.appendChild(this.textarea);var i=this._instantiationService.createInstance(j.CoreBrowserService,this.textarea);this._instantiationService.setService(k.ICoreBrowserService,i),this._charSizeService=this._instantiationService.createInstance(T.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(k.ICharSizeService,this._charSizeService),this._compositionView=N.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(o.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(r),this._theme=this.options.theme||this._theme,this.options.theme=void 0,this._colorManager=new M.ColorManager(N,this.options.allowTransparency),this.optionsService.onOptionChange((function(t){return e._colorManager.onOptionsChange(t)})),this._colorManager.setTheme(this._theme);var n=this._createRenderer();this._renderService=this._instantiationService.createInstance(E.RenderService,n,this.rows,this.screenElement),this._instantiationService.setService(k.IRenderService,this._renderService),this._renderService.onRender((function(t){return e._onRender.fire(t)})),this.onResize((function(t){return e._renderService.resize(t.cols,t.rows)})),this._soundService=this._instantiationService.createInstance(_.SoundService),this._instantiationService.setService(k.ISoundService,this._soundService),this._mouseService=this._instantiationService.createInstance(A.MouseService),this._instantiationService.setService(k.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(s.Viewport,(function(t,r){return e.scrollLines(t,r)}),this._viewportElement,this._viewportScrollArea),this.viewport.onThemeChange(this._colorManager.colors),this.register(this.viewport),this.register(this.onCursorMove((function(){return e._renderService.onCursorMove()}))),this.register(this.onResize((function(){return e._renderService.onResize(e.cols,e.rows)}))),this.register(this.onBlur((function(){return e._renderService.onBlur()}))),this.register(this.onFocus((function(){return e._renderService.onFocus()}))),this.register(this._renderService.onDimensionsChange((function(){return e.viewport.syncScrollArea()}))),this._selectionService=this._instantiationService.createInstance(p.SelectionService,(function(t,r){return e.scrollLines(t,r)}),this.element,this.screenElement),this._instantiationService.setService(k.ISelectionService,this._selectionService),this.register(this._selectionService.onSelectionChange((function(){return e._onSelectionChange.fire()}))),this.register(this._selectionService.onRedrawRequest((function(t){return e._renderService.onSelectionChanged(t.start,t.end,t.columnSelectMode)}))),this.register(this._selectionService.onLinuxMouseSelection((function(t){e.textarea.value=t,e.textarea.focus(),e.textarea.select()}))),this.register(this.onScroll((function(){e.viewport.syncScrollArea(),e._selectionService.refresh()}))),this.register(f.addDisposableDomListener(this._viewportElement,"scroll",(function(){return e._selectionService.refresh()}))),this._mouseZoneManager=this._instantiationService.createInstance(v.MouseZoneManager,this.element,this.screenElement),this.register(this._mouseZoneManager),this.register(this.onScroll((function(){return e._mouseZoneManager.clearAll()}))),this.linkifier.attachToDom(this.element,this._mouseZoneManager),this.register(f.addDisposableDomListener(this.element,"mousedown",(function(t){return e._selectionService.onMouseDown(t)}))),this.mouseEvents?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager=new y.AccessibilityManager(this,this._renderService)),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()},e.prototype._createRenderer=function(){switch(this.options.rendererType){case"canvas":return this._instantiationService.createInstance(l.Renderer,this._colorManager.colors,this.screenElement,this.linkifier);case"dom":return this._instantiationService.createInstance(m.DomRenderer,this._colorManager.colors,this.element,this.screenElement,this._viewportElement,this.linkifier);default:throw new Error('Unrecognized rendererType "'+this.options.rendererType+'"')}},e.prototype._setTheme=function(t){var e,r,i;this._theme=t,null===(e=this._colorManager)||void 0===e||e.setTheme(t),null===(r=this._renderService)||void 0===r||r.setColors(this._colorManager.colors),null===(i=this.viewport)||void 0===i||i.onThemeChange(this._colorManager.colors)},e.prototype.bindMouse=function(){var t=this,e=this,r=this.element;function i(t){var r,i,n;if(!(r=e._mouseService.getRawByteCoords(t,e.screenElement,e.cols,e.rows)))return!1;switch(t.overrideType||t.type){case"mousemove":n=32,void 0===t.buttons?(i=3,void 0!==t.button&&(i=t.button<3?t.button:3)):i=1&t.buttons?0:4&t.buttons?1:2&t.buttons?2:3;break;case"mouseup":n=0,i=t.button<3?t.button:3;break;case"mousedown":n=1,i=t.button<3?t.button:3;break;case"wheel":0!==t.deltaY&&(n=t.deltaY<0?0:1),i=4;break;default:return!1}return!(void 0===n||void 0===i||i>4)&&e._coreMouseService.triggerMouseEvent({col:r.x-33,row:r.y-33,button:i,action:n,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey})}var n={mouseup:null,wheel:null,mousedrag:null,mousemove:null},o=function(e){return i(e),e.buttons||(t._document.removeEventListener("mouseup",n.mouseup),n.mousedrag&&t._document.removeEventListener("mousemove",n.mousedrag)),t.cancel(e)},s=function(e){return i(e),e.preventDefault(),t.cancel(e)},a=function(t){t.buttons&&i(t)},c=function(t){t.buttons||i(t)};this._coreMouseService.onProtocolChange((function(e){t.mouseEvents=e,e?("debug"===t.optionsService.options.logLevel&&t._logService.debug("Binding to mouse events:",t._coreMouseService.explainEvents(e)),t.element.classList.add("enable-mouse-events"),t._selectionService.disable()):(t._logService.debug("Unbinding from mouse events."),t.element.classList.remove("enable-mouse-events"),t._selectionService.enable()),8&e?n.mousemove||(r.addEventListener("mousemove",c),n.mousemove=c):(r.removeEventListener("mousemove",n.mousemove),n.mousemove=null),16&e?n.wheel||(r.addEventListener("wheel",s),n.wheel=s):(r.removeEventListener("wheel",n.wheel),n.wheel=null),2&e?n.mouseup||(n.mouseup=o):(t._document.removeEventListener("mouseup",n.mouseup),n.mouseup=null),4&e?n.mousedrag||(n.mousedrag=a):(t._document.removeEventListener("mousemove",n.mousedrag),n.mousedrag=null)})),this._coreMouseService.activeProtocol=this._coreMouseService.activeProtocol,this.register(f.addDisposableDomListener(r,"mousedown",(function(e){if(e.preventDefault(),t.focus(),t.mouseEvents&&!t._selectionService.shouldForceSelection(e))return i(e),n.mouseup&&t._document.addEventListener("mouseup",n.mouseup),n.mousedrag&&t._document.addEventListener("mousemove",n.mousedrag),t.cancel(e)}))),this.register(f.addDisposableDomListener(r,"wheel",(function(e){if(n.wheel);else if(!t.buffer.hasScrollback){var r=t.viewport.getLinesScrolled(e);if(0===r)return;for(var i=h.C0.ESC+(t._coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(e.deltaY<0?"A":"B"),o="",s=0;s<Math.abs(r);s++)o+=i;t._coreService.triggerDataEvent(o,!0)}}))),this.register(f.addDisposableDomListener(r,"wheel",(function(e){if(!n.wheel)return t.viewport.onWheel(e)?void 0:t.cancel(e)}))),this.register(f.addDisposableDomListener(r,"touchstart",(function(e){if(!t.mouseEvents)return t.viewport.onTouchStart(e),t.cancel(e)}))),this.register(f.addDisposableDomListener(r,"touchmove",(function(e){if(!t.mouseEvents)return t.viewport.onTouchMove(e)?void 0:t.cancel(e)})))},e.prototype.refresh=function(t,e){var r;null===(r=this._renderService)||void 0===r||r.refreshRows(t,e)},e.prototype._queueLinkification=function(t,e){var r;null===(r=this.linkifier)||void 0===r||r.linkifyRows(t,e)},e.prototype.updateCursorStyle=function(t){this._selectionService&&this._selectionService.shouldColumnSelect(t)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")},e.prototype.showCursor=function(){this._coreService.isCursorInitialized||(this._coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))},e.prototype.scroll=function(t){var e;void 0===t&&(t=!1),e=this._blankLine;var r=this.eraseAttrData();e&&e.length===this.cols&&e.getFg(0)===r.fg&&e.getBg(0)===r.bg||(e=this.buffer.getBlankLine(r,t),this._blankLine=e),e.isWrapped=t;var i=this.buffer.ybase+this.buffer.scrollTop,n=this.buffer.ybase+this.buffer.scrollBottom;if(0===this.buffer.scrollTop){var o=this.buffer.lines.isFull;n===this.buffer.lines.length-1?o?this.buffer.lines.recycle().copyFrom(e):this.buffer.lines.push(e.clone()):this.buffer.lines.splice(n+1,0,e.clone()),o?this._userScrolling&&(this.buffer.ydisp=Math.max(this.buffer.ydisp-1,0)):(this.buffer.ybase++,this._userScrolling||this.buffer.ydisp++)}else{var s=n-i+1;this.buffer.lines.shiftElements(i+1,s-1,-1),this.buffer.lines.set(n,e.clone())}this._userScrolling||(this.buffer.ydisp=this.buffer.ybase),this._dirtyRowService.markRangeDirty(this.buffer.scrollTop,this.buffer.scrollBottom),this._onScroll.fire(this.buffer.ydisp)},e.prototype.scrollLines=function(t,e){if(t<0){if(0===this.buffer.ydisp)return;this._userScrolling=!0}else t+this.buffer.ydisp>=this.buffer.ybase&&(this._userScrolling=!1);var r=this.buffer.ydisp;this.buffer.ydisp=Math.max(Math.min(this.buffer.ydisp+t,this.buffer.ybase),0),r!==this.buffer.ydisp&&(e||this._onScroll.fire(this.buffer.ydisp),this.refresh(0,this.rows-1))},e.prototype.scrollPages=function(t){this.scrollLines(t*(this.rows-1))},e.prototype.scrollToTop=function(){this.scrollLines(-this.buffer.ydisp)},e.prototype.scrollToBottom=function(){this.scrollLines(this.buffer.ybase-this.buffer.ydisp)},e.prototype.scrollToLine=function(t){var e=t-this.buffer.ydisp;0!==e&&this.scrollLines(e)},e.prototype.paste=function(t){a.paste(t,this.textarea,this.bracketedPasteMode,this._coreService)},e.prototype.attachCustomKeyEventHandler=function(t){this._customKeyEventHandler=t},e.prototype.addEscHandler=function(t,e){return this._inputHandler.addEscHandler(t,e)},e.prototype.addDcsHandler=function(t,e){return this._inputHandler.addDcsHandler(t,e)},e.prototype.addCsiHandler=function(t,e){return this._inputHandler.addCsiHandler(t,e)},e.prototype.addOscHandler=function(t,e){return this._inputHandler.addOscHandler(t,e)},e.prototype.registerLinkMatcher=function(t,e,r){var i=this.linkifier.registerLinkMatcher(t,e,r);return this.refresh(0,this.rows-1),i},e.prototype.deregisterLinkMatcher=function(t){this.linkifier.deregisterLinkMatcher(t)&&this.refresh(0,this.rows-1)},e.prototype.registerCharacterJoiner=function(t){var e=this._renderService.registerCharacterJoiner(t);return this.refresh(0,this.rows-1),e},e.prototype.deregisterCharacterJoiner=function(t){this._renderService.deregisterCharacterJoiner(t)&&this.refresh(0,this.rows-1)},Object.defineProperty(e.prototype,"markers",{get:function(){return this.buffer.markers},enumerable:!0,configurable:!0}),e.prototype.addMarker=function(t){if(this.buffer===this.buffers.normal)return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+t)},e.prototype.hasSelection=function(){return!!this._selectionService&&this._selectionService.hasSelection},e.prototype.select=function(t,e,r){this._selectionService.setSelection(t,e,r)},e.prototype.getSelection=function(){return this._selectionService?this._selectionService.selectionText:""},e.prototype.getSelectionPosition=function(){if(this._selectionService.hasSelection)return{startColumn:this._selectionService.selectionStart[0],startRow:this._selectionService.selectionStart[1],endColumn:this._selectionService.selectionEnd[0],endRow:this._selectionService.selectionEnd[1]}},e.prototype.clearSelection=function(){var t;null===(t=this._selectionService)||void 0===t||t.clearSelection()},e.prototype.selectAll=function(){var t;null===(t=this._selectionService)||void 0===t||t.selectAll()},e.prototype.selectLines=function(t,e){var r;null===(r=this._selectionService)||void 0===r||r.selectLines(t,e)},e.prototype._keyDown=function(t){if(this._keyDownHandled=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(t))return!1;if(!this._compositionHelper.keydown(t))return this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;var e=b.evaluateKeyboardEvent(t,this._coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(t),3===e.type||2===e.type){var r=this.rows-1;return this.scrollLines(2===e.type?-r:r),this.cancel(t,!0)}return 1===e.type&&this.selectAll(),!!this._isThirdLevelShift(this.browser,t)||(e.cancel&&this.cancel(t,!0),!e.key||(e.key!==h.C0.ETX&&e.key!==h.C0.CR||(this.textarea.value=""),this._onKey.fire({key:e.key,domEvent:t}),this.showCursor(),this._coreService.triggerDataEvent(e.key,!0),this.optionsService.options.screenReaderMode?void(this._keyDownHandled=!0):this.cancel(t,!0)))},e.prototype._isThirdLevelShift=function(t,e){var r=t.isMac&&!this.options.macOptionIsMeta&&e.altKey&&!e.ctrlKey&&!e.metaKey||t.isWindows&&e.altKey&&e.ctrlKey&&!e.metaKey;return"keypress"===e.type?r:r&&(!e.keyCode||e.keyCode>47)},e.prototype.setgLevel=function(t){this.glevel=t,this.charset=this.charsets[t]},e.prototype.setgCharset=function(t,e){this.charsets[t]=e,this.glevel===t&&(this.charset=e)},e.prototype._keyUp=function(t){this._customKeyEventHandler&&!1===this._customKeyEventHandler(t)||(function(t){return 16===t.keyCode||17===t.keyCode||18===t.keyCode}(t)||this.focus(),this.updateCursorStyle(t))},e.prototype._keyPress=function(t){var e;if(this._keyDownHandled)return!1;if(this._customKeyEventHandler&&!1===this._customKeyEventHandler(t))return!1;if(this.cancel(t),t.charCode)e=t.charCode;else if(null===t.which||void 0===t.which)e=t.keyCode;else{if(0===t.which||0===t.charCode)return!1;e=t.which}return!(!e||(t.altKey||t.ctrlKey||t.metaKey)&&!this._isThirdLevelShift(this.browser,t)||(e=String.fromCharCode(e),this._onKey.fire({key:e,domEvent:t}),this.showCursor(),this._coreService.triggerDataEvent(e,!0),0))},e.prototype.bell=function(){var t=this;this._soundBell()&&this._soundService.playBellSound(),this._visualBell()&&(this.element.classList.add("visual-bell-active"),clearTimeout(this._visualBellTimer),this._visualBellTimer=window.setTimeout((function(){t.element.classList.remove("visual-bell-active")}),200))},e.prototype.resize=function(t,e){var r;isNaN(t)||isNaN(e)||(t!==this.cols||e!==this.rows?(t<L.MINIMUM_COLS&&(t=L.MINIMUM_COLS),e<L.MINIMUM_ROWS&&(e=L.MINIMUM_ROWS),this.buffers.resize(t,e),this._bufferService.resize(t,e),this.buffers.setupTabStops(this.cols),null===(r=this._charSizeService)||void 0===r||r.measure(),this.viewport.syncScrollArea(!0),this.refresh(0,this.rows-1),this._onResize.fire({cols:t,rows:e})):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure())},e.prototype.clear=function(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(var t=1;t<this.rows;t++)this.buffer.lines.push(this.buffer.getBlankLine(w.DEFAULT_ATTR_DATA));this.refresh(0,this.rows-1),this._onScroll.fire(this.buffer.ydisp)}},e.prototype.is=function(t){return 0===(this.options.termName+"").indexOf(t)},e.prototype.handleTitle=function(t){this._onTitleChange.fire(t)},e.prototype.reset=function(){var t,e;this.options.rows=this.rows,this.options.cols=this.cols;var r=this._customKeyEventHandler,i=this._inputHandler,n=this._userScrolling;this._setup(),this._bufferService.reset(),this._coreService.reset(),this._coreMouseService.reset(),null===(t=this._selectionService)||void 0===t||t.reset(),this._customKeyEventHandler=r,this._inputHandler=i,this._userScrolling=n,this.refresh(0,this.rows-1),null===(e=this.viewport)||void 0===e||e.syncScrollArea()},e.prototype.cancel=function(t,e){if(this.options.cancelEvents||e)return t.preventDefault(),t.stopPropagation(),!1},e.prototype._visualBell=function(){return!1},e.prototype._soundBell=function(){return"sound"===this.options.bellStyle},e.prototype.write=function(t,e){this._writeBuffer.write(t,e)},e.prototype.writeSync=function(t){this._writeBuffer.writeSync(t)},e}(I.Disposable);e.Terminal=W},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),s=r(0),a=function(){function t(t,e,r,i,n,o){this._textarea=t,this._compositionView=e,this._bufferService=r,this._optionsService=i,this._charSizeService=n,this._coreService=o,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0}}return t.prototype.compositionstart=function(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._compositionView.classList.add("active")},t.prototype.compositionupdate=function(t){var e=this;this._compositionView.textContent=t.data,this.updateCompositionElements(),setTimeout((function(){e._compositionPosition.end=e._textarea.value.length}),0)},t.prototype.compositionend=function(){this._finalizeComposition(!0)},t.prototype.keydown=function(t){if(this._isComposing||this._isSendingComposition){if(229===t.keyCode)return!1;if(16===t.keyCode||17===t.keyCode||18===t.keyCode)return!1;this._finalizeComposition(!1)}return 229!==t.keyCode||(this._handleAnyTextareaChanges(),!1)},t.prototype._finalizeComposition=function(t){var e=this;if(this._compositionView.classList.remove("active"),this._isComposing=!1,this._clearTextareaPosition(),t){var r={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((function(){var t;e._isSendingComposition&&(e._isSendingComposition=!1,t=e._isComposing?e._textarea.value.substring(r.start,r.end):e._textarea.value.substring(r.start),e._coreService.triggerDataEvent(t,!0))}),0)}else{this._isSendingComposition=!1;var i=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(i,!0)}},t.prototype._handleAnyTextareaChanges=function(){var t=this,e=this._textarea.value;setTimeout((function(){if(!t._isComposing){var r=t._textarea.value.replace(e,"");r.length>0&&t._coreService.triggerDataEvent(r,!0)}}),0)},t.prototype.updateCompositionElements=function(t){var e=this;if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){var r=Math.ceil(this._charSizeService.height*this._optionsService.options.lineHeight),i=this._bufferService.buffer.y*r,n=this._bufferService.buffer.x*this._charSizeService.width;this._compositionView.style.left=n+"px",this._compositionView.style.top=i+"px",this._compositionView.style.height=r+"px",this._compositionView.style.lineHeight=r+"px",this._compositionView.style.fontFamily=this._optionsService.options.fontFamily,this._compositionView.style.fontSize=this._optionsService.options.fontSize+"px";var o=this._compositionView.getBoundingClientRect();this._textarea.style.left=n+"px",this._textarea.style.top=i+"px",this._textarea.style.width=o.width+"px",this._textarea.style.height=o.height+"px",this._textarea.style.lineHeight=o.height+"px"}t||setTimeout((function(){return e.updateCompositionElements(!0)}),0)}},t.prototype._clearTextareaPosition=function(){this._textarea.style.left="",this._textarea.style.top=""},i([n(2,s.IBufferService),n(3,s.IOptionsService),n(4,o.ICharSizeService),n(5,s.ICoreService)],t)}();e.CompositionHelper=a},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},s=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(2),h=r(7),c=r(4),l=r(0),u=15,p=function(t){function e(e,r,i,n,o,s,a){var c=t.call(this)||this;return c._scrollLines=e,c._viewportElement=r,c._scrollArea=i,c._bufferService=n,c._optionsService=o,c._charSizeService=s,c._renderService=a,c.scrollBarWidth=0,c._currentRowHeight=0,c._lastRecordedBufferLength=0,c._lastRecordedViewportHeight=0,c._lastRecordedBufferHeight=0,c._lastTouchY=0,c._lastScrollTop=0,c._wheelPartialScroll=0,c._refreshAnimationFrame=null,c._ignoreNextScrollEvent=!1,c.scrollBarWidth=c._viewportElement.offsetWidth-c._scrollArea.offsetWidth||u,c.register(h.addDisposableDomListener(c._viewportElement,"scroll",c._onScroll.bind(c))),setTimeout((function(){return c.syncScrollArea()}),0),c}return n(e,t),e.prototype.onThemeChange=function(t){this._viewportElement.style.backgroundColor=t.background.css},e.prototype._refresh=function(t){var e=this;if(t)return this._innerRefresh(),void(null!==this._refreshAnimationFrame&&cancelAnimationFrame(this._refreshAnimationFrame));null===this._refreshAnimationFrame&&(this._refreshAnimationFrame=requestAnimationFrame((function(){return e._innerRefresh()})))},e.prototype._innerRefresh=function(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.scaledCellHeight/window.devicePixelRatio,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;var t=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.canvasHeight);this._lastRecordedBufferHeight!==t&&(this._lastRecordedBufferHeight=t,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}var e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==e&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=e),this._refreshAnimationFrame=null},e.prototype.syncScrollArea=function(t){if(void 0===t&&(t=!1),this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(t);if(this._lastRecordedViewportHeight===this._renderService.dimensions.canvasHeight){var e=this._bufferService.buffer.ydisp*this._currentRowHeight;this._lastScrollTop===e&&this._lastScrollTop===this._viewportElement.scrollTop&&this._renderService.dimensions.scaledCellHeight/window.devicePixelRatio===this._currentRowHeight||this._refresh(t)}else this._refresh(t)},e.prototype._onScroll=function(t){if(this._lastScrollTop=this._viewportElement.scrollTop,this._viewportElement.offsetParent)if(this._ignoreNextScrollEvent)this._ignoreNextScrollEvent=!1;else{var e=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._scrollLines(e,!0)}},e.prototype._bubbleScroll=function(t,e){var r=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(e<0&&0!==this._viewportElement.scrollTop||e>0&&r<this._lastRecordedBufferHeight)||(t.cancelable&&t.preventDefault(),!1)},e.prototype.onWheel=function(t){var e=this._getPixelsScrolled(t);return 0!==e&&(this._viewportElement.scrollTop+=e,this._bubbleScroll(t,e))},e.prototype._getPixelsScrolled=function(t){if(0===t.deltaY)return 0;var e=this._applyScrollModifier(t.deltaY,t);return t.deltaMode===WheelEvent.DOM_DELTA_LINE?e*=this._currentRowHeight:t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._currentRowHeight*this._bufferService.rows),e},e.prototype.getLinesScrolled=function(t){if(0===t.deltaY)return 0;var e=this._applyScrollModifier(t.deltaY,t);return t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(e/=this._currentRowHeight+0,this._wheelPartialScroll+=e,e=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):t.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._bufferService.rows),e},e.prototype._applyScrollModifier=function(t,e){var r=this._optionsService.options.fastScrollModifier;return"alt"===r&&e.altKey||"ctrl"===r&&e.ctrlKey||"shift"===r&&e.shiftKey?t*this._optionsService.options.fastScrollSensitivity*this._optionsService.options.scrollSensitivity:t*this._optionsService.options.scrollSensitivity},e.prototype.onTouchStart=function(t){this._lastTouchY=t.touches[0].pageY},e.prototype.onTouchMove=function(t){var e=this._lastTouchY-t.touches[0].pageY;return this._lastTouchY=t.touches[0].pageY,0!==e&&(this._viewportElement.scrollTop+=e,this._bubbleScroll(t,e))},o([s(3,l.IBufferService),s(4,l.IOptionsService),s(5,c.ICharSizeService),s(6,c.IRenderService)],e)}(a.Disposable);e.Viewport=p},function(t,e,r){"use strict";function i(t){return t.replace(/\r?\n/g,"\r")}function n(t,e){return e?"[200~"+t+"[201~":t}function o(t,e,r,o){t=n(t=i(t),r),o.triggerDataEvent(t,!0),e.value=""}function s(t,e,r){var i=r.getBoundingClientRect(),n=t.clientX-i.left-10,o=t.clientY-i.top-10;e.style.position="absolute",e.style.width="20px",e.style.height="20px",e.style.left=n+"px",e.style.top=o+"px",e.style.zIndex="1000",e.focus(),setTimeout((function(){e.style.position="",e.style.width="",e.style.height="",e.style.left="",e.style.top="",e.style.zIndex=""}),200)}Object.defineProperty(e,"__esModule",{value:!0}),e.prepareTextForTerminal=i,e.bracketTextForPaste=n,e.copyHandler=function(t,e){t.clipboardData&&t.clipboardData.setData("text/plain",e.selectionText),t.preventDefault()},e.handlePasteEvent=function(t,e,r,i){t.stopPropagation(),t.clipboardData&&o(t.clipboardData.getData("text/plain"),e,r,i)},e.paste=o,e.moveTextAreaUnderMouseCursor=s,e.rightClickHandler=function(t,e,r,i,n){s(t,e,r),n&&!i.isClickInSelection(t)&&i.selectWordAtCursor(t),e.value=i.selectionText,e.select()}},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(12),s=r(18),a=r(19),h=r(39),c=r(2),l=r(15),u=r(8),p=r(16),d=r(1),f=r(3),g=r(5),_=r(6),v=r(21),y=r(23),m={"(":0,")":1,"*":2,"+":3,"-":1,".":2},b=function(){function t(t,e,r,i){this._bufferService=t,this._coreService=e,this._logService=r,this._optionsService=i,this._data=new Uint32Array(0)}return t.prototype.hook=function(t){this._data=new Uint32Array(0)},t.prototype.put=function(t,e,r){this._data=l.concat(this._data,t.subarray(e,r))},t.prototype.unhook=function(t){if(t){var e=u.utf32ToString(this._data);switch(this._data=new Uint32Array(0),e){case'"q':return this._coreService.triggerDataEvent(o.C0.ESC+'P1$r0"q'+o.C0.ESC+"\\");case'"p':return this._coreService.triggerDataEvent(o.C0.ESC+'P1$r61"p'+o.C0.ESC+"\\");case"r":var r=this._bufferService.buffer.scrollTop+1+";"+(this._bufferService.buffer.scrollBottom+1)+"r";return this._coreService.triggerDataEvent(o.C0.ESC+"P1$r"+r+o.C0.ESC+"\\");case"m":return this._coreService.triggerDataEvent(o.C0.ESC+"P1$r0m"+o.C0.ESC+"\\");case" q":var i={block:2,underline:4,bar:6}[this._optionsService.options.cursorStyle];return i-=this._optionsService.options.cursorBlink?1:0,this._coreService.triggerDataEvent(o.C0.ESC+"P1$r"+i+" q"+o.C0.ESC+"\\");default:this._logService.debug("Unknown DCS $q %s",e),this._coreService.triggerDataEvent(o.C0.ESC+"P0$r"+o.C0.ESC+"\\")}}else this._data=new Uint32Array(0)},t}(),S=function(t){function e(e,r,i,n,a,c,l,p){void 0===p&&(p=new h.EscapeSequenceParser);var f=t.call(this)||this;f._terminal=e,f._bufferService=r,f._coreService=i,f._dirtyRowService=n,f._logService=a,f._optionsService=c,f._coreMouseService=l,f._parser=p,f._parseBuffer=new Uint32Array(4096),f._stringDecoder=new u.StringToUtf32,f._utf8Decoder=new u.Utf8ToUtf32,f._workCell=new g.CellData,f._onCursorMove=new d.EventEmitter,f._onLineFeed=new d.EventEmitter,f._onScroll=new d.EventEmitter,f.register(f._parser),f._parser.setCsiHandlerFallback((function(t,e){f._logService.debug("Unknown CSI code: ",{identifier:f._parser.identToString(t),params:e.toArray()})})),f._parser.setEscHandlerFallback((function(t){f._logService.debug("Unknown ESC code: ",{identifier:f._parser.identToString(t)})})),f._parser.setExecuteHandlerFallback((function(t){f._logService.debug("Unknown EXECUTE code: ",{code:t})})),f._parser.setOscHandlerFallback((function(t,e,r){f._logService.debug("Unknown OSC code: ",{identifier:t,action:e,data:r})})),f._parser.setDcsHandlerFallback((function(t,e,r){"HOOK"===e&&(r=r.toArray()),f._logService.debug("Unknown DCS code: ",{identifier:f._parser.identToString(t),action:e,payload:r})})),f._parser.setPrintHandler((function(t,e,r){return f.print(t,e,r)})),f._parser.setCsiHandler({final:"@"},(function(t){return f.insertChars(t)})),f._parser.setCsiHandler({intermediates:" ",final:"@"},(function(t){return f.scrollLeft(t)})),f._parser.setCsiHandler({final:"A"},(function(t){return f.cursorUp(t)})),f._parser.setCsiHandler({intermediates:" ",final:"A"},(function(t){return f.scrollRight(t)})),f._parser.setCsiHandler({final:"B"},(function(t){return f.cursorDown(t)})),f._parser.setCsiHandler({final:"C"},(function(t){return f.cursorForward(t)})),f._parser.setCsiHandler({final:"D"},(function(t){return f.cursorBackward(t)})),f._parser.setCsiHandler({final:"E"},(function(t){return f.cursorNextLine(t)})),f._parser.setCsiHandler({final:"F"},(function(t){return f.cursorPrecedingLine(t)})),f._parser.setCsiHandler({final:"G"},(function(t){return f.cursorCharAbsolute(t)})),f._parser.setCsiHandler({final:"H"},(function(t){return f.cursorPosition(t)})),f._parser.setCsiHandler({final:"I"},(function(t){return f.cursorForwardTab(t)})),f._parser.setCsiHandler({final:"J"},(function(t){return f.eraseInDisplay(t)})),f._parser.setCsiHandler({prefix:"?",final:"J"},(function(t){return f.eraseInDisplay(t)})),f._parser.setCsiHandler({final:"K"},(function(t){return f.eraseInLine(t)})),f._parser.setCsiHandler({prefix:"?",final:"K"},(function(t){return f.eraseInLine(t)})),f._parser.setCsiHandler({final:"L"},(function(t){return f.insertLines(t)})),f._parser.setCsiHandler({final:"M"},(function(t){return f.deleteLines(t)})),f._parser.setCsiHandler({final:"P"},(function(t){return f.deleteChars(t)})),f._parser.setCsiHandler({final:"S"},(function(t){return f.scrollUp(t)})),f._parser.setCsiHandler({final:"T"},(function(t){return f.scrollDown(t)})),f._parser.setCsiHandler({final:"X"},(function(t){return f.eraseChars(t)})),f._parser.setCsiHandler({final:"Z"},(function(t){return f.cursorBackwardTab(t)})),f._parser.setCsiHandler({final:"`"},(function(t){return f.charPosAbsolute(t)})),f._parser.setCsiHandler({final:"a"},(function(t){return f.hPositionRelative(t)})),f._parser.setCsiHandler({final:"b"},(function(t){return f.repeatPrecedingCharacter(t)})),f._parser.setCsiHandler({final:"c"},(function(t){return f.sendDeviceAttributesPrimary(t)})),f._parser.setCsiHandler({prefix:">",final:"c"},(function(t){return f.sendDeviceAttributesSecondary(t)})),f._parser.setCsiHandler({final:"d"},(function(t){return f.linePosAbsolute(t)})),f._parser.setCsiHandler({final:"e"},(function(t){return f.vPositionRelative(t)})),f._parser.setCsiHandler({final:"f"},(function(t){return f.hVPosition(t)})),f._parser.setCsiHandler({final:"g"},(function(t){return f.tabClear(t)})),f._parser.setCsiHandler({final:"h"},(function(t){return f.setMode(t)})),f._parser.setCsiHandler({prefix:"?",final:"h"},(function(t){return f.setModePrivate(t)})),f._parser.setCsiHandler({final:"l"},(function(t){return f.resetMode(t)})),f._parser.setCsiHandler({prefix:"?",final:"l"},(function(t){return f.resetModePrivate(t)})),f._parser.setCsiHandler({final:"m"},(function(t){return f.charAttributes(t)})),f._parser.setCsiHandler({final:"n"},(function(t){return f.deviceStatus(t)})),f._parser.setCsiHandler({prefix:"?",final:"n"},(function(t){return f.deviceStatusPrivate(t)})),f._parser.setCsiHandler({intermediates:"!",final:"p"},(function(t){return f.softReset(t)})),f._parser.setCsiHandler({intermediates:" ",final:"q"},(function(t){return f.setCursorStyle(t)})),f._parser.setCsiHandler({final:"r"},(function(t){return f.setScrollRegion(t)})),f._parser.setCsiHandler({final:"s"},(function(t){return f.saveCursor(t)})),f._parser.setCsiHandler({final:"u"},(function(t){return f.restoreCursor(t)})),f._parser.setCsiHandler({intermediates:"'",final:"}"},(function(t){return f.insertColumns(t)})),f._parser.setCsiHandler({intermediates:"'",final:"~"},(function(t){return f.deleteColumns(t)})),f._parser.setExecuteHandler(o.C0.BEL,(function(){return f.bell()})),f._parser.setExecuteHandler(o.C0.LF,(function(){return f.lineFeed()})),f._parser.setExecuteHandler(o.C0.VT,(function(){return f.lineFeed()})),f._parser.setExecuteHandler(o.C0.FF,(function(){return f.lineFeed()})),f._parser.setExecuteHandler(o.C0.CR,(function(){return f.carriageReturn()})),f._parser.setExecuteHandler(o.C0.BS,(function(){return f.backspace()})),f._parser.setExecuteHandler(o.C0.HT,(function(){return f.tab()})),f._parser.setExecuteHandler(o.C0.SO,(function(){return f.shiftOut()})),f._parser.setExecuteHandler(o.C0.SI,(function(){return f.shiftIn()})),f._parser.setExecuteHandler(o.C1.IND,(function(){return f.index()})),f._parser.setExecuteHandler(o.C1.NEL,(function(){return f.nextLine()})),f._parser.setExecuteHandler(o.C1.HTS,(function(){return f.tabSet()})),f._parser.setOscHandler(0,new v.OscHandler((function(t){return f.setTitle(t)}))),f._parser.setOscHandler(2,new v.OscHandler((function(t){return f.setTitle(t)}))),f._parser.setEscHandler({final:"7"},(function(){return f.saveCursor()})),f._parser.setEscHandler({final:"8"},(function(){return f.restoreCursor()})),f._parser.setEscHandler({final:"D"},(function(){return f.index()})),f._parser.setEscHandler({final:"E"},(function(){return f.nextLine()})),f._parser.setEscHandler({final:"H"},(function(){return f.tabSet()})),f._parser.setEscHandler({final:"M"},(function(){return f.reverseIndex()})),f._parser.setEscHandler({final:"="},(function(){return f.keypadApplicationMode()})),f._parser.setEscHandler({final:">"},(function(){return f.keypadNumericMode()})),f._parser.setEscHandler({final:"c"},(function(){return f.reset()})),f._parser.setEscHandler({final:"n"},(function(){return f.setgLevel(2)})),f._parser.setEscHandler({final:"o"},(function(){return f.setgLevel(3)})),f._parser.setEscHandler({final:"|"},(function(){return f.setgLevel(3)})),f._parser.setEscHandler({final:"}"},(function(){return f.setgLevel(2)})),f._parser.setEscHandler({final:"~"},(function(){return f.setgLevel(1)})),f._parser.setEscHandler({intermediates:"%",final:"@"},(function(){return f.selectDefaultCharset()})),f._parser.setEscHandler({intermediates:"%",final:"G"},(function(){return f.selectDefaultCharset()}));var _=function(t){y._parser.setEscHandler({intermediates:"(",final:t},(function(){return f.selectCharset("("+t)})),y._parser.setEscHandler({intermediates:")",final:t},(function(){return f.selectCharset(")"+t)})),y._parser.setEscHandler({intermediates:"*",final:t},(function(){return f.selectCharset("*"+t)})),y._parser.setEscHandler({intermediates:"+",final:t},(function(){return f.selectCharset("+"+t)})),y._parser.setEscHandler({intermediates:"-",final:t},(function(){return f.selectCharset("-"+t)})),y._parser.setEscHandler({intermediates:".",final:t},(function(){return f.selectCharset("."+t)})),y._parser.setEscHandler({intermediates:"/",final:t},(function(){return f.selectCharset("/"+t)}))},y=this;for(var m in s.CHARSETS)_(m);return f._parser.setEscHandler({intermediates:"#",final:"8"},(function(){return f.screenAlignmentPattern()})),f._parser.setErrorHandler((function(t){return f._logService.error("Parsing error: ",t),t})),f._parser.setDcsHandler({intermediates:"$",final:"q"},new b(f._bufferService,f._coreService,f._logService,f._optionsService)),f}return n(e,t),Object.defineProperty(e.prototype,"onCursorMove",{get:function(){return this._onCursorMove.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onLineFeed",{get:function(){return this._onLineFeed.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onScroll",{get:function(){return this._onScroll.event},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.dispose.call(this)},e.prototype.parse=function(t){var e=this._bufferService.buffer,r=e.x,i=e.y;if(this._logService.debug("parsing data",t),this._parseBuffer.length<t.length&&this._parseBuffer.length<131072&&(this._parseBuffer=new Uint32Array(Math.min(t.length,131072))),this._dirtyRowService.clearRange(),t.length>131072)for(var n=0;n<t.length;n+=131072){var o=n+131072<t.length?n+131072:t.length,s="string"==typeof t?this._stringDecoder.decode(t.substring(n,o),this._parseBuffer):this._utf8Decoder.decode(t.subarray(n,o),this._parseBuffer);this._parser.parse(this._parseBuffer,s)}else s="string"==typeof t?this._stringDecoder.decode(t,this._parseBuffer):this._utf8Decoder.decode(t,this._parseBuffer),this._parser.parse(this._parseBuffer,s);(e=this._bufferService.buffer).x===r&&e.y===i||this._onCursorMove.fire(),this._terminal.refresh(this._dirtyRowService.start,this._dirtyRowService.end)},e.prototype.print=function(t,e,r){var i,n,o=this._bufferService.buffer,s=this._terminal.charset,h=this._optionsService.options.screenReaderMode,c=this._bufferService.cols,l=this._terminal.wraparoundMode,p=this._terminal.insertMode,d=this._terminal.curAttrData,g=o.lines.get(o.y+o.ybase);this._dirtyRowService.markDirty(o.y);for(var _=e;_<r;++_){if(i=t[_],n=a.wcwidth(i),i<127&&s){var v=s[String.fromCharCode(i)];v&&(i=v.charCodeAt(0))}if(h&&this._terminal.onA11yCharEmitter.fire(u.stringFromCodePoint(i)),n||!o.x){if(o.x+n-1>=c)if(l)o.x=0,o.y++,o.y===o.scrollBottom+1?(o.y--,this._terminal.scroll(!0)):(o.y>=this._bufferService.rows&&(o.y=this._bufferService.rows-1),o.lines.get(o.y).isWrapped=!0),g=o.lines.get(o.y+o.ybase);else if(o.x=c-1,2===n)continue;if(p&&(g.insertCells(o.x,n,o.getNullCell(d)),2===g.getWidth(c-1)&&g.setCellFromCodePoint(c-1,f.NULL_CELL_CODE,f.NULL_CELL_WIDTH,d.fg,d.bg)),g.setCellFromCodePoint(o.x++,i,n,d.fg,d.bg),n>0)for(;--n;)g.setCellFromCodePoint(o.x++,0,0,d.fg,d.bg)}else g.getWidth(o.x-1)?g.addCodepointToCell(o.x-1,i):g.addCodepointToCell(o.x-2,i)}r&&(g.loadCell(o.x-1,this._workCell),2===this._workCell.getWidth()||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._dirtyRowService.markDirty(o.y)},e.prototype.addCsiHandler=function(t,e){return this._parser.addCsiHandler(t,e)},e.prototype.addDcsHandler=function(t,e){return this._parser.addDcsHandler(t,new y.DcsHandler(e))},e.prototype.addEscHandler=function(t,e){return this._parser.addEscHandler(t,e)},e.prototype.addOscHandler=function(t,e){return this._parser.addOscHandler(t,new v.OscHandler(e))},e.prototype.bell=function(){this._terminal.bell()},e.prototype.lineFeed=function(){var t=this._bufferService.buffer;this._dirtyRowService.markDirty(t.y),this._optionsService.options.convertEol&&(t.x=0),t.y++,t.y===t.scrollBottom+1?(t.y--,this._terminal.scroll()):t.y>=this._bufferService.rows&&(t.y=this._bufferService.rows-1),t.x>=this._bufferService.cols&&t.x--,this._dirtyRowService.markDirty(t.y),this._onLineFeed.fire()},e.prototype.carriageReturn=function(){this._bufferService.buffer.x=0},e.prototype.backspace=function(){this._restrictCursor(),this._bufferService.buffer.x>0&&this._bufferService.buffer.x--},e.prototype.tab=function(){if(!(this._bufferService.buffer.x>=this._bufferService.cols)){var t=this._bufferService.buffer.x;this._bufferService.buffer.x=this._bufferService.buffer.nextStop(),this._optionsService.options.screenReaderMode&&this._terminal.onA11yTabEmitter.fire(this._bufferService.buffer.x-t)}},e.prototype.shiftOut=function(){this._terminal.setgLevel(1)},e.prototype.shiftIn=function(){this._terminal.setgLevel(0)},e.prototype._restrictCursor=function(){this._bufferService.buffer.x=Math.min(this._bufferService.cols-1,Math.max(0,this._bufferService.buffer.x)),this._bufferService.buffer.y=this._terminal.originMode?Math.min(this._bufferService.buffer.scrollBottom,Math.max(this._bufferService.buffer.scrollTop,this._bufferService.buffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._bufferService.buffer.y)),this._dirtyRowService.markDirty(this._bufferService.buffer.y)},e.prototype._setCursor=function(t,e){this._dirtyRowService.markDirty(this._bufferService.buffer.y),this._terminal.originMode?(this._bufferService.buffer.x=t,this._bufferService.buffer.y=this._bufferService.buffer.scrollTop+e):(this._bufferService.buffer.x=t,this._bufferService.buffer.y=e),this._restrictCursor(),this._dirtyRowService.markDirty(this._bufferService.buffer.y)},e.prototype._moveCursor=function(t,e){this._restrictCursor(),this._setCursor(this._bufferService.buffer.x+t,this._bufferService.buffer.y+e)},e.prototype.cursorUp=function(t){var e=this._bufferService.buffer.y-this._bufferService.buffer.scrollTop;e>=0?this._moveCursor(0,-Math.min(e,t.params[0]||1)):this._moveCursor(0,-(t.params[0]||1))},e.prototype.cursorDown=function(t){var e=this._bufferService.buffer.scrollBottom-this._bufferService.buffer.y;e>=0?this._moveCursor(0,Math.min(e,t.params[0]||1)):this._moveCursor(0,t.params[0]||1)},e.prototype.cursorForward=function(t){this._moveCursor(t.params[0]||1,0)},e.prototype.cursorBackward=function(t){this._moveCursor(-(t.params[0]||1),0)},e.prototype.cursorNextLine=function(t){this.cursorDown(t),this._bufferService.buffer.x=0},e.prototype.cursorPrecedingLine=function(t){this.cursorUp(t),this._bufferService.buffer.x=0},e.prototype.cursorCharAbsolute=function(t){this._setCursor((t.params[0]||1)-1,this._bufferService.buffer.y)},e.prototype.cursorPosition=function(t){this._setCursor(t.length>=2?(t.params[1]||1)-1:0,(t.params[0]||1)-1)},e.prototype.charPosAbsolute=function(t){this._setCursor((t.params[0]||1)-1,this._bufferService.buffer.y)},e.prototype.hPositionRelative=function(t){this._moveCursor(t.params[0]||1,0)},e.prototype.linePosAbsolute=function(t){this._setCursor(this._bufferService.buffer.x,(t.params[0]||1)-1)},e.prototype.vPositionRelative=function(t){this._moveCursor(0,t.params[0]||1)},e.prototype.hVPosition=function(t){this.cursorPosition(t)},e.prototype.tabClear=function(t){var e=t.params[0];0===e?delete this._bufferService.buffer.tabs[this._bufferService.buffer.x]:3===e&&(this._bufferService.buffer.tabs={})},e.prototype.cursorForwardTab=function(t){if(!(this._bufferService.buffer.x>=this._bufferService.cols))for(var e=t.params[0]||1;e--;)this._bufferService.buffer.x=this._bufferService.buffer.nextStop()},e.prototype.cursorBackwardTab=function(t){if(!(this._bufferService.buffer.x>=this._bufferService.cols))for(var e=t.params[0]||1,r=this._bufferService.buffer;e--;)r.x=r.prevStop()},e.prototype._eraseInBufferLine=function(t,e,r,i){void 0===i&&(i=!1);var n=this._bufferService.buffer.lines.get(this._bufferService.buffer.ybase+t);n.replaceCells(e,r,this._bufferService.buffer.getNullCell(this._terminal.eraseAttrData())),i&&(n.isWrapped=!1)},e.prototype._resetBufferLine=function(t){var e=this._bufferService.buffer.lines.get(this._bufferService.buffer.ybase+t);e.fill(this._bufferService.buffer.getNullCell(this._terminal.eraseAttrData())),e.isWrapped=!1},e.prototype.eraseInDisplay=function(t){var e;switch(this._restrictCursor(),t.params[0]){case 0:for(e=this._bufferService.buffer.y,this._dirtyRowService.markDirty(e),this._eraseInBufferLine(e++,this._bufferService.buffer.x,this._bufferService.cols,0===this._bufferService.buffer.x);e<this._bufferService.rows;e++)this._resetBufferLine(e);this._dirtyRowService.markDirty(e);break;case 1:for(e=this._bufferService.buffer.y,this._dirtyRowService.markDirty(e),this._eraseInBufferLine(e,0,this._bufferService.buffer.x+1,!0),this._bufferService.buffer.x+1>=this._bufferService.cols&&(this._bufferService.buffer.lines.get(e+1).isWrapped=!1);e--;)this._resetBufferLine(e);this._dirtyRowService.markDirty(0);break;case 2:for(e=this._bufferService.rows,this._dirtyRowService.markDirty(e-1);e--;)this._resetBufferLine(e);this._dirtyRowService.markDirty(0);break;case 3:var r=this._bufferService.buffer.lines.length-this._bufferService.rows;r>0&&(this._bufferService.buffer.lines.trimStart(r),this._bufferService.buffer.ybase=Math.max(this._bufferService.buffer.ybase-r,0),this._bufferService.buffer.ydisp=Math.max(this._bufferService.buffer.ydisp-r,0),this._onScroll.fire(0))}},e.prototype.eraseInLine=function(t){switch(this._restrictCursor(),t.params[0]){case 0:this._eraseInBufferLine(this._bufferService.buffer.y,this._bufferService.buffer.x,this._bufferService.cols);break;case 1:this._eraseInBufferLine(this._bufferService.buffer.y,0,this._bufferService.buffer.x+1);break;case 2:this._eraseInBufferLine(this._bufferService.buffer.y,0,this._bufferService.cols)}this._dirtyRowService.markDirty(this._bufferService.buffer.y)},e.prototype.insertLines=function(t){this._restrictCursor();var e=t.params[0]||1,r=this._bufferService.buffer;if(!(r.y>r.scrollBottom||r.y<r.scrollTop)){for(var i=r.y+r.ybase,n=this._bufferService.rows-1-r.scrollBottom,o=this._bufferService.rows-1+r.ybase-n+1;e--;)r.lines.splice(o-1,1),r.lines.splice(i,0,r.getBlankLine(this._terminal.eraseAttrData()));this._dirtyRowService.markRangeDirty(r.y,r.scrollBottom),r.x=0}},e.prototype.deleteLines=function(t){this._restrictCursor();var e=t.params[0]||1,r=this._bufferService.buffer;if(!(r.y>r.scrollBottom||r.y<r.scrollTop)){var i,n=r.y+r.ybase;for(i=this._bufferService.rows-1-r.scrollBottom,i=this._bufferService.rows-1+r.ybase-i;e--;)r.lines.splice(n,1),r.lines.splice(i,0,r.getBlankLine(this._terminal.eraseAttrData()));this._dirtyRowService.markRangeDirty(r.y,r.scrollBottom),r.x=0}},e.prototype.insertChars=function(t){this._restrictCursor();var e=this._bufferService.buffer.lines.get(this._bufferService.buffer.y+this._bufferService.buffer.ybase);e&&(e.insertCells(this._bufferService.buffer.x,t.params[0]||1,this._bufferService.buffer.getNullCell(this._terminal.eraseAttrData())),this._dirtyRowService.markDirty(this._bufferService.buffer.y))},e.prototype.deleteChars=function(t){this._restrictCursor();var e=this._bufferService.buffer.lines.get(this._bufferService.buffer.y+this._bufferService.buffer.ybase);e&&(e.deleteCells(this._bufferService.buffer.x,t.params[0]||1,this._bufferService.buffer.getNullCell(this._terminal.eraseAttrData())),this._dirtyRowService.markDirty(this._bufferService.buffer.y))},e.prototype.scrollUp=function(t){for(var e=t.params[0]||1,r=this._bufferService.buffer;e--;)r.lines.splice(r.ybase+r.scrollTop,1),r.lines.splice(r.ybase+r.scrollBottom,0,r.getBlankLine(this._terminal.eraseAttrData()));this._dirtyRowService.markRangeDirty(r.scrollTop,r.scrollBottom)},e.prototype.scrollDown=function(t){for(var e=t.params[0]||1,r=this._bufferService.buffer;e--;)r.lines.splice(r.ybase+r.scrollBottom,1),r.lines.splice(r.ybase+r.scrollTop,0,r.getBlankLine(p.DEFAULT_ATTR_DATA));this._dirtyRowService.markRangeDirty(r.scrollTop,r.scrollBottom)},e.prototype.scrollLeft=function(t){var e=this._bufferService.buffer;if(!(e.y>e.scrollBottom||e.y<e.scrollTop)){for(var r=t.params[0]||1,i=e.scrollTop;i<=e.scrollBottom;++i){var n=e.lines.get(e.ybase+i);n.deleteCells(0,r,e.getNullCell(this._terminal.eraseAttrData())),n.isWrapped=!1}this._dirtyRowService.markRangeDirty(e.scrollTop,e.scrollBottom)}},e.prototype.scrollRight=function(t){var e=this._bufferService.buffer;if(!(e.y>e.scrollBottom||e.y<e.scrollTop)){for(var r=t.params[0]||1,i=e.scrollTop;i<=e.scrollBottom;++i){var n=e.lines.get(e.ybase+i);n.insertCells(0,r,e.getNullCell(this._terminal.eraseAttrData())),n.isWrapped=!1}this._dirtyRowService.markRangeDirty(e.scrollTop,e.scrollBottom)}},e.prototype.insertColumns=function(t){var e=this._bufferService.buffer;if(!(e.y>e.scrollBottom||e.y<e.scrollTop)){for(var r=t.params[0]||1,i=e.scrollTop;i<=e.scrollBottom;++i){var n=this._bufferService.buffer.lines.get(e.ybase+i);n.insertCells(e.x,r,e.getNullCell(this._terminal.eraseAttrData())),n.isWrapped=!1}this._dirtyRowService.markRangeDirty(e.scrollTop,e.scrollBottom)}},e.prototype.deleteColumns=function(t){var e=this._bufferService.buffer;if(!(e.y>e.scrollBottom||e.y<e.scrollTop)){for(var r=t.params[0]||1,i=e.scrollTop;i<=e.scrollBottom;++i){var n=e.lines.get(e.ybase+i);n.deleteCells(e.x,r,e.getNullCell(this._terminal.eraseAttrData())),n.isWrapped=!1}this._dirtyRowService.markRangeDirty(e.scrollTop,e.scrollBottom)}},e.prototype.eraseChars=function(t){this._restrictCursor();var e=this._bufferService.buffer.lines.get(this._bufferService.buffer.y+this._bufferService.buffer.ybase);e&&(e.replaceCells(this._bufferService.buffer.x,this._bufferService.buffer.x+(t.params[0]||1),this._bufferService.buffer.getNullCell(this._terminal.eraseAttrData())),this._dirtyRowService.markDirty(this._bufferService.buffer.y))},e.prototype.repeatPrecedingCharacter=function(t){if(this._parser.precedingCodepoint){for(var e=t.params[0]||1,r=new Uint32Array(e),i=0;i<e;++i)r[i]=this._parser.precedingCodepoint;this.print(r,0,r.length)}},e.prototype.sendDeviceAttributesPrimary=function(t){t.params[0]>0||(this._terminal.is("xterm")||this._terminal.is("rxvt-unicode")||this._terminal.is("screen")?this._coreService.triggerDataEvent(o.C0.ESC+"[?1;2c"):this._terminal.is("linux")&&this._coreService.triggerDataEvent(o.C0.ESC+"[?6c"))},e.prototype.sendDeviceAttributesSecondary=function(t){t.params[0]>0||(this._terminal.is("xterm")?this._coreService.triggerDataEvent(o.C0.ESC+"[>0;276;0c"):this._terminal.is("rxvt-unicode")?this._coreService.triggerDataEvent(o.C0.ESC+"[>85;95;0c"):this._terminal.is("linux")?this._coreService.triggerDataEvent(t.params[0]+"c"):this._terminal.is("screen")&&this._coreService.triggerDataEvent(o.C0.ESC+"[>83;40003;0c"))},e.prototype.setMode=function(t){for(var e=0;e<t.length;e++)switch(t.params[e]){case 4:this._terminal.insertMode=!0}},e.prototype.setModePrivate=function(t){for(var e=0;e<t.length;e++)switch(t.params[e]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._terminal.setgCharset(0,s.DEFAULT_CHARSET),this._terminal.setgCharset(1,s.DEFAULT_CHARSET),this._terminal.setgCharset(2,s.DEFAULT_CHARSET),this._terminal.setgCharset(3,s.DEFAULT_CHARSET);break;case 3:this._terminal.savedCols=this._bufferService.cols,this._terminal.resize(132,this._bufferService.rows),this._terminal.reset();break;case 6:this._terminal.originMode=!0,this._setCursor(0,0);break;case 7:this._terminal.wraparoundMode=!0;break;case 12:break;case 66:this._logService.debug("Serial port requested application keypad."),this._terminal.applicationKeypad=!0,this._terminal.viewport&&this._terminal.viewport.syncScrollArea();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._terminal.sendFocus=!0;break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._terminal.eraseAttrData()),this._terminal.refresh(0,this._bufferService.rows-1),this._terminal.viewport&&this._terminal.viewport.syncScrollArea(),this._terminal.showCursor();break;case 2004:this._terminal.bracketedPasteMode=!0}},e.prototype.resetMode=function(t){for(var e=0;e<t.length;e++)switch(t.params[e]){case 4:this._terminal.insertMode=!1}},e.prototype.resetModePrivate=function(t){for(var e=0;e<t.length;e++)switch(t.params[e]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:132===this._bufferService.cols&&this._terminal.savedCols&&this._terminal.resize(this._terminal.savedCols,this._bufferService.rows),delete this._terminal.savedCols,this._terminal.reset();break;case 6:this._terminal.originMode=!1,this._setCursor(0,0);break;case 7:this._terminal.wraparoundMode=!1;break;case 12:break;case 66:this._logService.debug("Switching back to normal keypad."),this._terminal.applicationKeypad=!1,this._terminal.viewport&&this._terminal.viewport.syncScrollArea();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._terminal.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===t.params[e]&&this.restoreCursor(),this._terminal.refresh(0,this._bufferService.rows-1),this._terminal.viewport&&this._terminal.viewport.syncScrollArea(),this._terminal.showCursor();break;case 2004:this._terminal.bracketedPasteMode=!1}},e.prototype._extractColor=function(t,e,r){var i=[0,0,-1,0,0,0],n=0,o=0;do{if(i[o+n]=t.params[e+o],t.hasSubParams(e+o)){var s=t.getSubParams(e+o),a=0;do{5===i[1]&&(n=1),i[o+a+1+n]=s[a]}while(++a<s.length&&a+o+1+n<i.length);break}if(5===i[1]&&o+n>=2||2===i[1]&&o+n>=5)break;i[1]&&(n=1)}while(++o+e<t.length&&o+n<i.length);for(a=2;a<i.length;++a)-1===i[a]&&(i[a]=0);return 38===i[0]?2===i[1]?(r.fg|=50331648,r.fg&=-16777216,r.fg|=_.AttributeData.fromColorRGB([i[3],i[4],i[5]])):5===i[1]&&(r.fg&=-50331904,r.fg|=33554432|255&i[3]):48===i[0]&&(2===i[1]?(r.bg|=50331648,r.bg&=-16777216,r.bg|=_.AttributeData.fromColorRGB([i[3],i[4],i[5]])):5===i[1]&&(r.bg&=-50331904,r.bg|=33554432|255&i[3])),o},e.prototype.charAttributes=function(t){if(1===t.length&&0===t.params[0])return this._terminal.curAttrData.fg=p.DEFAULT_ATTR_DATA.fg,void(this._terminal.curAttrData.bg=p.DEFAULT_ATTR_DATA.bg);for(var e,r=t.length,i=this._terminal.curAttrData,n=0;n<r;n++)(e=t.params[n])>=30&&e<=37?(i.fg&=-50331904,i.fg|=16777216|e-30):e>=40&&e<=47?(i.bg&=-50331904,i.bg|=16777216|e-40):e>=90&&e<=97?(i.fg&=-50331904,i.fg|=16777224|e-90):e>=100&&e<=107?(i.bg&=-50331904,i.bg|=16777224|e-100):0===e?(i.fg=p.DEFAULT_ATTR_DATA.fg,i.bg=p.DEFAULT_ATTR_DATA.bg):1===e?i.fg|=134217728:3===e?i.bg|=67108864:4===e?i.fg|=268435456:5===e?i.fg|=536870912:7===e?i.fg|=67108864:8===e?i.fg|=1073741824:2===e?i.bg|=134217728:22===e?(i.fg&=-134217729,i.bg&=-134217729):23===e?i.bg&=-67108865:24===e?i.fg&=-268435457:25===e?i.fg&=-536870913:27===e?i.fg&=-67108865:28===e?i.fg&=-1073741825:39===e?(i.fg&=-67108864,i.fg|=16777215&p.DEFAULT_ATTR_DATA.fg):49===e?(i.bg&=-67108864,i.bg|=16777215&p.DEFAULT_ATTR_DATA.bg):38===e||48===e?n+=this._extractColor(t,n,i):100===e?(i.fg&=-67108864,i.fg|=16777215&p.DEFAULT_ATTR_DATA.fg,i.bg&=-67108864,i.bg|=16777215&p.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",e)},e.prototype.deviceStatus=function(t){switch(t.params[0]){case 5:this._coreService.triggerDataEvent(o.C0.ESC+"[0n");break;case 6:var e=this._bufferService.buffer.y+1,r=this._bufferService.buffer.x+1;this._coreService.triggerDataEvent(o.C0.ESC+"["+e+";"+r+"R")}},e.prototype.deviceStatusPrivate=function(t){switch(t.params[0]){case 6:var e=this._bufferService.buffer.y+1,r=this._bufferService.buffer.x+1;this._coreService.triggerDataEvent(o.C0.ESC+"[?"+e+";"+r+"R")}},e.prototype.softReset=function(t){this._coreService.isCursorHidden=!1,this._terminal.insertMode=!1,this._terminal.originMode=!1,this._terminal.wraparoundMode=!0,this._terminal.applicationKeypad=!1,this._terminal.viewport&&this._terminal.viewport.syncScrollArea(),this._coreService.decPrivateModes.applicationCursorKeys=!1,this._bufferService.buffer.scrollTop=0,this._bufferService.buffer.scrollBottom=this._bufferService.rows-1,this._terminal.curAttrData=p.DEFAULT_ATTR_DATA.clone(),this._bufferService.buffer.x=this._bufferService.buffer.y=0,this._terminal.charset=null,this._terminal.glevel=0,this._terminal.charsets=[null]},e.prototype.setCursorStyle=function(t){var e=t.params[0]||1;switch(e){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}var r=e%2==1;this._optionsService.options.cursorBlink=r},e.prototype.setScrollRegion=function(t){var e,r=t.params[0]||1;(t.length<2||(e=t.params[1])>this._bufferService.rows||0===e)&&(e=this._bufferService.rows),e>r&&(this._bufferService.buffer.scrollTop=r-1,this._bufferService.buffer.scrollBottom=e-1,this._setCursor(0,0))},e.prototype.saveCursor=function(t){this._bufferService.buffer.savedX=this._bufferService.buffer.x,this._bufferService.buffer.savedY=this._bufferService.buffer.ybase+this._bufferService.buffer.y,this._bufferService.buffer.savedCurAttrData.fg=this._terminal.curAttrData.fg,this._bufferService.buffer.savedCurAttrData.bg=this._terminal.curAttrData.bg,this._bufferService.buffer.savedCharset=this._terminal.charset},e.prototype.restoreCursor=function(t){this._bufferService.buffer.x=this._bufferService.buffer.savedX||0,this._bufferService.buffer.y=Math.max(this._bufferService.buffer.savedY-this._bufferService.buffer.ybase,0),this._terminal.curAttrData.fg=this._bufferService.buffer.savedCurAttrData.fg,this._terminal.curAttrData.bg=this._bufferService.buffer.savedCurAttrData.bg,this._terminal.charset=this._savedCharset,this._bufferService.buffer.savedCharset&&(this._terminal.charset=this._bufferService.buffer.savedCharset),this._restrictCursor()},e.prototype.setTitle=function(t){this._terminal.handleTitle(t)},e.prototype.nextLine=function(){this._bufferService.buffer.x=0,this.index()},e.prototype.keypadApplicationMode=function(){this._logService.debug("Serial port requested application keypad."),this._terminal.applicationKeypad=!0,this._terminal.viewport&&this._terminal.viewport.syncScrollArea()},e.prototype.keypadNumericMode=function(){this._logService.debug("Switching back to normal keypad."),this._terminal.applicationKeypad=!1,this._terminal.viewport&&this._terminal.viewport.syncScrollArea()},e.prototype.selectDefaultCharset=function(){this._terminal.setgLevel(0),this._terminal.setgCharset(0,s.DEFAULT_CHARSET)},e.prototype.selectCharset=function(t){2===t.length?"/"!==t[0]&&this._terminal.setgCharset(m[t[0]],s.CHARSETS[t[1]]||s.DEFAULT_CHARSET):this.selectDefaultCharset()},e.prototype.index=function(){this._restrictCursor();var t=this._bufferService.buffer;this._bufferService.buffer.y++,t.y===t.scrollBottom+1?(t.y--,this._terminal.scroll()):t.y>=this._bufferService.rows&&(t.y=this._bufferService.rows-1),this._restrictCursor()},e.prototype.tabSet=function(){this._bufferService.buffer.tabs[this._bufferService.buffer.x]=!0},e.prototype.reverseIndex=function(){this._restrictCursor();var t=this._bufferService.buffer;if(t.y===t.scrollTop){var e=t.scrollBottom-t.scrollTop;t.lines.shiftElements(t.y+t.ybase,e,1),t.lines.set(t.y+t.ybase,t.getBlankLine(this._terminal.eraseAttrData())),this._dirtyRowService.markRangeDirty(t.scrollTop,t.scrollBottom)}else t.y--,this._restrictCursor()},e.prototype.reset=function(){this._parser.reset(),this._terminal.reset()},e.prototype.setgLevel=function(t){this._terminal.setgLevel(t)},e.prototype.screenAlignmentPattern=function(){var t=new g.CellData;t.content=1<<22|"E".charCodeAt(0),t.fg=this._terminal.curAttrData.fg,t.bg=this._terminal.curAttrData.bg;var e=this._bufferService.buffer;this._setCursor(0,0);for(var r=0;r<this._bufferService.rows;++r){var i=e.y+e.ybase+r;e.lines.get(i).fill(t),e.lines.get(i).isWrapped=!1}this._dirtyRowService.markAllDirty(),this._setCursor(0,0)},e}(c.Disposable);e.InputHandler=S},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(2),s=r(15),a=r(20),h=r(21),c=r(23),l=function(){function t(t){this.table=new Uint8Array(t)}return t.prototype.setDefault=function(t,e){s.fill(this.table,t<<4|e)},t.prototype.add=function(t,e,r,i){this.table[e<<8|t]=r<<4|i},t.prototype.addMany=function(t,e,r,i){for(var n=0;n<t.length;n++)this.table[e<<8|t[n]]=r<<4|i},t}();e.TransitionTable=l,e.VT500_TRANSITION_TABLE=function(){var t=new l(4095),e=Array.apply(null,Array(256)).map((function(t,e){return e})),r=function(t,r){return e.slice(t,r)},i=r(32,127),n=r(0,24);n.push(25),n.push.apply(n,r(28,32));var o,s=r(0,14);for(o in t.setDefault(1,0),t.addMany(i,0,2,0),s)t.addMany([24,26,153,154],o,3,0),t.addMany(r(128,144),o,3,0),t.addMany(r(144,152),o,3,0),t.add(156,o,0,0),t.add(27,o,11,1),t.add(157,o,4,8),t.addMany([152,158,159],o,0,7),t.add(155,o,11,3),t.add(144,o,11,9);return t.addMany(n,0,3,0),t.addMany(n,1,3,1),t.add(127,1,0,1),t.addMany(n,8,0,8),t.addMany(n,3,3,3),t.add(127,3,0,3),t.addMany(n,4,3,4),t.add(127,4,0,4),t.addMany(n,6,3,6),t.addMany(n,5,3,5),t.add(127,5,0,5),t.addMany(n,2,3,2),t.add(127,2,0,2),t.add(93,1,4,8),t.addMany(i,8,5,8),t.add(127,8,5,8),t.addMany([156,27,24,26,7],8,6,0),t.addMany(r(28,32),8,0,8),t.addMany([88,94,95],1,0,7),t.addMany(i,7,0,7),t.addMany(n,7,0,7),t.add(156,7,0,0),t.add(127,7,0,7),t.add(91,1,11,3),t.addMany(r(64,127),3,7,0),t.addMany(r(48,60),3,8,4),t.addMany([60,61,62,63],3,9,4),t.addMany(r(48,60),4,8,4),t.addMany(r(64,127),4,7,0),t.addMany([60,61,62,63],4,0,6),t.addMany(r(32,64),6,0,6),t.add(127,6,0,6),t.addMany(r(64,127),6,0,0),t.addMany(r(32,48),3,9,5),t.addMany(r(32,48),5,9,5),t.addMany(r(48,64),5,0,6),t.addMany(r(64,127),5,7,0),t.addMany(r(32,48),4,9,5),t.addMany(r(32,48),1,9,2),t.addMany(r(32,48),2,9,2),t.addMany(r(48,127),2,10,0),t.addMany(r(48,80),1,10,0),t.addMany(r(81,88),1,10,0),t.addMany([89,90,92],1,10,0),t.addMany(r(96,127),1,10,0),t.add(80,1,11,9),t.addMany(n,9,0,9),t.add(127,9,0,9),t.addMany(r(28,32),9,0,9),t.addMany(r(32,48),9,9,12),t.addMany(r(48,60),9,8,10),t.addMany([60,61,62,63],9,9,10),t.addMany(n,11,0,11),t.addMany(r(32,128),11,0,11),t.addMany(r(28,32),11,0,11),t.addMany(n,10,0,10),t.add(127,10,0,10),t.addMany(r(28,32),10,0,10),t.addMany(r(48,60),10,8,10),t.addMany([60,61,62,63],10,0,11),t.addMany(r(32,48),10,9,12),t.addMany(n,12,0,12),t.add(127,12,0,12),t.addMany(r(28,32),12,0,12),t.addMany(r(32,48),12,9,12),t.addMany(r(48,64),12,0,11),t.addMany(r(64,127),12,12,13),t.addMany(r(64,127),10,12,13),t.addMany(r(64,127),9,12,13),t.addMany(n,13,13,13),t.addMany(i,13,13,13),t.add(127,13,0,13),t.addMany([27,156,24,26],13,14,0),t.add(160,0,2,0),t.add(160,8,5,8),t.add(160,6,0,6),t.add(160,11,0,11),t.add(160,13,13,13),t}();var u=function(t){function r(r){void 0===r&&(r=e.VT500_TRANSITION_TABLE);var i=t.call(this)||this;return i.TRANSITIONS=r,i.initialState=0,i.currentState=i.initialState,i._params=new a.Params,i._params.addParam(0),i._collect=0,i.precedingCodepoint=0,i._printHandlerFb=function(t,e,r){},i._executeHandlerFb=function(t){},i._csiHandlerFb=function(t,e){},i._escHandlerFb=function(t){},i._errorHandlerFb=function(t){return t},i._printHandler=i._printHandlerFb,i._executeHandlers=Object.create(null),i._csiHandlers=Object.create(null),i._escHandlers=Object.create(null),i._oscParser=new h.OscParser,i._dcsParser=new c.DcsParser,i._errorHandler=i._errorHandlerFb,i.setEscHandler({final:"\\"},(function(){})),i}return n(r,t),r.prototype._identifier=function(t,e){void 0===e&&(e=[64,126]);var r=0;if(t.prefix){if(t.prefix.length>1)throw new Error("only one byte as prefix supported");if((r=t.prefix.charCodeAt(0))&&60>r||r>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(t.intermediates){if(t.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(var i=0;i<t.intermediates.length;++i){var n=t.intermediates.charCodeAt(i);if(32>n||n>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");r<<=8,r|=n}}if(1!==t.final.length)throw new Error("final must be a single byte");var o=t.final.charCodeAt(0);if(e[0]>o||o>e[1])throw new Error("final must be in range "+e[0]+" .. "+e[1]);return(r<<=8)|o},r.prototype.identToString=function(t){for(var e=[];t;)e.push(String.fromCharCode(255&t)),t>>=8;return e.reverse().join("")},r.prototype.dispose=function(){this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null),this._oscParser.dispose(),this._dcsParser.dispose()},r.prototype.setPrintHandler=function(t){this._printHandler=t},r.prototype.clearPrintHandler=function(){this._printHandler=this._printHandlerFb},r.prototype.addEscHandler=function(t,e){var r=this._identifier(t,[48,126]);void 0===this._escHandlers[r]&&(this._escHandlers[r]=[]);var i=this._escHandlers[r];return i.push(e),{dispose:function(){var t=i.indexOf(e);-1!==t&&i.splice(t,1)}}},r.prototype.setEscHandler=function(t,e){this._escHandlers[this._identifier(t,[48,126])]=[e]},r.prototype.clearEscHandler=function(t){this._escHandlers[this._identifier(t,[48,126])]&&delete this._escHandlers[this._identifier(t,[48,126])]},r.prototype.setEscHandlerFallback=function(t){this._escHandlerFb=t},r.prototype.setExecuteHandler=function(t,e){this._executeHandlers[t.charCodeAt(0)]=e},r.prototype.clearExecuteHandler=function(t){this._executeHandlers[t.charCodeAt(0)]&&delete this._executeHandlers[t.charCodeAt(0)]},r.prototype.setExecuteHandlerFallback=function(t){this._executeHandlerFb=t},r.prototype.addCsiHandler=function(t,e){var r=this._identifier(t);void 0===this._csiHandlers[r]&&(this._csiHandlers[r]=[]);var i=this._csiHandlers[r];return i.push(e),{dispose:function(){var t=i.indexOf(e);-1!==t&&i.splice(t,1)}}},r.prototype.setCsiHandler=function(t,e){this._csiHandlers[this._identifier(t)]=[e]},r.prototype.clearCsiHandler=function(t){this._csiHandlers[this._identifier(t)]&&delete this._csiHandlers[this._identifier(t)]},r.prototype.setCsiHandlerFallback=function(t){this._csiHandlerFb=t},r.prototype.addDcsHandler=function(t,e){return this._dcsParser.addHandler(this._identifier(t),e)},r.prototype.setDcsHandler=function(t,e){this._dcsParser.setHandler(this._identifier(t),e)},r.prototype.clearDcsHandler=function(t){this._dcsParser.clearHandler(this._identifier(t))},r.prototype.setDcsHandlerFallback=function(t){this._dcsParser.setHandlerFallback(t)},r.prototype.addOscHandler=function(t,e){return this._oscParser.addHandler(t,e)},r.prototype.setOscHandler=function(t,e){this._oscParser.setHandler(t,e)},r.prototype.clearOscHandler=function(t){this._oscParser.clearHandler(t)},r.prototype.setOscHandlerFallback=function(t){this._oscParser.setHandlerFallback(t)},r.prototype.setErrorHandler=function(t){this._errorHandler=t},r.prototype.clearErrorHandler=function(){this._errorHandler=this._errorHandlerFb},r.prototype.reset=function(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0},r.prototype.parse=function(t,e){for(var r=0,i=0,n=this.currentState,o=this._oscParser,s=this._dcsParser,a=this._collect,h=this._params,c=this.TRANSITIONS.table,l=0;l<e;++l){switch((i=c[n<<8|((r=t[l])<160?r:160)])>>4){case 2:for(var u=l+1;;++u){if(u>=e||(r=t[u])<32||r>126&&r<160){this._printHandler(t,l,u),l=u-1;break}if(++u>=e||(r=t[u])<32||r>126&&r<160){this._printHandler(t,l,u),l=u-1;break}if(++u>=e||(r=t[u])<32||r>126&&r<160){this._printHandler(t,l,u),l=u-1;break}if(++u>=e||(r=t[u])<32||r>126&&r<160){this._printHandler(t,l,u),l=u-1;break}}break;case 3:this._executeHandlers[r]?this._executeHandlers[r]():this._executeHandlerFb(r),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:l,code:r,currentState:n,collect:a,params:h,abort:!1}).abort)return;break;case 7:for(var p=this._csiHandlers[a<<8|r],d=p?p.length-1:-1;d>=0&&!1===p[d](h);d--);d<0&&this._csiHandlerFb(a<<8|r,h),this.precedingCodepoint=0;break;case 8:do{switch(r){case 59:h.addParam(0);break;case 58:h.addSubParam(-1);break;default:h.addDigit(r-48)}}while(++l<e&&(r=t[l])>47&&r<60);l--;break;case 9:a<<=8,a|=r;break;case 10:for(var f=this._escHandlers[a<<8|r],g=f?f.length-1:-1;g>=0&&!1===f[g]();g--);g<0&&this._escHandlerFb(a<<8|r),this.precedingCodepoint=0;break;case 11:h.reset(),h.addParam(0),a=0;break;case 12:s.hook(a<<8|r,h);break;case 13:for(var _=l+1;;++_)if(_>=e||24===(r=t[_])||26===r||27===r||r>127&&r<160){s.put(t,l,_),l=_-1;break}break;case 14:s.unhook(24!==r&&26!==r),27===r&&(i|=1),h.reset(),h.addParam(0),a=0,this.precedingCodepoint=0;break;case 4:o.start();break;case 5:for(var v=l+1;;v++)if(v>=e||(r=t[v])<32||r>127&&r<=159){o.put(t,l,v),l=v-1;break}break;case 6:o.end(24!==r&&26!==r),27===r&&(i|=1),h.reset(),h.addParam(0),a=0,this.precedingCodepoint=0}n=15&i}this._collect=a,this.currentState=n},r}(o.Disposable);e.EscapeSequenceParser=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},s=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(41),h=r(47),c=r(48),l=r(49),u=r(28),p=r(2),d=r(4),f=r(0),g=r(24),_=r(1),v=1,y=function(t){function e(e,r,i,n,o,s,p,d){var f=t.call(this)||this;f._colors=e,f._screenElement=r,f._linkifier=i,f._bufferService=n,f._charSizeService=o,f._optionsService=s,f.coreService=p,f.coreBrowserService=d,f._id=v++,f._onRequestRefreshRows=new _.EventEmitter;var g=f._optionsService.options.allowTransparency;return f._characterJoinerRegistry=new u.CharacterJoinerRegistry(f._bufferService),f._renderLayers=[new a.TextRenderLayer(f._screenElement,0,f._colors,f._characterJoinerRegistry,g,f._id,f._bufferService,s),new h.SelectionRenderLayer(f._screenElement,1,f._colors,f._id,f._bufferService,s),new l.LinkRenderLayer(f._screenElement,2,f._colors,f._id,f._linkifier,f._bufferService,s),new c.CursorRenderLayer(f._screenElement,3,f._colors,f._id,f._onRequestRefreshRows,f._bufferService,s,p,d)],f.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},f._devicePixelRatio=window.devicePixelRatio,f._updateDimensions(),f.onOptionsChanged(),f}return n(e,t),Object.defineProperty(e.prototype,"onRequestRefreshRows",{get:function(){return this._onRequestRefreshRows.event},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.dispose.call(this),this._renderLayers.forEach((function(t){return t.dispose()})),g.removeTerminalFromCache(this._id)},e.prototype.onDevicePixelRatioChange=function(){this._devicePixelRatio!==window.devicePixelRatio&&(this._devicePixelRatio=window.devicePixelRatio,this.onResize(this._bufferService.cols,this._bufferService.rows))},e.prototype.setColors=function(t){var e=this;this._colors=t,this._renderLayers.forEach((function(t){t.setColors(e._colors),t.reset()}))},e.prototype.onResize=function(t,e){var r=this;this._updateDimensions(),this._renderLayers.forEach((function(t){return t.resize(r.dimensions)})),this._screenElement.style.width=this.dimensions.canvasWidth+"px",this._screenElement.style.height=this.dimensions.canvasHeight+"px"},e.prototype.onCharSizeChanged=function(){this.onResize(this._bufferService.cols,this._bufferService.rows)},e.prototype.onBlur=function(){this._runOperation((function(t){return t.onBlur()}))},e.prototype.onFocus=function(){this._runOperation((function(t){return t.onFocus()}))},e.prototype.onSelectionChanged=function(t,e,r){void 0===r&&(r=!1),this._runOperation((function(i){return i.onSelectionChanged(t,e,r)}))},e.prototype.onCursorMove=function(){this._runOperation((function(t){return t.onCursorMove()}))},e.prototype.onOptionsChanged=function(){this._runOperation((function(t){return t.onOptionsChanged()}))},e.prototype.clear=function(){this._runOperation((function(t){return t.reset()}))},e.prototype._runOperation=function(t){this._renderLayers.forEach((function(e){return t(e)}))},e.prototype.renderRows=function(t,e){this._renderLayers.forEach((function(r){return r.onGridChanged(t,e)}))},e.prototype._updateDimensions=function(){this._charSizeService.hasValidSize&&(this.dimensions.scaledCharWidth=Math.floor(this._charSizeService.width*window.devicePixelRatio),this.dimensions.scaledCharHeight=Math.ceil(this._charSizeService.height*window.devicePixelRatio),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._optionsService.options.lineHeight),this.dimensions.scaledCharTop=1===this._optionsService.options.lineHeight?0:Math.round((this.dimensions.scaledCellHeight-this.dimensions.scaledCharHeight)/2),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._optionsService.options.letterSpacing),this.dimensions.scaledCharLeft=Math.floor(this._optionsService.options.letterSpacing/2),this.dimensions.scaledCanvasHeight=this._bufferService.rows*this.dimensions.scaledCellHeight,this.dimensions.scaledCanvasWidth=this._bufferService.cols*this.dimensions.scaledCellWidth,this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._bufferService.rows,this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._bufferService.cols)},e.prototype.registerCharacterJoiner=function(t){return this._characterJoinerRegistry.registerCharacterJoiner(t)},e.prototype.deregisterCharacterJoiner=function(t){return this._characterJoinerRegistry.deregisterCharacterJoiner(t)},o([s(3,f.IBufferService),s(4,d.ICharSizeService),s(5,f.IOptionsService),s(6,f.ICoreService),s(7,d.ICoreBrowserService)],e)}(p.Disposable);e.Renderer=y},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(42),s=r(13),a=r(6),h=r(3),c=r(28),l=r(5),u=function(t){function e(e,r,i,n,s,a,h,c){var u=t.call(this,e,"text",r,s,i,a,h,c)||this;return u.bufferService=h,u.optionsService=c,u._characterWidth=0,u._characterFont="",u._characterOverlapCache={},u._workCell=new l.CellData,u._state=new o.GridCache,u._characterJoinerRegistry=n,u}return n(e,t),e.prototype.resize=function(e){t.prototype.resize.call(this,e);var r=this._getFont(!1,!1);this._characterWidth===e.scaledCharWidth&&this._characterFont===r||(this._characterWidth=e.scaledCharWidth,this._characterFont=r,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)},e.prototype.reset=function(){this._state.clear(),this._clearAll()},e.prototype._forEachCell=function(t,e,r,i){for(var n=t;n<=e;n++)for(var o=n+this._bufferService.buffer.ydisp,s=this._bufferService.buffer.lines.get(o),a=r?r.getJoinedCharacters(o):[],l=0;l<this._bufferService.cols;l++){s.loadCell(l,this._workCell);var u=this._workCell,p=!1,d=l;if(0!==u.getWidth()){if(a.length>0&&l===a[0][0]){p=!0;var f=a.shift();u=new c.JoinedCellData(this._workCell,s.translateToString(!0,f[0],f[1]),f[1]-f[0]),d=f[1]-1}!p&&this._isOverlapping(u)&&d<s.length-1&&s.getCodePoint(d+1)===h.NULL_CELL_CODE&&(u.content&=-12582913,u.content|=2<<22),i(u,l,n),l=d}}},e.prototype._drawBackground=function(t,e){var r=this,i=this._ctx,n=this._bufferService.cols,o=0,s=0,h=null;i.save(),this._forEachCell(t,e,null,(function(t,e,c){var l=null;t.isInverse()?l=t.isFgDefault()?r._colors.foreground.css:t.isFgRGB()?"rgb("+a.AttributeData.toColorRGB(t.getFgColor()).join(",")+")":r._colors.ansi[t.getFgColor()].css:t.isBgRGB()?l="rgb("+a.AttributeData.toColorRGB(t.getBgColor()).join(",")+")":t.isBgPalette()&&(l=r._colors.ansi[t.getBgColor()].css),null===h&&(o=e,s=c),c!==s?(i.fillStyle=h||"",r._fillCells(o,s,n-o,1),o=e,s=c):h!==l&&(i.fillStyle=h||"",r._fillCells(o,s,e-o,1),o=e,s=c),h=l})),null!==h&&(i.fillStyle=h,this._fillCells(o,s,n-o,1)),i.restore()},e.prototype._drawForeground=function(t,e){var r=this;this._forEachCell(t,e,this._characterJoinerRegistry,(function(t,e,i){if(!t.isInvisible()&&(r._drawChars(t,e,i),t.isUnderline())){if(r._ctx.save(),t.isInverse())if(t.isBgDefault())r._ctx.fillStyle=r._colors.background.css;else if(t.isBgRGB())r._ctx.fillStyle="rgb("+a.AttributeData.toColorRGB(t.getBgColor()).join(",")+")";else{var n=t.getBgColor();r._optionsService.options.drawBoldTextInBrightColors&&t.isBold()&&n<8&&(n+=8),r._ctx.fillStyle=r._colors.ansi[n].css}else if(t.isFgDefault())r._ctx.fillStyle=r._colors.foreground.css;else if(t.isFgRGB())r._ctx.fillStyle="rgb("+a.AttributeData.toColorRGB(t.getFgColor()).join(",")+")";else{var o=t.getFgColor();r._optionsService.options.drawBoldTextInBrightColors&&t.isBold()&&o<8&&(o+=8),r._ctx.fillStyle=r._colors.ansi[o].css}r._fillBottomLineAtCells(e,i,t.getWidth()),r._ctx.restore()}}))},e.prototype.onGridChanged=function(t,e){0!==this._state.cache.length&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,t,this._bufferService.cols,e-t+1),this._drawBackground(t,e),this._drawForeground(t,e))},e.prototype.onOptionsChanged=function(){this._setTransparency(this._optionsService.options.allowTransparency)},e.prototype._isOverlapping=function(t){if(1!==t.getWidth())return!1;if(t.getCode()<256)return!1;var e=t.getChars();if(this._characterOverlapCache.hasOwnProperty(e))return this._characterOverlapCache[e];this._ctx.save(),this._ctx.font=this._characterFont;var r=Math.floor(this._ctx.measureText(e).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[e]=r,r},e}(s.BaseRenderLayer);e.TextRenderLayer=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.cache=[]}return t.prototype.resize=function(t,e){for(var r=0;r<t;r++){this.cache.length<=r&&this.cache.push([]);for(var i=this.cache[r].length;i<e;i++)this.cache[r].push(void 0);this.cache[r].length=e}this.cache.length=t},t.prototype.clear=function(){for(var t=0;t<this.cache.length;t++)for(var e=0;e<this.cache[t].length;e++)this.cache[t][e]=void 0},t}();e.GridCache=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(9),s=r(44),a=r(26),h=r(46),c=r(11),l=r(27),u=r(10),p=1024,d=1024,f={css:"rgba(0, 0, 0, 0)",rgba:0};function g(t){return t.code<<21|t.bg<<12|t.fg<<3|(t.bold?0:4)+(t.dim?0:2)+(t.italic?0:1)}e.getGlyphCacheKey=g;var _=function(t){function e(e,r){var i=t.call(this)||this;i._config=r,i._drawToCacheCount=0,i._glyphsWaitingOnBitmap=[],i._bitmapCommitTimeout=null,i._bitmap=null,i._cacheCanvas=e.createElement("canvas"),i._cacheCanvas.width=p,i._cacheCanvas.height=d,i._cacheCtx=l.throwIfFalsy(i._cacheCanvas.getContext("2d",{alpha:!0}));var n=e.createElement("canvas");n.width=i._config.scaledCharWidth,n.height=i._config.scaledCharHeight,i._tmpCtx=l.throwIfFalsy(n.getContext("2d",{alpha:i._config.allowTransparency})),i._width=Math.floor(p/i._config.scaledCharWidth),i._height=Math.floor(d/i._config.scaledCharHeight);var o=i._width*i._height;return i._cacheMap=new h.LRUMap(o),i._cacheMap.prealloc(o),i}return n(e,t),e.prototype.dispose=function(){null!==this._bitmapCommitTimeout&&(window.clearTimeout(this._bitmapCommitTimeout),this._bitmapCommitTimeout=null)},e.prototype.beginFrame=function(){this._drawToCacheCount=0},e.prototype.draw=function(t,e,r,i){if(32===e.code)return!0;if(!this._canCache(e))return!1;var n=g(e),o=this._cacheMap.get(n);if(null!=o)return this._drawFromCache(t,o,r,i),!0;if(this._drawToCacheCount<100){var s;s=this._cacheMap.size<this._cacheMap.capacity?this._cacheMap.size:this._cacheMap.peek().index;var a=this._drawToCache(e,s);return this._cacheMap.set(n,a),this._drawFromCache(t,a,r,i),!0}return!1},e.prototype._canCache=function(t){return t.code<256},e.prototype._toCoordinateX=function(t){return t%this._width*this._config.scaledCharWidth},e.prototype._toCoordinateY=function(t){return Math.floor(t/this._width)*this._config.scaledCharHeight},e.prototype._drawFromCache=function(t,e,r,i){if(!e.isEmpty){var n=this._toCoordinateX(e.index),o=this._toCoordinateY(e.index);t.drawImage(e.inBitmap?this._bitmap:this._cacheCanvas,n,o,this._config.scaledCharWidth,this._config.scaledCharHeight,r,i,this._config.scaledCharWidth,this._config.scaledCharHeight)}},e.prototype._getColorFromAnsiIndex=function(t){return t<this._config.colors.ansi.length?this._config.colors.ansi[t]:a.DEFAULT_ANSI_COLORS[t]},e.prototype._getBackgroundColor=function(t){return this._config.allowTransparency?f:t.bg===o.INVERTED_DEFAULT_COLOR?this._config.colors.foreground:t.bg<256?this._getColorFromAnsiIndex(t.bg):this._config.colors.background},e.prototype._getForegroundColor=function(t){return t.fg===o.INVERTED_DEFAULT_COLOR?u.opaque(this._config.colors.background):t.fg<256?this._getColorFromAnsiIndex(t.fg):this._config.colors.foreground},e.prototype._drawToCache=function(t,e){this._drawToCacheCount++,this._tmpCtx.save();var r=this._getBackgroundColor(t);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=r.css,this._tmpCtx.fillRect(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),this._tmpCtx.globalCompositeOperation="source-over";var i=t.bold?this._config.fontWeightBold:this._config.fontWeight,n=t.italic?"italic":"";this._tmpCtx.font=n+" "+i+" "+this._config.fontSize*this._config.devicePixelRatio+"px "+this._config.fontFamily,this._tmpCtx.textBaseline="middle",this._tmpCtx.fillStyle=this._getForegroundColor(t).css,t.dim&&(this._tmpCtx.globalAlpha=o.DIM_OPACITY),this._tmpCtx.fillText(t.chars,0,this._config.scaledCharHeight/2),this._tmpCtx.restore();var s=this._tmpCtx.getImageData(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),a=!1;this._config.allowTransparency||(a=function(t,e){for(var r=!0,i=e.rgba>>>24,n=e.rgba>>>16&255,o=e.rgba>>>8&255,s=0;s<t.data.length;s+=4)t.data[s]===i&&t.data[s+1]===n&&t.data[s+2]===o?t.data[s+3]=0:r=!1;return r}(s,r));var h=this._toCoordinateX(e),c=this._toCoordinateY(e);this._cacheCtx.putImageData(s,h,c);var l={index:e,isEmpty:a,inBitmap:!1};return this._addGlyphToBitmap(l),l},e.prototype._addGlyphToBitmap=function(t){var e=this;"createImageBitmap"in window&&!c.isFirefox&&!c.isSafari&&(this._glyphsWaitingOnBitmap.push(t),null===this._bitmapCommitTimeout&&(this._bitmapCommitTimeout=window.setTimeout((function(){return e._generateBitmap()}),100)))},e.prototype._generateBitmap=function(){var t=this,e=this._glyphsWaitingOnBitmap;this._glyphsWaitingOnBitmap=[],window.createImageBitmap(this._cacheCanvas).then((function(r){t._bitmap=r;for(var i=0;i<e.length;i++)e[i].inBitmap=!0})),this._bitmapCommitTimeout=null},e}(s.BaseCharAtlas);e.DynamicCharAtlas=_;var v=function(t){function e(e,r){return t.call(this)||this}return n(e,t),e.prototype.draw=function(t,e,r,i){return!1},e}(s.BaseCharAtlas);e.NoneCharAtlas=v},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._didWarmUp=!1}return t.prototype.dispose=function(){},t.prototype.warmUp=function(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)},t.prototype._doWarmUp=function(){},t.prototype.beginFrame=function(){},t}();e.BaseCharAtlas=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._color={},this._rgba={}}return t.prototype.clear=function(){this._color={},this._rgba={}},t.prototype.setCss=function(t,e,r){this._rgba[t]||(this._rgba[t]={}),this._rgba[t][e]=r},t.prototype.getCss=function(t,e){return this._rgba[t]?this._rgba[t][e]:void 0},t.prototype.setColor=function(t,e,r){this._color[t]||(this._color[t]={}),this._color[t][e]=r},t.prototype.getColor=function(t,e){return this._color[t]?this._color[t][e]:void 0},t}();e.ColorContrastCache=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.capacity=t,this._map={},this._head=null,this._tail=null,this._nodePool=[],this.size=0}return t.prototype._unlinkNode=function(t){var e=t.prev,r=t.next;t===this._head&&(this._head=r),t===this._tail&&(this._tail=e),null!==e&&(e.next=r),null!==r&&(r.prev=e)},t.prototype._appendNode=function(t){var e=this._tail;null!==e&&(e.next=t),t.prev=e,t.next=null,this._tail=t,null===this._head&&(this._head=t)},t.prototype.prealloc=function(t){for(var e=this._nodePool,r=0;r<t;r++)e.push({prev:null,next:null,key:null,value:null})},t.prototype.get=function(t){var e=this._map[t];return void 0!==e?(this._unlinkNode(e),this._appendNode(e),e.value):null},t.prototype.peekValue=function(t){var e=this._map[t];return void 0!==e?e.value:null},t.prototype.peek=function(){var t=this._head;return null===t?null:t.value},t.prototype.set=function(t,e){var r=this._map[t];if(void 0!==r)r=this._map[t],this._unlinkNode(r),r.value=e;else if(this.size>=this.capacity)r=this._head,this._unlinkNode(r),delete this._map[r.key],r.key=t,r.value=e,this._map[t]=r;else{var i=this._nodePool;i.length>0?((r=i.pop()).key=t,r.value=e):r={prev:null,next:null,key:t,value:e},this._map[t]=r,this.size++}this._appendNode(r)},t}();e.LRUMap=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(e,r,i,n,o,s){var a=t.call(this,e,"selection",r,!0,i,n,o,s)||this;return a.bufferService=o,a.optionsService=s,a._clearState(),a}return n(e,t),e.prototype._clearState=function(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}},e.prototype.resize=function(e){t.prototype.resize.call(this,e),this._clearState()},e.prototype.reset=function(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())},e.prototype.onSelectionChanged=function(t,e,r){if(this._didStateChange(t,e,r,this._bufferService.buffer.ydisp))if(this._clearAll(),t&&e){var i=t[1]-this._bufferService.buffer.ydisp,n=e[1]-this._bufferService.buffer.ydisp,o=Math.max(i,0),s=Math.min(n,this._bufferService.rows-1);if(!(o>=this._bufferService.rows||s<0)){if(this._ctx.fillStyle=this._colors.selection.css,r){var a=t[0],h=e[0]-a,c=s-o+1;this._fillCells(a,o,h,c)}else{a=i===o?t[0]:0;var l=o===s?e[0]:this._bufferService.cols;this._fillCells(a,o,l-a,1);var u=Math.max(s-o-1,0);if(this._fillCells(0,o+1,this._bufferService.cols,u),o!==s){var p=n===s?e[0]:this._bufferService.cols;this._fillCells(0,s,p,1)}}this._state.start=[t[0],t[1]],this._state.end=[e[0],e[1]],this._state.columnSelectMode=r,this._state.ydisp=this._bufferService.buffer.ydisp}}else this._clearState()},e.prototype._didStateChange=function(t,e,r,i){return!this._areCoordinatesEqual(t,this._state.start)||!this._areCoordinatesEqual(e,this._state.end)||r!==this._state.columnSelectMode||i!==this._state.ydisp},e.prototype._areCoordinatesEqual=function(t,e){return!(!t||!e)&&t[0]===e[0]&&t[1]===e[1]},e}(r(13).BaseRenderLayer);e.SelectionRenderLayer=o},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(13),s=r(5),a=function(t){function e(e,r,i,n,o,a,h,c,l){var u=t.call(this,e,"cursor",r,!0,i,n,a,h)||this;return u._onRequestRefreshRowsEvent=o,u.bufferService=a,u.optionsService=h,u._coreService=c,u._coreBrowserService=l,u._cell=new s.CellData,u._state={x:0,y:0,isFocused:!1,style:"",width:0},u._cursorRenderers={bar:u._renderBarCursor.bind(u),block:u._renderBlockCursor.bind(u),underline:u._renderUnderlineCursor.bind(u)},u}return n(e,t),e.prototype.resize=function(e){t.prototype.resize.call(this,e),this._state={x:0,y:0,isFocused:!1,style:"",width:0}},e.prototype.reset=function(){this._clearCursor(),this._cursorBlinkStateManager&&(this._cursorBlinkStateManager.dispose(),this._cursorBlinkStateManager=void 0,this.onOptionsChanged())},e.prototype.onBlur=function(){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.pause(),this._onRequestRefreshRowsEvent.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},e.prototype.onFocus=function(){this._cursorBlinkStateManager?this._cursorBlinkStateManager.resume():this._onRequestRefreshRowsEvent.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},e.prototype.onOptionsChanged=function(){var t,e=this;this._optionsService.options.cursorBlink?this._cursorBlinkStateManager||(this._cursorBlinkStateManager=new h(this._coreBrowserService.isFocused,(function(){e._render(!0)}))):(null===(t=this._cursorBlinkStateManager)||void 0===t||t.dispose(),this._cursorBlinkStateManager=void 0),this._onRequestRefreshRowsEvent.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})},e.prototype.onCursorMove=function(){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.restartBlinkAnimation()},e.prototype.onGridChanged=function(t,e){!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isPaused?this._render(!1):this._cursorBlinkStateManager.restartBlinkAnimation()},e.prototype._render=function(t){if(this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden){var e=this._bufferService.buffer.ybase+this._bufferService.buffer.y,r=e-this._bufferService.buffer.ydisp;if(r<0||r>=this._bufferService.rows)this._clearCursor();else if(this._bufferService.buffer.lines.get(e).loadCell(this._bufferService.buffer.x,this._cell),void 0!==this._cell.content){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css;var i=this._optionsService.options.cursorStyle;return i&&"block"!==i?this._cursorRenderers[i](this._bufferService.buffer.x,r,this._cell):this._renderBlurCursor(this._bufferService.buffer.x,r,this._cell),this._ctx.restore(),this._state.x=this._bufferService.buffer.x,this._state.y=r,this._state.isFocused=!1,this._state.style=i,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isCursorVisible){if(this._state){if(this._state.x===this._bufferService.buffer.x&&this._state.y===r&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.options.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.options.cursorStyle||"block"](this._bufferService.buffer.x,r,this._cell),this._ctx.restore(),this._state.x=this._bufferService.buffer.x,this._state.y=r,this._state.isFocused=!1,this._state.style=this._optionsService.options.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}else this._clearCursor()},e.prototype._clearCursor=function(){this._state&&(this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})},e.prototype._renderBarCursor=function(t,e,r){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillLeftLineAtCell(t,e),this._ctx.restore()},e.prototype._renderBlockCursor=function(t,e,r){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillCells(t,e,r.getWidth(),1),this._ctx.fillStyle=this._colors.cursorAccent.css,this._fillCharTrueColor(r,t,e),this._ctx.restore()},e.prototype._renderUnderlineCursor=function(t,e,r){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillBottomLineAtCells(t,e),this._ctx.restore()},e.prototype._renderBlurCursor=function(t,e,r){this._ctx.save(),this._ctx.strokeStyle=this._colors.cursor.css,this._strokeRectAtCell(t,e,r.getWidth(),1),this._ctx.restore()},e}(o.BaseRenderLayer);e.CursorRenderLayer=a;var h=function(){function t(t,e){this._renderCallback=e,this.isCursorVisible=!0,t&&this._restartInterval()}return Object.defineProperty(t.prototype,"isPaused",{get:function(){return!(this._blinkStartTimeout||this._blinkInterval)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},t.prototype.restartBlinkAnimation=function(){var t=this;this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=window.requestAnimationFrame((function(){t._renderCallback(),t._animationFrame=void 0}))))},t.prototype._restartInterval=function(t){var e=this;void 0===t&&(t=600),this._blinkInterval&&window.clearInterval(this._blinkInterval),this._blinkStartTimeout=setTimeout((function(){if(e._animationTimeRestarted){var t=600-(Date.now()-e._animationTimeRestarted);if(e._animationTimeRestarted=void 0,t>0)return void e._restartInterval(t)}e.isCursorVisible=!1,e._animationFrame=window.requestAnimationFrame((function(){e._renderCallback(),e._animationFrame=void 0})),e._blinkInterval=setInterval((function(){if(e._animationTimeRestarted){var t=600-(Date.now()-e._animationTimeRestarted);return e._animationTimeRestarted=void 0,void e._restartInterval(t)}e.isCursorVisible=!e.isCursorVisible,e._animationFrame=window.requestAnimationFrame((function(){e._renderCallback(),e._animationFrame=void 0}))}),600)}),t)},t.prototype.pause=function(){this.isCursorVisible=!0,this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)},t.prototype.resume=function(){this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()},t}()},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(13),s=r(9),a=r(25),h=function(t){function e(e,r,i,n,o,s,a){var h=t.call(this,e,"link",r,!0,i,n,s,a)||this;return h.bufferService=s,h.optionsService=a,o.onLinkHover((function(t){return h._onLinkHover(t)})),o.onLinkLeave((function(t){return h._onLinkLeave(t)})),h}return n(e,t),e.prototype.resize=function(e){t.prototype.resize.call(this,e),this._state=void 0},e.prototype.reset=function(){this._clearCurrentLink()},e.prototype._clearCurrentLink=function(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);var t=this._state.y2-this._state.y1-1;t>0&&this._clearCells(0,this._state.y1+1,this._state.cols,t),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}},e.prototype._onLinkHover=function(t){if(t.fg===s.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._colors.background.css:t.fg&&a.is256Color(t.fg)?this._ctx.fillStyle=this._colors.ansi[t.fg].css:this._ctx.fillStyle=this._colors.foreground.css,t.y1===t.y2)this._fillBottomLineAtCells(t.x1,t.y1,t.x2-t.x1);else{this._fillBottomLineAtCells(t.x1,t.y1,t.cols-t.x1);for(var e=t.y1+1;e<t.y2;e++)this._fillBottomLineAtCells(0,e,t.cols);this._fillBottomLineAtCells(0,t.y2,t.x2)}this._state=t},e.prototype._onLinkLeave=function(t){this._clearCurrentLink()},e}(o.BaseRenderLayer);e.LinkRenderLayer=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(19),n=r(1),o=function(){function t(t,e){this._bufferService=t,this._logService=e,this._linkMatchers=[],this._nextLinkMatcherId=0,this._onLinkHover=new n.EventEmitter,this._onLinkLeave=new n.EventEmitter,this._onLinkTooltip=new n.EventEmitter,this._rowsToLinkify={start:void 0,end:void 0}}return Object.defineProperty(t.prototype,"onLinkHover",{get:function(){return this._onLinkHover.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onLinkLeave",{get:function(){return this._onLinkLeave.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onLinkTooltip",{get:function(){return this._onLinkTooltip.event},enumerable:!0,configurable:!0}),t.prototype.attachToDom=function(t,e){this._element=t,this._mouseZoneManager=e},t.prototype.linkifyRows=function(e,r){var i=this;this._mouseZoneManager&&(void 0===this._rowsToLinkify.start||void 0===this._rowsToLinkify.end?(this._rowsToLinkify.start=e,this._rowsToLinkify.end=r):(this._rowsToLinkify.start=Math.min(this._rowsToLinkify.start,e),this._rowsToLinkify.end=Math.max(this._rowsToLinkify.end,r)),this._mouseZoneManager.clearAll(e,r),this._rowsTimeoutId&&clearTimeout(this._rowsTimeoutId),this._rowsTimeoutId=setTimeout((function(){return i._linkifyRows()}),t._timeBeforeLatency))},t.prototype._linkifyRows=function(){this._rowsTimeoutId=void 0;var t=this._bufferService.buffer;if(void 0!==this._rowsToLinkify.start&&void 0!==this._rowsToLinkify.end){var e=t.ydisp+this._rowsToLinkify.start;if(!(e>=t.lines.length)){for(var r=t.ydisp+Math.min(this._rowsToLinkify.end,this._bufferService.rows)+1,i=Math.ceil(2e3/this._bufferService.cols),n=this._bufferService.buffer.iterator(!1,e,r,i,i);n.hasNext();)for(var o=n.next(),s=0;s<this._linkMatchers.length;s++)this._doLinkifyRow(o.range.first,o.content,this._linkMatchers[s]);this._rowsToLinkify.start=void 0,this._rowsToLinkify.end=void 0}}else this._logService.debug("_rowToLinkify was unset before _linkifyRows was called")},t.prototype.registerLinkMatcher=function(t,e,r){if(void 0===r&&(r={}),!e)throw new Error("handler must be defined");var i={id:this._nextLinkMatcherId++,regex:t,handler:e,matchIndex:r.matchIndex,validationCallback:r.validationCallback,hoverTooltipCallback:r.tooltipCallback,hoverLeaveCallback:r.leaveCallback,willLinkActivate:r.willLinkActivate,priority:r.priority||0};return this._addLinkMatcherToList(i),i.id},t.prototype._addLinkMatcherToList=function(t){if(0!==this._linkMatchers.length){for(var e=this._linkMatchers.length-1;e>=0;e--)if(t.priority<=this._linkMatchers[e].priority)return void this._linkMatchers.splice(e+1,0,t);this._linkMatchers.splice(0,0,t)}else this._linkMatchers.push(t)},t.prototype.deregisterLinkMatcher=function(t){for(var e=0;e<this._linkMatchers.length;e++)if(this._linkMatchers[e].id===t)return this._linkMatchers.splice(e,1),!0;return!1},t.prototype._doLinkifyRow=function(t,e,r){for(var i,n=this,o=new RegExp(r.regex.source,(r.regex.flags||"")+"g"),s=-1,a=function(){var a=i["number"!=typeof r.matchIndex?0:r.matchIndex];if(!a)return h._logService.debug("match found without corresponding matchIndex",i,r),"break";if(s=e.indexOf(a,s+1),o.lastIndex=s+a.length,s<0)return"break";var c=h._bufferService.buffer.stringIndexToBufferIndex(t,s);if(c[0]<0)return"break";var l=h._bufferService.buffer.lines.get(c[0]);if(!l)return"break";var u=l.getFg(c[1]),p=u?u>>9&511:void 0;r.validationCallback?r.validationCallback(a,(function(t){n._rowsTimeoutId||t&&n._addLink(c[1],c[0]-n._bufferService.buffer.ydisp,a,r,p)})):h._addLink(c[1],c[0]-h._bufferService.buffer.ydisp,a,r,p)},h=this;null!==(i=o.exec(e))&&"break"!==a(););},t.prototype._addLink=function(t,e,r,n,o){var a=this;if(this._mouseZoneManager&&this._element){var h=i.getStringCellWidth(r),c=t%this._bufferService.cols,l=e+Math.floor(t/this._bufferService.cols),u=(c+h)%this._bufferService.cols,p=l+Math.floor((c+h)/this._bufferService.cols);0===u&&(u=this._bufferService.cols,p--),this._mouseZoneManager.add(new s(c+1,l+1,u+1,p+1,(function(t){if(n.handler)return n.handler(t,r);window.open(r,"_blank")}),(function(){a._onLinkHover.fire(a._createLinkHoverEvent(c,l,u,p,o)),a._element.classList.add("xterm-cursor-pointer")}),(function(t){a._onLinkTooltip.fire(a._createLinkHoverEvent(c,l,u,p,o)),n.hoverTooltipCallback&&n.hoverTooltipCallback(t,r,{start:{x:c,y:l},end:{x:u,y:p}})}),(function(){a._onLinkLeave.fire(a._createLinkHoverEvent(c,l,u,p,o)),a._element.classList.remove("xterm-cursor-pointer"),n.hoverLeaveCallback&&n.hoverLeaveCallback()}),(function(t){return!n.willLinkActivate||n.willLinkActivate(t,r)})))}},t.prototype._createLinkHoverEvent=function(t,e,r,i,n){return{x1:t,y1:e,x2:r,y2:i,cols:this._bufferService.cols,fg:n}},t._timeBeforeLatency=200,t}();e.Linkifier=o;var s=function(t,e,r,i,n,o,s,a,h){this.x1=t,this.y1=e,this.x2=r,this.y2=i,this.clickCallback=n,this.hoverCallback=o,this.tooltipCallback=s,this.leaveCallback=a,this.willLinkActivate=h};e.MouseZone=s},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(11),s=r(52),a=r(5),h=r(1),c=r(4),l=r(0),u=r(29),p=r(53),d=String.fromCharCode(160),f=new RegExp(d,"g"),g=function(){function t(t,e,r,i,n,o,c,l){var u=this;this._scrollLines=t,this._element=e,this._screenElement=r,this._charSizeService=i,this._bufferService=n,this._coreService=o,this._mouseService=c,this._optionsService=l,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new a.CellData,this._mouseDownTimeStamp=0,this._onLinuxMouseSelection=new h.EventEmitter,this._onRedrawRequest=new h.EventEmitter,this._onSelectionChange=new h.EventEmitter,this._mouseMoveListener=function(t){return u._onMouseMove(t)},this._mouseUpListener=function(t){return u._onMouseUp(t)},this._coreService.onUserInput((function(){u.hasSelection&&u.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((function(t){return u._onTrim(t)})),this._bufferService.buffers.onBufferActivate((function(t){return u._onBufferActivate(t)})),this.enable(),this._model=new s.SelectionModel(this._bufferService),this._activeSelectionMode=0}return Object.defineProperty(t.prototype,"onLinuxMouseSelection",{get:function(){return this._onLinuxMouseSelection.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onRedrawRequest",{get:function(){return this._onRedrawRequest.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSelectionChange",{get:function(){return this._onSelectionChange.event},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._removeMouseDownListeners()},t.prototype.reset=function(){this.clearSelection()},t.prototype.disable=function(){this.clearSelection(),this._enabled=!1},t.prototype.enable=function(){this._enabled=!0},Object.defineProperty(t.prototype,"selectionStart",{get:function(){return this._model.finalSelectionStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectionEnd",{get:function(){return this._model.finalSelectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasSelection",{get:function(){var t=this._model.finalSelectionStart,e=this._model.finalSelectionEnd;return!(!t||!e||t[0]===e[0]&&t[1]===e[1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectionText",{get:function(){var t=this._model.finalSelectionStart,e=this._model.finalSelectionEnd;if(!t||!e)return"";var r=this._bufferService.buffer,i=[];if(3===this._activeSelectionMode){if(t[0]===e[0])return"";for(var n=t[1];n<=e[1];n++){var s=r.translateBufferLineToString(n,!0,t[0],e[0]);i.push(s)}}else{var a=t[1]===e[1]?e[0]:void 0;for(i.push(r.translateBufferLineToString(t[1],!0,t[0],a)),n=t[1]+1;n<=e[1]-1;n++){var h=r.lines.get(n);s=r.translateBufferLineToString(n,!0),h&&h.isWrapped?i[i.length-1]+=s:i.push(s)}t[1]!==e[1]&&(h=r.lines.get(e[1]),s=r.translateBufferLineToString(e[1],!0,0,e[0]),h&&h.isWrapped?i[i.length-1]+=s:i.push(s))}return i.map((function(t){return t.replace(f," ")})).join(o.isWindows?"\r\n":"\n")},enumerable:!0,configurable:!0}),t.prototype.clearSelection=function(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()},t.prototype.refresh=function(t){var e=this;this._refreshAnimationFrame||(this._refreshAnimationFrame=window.requestAnimationFrame((function(){return e._refresh()}))),o.isLinux&&t&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)},t.prototype._refresh=function(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})},t.prototype.isClickInSelection=function(t){var e=this._getMouseBufferCoords(t),r=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!!(r&&i&&e)&&this._areCoordsInSelection(e,r,i)},t.prototype._areCoordsInSelection=function(t,e,r){return t[1]>e[1]&&t[1]<r[1]||e[1]===r[1]&&t[1]===e[1]&&t[0]>=e[0]&&t[0]<r[0]||e[1]<r[1]&&t[1]===r[1]&&t[0]<r[0]||e[1]<r[1]&&t[1]===e[1]&&t[0]>=e[0]},t.prototype.selectWordAtCursor=function(t){var e=this._getMouseBufferCoords(t);e&&(this._selectWordAt(e,!1),this._model.selectionEnd=void 0,this.refresh(!0))},t.prototype.selectAll=function(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()},t.prototype.selectLines=function(t,e){this._model.clearSelection(),t=Math.max(t,0),e=Math.min(e,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,t],this._model.selectionEnd=[this._bufferService.cols,e],this.refresh(),this._onSelectionChange.fire()},t.prototype._onTrim=function(t){this._model.onTrim(t)&&this.refresh()},t.prototype._getMouseBufferCoords=function(t){var e=this._mouseService.getCoords(t,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(e)return e[0]--,e[1]--,e[1]+=this._bufferService.buffer.ydisp,e},t.prototype._getMouseEventScrollAmount=function(t){var e=u.getCoordsRelativeToElement(t,this._screenElement)[1],r=this._bufferService.rows*Math.ceil(this._charSizeService.height*this._optionsService.options.lineHeight);return e>=0&&e<=r?0:(e>r&&(e-=r),e=Math.min(Math.max(e,-50),50),(e/=50)/Math.abs(e)+Math.round(14*e))},t.prototype.shouldForceSelection=function(t){return o.isMac?t.altKey&&this._optionsService.options.macOptionClickForcesSelection:t.shiftKey},t.prototype.onMouseDown=function(t){if(this._mouseDownTimeStamp=t.timeStamp,(2!==t.button||!this.hasSelection)&&0===t.button){if(!this._enabled){if(!this.shouldForceSelection(t))return;t.stopPropagation()}t.preventDefault(),this._dragScrollAmount=0,this._enabled&&t.shiftKey?this._onIncrementalClick(t):1===t.detail?this._onSingleClick(t):2===t.detail?this._onDoubleClick(t):3===t.detail&&this._onTripleClick(t),this._addMouseDownListeners(),this.refresh(!0)}},t.prototype._addMouseDownListeners=function(){var t=this;this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=window.setInterval((function(){return t._dragScroll()}),50)},t.prototype._removeMouseDownListeners=function(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0},t.prototype._onIncrementalClick=function(t){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(t))},t.prototype._onSingleClick=function(t){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(t)?3:0,this._model.selectionStart=this._getMouseBufferCoords(t),this._model.selectionStart){this._model.selectionEnd=void 0;var e=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);e&&e.length!==this._model.selectionStart[0]&&0===e.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}},t.prototype._onDoubleClick=function(t){var e=this._getMouseBufferCoords(t);e&&(this._activeSelectionMode=1,this._selectWordAt(e,!0))},t.prototype._onTripleClick=function(t){var e=this._getMouseBufferCoords(t);e&&(this._activeSelectionMode=2,this._selectLineAt(e[1]))},t.prototype.shouldColumnSelect=function(t){return t.altKey&&!(o.isMac&&this._optionsService.options.macOptionClickForcesSelection)},t.prototype._onMouseMove=function(t){if(t.stopImmediatePropagation(),this._model.selectionStart){var e=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(t),this._model.selectionEnd){2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(t),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));var r=this._bufferService.buffer;if(this._model.selectionEnd[1]<r.lines.length){var i=r.lines.get(this._model.selectionEnd[1]);i&&0===i.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]++}e&&e[0]===this._model.selectionEnd[0]&&e[1]===this._model.selectionEnd[1]||this.refresh(!0)}else this.refresh(!0)}},t.prototype._dragScroll=function(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._scrollLines(this._dragScrollAmount,!1);var t=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(t.ydisp+this._bufferService.rows,t.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=t.ydisp),this.refresh()}},t.prototype._onMouseUp=function(t){var e=t.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&e<500){if(t.altKey&&this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){var r=this._mouseService.getCoords(t,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(r&&void 0!==r[0]&&void 0!==r[1]){var i=p.moveToCellSequence(r[0]-1,r[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(i,!0)}}}else this.hasSelection&&this._onSelectionChange.fire()},t.prototype._onBufferActivate=function(t){var e=this;this.clearSelection(),this._trimListener.dispose(),this._trimListener=t.activeBuffer.lines.onTrim((function(t){return e._onTrim(t)}))},t.prototype._convertViewportColToCharacterIndex=function(t,e){for(var r=e[0],i=0;e[0]>=i;i++){var n=t.loadCell(i,this._workCell).getChars().length;0===this._workCell.getWidth()?r--:n>1&&e[0]!==i&&(r+=n-1)}return r},t.prototype.setSelection=function(t,e,r){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[t,e],this._model.selectionStartLength=r,this.refresh()},t.prototype._getWordAt=function(t,e,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),!(t[0]>=this._bufferService.cols)){var n=this._bufferService.buffer,o=n.lines.get(t[1]);if(o){var s=n.translateBufferLineToString(t[1],!1),a=this._convertViewportColToCharacterIndex(o,t),h=a,c=t[0]-a,l=0,u=0,p=0,d=0;if(" "===s.charAt(a)){for(;a>0&&" "===s.charAt(a-1);)a--;for(;h<s.length&&" "===s.charAt(h+1);)h++}else{var f=t[0],g=t[0];0===o.getWidth(f)&&(l++,f--),2===o.getWidth(g)&&(u++,g++);var _=o.getString(g).length;for(_>1&&(d+=_-1,h+=_-1);f>0&&a>0&&!this._isCharWordSeparator(o.loadCell(f-1,this._workCell));){o.loadCell(f-1,this._workCell);var v=this._workCell.getChars().length;0===this._workCell.getWidth()?(l++,f--):v>1&&(p+=v-1,a-=v-1),a--,f--}for(;g<o.length&&h+1<s.length&&!this._isCharWordSeparator(o.loadCell(g+1,this._workCell));){o.loadCell(g+1,this._workCell);var y=this._workCell.getChars().length;2===this._workCell.getWidth()?(u++,g++):y>1&&(d+=y-1,h+=y-1),h++,g++}}h++;var m=a+c-l+p,b=Math.min(this._bufferService.cols,h-a+l+u-p-d);if(e||""!==s.slice(a,h).trim()){if(r&&0===m&&32!==o.getCodePoint(0)){var S=n.lines.get(t[1]-1);if(S&&o.isWrapped&&32!==S.getCodePoint(this._bufferService.cols-1)){var w=this._getWordAt([this._bufferService.cols-1,t[1]-1],!1,!0,!1);if(w){var C=this._bufferService.cols-w.start;m-=C,b+=C}}}if(i&&m+b===this._bufferService.cols&&32!==o.getCodePoint(this._bufferService.cols-1)){var M=n.lines.get(t[1]+1);if(M&&M.isWrapped&&32!==M.getCodePoint(0)){var E=this._getWordAt([0,t[1]+1],!1,!1,!0);E&&(b+=E.length)}}return{start:m,length:b}}}}},t.prototype._selectWordAt=function(t,e){var r=this._getWordAt(t,e);if(r){for(;r.start<0;)r.start+=this._bufferService.cols,t[1]--;this._model.selectionStart=[r.start,t[1]],this._model.selectionStartLength=r.length}},t.prototype._selectToWordAt=function(t){var e=this._getWordAt(t,!0);if(e){for(var r=t[1];e.start<0;)e.start+=this._bufferService.cols,r--;if(!this._model.areSelectionValuesReversed())for(;e.start+e.length>this._bufferService.cols;)e.length-=this._bufferService.cols,r++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?e.start:e.start+e.length,r]}},t.prototype._isCharWordSeparator=function(t){return 0!==t.getWidth()&&this._optionsService.options.wordSeparator.indexOf(t.getChars())>=0},t.prototype._selectLineAt=function(t){var e=this._bufferService.buffer.getWrappedRangeForLine(t);this._model.selectionStart=[0,e.first],this._model.selectionEnd=[this._bufferService.cols,e.last],this._model.selectionStartLength=0},i([n(3,c.ICharSizeService),n(4,l.IBufferService),n(5,l.ICoreService),n(6,c.IMouseService),n(7,l.IOptionsService)],t)}();e.SelectionService=g},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._bufferService=t,this.isSelectAllActive=!1,this.selectionStartLength=0}return t.prototype.clearSelection=function(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0},Object.defineProperty(t.prototype,"finalSelectionStart",{get:function(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"finalSelectionEnd",{get:function(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){var t=this.selectionStart[0]+this.selectionStartLength;return t>this._bufferService.cols?[t%this._bufferService.cols,this.selectionStart[1]+Math.floor(t/this._bufferService.cols)]:[t,this.selectionStart[1]]}return this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]?[Math.max(this.selectionStart[0]+this.selectionStartLength,this.selectionEnd[0]),this.selectionEnd[1]]:this.selectionEnd}},enumerable:!0,configurable:!0}),t.prototype.areSelectionValuesReversed=function(){var t=this.selectionStart,e=this.selectionEnd;return!(!t||!e)&&(t[1]>e[1]||t[1]===e[1]&&t[0]>e[0])},t.prototype.onTrim=function(t){return this.selectionStart&&(this.selectionStart[1]-=t),this.selectionEnd&&(this.selectionEnd[1]-=t),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)},t}();e.SelectionModel=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(12);function n(t,e,r,i){var n=t-o(r,t),s=e-o(r,e);return l(Math.abs(n-s)-function(t,e,r){for(var i=0,n=t-o(r,t),s=e-o(r,e),h=0;h<Math.abs(n-s);h++){var c="A"===a(t,e)?-1:1,l=r.buffer.lines.get(n+c*h);l&&l.isWrapped&&i++}return i}(t,e,r),c(a(t,e),i))}function o(t,e){for(var r=0,i=t.buffer.lines.get(e),n=i&&i.isWrapped;n&&e>=0&&e<t.rows;)r++,n=(i=t.buffer.lines.get(--e))&&i.isWrapped;return r}function s(t,e,r,i,s,a){var h;return h=n(r,i,s,a).length>0?i-o(s,i):e,t<r&&h<=i||t>=r&&h<i?"C":"D"}function a(t,e){return t>e?"A":"B"}function h(t,e,r,i,n,o){for(var s=t,a=e,h="";s!==r||a!==i;)s+=n?1:-1,n&&s>o.cols-1?(h+=o.buffer.translateBufferLineToString(a,!1,t,s),s=0,t=0,a++):!n&&s<0&&(h+=o.buffer.translateBufferLineToString(a,!1,0,t+1),t=s=o.cols-1,a--);return h+o.buffer.translateBufferLineToString(a,!1,t,s)}function c(t,e){var r=e?"O":"[";return i.C0.ESC+r+t}function l(t,e){t=Math.floor(t);for(var r="",i=0;i<t;i++)r+=e;return r}e.moveToCellSequence=function(t,e,r,i){var a=r.buffer.x,u=r.buffer.y;return r.buffer.hasScrollback?function(t,e,r,i,n,o){var a=s(t,e,r,i,n,o);return l(Math.abs(t-r),c(a,o))}(a,u,t,e,r,i):function(t,e,r,i,s,a){return 0===n(e,i,s,a).length?"":l(h(t,e,t,e-o(s,e),!1,s).length,c("D",a))}(a,u,0,e,r,i)+n(u,e,r,i)+function(t,e,r,i,a,u){var p;p=n(e,i,a,u).length>0?i-o(a,i):e;var d=i,f=s(t,e,r,i,a,u);return l(h(t,p,r,d,"C"===f,a).length,c(f,u))}(a,u,t,e,r,i)}},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),s=function(){function t(t){this._optionsService=t}return Object.defineProperty(t,"audioContext",{get:function(){if(!t._audioContext){var e=window.AudioContext||window.webkitAudioContext;if(!e)return console.warn("Web Audio API is not supported by this browser. Consider upgrading to the latest version"),null;t._audioContext=new e}return t._audioContext},enumerable:!0,configurable:!0}),t.prototype.playBellSound=function(){var e=t.audioContext;if(e){var r=e.createBufferSource();e.decodeAudioData(this._base64ToArrayBuffer(this._removeMimeType(this._optionsService.options.bellSound)),(function(t){r.buffer=t,r.connect(e.destination),r.start(0)}))}},t.prototype._base64ToArrayBuffer=function(t){for(var e=window.atob(t),r=e.length,i=new Uint8Array(r),n=0;n<r;n++)i[n]=e.charCodeAt(n);return i.buffer},t.prototype._removeMimeType=function(t){return t.split(",")[1]},t=i([n(0,o.IOptionsService)],t)}();e.SoundService=s},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},s=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(2),h=r(7),c=r(4),l=r(0),u=function(t){function e(e,r,i,n,o){var s=t.call(this)||this;return s._element=e,s._screenElement=r,s._bufferService=i,s._mouseService=n,s._selectionService=o,s._zones=[],s._areZonesActive=!1,s._lastHoverCoords=[void 0,void 0],s._initialSelectionLength=0,s.register(h.addDisposableDomListener(s._element,"mousedown",(function(t){return s._onMouseDown(t)}))),s._mouseMoveListener=function(t){return s._onMouseMove(t)},s._mouseLeaveListener=function(t){return s._onMouseLeave(t)},s._clickListener=function(t){return s._onClick(t)},s}return n(e,t),e.prototype.dispose=function(){t.prototype.dispose.call(this),this._deactivate()},e.prototype.add=function(t){this._zones.push(t),1===this._zones.length&&this._activate()},e.prototype.clearAll=function(t,e){if(0!==this._zones.length){t&&e||(t=0,e=this._bufferService.rows-1);for(var r=0;r<this._zones.length;r++){var i=this._zones[r];(i.y1>t&&i.y1<=e+1||i.y2>t&&i.y2<=e+1||i.y1<t&&i.y2>e+1)&&(this._currentZone&&this._currentZone===i&&(this._currentZone.leaveCallback(),this._currentZone=void 0),this._zones.splice(r--,1))}0===this._zones.length&&this._deactivate()}},e.prototype._activate=function(){this._areZonesActive||(this._areZonesActive=!0,this._element.addEventListener("mousemove",this._mouseMoveListener),this._element.addEventListener("mouseleave",this._mouseLeaveListener),this._element.addEventListener("click",this._clickListener))},e.prototype._deactivate=function(){this._areZonesActive&&(this._areZonesActive=!1,this._element.removeEventListener("mousemove",this._mouseMoveListener),this._element.removeEventListener("mouseleave",this._mouseLeaveListener),this._element.removeEventListener("click",this._clickListener))},e.prototype._onMouseMove=function(t){this._lastHoverCoords[0]===t.pageX&&this._lastHoverCoords[1]===t.pageY||(this._onHover(t),this._lastHoverCoords=[t.pageX,t.pageY])},e.prototype._onHover=function(t){var e=this,r=this._findZoneEventAt(t);r!==this._currentZone&&(this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=void 0,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout)),r&&(this._currentZone=r,r.hoverCallback&&r.hoverCallback(t),this._tooltipTimeout=setTimeout((function(){return e._onTooltip(t)}),500)))},e.prototype._onTooltip=function(t){this._tooltipTimeout=void 0;var e=this._findZoneEventAt(t);e&&e.tooltipCallback&&e.tooltipCallback(t)},e.prototype._onMouseDown=function(t){var e;this._initialSelectionLength=this._getSelectionLength(),this._areZonesActive&&(null===(e=this._findZoneEventAt(t))||void 0===e?void 0:e.willLinkActivate(t))&&(t.preventDefault(),t.stopImmediatePropagation())},e.prototype._onMouseLeave=function(t){this._currentZone&&(this._currentZone.leaveCallback(),this._currentZone=void 0,this._tooltipTimeout&&clearTimeout(this._tooltipTimeout))},e.prototype._onClick=function(t){var e=this._findZoneEventAt(t),r=this._getSelectionLength();e&&r===this._initialSelectionLength&&(e.clickCallback(t),t.preventDefault(),t.stopImmediatePropagation())},e.prototype._getSelectionLength=function(){var t=this._selectionService.selectionText;return t?t.length:0},e.prototype._findZoneEventAt=function(t){var e=this._mouseService.getCoords(t,this._screenElement,this._bufferService.cols,this._bufferService.rows);if(e)for(var r=e[0],i=e[1],n=0;n<this._zones.length;n++){var o=this._zones[n];if(o.y1===o.y2){if(i===o.y1&&r>=o.x1&&r<o.x2)return o}else if(i===o.y1&&r>=o.x1||i===o.y2&&r<o.x2||i>o.y1&&i<o.y2)return o}},o([s(2,l.IBufferService),s(3,c.IMouseService),s(4,c.ISelectionService)],e)}(a.Disposable);e.MouseZoneManager=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(17),s=r(11),a=r(30),h=r(7),c=r(2),l=r(31),u=function(t){function e(e,r){var i=t.call(this)||this;i._terminal=e,i._renderService=r,i._liveRegionLineCount=0,i._charsToConsume=[],i._charsToAnnounce="",i._accessibilityTreeRoot=document.createElement("div"),i._accessibilityTreeRoot.classList.add("xterm-accessibility"),i._rowContainer=document.createElement("div"),i._rowContainer.classList.add("xterm-accessibility-tree"),i._rowElements=[];for(var n=0;n<i._terminal.rows;n++)i._rowElements[n]=i._createAccessibilityTreeNode(),i._rowContainer.appendChild(i._rowElements[n]);return i._topBoundaryFocusListener=function(t){return i._onBoundaryFocus(t,0)},i._bottomBoundaryFocusListener=function(t){return i._onBoundaryFocus(t,1)},i._rowElements[0].addEventListener("focus",i._topBoundaryFocusListener),i._rowElements[i._rowElements.length-1].addEventListener("focus",i._bottomBoundaryFocusListener),i._refreshRowsDimensions(),i._accessibilityTreeRoot.appendChild(i._rowContainer),i._renderRowsDebouncer=new a.RenderDebouncer(i._renderRows.bind(i)),i._refreshRows(),i._liveRegion=document.createElement("div"),i._liveRegion.classList.add("live-region"),i._liveRegion.setAttribute("aria-live","assertive"),i._accessibilityTreeRoot.appendChild(i._liveRegion),i._terminal.element.insertAdjacentElement("afterbegin",i._accessibilityTreeRoot),i.register(i._renderRowsDebouncer),i.register(i._terminal.onResize((function(t){return i._onResize(t.rows)}))),i.register(i._terminal.onRender((function(t){return i._refreshRows(t.start,t.end)}))),i.register(i._terminal.onScroll((function(){return i._refreshRows()}))),i.register(i._terminal.onA11yChar((function(t){return i._onChar(t)}))),i.register(i._terminal.onLineFeed((function(){return i._onChar("\n")}))),i.register(i._terminal.onA11yTab((function(t){return i._onTab(t)}))),i.register(i._terminal.onKey((function(t){return i._onKey(t.key)}))),i.register(i._terminal.onBlur((function(){return i._clearLiveRegion()}))),i.register(i._renderService.onDimensionsChange((function(){return i._refreshRowsDimensions()}))),i._screenDprMonitor=new l.ScreenDprMonitor,i.register(i._screenDprMonitor),i._screenDprMonitor.setListener((function(){return i._refreshRowsDimensions()})),i.register(h.addDisposableDomListener(window,"resize",(function(){return i._refreshRowsDimensions()}))),i}return n(e,t),e.prototype.dispose=function(){t.prototype.dispose.call(this),this._terminal.element.removeChild(this._accessibilityTreeRoot),this._rowElements.length=0},e.prototype._onBoundaryFocus=function(t,e){var r=t.target,i=this._rowElements[0===e?1:this._rowElements.length-2];if(r.getAttribute("aria-posinset")!==(0===e?"1":""+this._terminal.buffer.lines.length)&&t.relatedTarget===i){var n,o;if(0===e?(n=r,o=this._rowElements.pop(),this._rowContainer.removeChild(o)):(n=this._rowElements.shift(),o=r,this._rowContainer.removeChild(n)),n.removeEventListener("focus",this._topBoundaryFocusListener),o.removeEventListener("focus",this._bottomBoundaryFocusListener),0===e){var s=this._createAccessibilityTreeNode();this._rowElements.unshift(s),this._rowContainer.insertAdjacentElement("afterbegin",s)}else s=this._createAccessibilityTreeNode(),this._rowElements.push(s),this._rowContainer.appendChild(s);this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===e?-1:1),this._rowElements[0===e?1:this._rowElements.length-2].focus(),t.preventDefault(),t.stopImmediatePropagation()}},e.prototype._onResize=function(t){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(var e=this._rowContainer.children.length;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);for(;this._rowElements.length>t;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()},e.prototype._createAccessibilityTreeNode=function(){var t=document.createElement("div");return t.setAttribute("role","listitem"),t.tabIndex=-1,this._refreshRowDimensions(t),t},e.prototype._onTab=function(t){for(var e=0;e<t;e++)this._onChar(" ")},e.prototype._onChar=function(t){var e=this;this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==t&&(this._charsToAnnounce+=t):this._charsToAnnounce+=t,"\n"===t&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=o.tooMuchOutput)),s.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout((function(){e._accessibilityTreeRoot.appendChild(e._liveRegion)}),0))},e.prototype._clearLiveRegion=function(){this._liveRegion.textContent="",this._liveRegionLineCount=0,s.isMac&&this._liveRegion.parentNode&&this._accessibilityTreeRoot.removeChild(this._liveRegion)},e.prototype._onKey=function(t){this._clearLiveRegion(),this._charsToConsume.push(t)},e.prototype._refreshRows=function(t,e){this._renderRowsDebouncer.refresh(t,e,this._terminal.rows)},e.prototype._renderRows=function(t,e){for(var r=this._terminal.buffer,i=r.lines.length.toString(),n=t;n<=e;n++){var o=r.translateBufferLineToString(r.ydisp+n,!0),s=(r.ydisp+n+1).toString(),a=this._rowElements[n];a&&(0===o.length?a.innerHTML="&nbsp;":a.textContent=o,a.setAttribute("aria-posinset",s),a.setAttribute("aria-setsize",i))}this._announceCharacters()},e.prototype._refreshRowsDimensions=function(){if(this._renderService.dimensions.actualCellHeight){this._rowElements.length!==this._terminal.rows&&this._onResize(this._terminal.rows);for(var t=0;t<this._terminal.rows;t++)this._refreshRowDimensions(this._rowElements[t])}},e.prototype._refreshRowDimensions=function(t){t.style.height=this._renderService.dimensions.actualCellHeight+"px"},e.prototype._announceCharacters=function(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")},e}(c.Disposable);e.AccessibilityManager=u},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},s=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(58),h=r(9),c=r(2),l=r(4),u=r(0),p=r(1),d=r(10),f="xterm-dom-renderer-owner-",g="xterm-rows",_="xterm-selection",v=1,y=function(t){function e(e,r,i,n,o,s,h,c){var l=t.call(this)||this;return l._colors=e,l._element=r,l._screenElement=i,l._viewportElement=n,l._linkifier=o,l._charSizeService=s,l._optionsService=h,l._bufferService=c,l._terminalClass=v++,l._rowElements=[],l._onRequestRefreshRows=new p.EventEmitter,l._rowContainer=document.createElement("div"),l._rowContainer.classList.add(g),l._rowContainer.style.lineHeight="normal",l._rowContainer.setAttribute("aria-hidden","true"),l._refreshRowElements(l._bufferService.cols,l._bufferService.rows),l._selectionContainer=document.createElement("div"),l._selectionContainer.classList.add(_),l._selectionContainer.setAttribute("aria-hidden","true"),l.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},l._updateDimensions(),l._injectCss(),l._rowFactory=new a.DomRendererRowFactory(document,l._optionsService,l._colors),l._element.classList.add(f+l._terminalClass),l._screenElement.appendChild(l._rowContainer),l._screenElement.appendChild(l._selectionContainer),l._linkifier.onLinkHover((function(t){return l._onLinkHover(t)})),l._linkifier.onLinkLeave((function(t){return l._onLinkLeave(t)})),l}return n(e,t),Object.defineProperty(e.prototype,"onRequestRefreshRows",{get:function(){return this._onRequestRefreshRows.event},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._element.classList.remove(f+this._terminalClass),this._screenElement.removeChild(this._rowContainer),this._screenElement.removeChild(this._selectionContainer),this._screenElement.removeChild(this._themeStyleElement),this._screenElement.removeChild(this._dimensionsStyleElement),t.prototype.dispose.call(this)},e.prototype._updateDimensions=function(){var t=this;this.dimensions.scaledCharWidth=this._charSizeService.width*window.devicePixelRatio,this.dimensions.scaledCharHeight=Math.ceil(this._charSizeService.height*window.devicePixelRatio),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._optionsService.options.letterSpacing),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._optionsService.options.lineHeight),this.dimensions.scaledCharLeft=0,this.dimensions.scaledCharTop=0,this.dimensions.scaledCanvasWidth=this.dimensions.scaledCellWidth*this._bufferService.cols,this.dimensions.scaledCanvasHeight=this.dimensions.scaledCellHeight*this._bufferService.rows,this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/window.devicePixelRatio),this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/window.devicePixelRatio),this.dimensions.actualCellWidth=this.dimensions.canvasWidth/this._bufferService.cols,this.dimensions.actualCellHeight=this.dimensions.canvasHeight/this._bufferService.rows,this._rowElements.forEach((function(e){e.style.width=t.dimensions.canvasWidth+"px",e.style.height=t.dimensions.actualCellHeight+"px",e.style.lineHeight=t.dimensions.actualCellHeight+"px",e.style.overflow="hidden"})),this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));var e=this._terminalSelector+" ."+g+" span { display: inline-block; height: 100%; vertical-align: top; width: "+this.dimensions.actualCellWidth+"px}";this._dimensionsStyleElement.innerHTML=e,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=this.dimensions.canvasWidth+"px",this._screenElement.style.height=this.dimensions.canvasHeight+"px"},e.prototype.setColors=function(t){this._colors=t,this._injectCss()},e.prototype._injectCss=function(){var t=this;this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));var e=this._terminalSelector+" ."+g+" { color: "+this._colors.foreground.css+"; background-color: "+this._colors.background.css+"; font-family: "+this._optionsService.options.fontFamily+"; font-size: "+this._optionsService.options.fontSize+"px;}";e+=this._terminalSelector+" span:not(."+a.BOLD_CLASS+") { font-weight: "+this._optionsService.options.fontWeight+";}"+this._terminalSelector+" span."+a.BOLD_CLASS+" { font-weight: "+this._optionsService.options.fontWeightBold+";}"+this._terminalSelector+" span."+a.ITALIC_CLASS+" { font-style: italic;}",e+="@keyframes blink_box_shadow { 50% {  box-shadow: none; }}",e+="@keyframes blink_block { 0% {  background-color: "+this._colors.cursor.css+";  color: "+this._colors.cursorAccent.css+"; } 50% {  background-color: "+this._colors.cursorAccent.css+";  color: "+this._colors.cursor.css+"; }}",e+=this._terminalSelector+" ."+g+":not(.xterm-focus) ."+a.CURSOR_CLASS+"."+a.CURSOR_STYLE_BLOCK_CLASS+" { outline: 1px solid "+this._colors.cursor.css+"; outline-offset: -1px;}"+this._terminalSelector+" ."+g+".xterm-focus ."+a.CURSOR_CLASS+"."+a.CURSOR_BLINK_CLASS+":not(."+a.CURSOR_STYLE_BLOCK_CLASS+") { animation: blink_box_shadow 1s step-end infinite;}"+this._terminalSelector+" ."+g+".xterm-focus ."+a.CURSOR_CLASS+"."+a.CURSOR_BLINK_CLASS+"."+a.CURSOR_STYLE_BLOCK_CLASS+" { animation: blink_block 1s step-end infinite;}"+this._terminalSelector+" ."+g+".xterm-focus ."+a.CURSOR_CLASS+"."+a.CURSOR_STYLE_BLOCK_CLASS+" { background-color: "+this._colors.cursor.css+"; color: "+this._colors.cursorAccent.css+";}"+this._terminalSelector+" ."+g+" ."+a.CURSOR_CLASS+"."+a.CURSOR_STYLE_BAR_CLASS+" { box-shadow: 1px 0 0 "+this._colors.cursor.css+" inset;}"+this._terminalSelector+" ."+g+" ."+a.CURSOR_CLASS+"."+a.CURSOR_STYLE_UNDERLINE_CLASS+" { box-shadow: 0 -1px 0 "+this._colors.cursor.css+" inset;}",e+=this._terminalSelector+" ."+_+" { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}"+this._terminalSelector+" ."+_+" div { position: absolute; background-color: "+this._colors.selection.css+";}",this._colors.ansi.forEach((function(r,i){e+=t._terminalSelector+" .xterm-fg-"+i+" { color: "+r.css+"; }"+t._terminalSelector+" .xterm-bg-"+i+" { background-color: "+r.css+"; }"})),e+=this._terminalSelector+" .xterm-fg-"+h.INVERTED_DEFAULT_COLOR+" { color: "+d.opaque(this._colors.background).css+"; }"+this._terminalSelector+" .xterm-bg-"+h.INVERTED_DEFAULT_COLOR+" { background-color: "+this._colors.foreground.css+"; }",this._themeStyleElement.innerHTML=e},e.prototype.onDevicePixelRatioChange=function(){this._updateDimensions()},e.prototype._refreshRowElements=function(t,e){for(var r=this._rowElements.length;r<=e;r++){var i=document.createElement("div");this._rowContainer.appendChild(i),this._rowElements.push(i)}for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop())},e.prototype.onResize=function(t,e){this._refreshRowElements(t,e),this._updateDimensions()},e.prototype.onCharSizeChanged=function(){this._updateDimensions()},e.prototype.onBlur=function(){this._rowContainer.classList.remove("xterm-focus")},e.prototype.onFocus=function(){this._rowContainer.classList.add("xterm-focus")},e.prototype.onSelectionChanged=function(t,e,r){for(;this._selectionContainer.children.length;)this._selectionContainer.removeChild(this._selectionContainer.children[0]);if(t&&e){var i=t[1]-this._bufferService.buffer.ydisp,n=e[1]-this._bufferService.buffer.ydisp,o=Math.max(i,0),s=Math.min(n,this._bufferService.rows-1);if(!(o>=this._bufferService.rows||s<0)){var a=document.createDocumentFragment();if(r)a.appendChild(this._createSelectionElement(o,t[0],e[0],s-o+1));else{var h=i===o?t[0]:0,c=o===s?e[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(o,h,c));var l=s-o-1;if(a.appendChild(this._createSelectionElement(o+1,0,this._bufferService.cols,l)),o!==s){var u=n===s?e[0]:this._bufferService.cols;a.appendChild(this._createSelectionElement(s,0,u))}}this._selectionContainer.appendChild(a)}}},e.prototype._createSelectionElement=function(t,e,r,i){void 0===i&&(i=1);var n=document.createElement("div");return n.style.height=i*this.dimensions.actualCellHeight+"px",n.style.top=t*this.dimensions.actualCellHeight+"px",n.style.left=e*this.dimensions.actualCellWidth+"px",n.style.width=this.dimensions.actualCellWidth*(r-e)+"px",n},e.prototype.onCursorMove=function(){},e.prototype.onOptionsChanged=function(){this._updateDimensions(),this._injectCss()},e.prototype.clear=function(){this._rowElements.forEach((function(t){return t.innerHTML=""}))},e.prototype.renderRows=function(t,e){for(var r=this._bufferService.buffer.ybase+this._bufferService.buffer.y,i=this._bufferService.buffer.x,n=this._optionsService.options.cursorBlink,o=t;o<=e;o++){var s=this._rowElements[o];s.innerHTML="";var a=o+this._bufferService.buffer.ydisp,h=this._bufferService.buffer.lines.get(a),c=this._optionsService.options.cursorStyle;s.appendChild(this._rowFactory.createRow(h,a===r,c,i,n,this.dimensions.actualCellWidth,this._bufferService.cols))}},Object.defineProperty(e.prototype,"_terminalSelector",{get:function(){return"."+f+this._terminalClass},enumerable:!0,configurable:!0}),e.prototype.registerCharacterJoiner=function(t){return-1},e.prototype.deregisterCharacterJoiner=function(t){return!1},e.prototype._onLinkHover=function(t){this._setCellUnderline(t.x1,t.x2,t.y1,t.y2,t.cols,!0)},e.prototype._onLinkLeave=function(t){this._setCellUnderline(t.x1,t.x2,t.y1,t.y2,t.cols,!1)},e.prototype._setCellUnderline=function(t,e,r,i,n,o){for(;t!==e||r!==i;){var s=this._rowElements[r];if(!s)return;var a=s.children[t];a&&(a.style.textDecoration=o?"underline":"none"),++t>=n&&(t=0,r++)}},o([s(5,l.ICharSizeService),s(6,u.IOptionsService),s(7,u.IBufferService)],e)}(c.Disposable);e.DomRenderer=y},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(9),n=r(3),o=r(5),s=r(10);e.BOLD_CLASS="xterm-bold",e.DIM_CLASS="xterm-dim",e.ITALIC_CLASS="xterm-italic",e.UNDERLINE_CLASS="xterm-underline",e.CURSOR_CLASS="xterm-cursor",e.CURSOR_BLINK_CLASS="xterm-cursor-blink",e.CURSOR_STYLE_BLOCK_CLASS="xterm-cursor-block",e.CURSOR_STYLE_BAR_CLASS="xterm-cursor-bar",e.CURSOR_STYLE_UNDERLINE_CLASS="xterm-cursor-underline";var a=function(){function t(t,e,r){this._document=t,this._optionsService=e,this._colors=r,this._workCell=new o.CellData}return t.prototype.setColors=function(t){this._colors=t},t.prototype.createRow=function(t,r,o,a,c,l,u){for(var p=this._document.createDocumentFragment(),d=0,f=Math.min(t.length,u)-1;f>=0;f--)if(t.loadCell(f,this._workCell).getCode()!==n.NULL_CELL_CODE||r&&f===a){d=f+1;break}for(f=0;f<d;f++){t.loadCell(f,this._workCell);var g=this._workCell.getWidth();if(0!==g){var _=this._document.createElement("span");if(g>1&&(_.style.width=l*g+"px"),r&&f===a)switch(_.classList.add(e.CURSOR_CLASS),c&&_.classList.add(e.CURSOR_BLINK_CLASS),o){case"bar":_.classList.add(e.CURSOR_STYLE_BAR_CLASS);break;case"underline":_.classList.add(e.CURSOR_STYLE_UNDERLINE_CLASS);break;default:_.classList.add(e.CURSOR_STYLE_BLOCK_CLASS)}this._workCell.isBold()&&_.classList.add(e.BOLD_CLASS),this._workCell.isItalic()&&_.classList.add(e.ITALIC_CLASS),this._workCell.isDim()&&_.classList.add(e.DIM_CLASS),this._workCell.isUnderline()&&_.classList.add(e.UNDERLINE_CLASS),_.textContent=this._workCell.getChars()||n.WHITESPACE_CELL_CHAR;var v=this._workCell.getFgColor(),y=this._workCell.getFgColorMode(),m=this._workCell.getBgColor(),b=this._workCell.getBgColorMode(),S=!!this._workCell.isInverse();if(S){var w=v;v=m,m=w;var C=y;y=b,b=C}switch(y){case 16777216:case 33554432:this._workCell.isBold()&&v<8&&this._optionsService.options.drawBoldTextInBrightColors&&(v+=8),this._applyMinimumContrast(_,this._colors.background,this._colors.ansi[v])||_.classList.add("xterm-fg-"+v);break;case 50331648:var M=s.rgbaToColor(v>>16&255,v>>8&255,255&v);this._applyMinimumContrast(_,this._colors.background,M)||this._addStyle(_,"color:#"+h(v.toString(16),"0",6));break;case 0:default:this._applyMinimumContrast(_,this._colors.background,this._colors.foreground)||S&&_.classList.add("xterm-fg-"+i.INVERTED_DEFAULT_COLOR)}switch(b){case 16777216:case 33554432:_.classList.add("xterm-bg-"+m);break;case 50331648:this._addStyle(_,"background-color:#"+h(m.toString(16),"0",6));break;case 0:default:S&&_.classList.add("xterm-bg-"+i.INVERTED_DEFAULT_COLOR)}p.appendChild(_)}}return p},t.prototype._applyMinimumContrast=function(t,e,r){if(1===this._optionsService.options.minimumContrastRatio)return!1;var i=this._colors.contrastCache.getColor(this._workCell.bg,this._workCell.fg);return void 0===i&&(i=s.ensureContrastRatio(e,r,this._optionsService.options.minimumContrastRatio),this._colors.contrastCache.setColor(this._workCell.bg,this._workCell.fg,null!=i?i:null)),!!i&&(this._addStyle(t,"color:"+i.css),!0)},t.prototype._addStyle=function(t,e){t.setAttribute("style",""+(t.getAttribute("style")||"")+e+";")},t}();function h(t,e,r){for(;t.length<r;)t=e+t;return t}e.DomRendererRowFactory=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(12),n={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};e.evaluateKeyboardEvent=function(t,e,r,o){var s={type:0,cancel:!1,key:void 0},a=(t.shiftKey?1:0)|(t.altKey?2:0)|(t.ctrlKey?4:0)|(t.metaKey?8:0);switch(t.keyCode){case 0:"UIKeyInputUpArrow"===t.key?s.key=e?i.C0.ESC+"OA":i.C0.ESC+"[A":"UIKeyInputLeftArrow"===t.key?s.key=e?i.C0.ESC+"OD":i.C0.ESC+"[D":"UIKeyInputRightArrow"===t.key?s.key=e?i.C0.ESC+"OC":i.C0.ESC+"[C":"UIKeyInputDownArrow"===t.key&&(s.key=e?i.C0.ESC+"OB":i.C0.ESC+"[B");break;case 8:if(t.shiftKey){s.key=i.C0.BS;break}if(t.altKey){s.key=i.C0.ESC+i.C0.DEL;break}s.key=i.C0.DEL;break;case 9:if(t.shiftKey){s.key=i.C0.ESC+"[Z";break}s.key=i.C0.HT,s.cancel=!0;break;case 13:s.key=i.C0.CR,s.cancel=!0;break;case 27:s.key=i.C0.ESC,s.cancel=!0;break;case 37:if(t.metaKey)break;a?(s.key=i.C0.ESC+"[1;"+(a+1)+"D",s.key===i.C0.ESC+"[1;3D"&&(s.key=i.C0.ESC+(r?"b":"[1;5D"))):s.key=e?i.C0.ESC+"OD":i.C0.ESC+"[D";break;case 39:if(t.metaKey)break;a?(s.key=i.C0.ESC+"[1;"+(a+1)+"C",s.key===i.C0.ESC+"[1;3C"&&(s.key=i.C0.ESC+(r?"f":"[1;5C"))):s.key=e?i.C0.ESC+"OC":i.C0.ESC+"[C";break;case 38:if(t.metaKey)break;a?(s.key=i.C0.ESC+"[1;"+(a+1)+"A",r||s.key!==i.C0.ESC+"[1;3A"||(s.key=i.C0.ESC+"[1;5A")):s.key=e?i.C0.ESC+"OA":i.C0.ESC+"[A";break;case 40:if(t.metaKey)break;a?(s.key=i.C0.ESC+"[1;"+(a+1)+"B",r||s.key!==i.C0.ESC+"[1;3B"||(s.key=i.C0.ESC+"[1;5B")):s.key=e?i.C0.ESC+"OB":i.C0.ESC+"[B";break;case 45:t.shiftKey||t.ctrlKey||(s.key=i.C0.ESC+"[2~");break;case 46:s.key=a?i.C0.ESC+"[3;"+(a+1)+"~":i.C0.ESC+"[3~";break;case 36:s.key=a?i.C0.ESC+"[1;"+(a+1)+"H":e?i.C0.ESC+"OH":i.C0.ESC+"[H";break;case 35:s.key=a?i.C0.ESC+"[1;"+(a+1)+"F":e?i.C0.ESC+"OF":i.C0.ESC+"[F";break;case 33:t.shiftKey?s.type=2:s.key=i.C0.ESC+"[5~";break;case 34:t.shiftKey?s.type=3:s.key=i.C0.ESC+"[6~";break;case 112:s.key=a?i.C0.ESC+"[1;"+(a+1)+"P":i.C0.ESC+"OP";break;case 113:s.key=a?i.C0.ESC+"[1;"+(a+1)+"Q":i.C0.ESC+"OQ";break;case 114:s.key=a?i.C0.ESC+"[1;"+(a+1)+"R":i.C0.ESC+"OR";break;case 115:s.key=a?i.C0.ESC+"[1;"+(a+1)+"S":i.C0.ESC+"OS";break;case 116:s.key=a?i.C0.ESC+"[15;"+(a+1)+"~":i.C0.ESC+"[15~";break;case 117:s.key=a?i.C0.ESC+"[17;"+(a+1)+"~":i.C0.ESC+"[17~";break;case 118:s.key=a?i.C0.ESC+"[18;"+(a+1)+"~":i.C0.ESC+"[18~";break;case 119:s.key=a?i.C0.ESC+"[19;"+(a+1)+"~":i.C0.ESC+"[19~";break;case 120:s.key=a?i.C0.ESC+"[20;"+(a+1)+"~":i.C0.ESC+"[20~";break;case 121:s.key=a?i.C0.ESC+"[21;"+(a+1)+"~":i.C0.ESC+"[21~";break;case 122:s.key=a?i.C0.ESC+"[23;"+(a+1)+"~":i.C0.ESC+"[23~";break;case 123:s.key=a?i.C0.ESC+"[24;"+(a+1)+"~":i.C0.ESC+"[24~";break;default:if(!t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)if(r&&!o||!t.altKey||t.metaKey)r&&!t.altKey&&!t.ctrlKey&&t.metaKey?65===t.keyCode&&(s.type=1):t.key&&!t.ctrlKey&&!t.altKey&&!t.metaKey&&t.keyCode>=48&&1===t.key.length?s.key=t.key:t.key&&t.ctrlKey&&"_"===t.key&&(s.key=i.C0.US);else{var h=n[t.keyCode],c=h&&h[t.shiftKey?1:0];if(c)s.key=i.C0.ESC+c;else if(t.keyCode>=65&&t.keyCode<=90){var l=t.ctrlKey?t.keyCode-64:t.keyCode+32;s.key=i.C0.ESC+String.fromCharCode(l)}}else t.keyCode>=65&&t.keyCode<=90?s.key=String.fromCharCode(t.keyCode-64):32===t.keyCode?s.key=i.C0.NUL:t.keyCode>=51&&t.keyCode<=55?s.key=String.fromCharCode(t.keyCode-51+27):56===t.keyCode?s.key=i.C0.DEL:219===t.keyCode?s.key=i.C0.ESC:220===t.keyCode?s.key=i.C0.FS:221===t.keyCode&&(s.key=i.C0.GS)}return s}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(3);e.handleWindowsModeLineFeed=function(t){var e,r=null===(e=t.buffer.lines.get(t.buffer.ybase+t.buffer.y-1))||void 0===e?void 0:e.get(t.cols-1),n=t.buffer.lines.get(t.buffer.ybase+t.buffer.y);n&&r&&(n.isWrapped=r[i.CHAR_DATA_CODE_INDEX]!==i.NULL_CELL_CODE&&r[i.CHAR_DATA_CODE_INDEX]!==i.WHITESPACE_CELL_CODE)}},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},s=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(30),h=r(1),c=r(2),l=r(31),u=r(7),p=r(0),d=r(4),f=function(t){function e(e,r,i,n,o){var s=t.call(this)||this;if(s._renderer=e,s._rowCount=r,s.screenElement=i,s.optionsService=n,s.charSizeService=o,s._isPaused=!1,s._needsFullRefresh=!1,s._canvasWidth=0,s._canvasHeight=0,s._onDimensionsChange=new h.EventEmitter,s._onRender=new h.EventEmitter,s._onRefreshRequest=new h.EventEmitter,s._renderDebouncer=new a.RenderDebouncer((function(t,e){return s._renderRows(t,e)})),s.register(s._renderDebouncer),s._screenDprMonitor=new l.ScreenDprMonitor,s._screenDprMonitor.setListener((function(){return s.onDevicePixelRatioChange()})),s.register(s._screenDprMonitor),s.register(n.onOptionChange((function(){return s._renderer.onOptionsChanged()}))),s.register(o.onCharSizeChange((function(){return s.onCharSizeChanged()}))),s._renderer.onRequestRefreshRows((function(t){return s.refreshRows(t.start,t.end)})),s.register(u.addDisposableDomListener(window,"resize",(function(){return s.onDevicePixelRatioChange()}))),"IntersectionObserver"in window){var c=new IntersectionObserver((function(t){return s._onIntersectionChange(t[t.length-1])}),{threshold:0});c.observe(i),s.register({dispose:function(){return c.disconnect()}})}return s}return n(e,t),Object.defineProperty(e.prototype,"onDimensionsChange",{get:function(){return this._onDimensionsChange.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onRender",{get:function(){return this._onRender.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onRefreshRequest",{get:function(){return this._onRefreshRequest.event},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dimensions",{get:function(){return this._renderer.dimensions},enumerable:!0,configurable:!0}),e.prototype._onIntersectionChange=function(t){this._isPaused=0===t.intersectionRatio,!this._isPaused&&this._needsFullRefresh&&(this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)},e.prototype.refreshRows=function(t,e){this._isPaused?this._needsFullRefresh=!0:this._renderDebouncer.refresh(t,e,this._rowCount)},e.prototype._renderRows=function(t,e){this._renderer.renderRows(t,e),this._onRender.fire({start:t,end:e})},e.prototype.resize=function(t,e){this._rowCount=e,this._fireOnCanvasResize()},e.prototype.changeOptions=function(){this._renderer.onOptionsChanged(),this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize()},e.prototype._fireOnCanvasResize=function(){this._renderer.dimensions.canvasWidth===this._canvasWidth&&this._renderer.dimensions.canvasHeight===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.dimensions)},e.prototype.dispose=function(){this._renderer.dispose(),t.prototype.dispose.call(this)},e.prototype.setRenderer=function(t){var e=this;this._renderer.dispose(),this._renderer=t,this._renderer.onRequestRefreshRows((function(t){return e.refreshRows(t.start,t.end)})),this.refreshRows(0,this._rowCount-1)},e.prototype._fullRefresh=function(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)},e.prototype.setColors=function(t){this._renderer.setColors(t),this._fullRefresh()},e.prototype.onDevicePixelRatioChange=function(){this._renderer.onDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1)},e.prototype.onResize=function(t,e){this._renderer.onResize(t,e),this._fullRefresh()},e.prototype.onCharSizeChanged=function(){this._renderer.onCharSizeChanged()},e.prototype.onBlur=function(){this._renderer.onBlur()},e.prototype.onFocus=function(){this._renderer.onFocus()},e.prototype.onSelectionChanged=function(t,e,r){this._renderer.onSelectionChanged(t,e,r)},e.prototype.onCursorMove=function(){this._renderer.onCursorMove()},e.prototype.clear=function(){this._renderer.clear()},e.prototype.registerCharacterJoiner=function(t){return this._renderer.registerCharacterJoiner(t)},e.prototype.deregisterCharacterJoiner=function(t){return this._renderer.deregisterCharacterJoiner(t)},o([s(3,p.IOptionsService),s(4,d.ICharSizeService)],e)}(c.Disposable);e.RenderService=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=r(11),o=r(32);e.DEFAULT_BELL_SOUND="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjMyLjEwNAAAAAAAAAAAAAAA//tQxAADB8AhSmxhIIEVCSiJrDCQBTcu3UrAIwUdkRgQbFAZC1CQEwTJ9mjRvBA4UOLD8nKVOWfh+UlK3z/177OXrfOdKl7pyn3Xf//WreyTRUoAWgBgkOAGbZHBgG1OF6zM82DWbZaUmMBptgQhGjsyYqc9ae9XFz280948NMBWInljyzsNRFLPWdnZGWrddDsjK1unuSrVN9jJsK8KuQtQCtMBjCEtImISdNKJOopIpBFpNSMbIHCSRpRR5iakjTiyzLhchUUBwCgyKiweBv/7UsQbg8isVNoMPMjAAAA0gAAABEVFGmgqK////9bP/6XCykxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq",e.DEFAULT_OPTIONS=Object.freeze({cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",bellSound:e.DEFAULT_BELL_SOUND,bellStyle:"none",drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",lineHeight:1,letterSpacing:0,logLevel:"info",scrollback:1e3,scrollSensitivity:1,screenReaderMode:!1,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:n.isMac,rendererType:"canvas",windowsMode:!1,convertEol:!1,termName:"xterm",screenKeys:!1,cancelEvents:!1,useFlowControl:!1,wordSeparator:" ()[]{}',:;\"`"});var s=["cols","rows"],a=function(){function t(t){var r=this;this._onOptionChange=new i.EventEmitter,this.options=o.clone(e.DEFAULT_OPTIONS),Object.keys(t).forEach((function(e){if(e in r.options){var i=t[e];r.options[e]=i}}))}return Object.defineProperty(t.prototype,"onOptionChange",{get:function(){return this._onOptionChange.event},enumerable:!0,configurable:!0}),t.prototype.setOption=function(t,r){if(!(t in e.DEFAULT_OPTIONS))throw new Error('No option with key "'+t+'"');if(-1!==s.indexOf(t))throw new Error('Option "'+t+'" can only be set in the constructor');this.options[t]!==r&&(r=this._sanitizeAndValidateOption(t,r),this.options[t]!==r&&(this.options[t]=r,this._onOptionChange.fire(t)))},t.prototype._sanitizeAndValidateOption=function(t,r){switch(t){case"bellStyle":case"cursorStyle":case"fontWeight":case"fontWeightBold":case"rendererType":case"wordSeparator":r||(r=e.DEFAULT_OPTIONS[t]);break;case"lineHeight":case"tabStopWidth":if(r<1)throw new Error(t+" cannot be less than 1, value: "+r);break;case"minimumContrastRatio":r=Math.max(1,Math.min(21,Math.round(10*r)/10));case"scrollback":if((r=Math.min(r,4294967295))<0)throw new Error(t+" cannot be less than 0, value: "+r);break;case"fastScrollSensitivity":case"scrollSensitivity":if(r<=0)throw new Error(t+" cannot be less than or equal to 0, value: "+r)}return r},t.prototype.getOption=function(t){if(!(t in e.DEFAULT_OPTIONS))throw new Error('No option with key "'+t+'"');return this.options[t]},t}();e.OptionsService=a},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),s=r(1),a=function(){function t(t,e,r){this.document=t,this.parentElement=e,this._optionsService=r,this.width=0,this.height=0,this._onCharSizeChange=new s.EventEmitter,this._measureStrategy=new h(t,e,this._optionsService)}return Object.defineProperty(t.prototype,"hasValidSize",{get:function(){return this.width>0&&this.height>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onCharSizeChange",{get:function(){return this._onCharSizeChange.event},enumerable:!0,configurable:!0}),t.prototype.measure=function(){var t=this._measureStrategy.measure();t.width===this.width&&t.height===this.height||(this.width=t.width,this.height=t.height,this._onCharSizeChange.fire())},i([n(2,o.IOptionsService)],t)}();e.CharSizeService=a;var h=function(){function t(t,e,r){this._document=t,this._parentElement=e,this._optionsService=r,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W",this._measureElement.setAttribute("aria-hidden","true"),this._parentElement.appendChild(this._measureElement)}return t.prototype.measure=function(){this._measureElement.style.fontFamily=this._optionsService.options.fontFamily,this._measureElement.style.fontSize=this._optionsService.options.fontSize+"px";var t=this._measureElement.getBoundingClientRect();return 0!==t.width&&0!==t.height&&(this._result.width=t.width,this._result.height=Math.ceil(t.height)),this._result},t}()},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),s=r(65);e.MINIMUM_COLS=2,e.MINIMUM_ROWS=1;var a=function(){function t(t){this._optionsService=t,this.cols=Math.max(t.options.cols,e.MINIMUM_COLS),this.rows=Math.max(t.options.rows,e.MINIMUM_ROWS),this.buffers=new s.BufferSet(t,this)}return Object.defineProperty(t.prototype,"buffer",{get:function(){return this.buffers.active},enumerable:!0,configurable:!0}),t.prototype.resize=function(t,e){this.cols=t,this.rows=e},t.prototype.reset=function(){this.buffers=new s.BufferSet(this._optionsService,this)},i([n(0,o.IOptionsService)],t)}();e.BufferService=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(66),n=r(1),o=function(){function t(t,e){this.optionsService=t,this.bufferService=e,this._onBufferActivate=new n.EventEmitter,this._normal=new i.Buffer(!0,t,e),this._normal.fillViewportRows(),this._alt=new i.Buffer(!1,t,e),this._activeBuffer=this._normal,this.setupTabStops()}return Object.defineProperty(t.prototype,"onBufferActivate",{get:function(){return this._onBufferActivate.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alt",{get:function(){return this._alt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"active",{get:function(){return this._activeBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._normal},enumerable:!0,configurable:!0}),t.prototype.activateNormalBuffer=function(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))},t.prototype.activateAltBuffer=function(t){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(t),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))},t.prototype.resize=function(t,e){this._normal.resize(t,e),this._alt.resize(t,e)},t.prototype.setupTabStops=function(t){this._normal.setupTabStops(t),this._alt.setupTabStops(t)},t}();e.BufferSet=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(67),n=r(16),o=r(5),s=r(3),a=r(68),h=r(69),c=r(18);e.MAX_BUFFER_SIZE=4294967295;var l=function(){function t(t,e,r){this._hasScrollback=t,this._optionsService=e,this._bufferService=r,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.savedY=0,this.savedX=0,this.savedCurAttrData=n.DEFAULT_ATTR_DATA.clone(),this.savedCharset=c.DEFAULT_CHARSET,this.markers=[],this._nullCell=o.CellData.fromCharData([0,s.NULL_CELL_CHAR,s.NULL_CELL_WIDTH,s.NULL_CELL_CODE]),this._whitespaceCell=o.CellData.fromCharData([0,s.WHITESPACE_CELL_CHAR,s.WHITESPACE_CELL_WIDTH,s.WHITESPACE_CELL_CODE]),this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new i.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}return t.prototype.getNullCell=function(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg):(this._nullCell.fg=0,this._nullCell.bg=0),this._nullCell},t.prototype.getWhitespaceCell=function(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0),this._whitespaceCell},t.prototype.getBlankLine=function(t,e){return new n.BufferLine(this._bufferService.cols,this.getNullCell(t),e)},Object.defineProperty(t.prototype,"hasScrollback",{get:function(){return this._hasScrollback&&this.lines.maxLength>this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCursorInViewport",{get:function(){var t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows},enumerable:!0,configurable:!0}),t.prototype._getCorrectBufferLength=function(t){if(!this._hasScrollback)return t;var r=t+this._optionsService.options.scrollback;return r>e.MAX_BUFFER_SIZE?e.MAX_BUFFER_SIZE:r},t.prototype.fillViewportRows=function(t){if(0===this.lines.length){void 0===t&&(t=n.DEFAULT_ATTR_DATA);for(var e=this._rows;e--;)this.lines.push(this.getBlankLine(t))}},t.prototype.clear=function(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new i.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()},t.prototype.resize=function(t,e){var r=this.getNullCell(n.DEFAULT_ATTR_DATA),i=this._getCorrectBufferLength(e);if(i>this.lines.maxLength&&(this.lines.maxLength=i),this.lines.length>0){if(this._cols<t)for(var o=0;o<this.lines.length;o++)this.lines.get(o).resize(t,r);var s=0;if(this._rows<e)for(var a=this._rows;a<e;a++)this.lines.length<e+this.ybase&&(this._optionsService.options.windowsMode?this.lines.push(new n.BufferLine(t,r)):this.ybase>0&&this.lines.length<=this.ybase+this.y+s+1?(this.ybase--,s++,this.ydisp>0&&this.ydisp--):this.lines.push(new n.BufferLine(t,r)));else for(a=this._rows;a>e;a--)this.lines.length>e+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(i<this.lines.maxLength){var h=this.lines.length-i;h>0&&(this.lines.trimStart(h),this.ybase=Math.max(this.ybase-h,0),this.ydisp=Math.max(this.ydisp-h,0),this.savedY=Math.max(this.savedY-h,0)),this.lines.maxLength=i}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,e-1),s&&(this.y+=s),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=e-1,this._isReflowEnabled&&(this._reflow(t,e),this._cols>t))for(o=0;o<this.lines.length;o++)this.lines.get(o).resize(t,r);this._cols=t,this._rows=e},Object.defineProperty(t.prototype,"_isReflowEnabled",{get:function(){return this._hasScrollback&&!this._optionsService.options.windowsMode},enumerable:!0,configurable:!0}),t.prototype._reflow=function(t,e){this._cols!==t&&(t>this._cols?this._reflowLarger(t,e):this._reflowSmaller(t,e))},t.prototype._reflowLarger=function(t,e){var r=a.reflowLargerGetLinesToRemove(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(n.DEFAULT_ATTR_DATA));if(r.length>0){var i=a.reflowLargerCreateNewLayout(this.lines,r);a.reflowLargerApplyNewLayout(this.lines,i.layout),this._reflowLargerAdjustViewport(t,e,i.countRemoved)}},t.prototype._reflowLargerAdjustViewport=function(t,e,r){for(var i=this.getNullCell(n.DEFAULT_ATTR_DATA),o=r;o-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<e&&this.lines.push(new n.BufferLine(t,i))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-r,0)},t.prototype._reflowSmaller=function(t,e){for(var r=this.getNullCell(n.DEFAULT_ATTR_DATA),i=[],o=0,s=this.lines.length-1;s>=0;s--){var h=this.lines.get(s);if(!(!h||!h.isWrapped&&h.getTrimmedLength()<=t)){for(var c=[h];h.isWrapped&&s>0;)h=this.lines.get(--s),c.unshift(h);var l=this.ybase+this.y;if(!(l>=s&&l<s+c.length)){var u,p=c[c.length-1].getTrimmedLength(),d=a.reflowSmallerGetNewLineLengths(c,this._cols,t),f=d.length-c.length;u=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+f):Math.max(0,this.lines.length-this.lines.maxLength+f);for(var g=[],_=0;_<f;_++){var v=this.getBlankLine(n.DEFAULT_ATTR_DATA,!0);g.push(v)}g.length>0&&(i.push({start:s+c.length+o,newLines:g}),o+=g.length),c.push.apply(c,g);var y=d.length-1,m=d[y];0===m&&(m=d[--y]);for(var b=c.length-f-1,S=p;b>=0;){var w=Math.min(S,m);if(c[y].copyCellsFrom(c[b],S-w,m-w,w,!0),0==(m-=w)&&(m=d[--y]),0==(S-=w)){b--;var C=Math.max(b,0);S=a.getWrappedLineTrimmedLength(c,C,this._cols)}}for(_=0;_<c.length;_++)d[_]<t&&c[_].setCell(d[_],r);for(var M=f-u;M-- >0;)0===this.ybase?this.y<e-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+o)-e&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+f,this.ybase+e-1)}}}if(i.length>0){var E=[],x=[];for(_=0;_<this.lines.length;_++)x.push(this.lines.get(_));var P=this.lines.length,k=P-1,T=0,L=i[T];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+o);var I=0;for(_=Math.min(this.lines.maxLength-1,P+o-1);_>=0;_--)if(L&&L.start>k+I){for(var A=L.newLines.length-1;A>=0;A--)this.lines.set(_--,L.newLines[A]);_++,E.push({index:k+1,amount:L.newLines.length}),I+=L.newLines.length,L=i[++T]}else this.lines.set(_,x[k--]);var D=0;for(_=E.length-1;_>=0;_--)E[_].index+=D,this.lines.onInsertEmitter.fire(E[_]),D+=E[_].amount;var R=Math.max(0,P+o-this.lines.maxLength);R>0&&this.lines.onTrimEmitter.fire(R)}},t.prototype.stringIndexToBufferIndex=function(t,e,r){for(void 0===r&&(r=!1);e;){var i=this.lines.get(t);if(!i)return[-1,-1];for(var n=r?i.getTrimmedLength():i.length,o=0;o<n;++o)if(i.get(o)[s.CHAR_DATA_WIDTH_INDEX]&&(e-=i.get(o)[s.CHAR_DATA_CHAR_INDEX].length||1),e<0)return[t,o];t++}return[t,0]},t.prototype.translateBufferLineToString=function(t,e,r,i){void 0===r&&(r=0);var n=this.lines.get(t);return n?n.translateToString(e,r,i):""},t.prototype.getWrappedRangeForLine=function(t){for(var e=t,r=t;e>0&&this.lines.get(e).isWrapped;)e--;for(;r+1<this.lines.length&&this.lines.get(r+1).isWrapped;)r++;return{first:e,last:r}},t.prototype.setupTabStops=function(t){for(null!=t?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.options.tabStopWidth)this.tabs[t]=!0},t.prototype.prevStop=function(t){for(null==t&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t},t.prototype.nextStop=function(t){for(null==t&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t},t.prototype.addMarker=function(t){var e=this,r=new h.Marker(t);return this.markers.push(r),r.register(this.lines.onTrim((function(t){r.line-=t,r.line<0&&r.dispose()}))),r.register(this.lines.onInsert((function(t){r.line>=t.index&&(r.line+=t.amount)}))),r.register(this.lines.onDelete((function(t){r.line>=t.index&&r.line<t.index+t.amount&&r.dispose(),r.line>t.index&&(r.line-=t.amount)}))),r.register(r.onDispose((function(){return e._removeMarker(r)}))),r},t.prototype._removeMarker=function(t){this.markers.splice(this.markers.indexOf(t),1)},t.prototype.iterator=function(t,e,r,i,n){return new u(this,t,e,r,i,n)},t}();e.Buffer=l;var u=function(){function t(t,e,r,i,n,o){void 0===r&&(r=0),void 0===i&&(i=t.lines.length),void 0===n&&(n=0),void 0===o&&(o=0),this._buffer=t,this._trimRight=e,this._startIndex=r,this._endIndex=i,this._startOverscan=n,this._endOverscan=o,this._startIndex<0&&(this._startIndex=0),this._endIndex>this._buffer.lines.length&&(this._endIndex=this._buffer.lines.length),this._current=this._startIndex}return t.prototype.hasNext=function(){return this._current<this._endIndex},t.prototype.next=function(){var t=this._buffer.getWrappedRangeForLine(this._current);t.first<this._startIndex-this._startOverscan&&(t.first=this._startIndex-this._startOverscan),t.last>this._endIndex+this._endOverscan&&(t.last=this._endIndex+this._endOverscan),t.first=Math.max(t.first,0),t.last=Math.min(t.last,this._buffer.lines.length);for(var e="",r=t.first;r<=t.last;++r)e+=this._buffer.translateBufferLineToString(r,this._trimRight);return this._current=t.last+1,{range:t,content:e}},t}();e.BufferStringIterator=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),n=function(){function t(t){this._maxLength=t,this.onDeleteEmitter=new i.EventEmitter,this.onInsertEmitter=new i.EventEmitter,this.onTrimEmitter=new i.EventEmitter,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}return Object.defineProperty(t.prototype,"onDelete",{get:function(){return this.onDeleteEmitter.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onInsert",{get:function(){return this.onInsertEmitter.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onTrim",{get:function(){return this.onTrimEmitter.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxLength",{get:function(){return this._maxLength},set:function(t){if(this._maxLength!==t){for(var e=new Array(t),r=0;r<Math.min(t,this.length);r++)e[r]=this._array[this._getCyclicIndex(r)];this._array=e,this._maxLength=t,this._startIndex=0}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(t){if(t>this._length)for(var e=this._length;e<t;e++)this._array[e]=void 0;this._length=t},enumerable:!0,configurable:!0}),t.prototype.get=function(t){return this._array[this._getCyclicIndex(t)]},t.prototype.set=function(t,e){this._array[this._getCyclicIndex(t)]=e},t.prototype.push=function(t){this._array[this._getCyclicIndex(this._length)]=t,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++},t.prototype.recycle=function(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]},Object.defineProperty(t.prototype,"isFull",{get:function(){return this._length===this._maxLength},enumerable:!0,configurable:!0}),t.prototype.pop=function(){return this._array[this._getCyclicIndex(this._length---1)]},t.prototype.splice=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e){for(var n=t;n<this._length-e;n++)this._array[this._getCyclicIndex(n)]=this._array[this._getCyclicIndex(n+e)];this._length-=e}for(n=this._length-1;n>=t;n--)this._array[this._getCyclicIndex(n+r.length)]=this._array[this._getCyclicIndex(n)];for(n=0;n<r.length;n++)this._array[this._getCyclicIndex(t+n)]=r[n];if(this._length+r.length>this._maxLength){var o=this._length+r.length-this._maxLength;this._startIndex+=o,this._length=this._maxLength,this.onTrimEmitter.fire(o)}else this._length+=r.length},t.prototype.trimStart=function(t){t>this._length&&(t=this._length),this._startIndex+=t,this._length-=t,this.onTrimEmitter.fire(t)},t.prototype.shiftElements=function(t,e,r){if(!(e<=0)){if(t<0||t>=this._length)throw new Error("start argument out of range");if(t+r<0)throw new Error("Cannot shift elements in list beyond index 0");if(r>0){for(var i=e-1;i>=0;i--)this.set(t+i+r,this.get(t+i));var n=t+e+r-this._length;if(n>0)for(this._length+=n;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(i=0;i<e;i++)this.set(t+i+r,this.get(t+i))}},t.prototype._getCyclicIndex=function(t){return(this._startIndex+t)%this._maxLength},t}();e.CircularList=n},function(t,e,r){"use strict";function i(t,e,r){if(e===t.length-1)return t[e].getTrimmedLength();var i=!t[e].hasContent(r-1)&&1===t[e].getWidth(r-1),n=2===t[e+1].getWidth(0);return i&&n?r-1:r}Object.defineProperty(e,"__esModule",{value:!0}),e.reflowLargerGetLinesToRemove=function(t,e,r,n,o){for(var s=[],a=0;a<t.length-1;a++){var h=a,c=t.get(++h);if(c.isWrapped){for(var l=[t.get(a)];h<t.length&&c.isWrapped;)l.push(c),c=t.get(++h);if(n>=a&&n<h)a+=l.length-1;else{for(var u=0,p=i(l,u,e),d=1,f=0;d<l.length;){var g=i(l,d,e),_=g-f,v=r-p,y=Math.min(_,v);l[u].copyCellsFrom(l[d],f,p,y,!1),(p+=y)===r&&(u++,p=0),(f+=y)===g&&(d++,f=0),0===p&&0!==u&&2===l[u-1].getWidth(r-1)&&(l[u].copyCellsFrom(l[u-1],r-1,p++,1,!1),l[u-1].setCell(r-1,o))}l[u].replaceCells(p,r,o);for(var m=0,b=l.length-1;b>0&&(b>u||0===l[b].getTrimmedLength());b--)m++;m>0&&(s.push(a+l.length-m),s.push(m)),a+=l.length-1}}}return s},e.reflowLargerCreateNewLayout=function(t,e){for(var r=[],i=0,n=e[i],o=0,s=0;s<t.length;s++)if(n===s){var a=e[++i];t.onDeleteEmitter.fire({index:s-o,amount:a}),s+=a-1,o+=a,n=e[++i]}else r.push(s);return{layout:r,countRemoved:o}},e.reflowLargerApplyNewLayout=function(t,e){for(var r=[],i=0;i<e.length;i++)r.push(t.get(e[i]));for(i=0;i<r.length;i++)t.set(i,r[i]);t.length=e.length},e.reflowSmallerGetNewLineLengths=function(t,e,r){for(var n=[],o=t.map((function(r,n){return i(t,n,e)})).reduce((function(t,e){return t+e})),s=0,a=0,h=0;h<o;){if(o-h<r){n.push(o-h);break}s+=r;var c=i(t,a,e);s>c&&(s-=c,a++);var l=2===t[a].getWidth(s-1);l&&s--;var u=l?r-1:r;n.push(u),h+=u}return n},e.getWrappedLineTrimmedLength=i},function(t,e,r){"use strict";var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(1),s=function(t){function e(r){var i=t.call(this)||this;return i.line=r,i._id=e._nextId++,i.isDisposed=!1,i._onDispose=new o.EventEmitter,i}return n(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{get:function(){return this._onDispose.event},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire())},e._nextId=1,e}(r(2).Disposable);e.Marker=s},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(4),s=r(29),a=function(){function t(t,e){this._renderService=t,this._charSizeService=e}return t.prototype.getCoords=function(t,e,r,i,n){return s.getCoords(t,e,r,i,this._charSizeService.hasValidSize,this._renderService.dimensions.actualCellWidth,this._renderService.dimensions.actualCellHeight,n)},t.prototype.getRawByteCoords=function(t,e,r,i){var n=this.getCoords(t,e,r,i);return s.getRawByteCoords(n)},i([n(0,o.IRenderService),n(1,o.ICharSizeService)],t)}();e.MouseService=a},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),s=r(1),a=r(32),h=Object.freeze({applicationCursorKeys:!1}),c=function(){function t(t,e,r,i){this._scrollToBottom=t,this._bufferService=e,this._logService=r,this._optionsService=i,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=new s.EventEmitter,this._onUserInput=new s.EventEmitter,this._onBinary=new s.EventEmitter,this.decPrivateModes=a.clone(h)}return Object.defineProperty(t.prototype,"onData",{get:function(){return this._onData.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onUserInput",{get:function(){return this._onUserInput.event},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBinary",{get:function(){return this._onBinary.event},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.decPrivateModes=a.clone(h)},t.prototype.triggerDataEvent=function(t,e){if(void 0===e&&(e=!1),!this._optionsService.options.disableStdin){var r=this._bufferService.buffer;r.ybase!==r.ydisp&&this._scrollToBottom(),e&&this._onUserInput.fire(),this._logService.debug('sending data "'+t+'"',(function(){return t.split("").map((function(t){return t.charCodeAt(0)}))})),this._onData.fire(t)}},t.prototype.triggerBinaryEvent=function(t){this._optionsService.options.disableStdin||(this._logService.debug('sending binary "'+t+'"',(function(){return t.split("").map((function(t){return t.charCodeAt(0)}))})),this._onBinary.fire(t))},i([n(1,o.IBufferService),n(2,o.ILogService),n(3,o.IOptionsService)],t)}();e.CoreService=c},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}},o=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var s,a=r(0);!function(t){t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARN=2]="WARN",t[t.ERROR=3]="ERROR",t[t.OFF=4]="OFF"}(s=e.LogLevel||(e.LogLevel={}));var h={debug:s.DEBUG,info:s.INFO,warn:s.WARN,error:s.ERROR,off:s.OFF},c=function(){function t(t){var e=this;this._optionsService=t,this._updateLogLevel(),this._optionsService.onOptionChange((function(t){"logLevel"===t&&e._updateLogLevel()}))}return t.prototype._updateLogLevel=function(){this._logLevel=h[this._optionsService.options.logLevel]},t.prototype._evalLazyOptionalParams=function(t){for(var e=0;e<t.length;e++)"function"==typeof t[e]&&(t[e]=t[e]())},t.prototype._log=function(t,e,r){this._evalLazyOptionalParams(r),t.call.apply(t,o([console,"xterm.js: "+e],r))},t.prototype.debug=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this._logLevel<=s.DEBUG&&this._log(console.log,t,e)},t.prototype.info=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this._logLevel<=s.INFO&&this._log(console.info,t,e)},t.prototype.warn=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this._logLevel<=s.WARN&&this._log(console.warn,t,e)},t.prototype.error=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this._logLevel<=s.ERROR&&this._log(console.error,t,e)},i([n(0,a.IOptionsService)],t)}();e.LogService=c},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),s=function(){function t(t){this._bufferService=t,this.clearRange()}return Object.defineProperty(t.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),t.prototype.clearRange=function(){this._start=this._bufferService.buffer.y,this._end=this._bufferService.buffer.y},t.prototype.markDirty=function(t){t<this._start?this._start=t:t>this._end&&(this._end=t)},t.prototype.markRangeDirty=function(t,e){if(t>e){var r=t;t=e,e=r}t<this._start&&(this._start=t),e>this._end&&(this._end=e)},t.prototype.markAllDirty=function(){this.markRangeDirty(0,this._bufferService.rows-1)},i([n(0,o.IBufferService)],t)}();e.DirtyRowService=s},function(t,e,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i};Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),o=r(14),s=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._entries=new Map;for(var r=0,i=t;r<i.length;r++){var n=i[r],o=n[0],s=n[1];this.set(o,s)}}return t.prototype.set=function(t,e){var r=this._entries.get(t);return this._entries.set(t,e),r},t.prototype.forEach=function(t){this._entries.forEach((function(e,r){return t(r,e)}))},t.prototype.has=function(t){return this._entries.has(t)},t.prototype.get=function(t){return this._entries.get(t)},t}();e.ServiceCollection=s;var a=function(){function t(){this._services=new s,this._services.set(n.IInstantiationService,this)}return t.prototype.setService=function(t,e){this._services.set(t,e)},t.prototype.createInstance=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var n=o.getServiceDependencies(t).sort((function(t,e){return t.index-e.index})),s=[],a=0,h=n;a<h.length;a++){var c=h[a],l=this._services.get(c.id);if(!l)throw new Error("[createInstance] "+t.name+" depends on UNKNOWN service "+c.id+".");s.push(l)}var u=n.length>0?n[0].index:e.length;if(e.length!==u)throw new Error("[createInstance] First service dependency of "+t.name+" at position "+(u+1)+" conflicts with "+e.length+" static arguments");return new(t.bind.apply(t,i([void 0],i(e,s))))},t}();e.InstantiationService=a},function(t,e,r){"use strict";var i=this&&this.__decorate||function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s},n=this&&this.__param||function(t,e){return function(r,i){e(r,i,t)}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),s=r(1),a={NONE:{events:0,restrict:function(){return!1}},X10:{events:1,restrict:function(t){return 4!==t.button&&1===t.action&&(t.ctrl=!1,t.alt=!1,t.shift=!1,!0)}},VT200:{events:19,restrict:function(t){return 32!==t.action}},DRAG:{events:23,restrict:function(t){return 32!==t.action||3!==t.button}},ANY:{events:31,restrict:function(t){return!0}}};function h(t,e){var r=(t.ctrl?16:0)|(t.shift?4:0)|(t.alt?8:0);return 4===t.button?(r|=64,r|=t.action):(r|=3&t.button,4&t.button&&(r|=64),8&t.button&&(r|=128),32===t.action?r|=32:0!==t.action||e||(r|=3)),r}var c=String.fromCharCode,l={DEFAULT:function(t){var e=[h(t,!1)+32,t.col+32,t.row+32];return e[0]>255||e[1]>255||e[2]>255?"":"[M"+c(e[0])+c(e[1])+c(e[2])},SGR:function(t){var e=0===t.action&&4!==t.button?"m":"M";return"[<"+h(t,!0)+";"+t.col+";"+t.row+e}},u=function(){function t(t,e){var r=this;this._bufferService=t,this._coreService=e,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._onProtocolChange=new s.EventEmitter,this._lastEvent=null,Object.keys(a).forEach((function(t){return r.addProtocol(t,a[t])})),Object.keys(l).forEach((function(t){return r.addEncoding(t,l[t])})),this.reset()}return t.prototype.addProtocol=function(t,e){this._protocols[t]=e},t.prototype.addEncoding=function(t,e){this._encodings[t]=e},Object.defineProperty(t.prototype,"activeProtocol",{get:function(){return this._activeProtocol},set:function(t){if(!this._protocols[t])throw new Error('unknown protocol "'+t+'"');this._activeProtocol=t,this._onProtocolChange.fire(this._protocols[t].events)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeEncoding",{get:function(){return this._activeEncoding},set:function(t){if(!this._encodings[t])throw new Error('unknown encoding "'+t+'"');this._activeEncoding=t},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null},Object.defineProperty(t.prototype,"onProtocolChange",{get:function(){return this._onProtocolChange.event},enumerable:!0,configurable:!0}),t.prototype.triggerMouseEvent=function(t){if(t.col<0||t.col>=this._bufferService.cols||t.row<0||t.row>=this._bufferService.rows)return!1;if(4===t.button&&32===t.action)return!1;if(3===t.button&&32!==t.action)return!1;if(4!==t.button&&(2===t.action||3===t.action))return!1;if(t.col++,t.row++,32===t.action&&this._lastEvent&&this._compareEvents(this._lastEvent,t))return!1;if(!this._protocols[this._activeProtocol].restrict(t))return!1;var e=this._encodings[this._activeEncoding](t);return e&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(e):this._coreService.triggerDataEvent(e,!0)),this._lastEvent=t,!0},t.prototype.explainEvents=function(t){return{DOWN:!!(1&t),UP:!!(2&t),DRAG:!!(4&t),MOVE:!!(8&t),WHEEL:!!(16&t)}},t.prototype._compareEvents=function(t,e){return t.col===e.col&&t.row===e.row&&t.button===e.button&&t.action===e.action&&t.ctrl===e.ctrl&&t.alt===e.alt&&t.shift===e.shift},i([n(0,o.IBufferService),n(1,o.ICoreService)],t)}();e.CoreMouseService=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._action=t,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0}return t.prototype.writeSync=function(t){if(this._writeBuffer.length){for(var e=this._bufferOffset;e<this._writeBuffer.length;++e){var r=this._writeBuffer[e],i=this._callbacks[e];this._action(r),i&&i()}this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=2147483647}this._action(t)},t.prototype.write=function(t,e){var r=this;if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");this._writeBuffer.length||(this._bufferOffset=0,setTimeout((function(){return r._innerWrite()}))),this._pendingData+=t.length,this._writeBuffer.push(t),this._callbacks.push(e)},t.prototype._innerWrite=function(){for(var t=this,e=Date.now();this._writeBuffer.length>this._bufferOffset;){var r=this._writeBuffer[this._bufferOffset],i=this._callbacks[this._bufferOffset];if(this._bufferOffset++,this._action(r),this._pendingData-=r.length,i&&i(),Date.now()-e>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((function(){return t._innerWrite()}),0)):(this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0)},t}();e.WriteBuffer=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._textarea=t}return Object.defineProperty(t.prototype,"isFocused",{get:function(){return document.activeElement===this._textarea&&document.hasFocus()},enumerable:!0,configurable:!0}),t}();e.CoreBrowserService=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._addons=[]}return t.prototype.dispose=function(){for(var t=this._addons.length-1;t>=0;t--)this._addons[t].instance.dispose()},t.prototype.loadAddon=function(t,e){var r=this,i={instance:e,dispose:e.dispose,isDisposed:!1};this._addons.push(i),e.dispose=function(){return r._wrappedAddonDispose(i)},e.activate(t)},t.prototype._wrappedAddonDispose=function(t){if(!t.isDisposed){for(var e=-1,r=0;r<this._addons.length;r++)if(this._addons[r]===t){e=r;break}if(-1===e)throw new Error("Could not dispose an addon that has not been loaded");t.isDisposed=!0,t.dispose.apply(t.instance),this._addons.splice(e,1)}},t}();e.AddonManager=i}])},function(t,e,r){"use strict";var i=function(t,e){this.allApps=t,this.getCurrent=e.getCurrent,this.setCurrent=e.setCurrent};e.a=i},function(t,e,r){"use strict";(function(t,i){var n,o=r(45);n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:i;var s=Object(o.a)(n);e.a=s}).call(this,r(15),r(61)(t))},function(t,e,r){"use strict";var i=r(4),n=r.n(i);function o(t,e){void 0===e&&(e={});var r=document.createElement("div");t.parentNode.appendChild(r),r.appendChild(t);var i,o,s,a,h,c,l,u=e.title||document.createElement("span");return n()(r).prepend(u),i=u,a=!1,h=r||i,c=0,l=0,i.addEventListener("mousedown",(function(t){o=t.clientX,s=t.clientY,a=!0})),i.addEventListener("mouseup",(function(t){a=!1,c=parseInt(h.style.left)||0,l=parseInt(h.style.top)||0})),document.addEventListener("mousemove",(function(t){if(a){var e=t.clientX-o,r=t.clientY-s;h.style.left=c+e+"px",h.style.top=l+r+"px",i.style.left=c+e+"px",i.style.top=l+r+"px"}})),e.decoration(u),{_d:r,_t:u}}r.d(e,"a",(function(){return o}))},function(module,exports){var morphicVersion="2018-March-19",modules={},useBlurredShadows=getBlurredShadowSupport(),standardSettings={minimumFontHeight:getMinimumFontHeight(),globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:12,bubbleHelpFontSize:10,prompterFontName:"sans-serif",prompterFontSize:12,prompterSliderSize:10,handleSize:15,scrollBarSize:12,mouseScrollAmount:40,useSliderForInput:!1,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1,grabThreshold:5},touchScreenSettings={minimumFontHeight:standardSettings.minimumFontHeight,globalFontFamily:"",menuFontName:"sans-serif",menuFontSize:24,bubbleHelpFontSize:18,prompterFontName:"sans-serif",prompterFontSize:24,prompterSliderSize:20,handleSize:26,scrollBarSize:24,mouseScrollAmount:40,useSliderForInput:!0,useVirtualKeyboard:!0,isTouchDevice:!1,rasterizeSVGs:!1,isFlat:!1,grabThreshold:5},MorphicPreferences=standardSettings,Morph,WorldMorph,HandMorph,ShadowMorph,FrameMorph,MenuMorph,HandleMorph,StringFieldMorph,ColorPickerMorph,SliderMorph,ScrollFrameMorph,InspectorMorph,StringMorph,TextMorph,PenMorph,ColorPaletteMorph,GrayPaletteMorph,BlinkerMorph,CursorMorph,BoxMorph,SpeechBubbleMorph,DialMorph,CircleBoxMorph,SliderButtonMorph,MouseSensorMorph,ListMorph,TriggerMorph,MenuItemMorph,MenuItemMorph,BouncerMorph;function nop(){return null}function localize(t){return t}function isNil(t){return null==t}function contains(t,e){return-1!==t.indexOf(e)}function detect(t,e){var r,i=t.length;for(r=0;r<i;r+=1)if(e.call(null,t[r]))return t[r];return null}function sizeOf(t){var e,r=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r+=1);return r}function isString(t){return"string"==typeof t||t instanceof String}function isObject(t){return null!==t&&("object"==typeof t||t instanceof Object)}function radians(t){return t*Math.PI/180}function degrees(t){return 180*t/Math.PI}function fontHeight(t){return 1.2*Math.max(t,MorphicPreferences.minimumFontHeight)}function isWordChar(t){return t.match(/[A-zÀ-ÿ0-9]/)}function newCanvas(t,e){var r,i;return i=t||{x:0,y:0},(r=document.createElement("canvas")).width=i.x,r.height=i.y,e&&r.isRetinaEnabled&&(r.isRetinaEnabled=!1),r}function getMinimumFontHeight(){var t,e,r,i,n=document.createElement("canvas");for(n.width=50,n.height=50,(t=n.getContext("2d")).font="1px serif",e=t.measureText("I").width,t.fillStyle="black",t.textBaseline="bottom",t.fillText("I",0,50),i=0;i<50;i+=1)for(r=0;r<e;r+=1)if(0!==t.getImageData(r,i,1,1).data[3])return 50-i+1;return 0}function getBlurredShadowSupport(){var t,e,r;return(t=document.createElement("canvas")).width=10,t.height=10,(r=t.getContext("2d")).fillStyle="rgb(255, 0, 0)",r.beginPath(),r.arc(5,5,5,0,2*Math.PI,!0),r.closePath(),r.fill(),(e=document.createElement("canvas")).width=10,e.height=10,(r=e.getContext("2d")).shadowBlur=10,r.shadowColor="rgba(0, 0, 255, 1)",r.drawImage(t,0,0),!!r.getImageData(0,0,1,1).data[3]}function getDocumentPositionOf(t){var e,r;if(null===t)return{x:0,y:0};for(e={x:t.offsetLeft,y:t.offsetTop},r=t.offsetParent;null!==r;)e.x+=r.offsetLeft,e.y+=r.offsetTop,r!==document.body&&r!==document.documentElement&&(e.x-=r.scrollLeft,e.y-=r.scrollTop),r=r.offsetParent;return e}function copy(t){var e,r,i,n,o,s;if("object"!=typeof t)return t;if(e=t.valueOf(),t!==e)return new t.constructor(e);if(t instanceof t.constructor&&t.constructor!==Object)for(r=Object.create(t.constructor.prototype),o=(n=Object.keys(t)).length,s=0;s<o;s+=1)r[i=n[s]]=t[i];else for(i in r={},t)r[i]=t[i];return r}function enableRetinaSupport(){var t=document.createElement("canvas").getContext("2d"),e=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,r=Math.ceil(window.devicePixelRatio),i=HTMLCanvasElement.prototype,n=CanvasRenderingContext2D.prototype,o={drawImage:n.drawImage,getImageData:n.getImageData,width:Object.getOwnPropertyDescriptor(i,"width"),height:Object.getOwnPropertyDescriptor(i,"height"),shadowOffsetX:Object.getOwnPropertyDescriptor(n,"shadowOffsetX"),shadowOffsetY:Object.getOwnPropertyDescriptor(n,"shadowOffsetY"),shadowBlur:Object.getOwnPropertyDescriptor(n,"shadowBlur")};function s(t){return t.isRetinaEnabled?(r||1)/e:1}e!==r&&(Object.keys(o).some((function(t){var e=o[t];return e.hasOwnProperty("configurable")&&!e.configurable}))||(i._isRetinaEnabled=!0,i._bak=o,Object.defineProperty(i,"isRetinaEnabled",{get:function(){return this._isRetinaEnabled},set:function(t){var e=s(this),r=this.width,i=this.height;this._isRetinaEnabled=t,s(this)!=e&&(this.width=r,this.height=i)},configurable:!0}),Object.defineProperty(i,"width",{get:function(){return o.width.get.call(this)/s(this)},set:function(t){try{var e,r=s(this);o.width.set.call(this,t*r),(e=this.getContext("2d")).restore(),e.save(),e.scale(r,r)}catch(e){console.log("Retina Display Support Problem",e),o.width.set.call(this,t)}}}),Object.defineProperty(i,"height",{get:function(){return o.height.get.call(this)/s(this)},set:function(t){var e,r=s(this);o.height.set.call(this,t*r),(e=this.getContext("2d")).restore(),e.save(),e.scale(r,r)}}),n.drawImage=function(t){var e,r,i,n,a,h,c,l,u=s(t);switch(arguments.length){case 9:e=arguments[1],r=arguments[2],i=arguments[3],n=arguments[4],a=arguments[5],h=arguments[6],c=arguments[7],l=arguments[8];break;case 5:e=0,r=0,i=t.width,n=t.height,a=arguments[1],h=arguments[2],c=arguments[3],l=arguments[4];break;case 3:e=0,r=0,i=t.width,n=t.height,a=arguments[1],h=arguments[2],c=t.width,l=t.height;break;default:throw Error("Called drawImage() with "+arguments.length+" arguments")}o.drawImage.call(this,t,e*u,r*u,i*u,n*u,a,h,c,l)},n.getImageData=function(t,e,r,i){var n=s(this.canvas);return o.getImageData.call(this,t*n,e*n,r*n,i*n)},Object.defineProperty(n,"shadowOffsetX",{get:function(){return o.shadowOffsetX.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);o.shadowOffsetX.set.call(this,t*e)}}),Object.defineProperty(n,"shadowOffsetY",{get:function(){return o.shadowOffsetY.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);o.shadowOffsetY.set.call(this,t*e)}}),Object.defineProperty(n,"shadowBlur",{get:function(){return o.shadowBlur.get.call(this)/s(this.canvas)},set:function(t){var e=s(this.canvas);o.shadowBlur.set.call(this,t*e)}})))}function isRetinaSupported(){var t=document.createElement("canvas").getContext("2d"),e=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,r=HTMLCanvasElement.prototype,i=CanvasRenderingContext2D.prototype,n={drawImage:i.drawImage,getImageData:i.getImageData,width:Object.getOwnPropertyDescriptor(r,"width"),height:Object.getOwnPropertyDescriptor(r,"height"),shadowOffsetX:Object.getOwnPropertyDescriptor(i,"shadowOffsetX"),shadowOffsetY:Object.getOwnPropertyDescriptor(i,"shadowOffsetY"),shadowBlur:Object.getOwnPropertyDescriptor(i,"shadowBlur")};return e!==window.devicePixelRatio&&!Object.keys(n).some((function(t){var e=n[t];return e.hasOwnProperty("configurable")&&!e.configurable}))}function isRetinaEnabled(){return HTMLCanvasElement.prototype.hasOwnProperty("_isRetinaEnabled")}function disableRetinaSupport(){var t,e,r;isRetinaEnabled()&&(t=HTMLCanvasElement.prototype,e=CanvasRenderingContext2D.prototype,r=t._bak,Object.defineProperty(t,"width",r.width),Object.defineProperty(t,"height",r.height),e.drawImage=r.drawImage,e.getImageData=r.getImageData,Object.defineProperty(e,"shadowOffsetX",r.shadowOffsetX),Object.defineProperty(e,"shadowOffsetY",r.shadowOffsetY),Object.defineProperty(e,"shadowBlur",r.shadowBlur),delete t._isRetinaEnabled,delete t.isRetinaEnabled,delete t._bak)}function normalizeCanvas(t,e){var r;return t.isRetinaEnabled?((r=newCanvas(new Point(t.width,t.height),!0)).getContext("2d").drawImage(t,0,0),e?r:(t.isRetinaEnabled=!1,t.width=r.width,t.height=r.height,t.getContext("2d").drawImage(r,0,0),t)):t}function Animation(t,e,r,i,n,o){this.setter=t,this.getter=e,this.delta=r||0,this.duration=i||0,this.easing=isString(n)?this.easings[n]||this.easings.sinusoidal:n||this.easings.sinusoidal,this.onComplete=o||null,this.endTime=null,this.destination=null,this.isActive=!1,this.start()}function Color(t,e,r,i){this.r=t||0,this.g=e||0,this.b=r||0,this.a=i||(0===i?0:1)}function Point(t,e){this.x=t||0,this.y=e||0}function Rectangle(t,e,r,i){this.init(new Point(t||0,e||0),new Point(r||0,i||0))}function Node(t,e){this.init(t||null,e||[])}function Morph(){this.init()}function ShadowMorph(){this.init()}function HandleMorph(t,e,r,i,n,o){this.init(t,e,r,i,n,o)}function PenMorph(){this.init()}function ColorPaletteMorph(t,e){this.init(t||null,e||new Point(80,50))}function GrayPaletteMorph(t,e){this.init(t||null,e||new Point(80,10))}function ColorPickerMorph(t){this.init(t||new Color(255,255,255))}function BlinkerMorph(t){this.init(t)}function CursorMorph(t){this.init(t)}function BoxMorph(t,e,r){this.init(t,e,r)}function SpeechBubbleMorph(t,e,r,i,n,o,s){this.init(t,e,r,i,n,o,s)}function DialMorph(t,e,r,i,n){this.init(t,e,r,i,n)}function CircleBoxMorph(t){this.init(t||"vertical")}function SliderButtonMorph(t){this.init(t)}function SliderMorph(t,e,r,i,n,o){this.init(t||1,e||100,r||50,i||10,n||"vertical",o)}function MouseSensorMorph(t,e,r){this.init(t,e,r)}function InspectorMorph(t){this.init(t)}function MenuMorph(t,e,r,i){this.init(t,e,r,i)}function StringMorph(t,e,r,i,n,o,s,a,h,c){this.init(t,e,r,i,n,o,s,a,h,c)}function TextMorph(t,e,r,i,n,o,s,a,h,c){this.init(t,e,r,i,n,o,s,a,h,c)}function TriggerMorph(t,e,r,i,n,o,s,a,h,c,l){this.init(t,e,r,i,n,o,s,a,h,c,l)}function MenuItemMorph(t,e,r,i,n,o,s,a,h,c,l,u){this.shortcutString=u||null,this.shortcut=null,this.init(t,e,r,i,n,o,s,a,h,c,l)}function FrameMorph(t){this.init(t)}function ScrollFrameMorph(t,e,r){this.init(t,e,r)}function ListMorph(t,e,r,i){this.init(t||[],e||function(t){return isString(t)?t:t.toSource?t.toSource():t.toString()},r||[],i)}function StringFieldMorph(t,e,r,i,n,o,s){this.init(t||"",e||100,r||12,i||"sans-serif",n||!1,o||!1,s)}function BouncerMorph(){this.init()}function HandMorph(t){this.init(t)}function WorldMorph(t,e){this.init(t,e)}enableRetinaSupport(),Animation.prototype.easings={linear:function(t){return t},sinusoidal:function(t){return 1-Math.cos(radians(90*t))},quadratic:function(t){return t<.5?2*t*t:(4-2*t)*t-1},cubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},elastic:function(t){return(t-=.5)<0?(.01+.01/t)*Math.sin(50*t):(.02-.01/t)*Math.sin(50*t)+1},sine_in:function(t){return 1-Math.sin(radians(90+90*t))},quad_in:function(t){return t*t},cubic_in:function(t){return t*t*t},elastic_in:function(t){return(.04-.04/t)*Math.sin(25*t)+1},sine_out:function(t){return Math.sin(radians(90*t))},quad_out:function(t){return t*(2-t)},elastic_out:function(t){return.04*t/--t*Math.sin(25*t)}},Animation.prototype.start=function(){this.endTime=Date.now()+this.duration,this.destination=this.getter.call(this)+this.delta,this.isActive=!0},Animation.prototype.step=function(){if(this.isActive){var t=Date.now();t>this.endTime?(this.setter(this.destination),this.isActive=!1,this.onComplete&&this.onComplete()):this.setter(this.destination-this.delta*this.easing((this.endTime-t)/this.duration))}},Color.prototype.toString=function(){return"rgba("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+","+this.a+")"},Color.prototype.toRGBstring=function(){return"rgb("+Math.round(this.r)+","+Math.round(this.g)+","+Math.round(this.b)+")"},Color.fromString=function(t){var e=t.split(/[\(),]/).slice(1,5);return new Color(e[0],e[1],e[2],e[3])},Color.prototype.copy=function(){return new Color(this.r,this.g,this.b,this.a)},Color.prototype.eq=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},Color.prototype.hsv=function(){var t,e,r,i,n,o,s=this.r/255,a=this.g/255,h=this.b/255;if(r=t=Math.max(s,a,h),t,n=t,o=t-(e=Math.min(s,a,h)),i=0===t?0:o/t,t===e)r=0;else{switch(t){case s:r=(a-h)/o+(a<h?6:0);break;case a:r=(h-s)/o+2;break;case h:r=(s-a)/o+4}r/=6}return[r,i,n]},Color.prototype.set_hsv=function(t,e,r){var i,n,o,s,a;switch(o=r*(1-e),s=r*(1-(n=6*t-(i=Math.floor(6*t)))*e),a=r*(1-(1-n)*e),i%6){case 0:this.r=r,this.g=a,this.b=o;break;case 1:this.r=s,this.g=r,this.b=o;break;case 2:this.r=o,this.g=r,this.b=a;break;case 3:this.r=o,this.g=s,this.b=r;break;case 4:this.r=a,this.g=o,this.b=r;break;case 5:this.r=r,this.g=o,this.b=s}this.r*=255,this.g*=255,this.b*=255},Color.prototype.mixed=function(t,e){var r=Math.min(Math.max(t,0),1),i=1-r;return new Color(this.r*r+e.r*i,this.g*r+e.g*i,this.b*r+e.b*i)},Color.prototype.darker=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(0,0,0))},Color.prototype.lighter=function(t){var e=.8333;return t&&(e=(100-t)/100),this.mixed(e,new Color(255,255,255))},Color.prototype.dansDarker=function(){var t=this.hsv(),e=new Color,r=Math.max(t[2]-.16,0);return e.set_hsv(t[0],t[1],r),e},Color.prototype.inverted=function(){return new Color(255-this.r,255-this.g,255-this.b)},Point.prototype.toString=function(){return Math.round(this.x.toString())+"@"+Math.round(this.y.toString())},Point.prototype.copy=function(){return new Point(this.x,this.y)},Point.prototype.eq=function(t){return this.x===t.x&&this.y===t.y},Point.prototype.lt=function(t){return this.x<t.x&&this.y<t.y},Point.prototype.gt=function(t){return this.x>t.x&&this.y>t.y},Point.prototype.ge=function(t){return this.x>=t.x&&this.y>=t.y},Point.prototype.le=function(t){return this.x<=t.x&&this.y<=t.y},Point.prototype.max=function(t){return new Point(Math.max(this.x,t.x),Math.max(this.y,t.y))},Point.prototype.min=function(t){return new Point(Math.min(this.x,t.x),Math.min(this.y,t.y))},Point.prototype.round=function(){return new Point(Math.round(this.x),Math.round(this.y))},Point.prototype.abs=function(){return new Point(Math.abs(this.x),Math.abs(this.y))},Point.prototype.neg=function(){return new Point(-this.x,-this.y)},Point.prototype.mirror=function(){return new Point(this.y,this.x)},Point.prototype.floor=function(){return new Point(Math.max(Math.floor(this.x),0),Math.max(Math.floor(this.y),0))},Point.prototype.ceil=function(){return new Point(Math.ceil(this.x),Math.ceil(this.y))},Point.prototype.add=function(t){return t instanceof Point?new Point(this.x+t.x,this.y+t.y):new Point(this.x+t,this.y+t)},Point.prototype.subtract=function(t){return t instanceof Point?new Point(this.x-t.x,this.y-t.y):new Point(this.x-t,this.y-t)},Point.prototype.multiplyBy=function(t){return t instanceof Point?new Point(this.x*t.x,this.y*t.y):new Point(this.x*t,this.y*t)},Point.prototype.divideBy=function(t){return t instanceof Point?new Point(this.x/t.x,this.y/t.y):new Point(this.x/t,this.y/t)},Point.prototype.floorDivideBy=function(t){return t instanceof Point?new Point(Math.floor(this.x/t.x),Math.floor(this.y/t.y)):new Point(Math.floor(this.x/t),Math.floor(this.y/t))},Point.prototype.r=function(){var t=this.multiplyBy(this);return Math.sqrt(t.x+t.y)},Point.prototype.degrees=function(){var t,e;return 0===this.x?this.y>=0?90:270:(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?degrees(e):360+degrees(e):180+degrees(e))},Point.prototype.theta=function(){var t,e;return 0===this.x?this.y>=0?radians(90):radians(270):(t=this.y/this.x,e=Math.atan(t),this.x>=0?this.y>=0?e:radians(360)+e:radians(180)+e)},Point.prototype.crossProduct=function(t){return this.multiplyBy(t.mirror())},Point.prototype.distanceTo=function(t){return t.subtract(this).r()},Point.prototype.rotate=function(t,e){var r=this.subtract(e);return"right"===t?new Point(-r.y,r.y).add(e):"left"===t?new Point(r.y,-r.y).add(e):e.subtract(r)},Point.prototype.flip=function(t,e){return"vertical"===t?new Point(this.x,2*e.y-this.y):new Point(2*e.x-this.x,this.y)},Point.prototype.distanceAngle=function(t,e){var r,i,n=e;return n>270?n-=360:n<-270&&(n+=360),-90<=n&&n<=90?(r=Math.sin(radians(n))*t,i=Math.sqrt(t*t-r*r),new Point(r+this.x,this.y-i)):(r=Math.sin(radians(180-n))*t,i=Math.sqrt(t*t-r*r),new Point(r+this.x,this.y+i))},Point.prototype.scaleBy=function(t){return this.multiplyBy(t)},Point.prototype.translateBy=function(t){return this.add(t)},Point.prototype.rotateBy=function(t,e){var r=e||new Point(0,0),i=this.subtract(r),n=i.r(),o=t-i.theta();return new Point(r.x+n*Math.cos(o),r.y-n*Math.sin(o))},Point.prototype.asArray=function(){return[this.x,this.y]},Rectangle.prototype.init=function(t,e){this.origin=t,this.corner=e},Rectangle.prototype.toString=function(){return"["+this.origin.toString()+" | "+this.extent().toString()+"]"},Rectangle.prototype.copy=function(){return new Rectangle(this.left(),this.top(),this.right(),this.bottom())},Point.prototype.corner=function(t){return new Rectangle(this.x,this.y,t.x,t.y)},Point.prototype.rectangle=function(t){var e,r;return e=this.min(t),r=this.max(t),new Rectangle(e.x,e.y,r.x,r.y)},Point.prototype.extent=function(t){var e=this.add(t);return new Rectangle(this.x,this.y,e.x,e.y)},Rectangle.prototype.setTo=function(t,e,r,i){this.origin=new Point(t||(0===t?0:this.left()),e||(0===e?0:this.top())),this.corner=new Point(r||(0===r?0:this.right()),i||(0===i?0:this.bottom()))},Rectangle.prototype.area=function(){var t=this.width();return t<0?0:Math.max(t*this.height(),0)},Rectangle.prototype.bottom=function(){return this.corner.y},Rectangle.prototype.bottomCenter=function(){return new Point(this.center().x,this.bottom())},Rectangle.prototype.bottomLeft=function(){return new Point(this.origin.x,this.corner.y)},Rectangle.prototype.bottomRight=function(){return this.corner.copy()},Rectangle.prototype.boundingBox=function(){return this},Rectangle.prototype.center=function(){return this.origin.add(this.corner.subtract(this.origin).floorDivideBy(2))},Rectangle.prototype.corners=function(){return[this.origin,this.bottomLeft(),this.corner,this.topRight()]},Rectangle.prototype.extent=function(){return this.corner.subtract(this.origin)},Rectangle.prototype.height=function(){return this.corner.y-this.origin.y},Rectangle.prototype.left=function(){return this.origin.x},Rectangle.prototype.leftCenter=function(){return new Point(this.left(),this.center().y)},Rectangle.prototype.right=function(){return this.corner.x},Rectangle.prototype.rightCenter=function(){return new Point(this.right(),this.center().y)},Rectangle.prototype.top=function(){return this.origin.y},Rectangle.prototype.topCenter=function(){return new Point(this.center().x,this.top())},Rectangle.prototype.topLeft=function(){return this.origin},Rectangle.prototype.topRight=function(){return new Point(this.corner.x,this.origin.y)},Rectangle.prototype.width=function(){return this.corner.x-this.origin.x},Rectangle.prototype.position=function(){return this.origin},Rectangle.prototype.eq=function(t){return this.origin.eq(t.origin)&&this.corner.eq(t.corner)},Rectangle.prototype.abs=function(){var t,e;return t=this.origin.abs(),e=this.corner.max(t),t.corner(e)},Rectangle.prototype.insetBy=function(t){var e=new Rectangle;return e.origin=this.origin.add(t),e.corner=this.corner.subtract(t),e},Rectangle.prototype.expandBy=function(t){var e=new Rectangle;return e.origin=this.origin.subtract(t),e.corner=this.corner.add(t),e},Rectangle.prototype.growBy=function(t){var e=new Rectangle;return e.origin=this.origin.copy(),e.corner=this.corner.add(t),e},Rectangle.prototype.intersect=function(t){var e=new Rectangle;return e.origin=this.origin.max(t.origin),e.corner=this.corner.min(t.corner),e},Rectangle.prototype.merge=function(t){var e=new Rectangle;return e.origin=this.origin.min(t.origin),e.corner=this.corner.max(t.corner),e},Rectangle.prototype.mergeWith=function(t){this.origin=this.origin.min(t.origin),this.corner=this.corner.max(t.corner)},Rectangle.prototype.round=function(){return this.origin.round().corner(this.corner.round())},Rectangle.prototype.spread=function(){return this.origin.floor().corner(this.corner.ceil()).expandBy(1)},Rectangle.prototype.amountToTranslateWithin=function(t){var e=0,r=0;return this.right()>t.right()&&(e=t.right()-this.right()),this.bottom()>t.bottom()&&(r=t.bottom()-this.bottom()),this.left()+e<t.left()&&(e=t.left()-this.left()),this.top()+r<t.top()&&(r=t.top()-this.top()),new Point(e,r)},Rectangle.prototype.containsPoint=function(t){return this.origin.le(t)&&t.lt(this.corner)},Rectangle.prototype.containsRectangle=function(t){return t.origin.gt(this.origin)&&t.corner.lt(this.corner)},Rectangle.prototype.intersects=function(t){var e=t.origin,r=t.corner;return r.x>=this.origin.x&&r.y>=this.origin.y&&e.x<=this.corner.x&&e.y<=this.corner.y},Rectangle.prototype.isNearTo=function(t,e){var r=t.origin,i=t.corner,n=e||0;return i.x+n>=this.origin.x&&i.y+n>=this.origin.y&&r.x-n<=this.corner.x&&r.y-n<=this.corner.y},Rectangle.prototype.scaleBy=function(t){var e=this.origin.multiplyBy(t),r=this.corner.multiplyBy(t);return new Rectangle(e.x,e.y,r.x,r.y)},Rectangle.prototype.translateBy=function(t){var e=this.origin.add(t),r=this.corner.add(t);return new Rectangle(e.x,e.y,r.x,r.y)},Rectangle.prototype.asArray=function(){return[this.left(),this.top(),this.right(),this.bottom()]},Rectangle.prototype.asArray_xywh=function(){return[this.left(),this.top(),this.width(),this.height()]},Node.prototype.init=function(t,e){this.parent=t||null,this.children=e||[]},Node.prototype.toString=function(){return"a Node["+this.children.length.toString()+"]"},Node.prototype.addChild=function(t){this.children.push(t),t.parent=this},Node.prototype.addChildFirst=function(t){this.children.splice(0,null,t),t.parent=this},Node.prototype.removeChild=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)},Node.prototype.root=function(){return null===this.parent?this:this.parent.root()},Node.prototype.depth=function(){return null===this.parent?0:this.parent.depth()+1},Node.prototype.allChildren=function(){var t=[this];return this.children.forEach((function(e){t=t.concat(e.allChildren())})),t},Node.prototype.forAllChildren=function(t){this.children.length>0&&this.children.forEach((function(e){e.forAllChildren(t)})),t.call(null,this)},Node.prototype.anyChild=function(t){var e;if(t.call(null,this))return!0;for(e=0;e<this.children.length;e+=1)if(this.children[e].anyChild(t))return!0;return!1},Node.prototype.allLeafs=function(){var t=[];return this.allChildren().forEach((function(e){0===e.children.length&&t.push(e)})),t},Node.prototype.allParents=function(){var t=[this];return null!==this.parent&&(t=t.concat(this.parent.allParents())),t},Node.prototype.siblings=function(){var t=this;return null===this.parent?[]:this.parent.children.filter((function(e){return e!==t}))},Node.prototype.parentThatIsA=function(t){return this instanceof t?this:this.parent?this.parent.parentThatIsA(t):null},Node.prototype.parentThatIsAnyOf=function(t){var e=!1,r=this;return t.forEach((function(t){r.constructor!==t||(e=!0)})),e?this:this.parent?this.parent.parentThatIsAnyOf(t):null},Morph.prototype=new Node,Morph.prototype.constructor=Morph,Morph.uber=Node.prototype,Morph.prototype.trackChanges=!0,Morph.prototype.shadowBlur=4,Morph.prototype.init=function(t){Morph.uber.init.call(this),this.isMorph=!0,this.image=null,this.bounds=new Rectangle(0,0,50,40),this.cachedFullImage=null,this.cachedFullBounds=null,this.color=new Color(80,80,80),this.texture=null,this.cachedTexture=null,this.alpha=1,this.isVisible=!0,this.isDraggable=!1,this.isTemplate=!1,this.acceptsDrops=!1,this.noticesTransparentClick=!1,t||this.drawNew(),this.fps=0,this.customContextMenu=null,this.lastTime=Date.now(),this.onNextStep=null},Morph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+" "+this.children.length.toString()+" "+this.bounds},Morph.prototype.destroy=function(){null!==this.parent&&(this.fullChanged(),this.parent.removeChild(this))},Morph.prototype.stepFrame=function(){if(!this.step)return null;var t,e,r;e=(t=Date.now())-this.lastTime,(this.fps>0?1e3/this.fps-e:0)<1&&(this.lastTime=t,this.onNextStep&&(r=this.onNextStep,this.onNextStep=null,r.call(this)),this.step(),this.children.forEach((function(t){t.stepFrame()})))},Morph.prototype.nextSteps=function(t){var e=t||[],r=e.shift(),i=this;r&&(this.onNextStep=function(){r.call(i),i.nextSteps(e)})},Morph.prototype.step=nop,Morph.prototype.left=function(){return this.bounds.left()},Morph.prototype.right=function(){return this.bounds.right()},Morph.prototype.top=function(){return this.bounds.top()},Morph.prototype.bottom=function(){return this.bounds.bottom()},Morph.prototype.center=function(){return this.bounds.center()},Morph.prototype.bottomCenter=function(){return this.bounds.bottomCenter()},Morph.prototype.bottomLeft=function(){return this.bounds.bottomLeft()},Morph.prototype.bottomRight=function(){return this.bounds.bottomRight()},Morph.prototype.boundingBox=function(){return this.bounds},Morph.prototype.corners=function(){return this.bounds.corners()},Morph.prototype.leftCenter=function(){return this.bounds.leftCenter()},Morph.prototype.rightCenter=function(){return this.bounds.rightCenter()},Morph.prototype.topCenter=function(){return this.bounds.topCenter()},Morph.prototype.topLeft=function(){return this.bounds.topLeft()},Morph.prototype.topRight=function(){return this.bounds.topRight()},Morph.prototype.position=function(){return this.bounds.origin},Morph.prototype.extent=function(){return this.bounds.extent()},Morph.prototype.width=function(){return this.bounds.width()},Morph.prototype.height=function(){return this.bounds.height()},Morph.prototype.fullBounds=function(){var t;return t=this.bounds,this.children.forEach((function(e){e.isVisible&&(t=t.merge(e.fullBounds()))})),t},Morph.prototype.fullBoundsNoShadow=function(){var t;return t=this.bounds,this.children.forEach((function(e){e instanceof ShadowMorph||!e.isVisible||(t=t.merge(e.fullBounds()))})),t},Morph.prototype.visibleBounds=function(){var t=this.bounds;return this.allParents().filter((function(t){return t instanceof FrameMorph})).forEach((function(e){t=t.intersect(e.bounds)})),t},Morph.prototype.moveBy=function(t){this.fullChanged(),this.silentMoveBy(t),this.fullChanged()},Morph.prototype.silentMoveBy=function(t){var e=this.children,r=e.length;for(this.bounds=this.bounds.translateBy(t),this.cachedFullBounds&&(this.cachedFullBounds=this.cachedFullBounds.translateBy(t));r>0;r-=1)e[r-1].silentMoveBy(t)},Morph.prototype.setPosition=function(t){var e=t.subtract(this.topLeft());0===e.x&&0===e.y||this.moveBy(e)},Morph.prototype.silentSetPosition=function(t){var e=t.subtract(this.topLeft());0===e.x&&0===e.y||this.silentMoveBy(e)},Morph.prototype.setLeft=function(t){this.setPosition(new Point(t,this.top()))},Morph.prototype.setRight=function(t){this.setPosition(new Point(t-this.width(),this.top()))},Morph.prototype.setTop=function(t){this.setPosition(new Point(this.left(),t))},Morph.prototype.setBottom=function(t){this.setPosition(new Point(this.left(),t-this.height()))},Morph.prototype.setCenter=function(t){this.setPosition(t.subtract(this.extent().floorDivideBy(2)))},Morph.prototype.setFullCenter=function(t){this.setPosition(t.subtract(this.fullBounds().extent().floorDivideBy(2)))},Morph.prototype.keepWithin=function(t){var e,r,i,n;(r=this.fullBounds().right()-t.right())>0&&this.moveBy(new Point(-r,0)),(e=this.fullBounds().left()-t.left())<0&&this.moveBy(new Point(-e,0)),(n=this.fullBounds().bottom()-t.bottom())>0&&this.moveBy(new Point(0,-n)),(i=this.fullBounds().top()-t.top())<0&&this.moveBy(new Point(0,-i))},Morph.prototype.scrollIntoView=function(){var t,e,r,i,n=this.parentThatIsA(ScrollFrameMorph);n&&((e=Math.min(this.fullBounds().right()-n.right(),n.contents.right()-n.right()))>0&&n.contents.moveBy(new Point(-e,0)),(t=this.fullBounds().left()-n.left())<0&&n.contents.moveBy(new Point(-t,0)),(r=this.fullBounds().top()-n.top())<0&&n.contents.moveBy(new Point(0,-r)),(i=this.fullBounds().bottom()-n.bottom())>0&&n.contents.moveBy(new Point(0,-i)),n.adjustScrollBars())},Morph.prototype.setExtent=function(t,e){e?this.silentSetExtent(t):t.eq(this.extent())||(this.changed(),this.silentSetExtent(t),this.changed(),this.drawNew())},Morph.prototype.silentSetExtent=function(t){var e,r,i;e=t.round(),r=Math.max(e.x,0),i=Math.max(e.y,0),this.bounds.corner=new Point(this.bounds.origin.x+r,this.bounds.origin.y+i)},Morph.prototype.setWidth=function(t){this.setExtent(new Point(t||0,this.height()))},Morph.prototype.silentSetWidth=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.origin.x+e,this.bounds.corner.y)},Morph.prototype.setHeight=function(t){this.setExtent(new Point(this.width(),t||0))},Morph.prototype.silentSetHeight=function(t){var e=Math.max(Math.round(t||0),0);this.bounds.corner=new Point(this.bounds.corner.x,this.bounds.origin.y+e)},Morph.prototype.setColor=function(t){t&&(this.color.eq(t)||(this.color=t,this.changed(),this.drawNew()))},Morph.prototype.drawNew=function(){this.image=newCanvas(this.extent());var t=this.image.getContext("2d");t.fillStyle=this.color.toString(),t.fillRect(0,0,this.width(),this.height()),this.cachedTexture?this.drawCachedTexture():this.texture&&this.drawTexture(this.texture)},Morph.prototype.drawTexture=function(t){var e=this;this.cachedTexture=new Image,this.cachedTexture.onload=function(){e.drawCachedTexture()},this.cachedTexture.src=this.texture=t},Morph.prototype.drawCachedTexture=function(){var t,e,r=this.cachedTexture,i=Math.floor(this.image.width/r.width),n=Math.floor(this.image.height/r.height),o=this.image.getContext("2d");for(e=0;e<=n;e+=1)for(t=0;t<=i;t+=1)o.drawImage(r,t*r.width,e*r.height);this.changed()},Morph.prototype.drawOn=function(t,e){var r,i,n,o,s,a,h,c,l=this.cachedFullImage||this.image,u=this.cachedFullBounds||this.bounds;if(!this.isVisible)return null;if((r=(e||u).intersect(u)).extent().gt(new Point(0,0))){if(i=u.position().neg(),n=r.copy().translateBy(i),(o=t.getContext("2d")).globalAlpha=this.alpha,h=n.left(),c=n.top(),s=Math.min(n.width(),l.width-h),a=Math.min(n.height(),l.height-c),s<1||a<1)return null;o.drawImage(l,h,c,s,a,r.left(),r.top(),s,a)}},Morph.prototype.fullDrawOn=function(t,e){var r;if(!this.isVisible)return null;r=e||this.cachedFullBounds||this.fullBounds(),this.drawOn(t,r),this.cachedFullImage||this.children.forEach((function(e){e.fullDrawOn(t,r)}))},Morph.prototype.hide=function(){this.isVisible=!1,this.changed(),this.children.forEach((function(t){t.hide()}))},Morph.prototype.show=function(){this.isVisible=!0,this.changed(),this.children.forEach((function(t){t.show()}))},Morph.prototype.toggleVisibility=function(){this.isVisible=!this.isVisible,this.changed(),this.children.forEach((function(t){t.toggleVisibility()}))},Morph.prototype.fullImageClassic=function(){var t=this.cachedFullBounds||this.fullBounds(),e=newCanvas(t.extent());return e.getContext("2d").translate(-t.origin.x,-t.origin.y),this.fullDrawOn(e,t),e.globalAlpha=this.alpha,e},Morph.prototype.fullImage=function(){var t,e,r;return t=newCanvas(this.fullBounds().extent()),e=t.getContext("2d"),r=this.fullBounds(),this.allChildren().forEach((function(t){t.isVisible&&(e.globalAlpha=t.alpha,t.image.width&&t.image.height&&e.drawImage(t.image,t.bounds.origin.x-r.origin.x,t.bounds.origin.y-r.origin.y))})),t},Morph.prototype.shadowImage=function(t,e){var r,i,n,o,s,a=t||new Point(7,7),h=e||new Color(0,0,0);return r=this.fullBounds().extent(),i=this.fullImage(),(s=(n=newCanvas(r)).getContext("2d")).drawImage(i,0,0),s.globalCompositeOperation="destination-out",s.drawImage(i,-a.x,-a.y),(s=(o=newCanvas(r)).getContext("2d")).drawImage(n,0,0),s.globalCompositeOperation="source-atop",s.fillStyle=h.toString(),s.fillRect(0,0,r.x,r.y),o},Morph.prototype.shadowImageBlurred=function(t,e){var r,i,n,o,s=t||new Point(7,7),a=this.shadowBlur,h=e||new Color(0,0,0);return r=this.fullBounds().extent().add(2*a),i=this.fullImage(),(o=(n=newCanvas(r)).getContext("2d")).shadowOffsetX=s.x,o.shadowOffsetY=s.y,o.shadowBlur=a,o.shadowColor=h.toString(),o.drawImage(i,a-s.x,a-s.y),o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=0,o.globalCompositeOperation="destination-out",o.drawImage(i,a-s.x,a-s.y),n},Morph.prototype.shadow=function(t,e,r){var i=new ShadowMorph,n=t||new Point(7,7),o=e||(0===e?0:.2),s=this.fullBounds();return i.setExtent(s.extent().add(2*this.shadowBlur)),useBlurredShadows&&!MorphicPreferences.isFlat?(i.image=this.shadowImageBlurred(n,r),i.alpha=o,i.setPosition(s.origin.add(n).subtract(this.shadowBlur))):(i.image=this.shadowImage(n,r),i.alpha=o,i.setPosition(s.origin.add(n))),i},Morph.prototype.addShadow=function(t,e,r){var i,n=t||new Point(7,7),o=e||(0===e?0:.2);return i=this.shadow(n,o,r),this.addBack(i),this.fullChanged(),i},Morph.prototype.getShadow=function(){var t;return 0!==(t=this.children.slice(0).reverse().filter((function(t){return t instanceof ShadowMorph}))).length?t[0]:null},Morph.prototype.removeShadow=function(){var t=this.getShadow();null!==t&&(this.fullChanged(),this.removeChild(t))},Morph.prototype.penTrails=function(){return this.image},Morph.prototype.changed=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread())}this.parent&&this.parent.childChanged(this)},Morph.prototype.fullChanged=function(){if(this.trackChanges){var t=this.root();t instanceof WorldMorph&&t.broken.push((this.cachedFullBounds||this.fullBounds()).spread())}},Morph.prototype.childChanged=function(){this.parent&&this.parent.childChanged(this)},Morph.prototype.world=function(){var t=this.root();return t instanceof WorldMorph?t:t instanceof HandMorph?t.world:null},Morph.prototype.add=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChild(t)},Morph.prototype.addBack=function(t){var e=t.parent;null!==e&&e.removeChild(t),this.addChildFirst(t)},Morph.prototype.topMorphAt=function(t){var e,r;if(!this.isVisible)return null;for(e=this.children.length-1;e>=0;e-=1)if(r=this.children[e].topMorphAt(t))return r;return!this.bounds.containsPoint(t)||!this.noticesTransparentClick&&this.isTransparentAt(t)?null:this},Morph.prototype.topMorphSuchThat=function(t){var e;return t.call(null,this)?(e=detect(this.children.slice(0).reverse(),t))?e.topMorphSuchThat(t):this:null},Morph.prototype.overlappedMorphs=function(){var t=this.world(),e=this.fullBounds(),r=this,i=this.allParents(),n=this.allChildren();return t.allChildren().filter((function(o){return o.isVisible&&o!==r&&o!==t&&!contains(i,o)&&!contains(n,o)&&o.fullBounds().intersects(e)}))},Morph.prototype.getPixelColor=function(t){var e,r;return e=t.subtract(this.bounds.origin),new Color((r=this.image.getContext("2d").getImageData(e.x,e.y,1,1)).data[0],r.data[1],r.data[2],r.data[3]/255)},Morph.prototype.isTransparentAt=function(t){var e;return!!this.bounds.containsPoint(t)&&(!this.texture&&(e=t.subtract(this.bounds.origin),0===this.image.getContext("2d").getImageData(Math.floor(e.x),Math.floor(e.y),1,1).data[3]))},Morph.prototype.copy=function(){var t=copy(this);return t.parent=null,t.children=[],t.bounds=this.bounds.copy(),t},Morph.prototype.fullCopy=function(){var t,e=new Map;return(t=this.copyRecordingReferences(e)).forAllChildren((function(t){t.updateReferences(e)})),t},Morph.prototype.copyRecordingReferences=function(t){var e=this.copy();return t.set(this,e),this.children.forEach((function(r){e.add(r.copyRecordingReferences(t))})),e},Morph.prototype.updateReferences=function(t){var e,r,i,n,o=Object.keys(this),s=o.length;for(n=0;n<s;n+=1)(r=this[e=o[n]])&&r.isMorph&&(i=t.get(r))&&(this[e]=i)},Morph.prototype.rootForGrab=function(){return this instanceof ShadowMorph?this.parent.rootForGrab():this.parent instanceof ScrollFrameMorph?this.parent:null===this.parent||this.parent instanceof WorldMorph||this.parent instanceof FrameMorph||!0===this.isDraggable?this:this.parent.rootForGrab()},Morph.prototype.isCorrectingOutsideDrag=function(){return!0},Morph.prototype.wantsDropOf=function(t){return!(t instanceof HandleMorph||t instanceof MenuMorph||t instanceof InspectorMorph)&&this.acceptsDrops},Morph.prototype.pickUp=function(t){var e=t||this.world();this.setPosition(e.hand.position().subtract(this.extent().floorDivideBy(2))),e.hand.grab(this)},Morph.prototype.isPickedUp=function(){return null!==this.parentThatIsA(HandMorph)},Morph.prototype.situation=function(){return this.parent?{origin:this.parent,position:this.position().subtract(this.parent.position())}:null},Morph.prototype.slideBackTo=function(t,e,r,i){var n=t.origin.position().add(t.position),o=this;this.glideTo(n,e,null,(function(){t.origin.add(o),r&&r(),o.justDropped&&o.justDropped(),t.origin.reactToDropOf&&t.origin.reactToDropOf(o),i&&i()}))},Morph.prototype.glideTo=function(t,e,r,i){var n=this.world(),o=this;n.animations.push(new Animation((function(t){o.setLeft(t)}),(function(){return o.left()}),-(this.left()-t.x),e||100,r,i)),n.animations.push(new Animation((function(t){o.setTop(t)}),(function(){return o.top()}),-(this.top()-t.y),e||100,r))},Morph.prototype.fadeTo=function(t,e,r,i){var n=this.world(),o=this,s=this.alpha;this.children.forEach((function(i){i.fadeTo(t,e,r)})),n.animations.push(new Animation((function(t){o.alpha=t,o.changed()}),(function(){return o.alpha}),t-this.alpha,e||200,r,(function(){o.alpha=s,i&&i()})))},Morph.prototype.perish=function(t,e){var r=this;this.fadeTo(0,t||100,null,(function(){r.destroy(),e&&e()}))},Morph.prototype.nop=nop,Morph.prototype.resize=function(){this.world().activeHandle=new HandleMorph(this)},Morph.prototype.move=function(){this.world().activeHandle=new HandleMorph(this,null,null,null,null,"move")},Morph.prototype.moveCenter=function(){this.world().activeHandle=new HandleMorph(this,null,null,null,null,"moveCenter")},Morph.prototype.hint=function(t){var e,r;r=t,t?t.toString&&(r=t.toString()):r="NULL",(e=new MenuMorph(this,r)).isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.inform=function(t){var e,r;r=t,t?t.toString&&(r=t.toString()):r="NULL",(e=new MenuMorph(this,r)).addItem("Ok"),e.isDraggable=!0,e.popUpCenteredAtHand(this.world())},Morph.prototype.prompt=function(t,e,r,i,n,o,s,a){var h,c,l,u;s&&(u=!0),h=new MenuMorph(e||null,t||"",r||null),c=new StringFieldMorph(i||"",n||100,MorphicPreferences.prompterFontSize,MorphicPreferences.prompterFontName,!1,!1,u),h.items.push(c),(s||MorphicPreferences.useSliderForInput)&&((l=new SliderMorph(o||0,s,parseFloat(i),Math.floor((s-o)/4),"horizontal")).alpha=1,l.color=new Color(225,225,225),l.button.color=h.borderColor,l.button.highlightColor=l.button.color.copy(),l.button.highlightColor.b+=100,l.button.pressColor=l.button.color.copy(),l.button.pressColor.b+=150,l.setHeight(MorphicPreferences.prompterSliderSize),l.action=a?function(t){c.changed(),c.text.text=Math.round(t).toString(),c.text.drawNew(),c.text.changed(),c.text.edit()}:function(t){c.changed(),c.text.text=t.toString(),c.text.drawNew(),c.text.changed()},h.items.push(l)),h.addLine(2),h.addItem("Ok",(function(){return c.string()})),h.addItem("Cancel",(function(){return null})),h.isDraggable=!0,h.popUpAtHand(this.world()),c.text.edit()},Morph.prototype.pickColor=function(t,e,r,i){var n,o;n=new MenuMorph(e||null,t||"",r||null),o=new ColorPickerMorph(i),n.items.push(o),n.addLine(2),n.addItem("Ok",(function(){return o.getChoice()})),n.addItem("Cancel",(function(){return null})),n.isDraggable=!0,n.popUpAtHand(this.world())},Morph.prototype.inspect=function(t){var e,r=this.world instanceof Function?this.world():this.root()||this.world,i=this;t&&(i=t),(e=new InspectorMorph(i)).setPosition(r.hand.position()),e.keepWithin(r),r.add(e),e.changed()},Morph.prototype.contextMenu=function(){var t;return this.customContextMenu?this.customContextMenu:(t=this.world instanceof Function?this.world():this.world)&&t.isDevMode?this.parent===t?this.developersMenu():this.hierarchyMenu():this.userMenu()||this.parent&&this.parent.userMenu()},Morph.prototype.hierarchyMenu=function(){var t=this.allParents(),e=this.world instanceof Function?this.world():this.world,r=new MenuMorph(this,null);return t.forEach((function(t){t.developersMenu&&t!==e&&r.addMenu(t.toString().slice(0,50),t.developersMenu())})),r},Morph.prototype.developersMenu=function(){var t=this.world instanceof Function?this.world():this.world,e=this.userMenu()||this.parent&&this.parent.userMenu(),r=new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]);return e&&(r.addMenu("user features",e),r.addLine()),r.addItem("color...",(function(){this.pickColor(r.title+localize("\ncolor:"),this.setColor,this,this.color)}),"choose another color \nfor this morph.js"),r.addItem("transparency...",(function(){this.prompt(r.title+localize("\nalpha\nvalue:"),this.setAlphaScaled,this,(100*this.alpha).toString(),null,1,100,!0)}),"set this morph.js's\nalpha value"),r.addItem("resize...","resize","show a handle\nwhich can be dragged\nto change this morph.js's extent"),r.addLine(),r.addItem("duplicate",(function(){this.fullCopy().pickUp(this.world())}),"make a copy\nand pick it up"),r.addItem("pick up","pickUp","detach and put \ninto the hand"),r.addItem("attach...","attach","stick this morph.js\nto another one"),r.addItem("move...","move","show a handle\nwhich can be dragged\nto move this morph.js"),r.addItem("inspect...","inspect","open a window\non all properties"),r.addItem("pic...",(function(){window.open(this.fullImageClassic().toDataURL())}),"open a new window\nwith a picture of this morph.js"),r.addLine(),this.isDraggable?r.addItem("lock","toggleIsDraggable","make this morph.js\nunmovable"):r.addItem("unlock","toggleIsDraggable","make this morph.js\nmovable"),r.addItem("hide","hide"),r.addItem("delete","destroy"),this instanceof WorldMorph||(r.addLine(),r.addItem("World...",(function(){t.contextMenu().popUpAtHand(t)}),"show the\nWorld's menu")),r},Morph.prototype.userMenu=function(){return null},Morph.prototype.setAlphaScaled=function(t){var e,r;"number"==typeof t?(r=t/100,this.alpha=Math.min(Math.max(r,.1),1)):(e=parseFloat(t),isNaN(e)||(r=e/100,this.alpha=Math.min(Math.max(r,.1),1))),this.changed()},Morph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose new parent:"),r=this;t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){t.add(r),r.isDraggable=!1}))})),t.length>0&&e.popUpAtHand(this.world())},Morph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable},Morph.prototype.colorSetters=function(){return["color"]},Morph.prototype.numericalSetters=function(){return["setLeft","setTop","setWidth","setHeight","setAlphaScaled"]},Morph.prototype.allEntryFields=function(){return this.allChildren().filter((function(t){return t.isEditable&&(t instanceof StringMorph||t instanceof TextMorph)}))},Morph.prototype.nextEntryField=function(t){var e=this.allEntryFields(),r=e.indexOf(t);return-1!==r&&e.length>r+1?e[r+1]:e[0]},Morph.prototype.previousEntryField=function(t){var e=this.allEntryFields(),r=e.indexOf(t);return-1!==r?r>0?e[r-1]:e[e.length-1]:e[0]},Morph.prototype.tab=function(t){this.nextTab?this.nextTab(t):this.parent&&this.parent.tab(t)},Morph.prototype.backTab=function(t){this.previousTab?this.previousTab(t):this.parent&&this.parent.backTab(t)},Morph.prototype.escalateEvent=function(t,e){for(var r=this.parent;!r[t]&&null!==r.parent;)r=r.parent;r[t]&&r[t](e)},Morph.prototype.evaluateString=function(code){var result;try{result=eval(code),this.drawNew(),this.changed()}catch(t){this.inform(t)}return result},Morph.prototype.isTouching=function(t){var e=this.overlappingImage(t);return!(!e.width||!e.height)&&null!==detect(e.getContext("2d").getImageData(1,1,e.width,e.height).data,(function(t){return 0!==t}))},Morph.prototype.overlappingImage=function(t){var e=this.fullBounds(),r=t.fullBounds(),i=e.intersect(r),n=newCanvas(i.extent()),o=n.getContext("2d");return i.width()<1||i.height()<1?newCanvas(new Point(1,1)):(o.drawImage(this.fullImage(),i.origin.x-e.origin.x,i.origin.y-e.origin.y),o.globalCompositeOperation="source-in",o.drawImage(t.fullImage(),r.origin.x-i.origin.x,r.origin.y-i.origin.y),n)},ShadowMorph.prototype=new Morph,ShadowMorph.prototype.constructor=ShadowMorph,ShadowMorph.uber=Morph.prototype,ShadowMorph.prototype.topMorphAt=function(){return null},HandleMorph.prototype=new Morph,HandleMorph.prototype.constructor=HandleMorph,HandleMorph.uber=Morph.prototype,HandleMorph.prototype.init=function(t,e,r,i,n,o){var s=MorphicPreferences.handleSize;this.target=t||null,this.minExtent=new Point(e||0,r||0),this.inset=new Point(i||0,n||i||0),this.type=o||"resize",HandleMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isDraggable=!1,this.noticesTransparentClick=!0,"movePivot"===this.type&&(s*=2),this.setExtent(new Point(s,s))},HandleMorph.prototype.drawNew=function(){this.normalImage=newCanvas(this.extent()),this.highlightImage=newCanvas(this.extent()),"movePivot"===this.type?(this.drawCrosshairsOnCanvas(this.normalImage,.6),this.drawCrosshairsOnCanvas(this.highlightImage,.5)):(this.drawOnCanvas(this.normalImage,this.color,new Color(100,100,100)),this.drawOnCanvas(this.highlightImage,new Color(100,100,255),new Color(255,255,255))),this.image=this.normalImage,this.target&&("moveCenter"===this.type?this.setCenter(this.target.center()):"movePivot"===this.type?this.setCenter(this.target.rotationCenter()):this.setPosition(this.target.bottomRight().subtract(this.extent().add(this.inset))),this.target.add(this),this.target.changed())},HandleMorph.prototype.drawCrosshairsOnCanvas=function(t,e){var r=t.getContext("2d"),i=t.width/2;r.fillStyle="rgba(255, 255, 255, 0.5)",r.arc(i,i,.9*i,radians(0),radians(360),!1),r.fill(),r.strokeStyle="black",r.lineWidth=1,r.beginPath(),r.arc(i,i,i*e,radians(0),radians(360),!1),r.stroke(),r.moveTo(0,i),r.lineTo(t.width,i),r.stroke(),r.moveTo(i,0),r.lineTo(i,t.height),r.stroke()},HandleMorph.prototype.drawOnCanvas=function(t,e,r){var i,n,o,s,a,h=t.getContext("2d"),c=0===this.type.indexOf("move");if(h.lineWidth=1,h.lineCap="round",h.strokeStyle=e.toString(),c)for(n=(i=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),a=0;a<=this.height();a+=6)n.y=i.y-a,s.y=o.y-a,h.beginPath(),h.moveTo(n.x,n.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke();for(n=(i=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),a=0;a<=this.width();a+=6)n.x=i.x+a,s.x=o.x+a,h.beginPath(),h.moveTo(n.x,n.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke();if(h.strokeStyle=r.toString(),c)for(n=(i=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),a=-2;a<=this.height();a+=6)n.y=i.y-a,s.y=o.y-a,h.beginPath(),h.moveTo(n.x,n.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke();for(n=(i=this.bottomLeft().subtract(this.position())).copy(),s=(o=this.topRight().subtract(this.position())).copy(),a=2;a<=this.width();a+=6)n.x=i.x+a,s.x=o.x+a,h.beginPath(),h.moveTo(n.x,n.y),h.lineTo(s.x,s.y),h.closePath(),h.stroke()},HandleMorph.prototype.step=null,HandleMorph.prototype.mouseDownLeft=function(t){var e,r=this.root(),i=this;if(!this.target)return null;e=0===this.type.indexOf("move")?t.subtract(this.center()):t.subtract(this.bounds.origin),this.step=function(){var t,n;r.hand.mouseButton?(t=r.hand.bounds.origin.copy().subtract(e),"resize"===this.type?(n=(n=t.add(i.extent().add(i.inset)).subtract(i.target.bounds.origin)).max(i.minExtent),i.target.setExtent(n),i.setPosition(i.target.bottomRight().subtract(i.extent().add(i.inset)))):"moveCenter"===this.type?i.target.setCenter(t):"movePivot"===this.type?(i.target.setPivot(t),i.setCenter(this.target.rotationCenter())):i.target.setPosition(t.subtract(this.target.extent()).add(this.extent()))):this.step=null},this.target.step||(this.target.step=function(){nop()})},HandleMorph.prototype.rootForGrab=function(){return this},HandleMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},HandleMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},HandleMorph.prototype.attach=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),r=this;t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){r.isDraggable=!1,r.target=t,r.drawNew(),r.noticesTransparentClick=!0}))})),t.length>0&&e.popUpAtHand(this.world())},PenMorph.prototype=new Morph,PenMorph.prototype.constructor=PenMorph,PenMorph.uber=Morph.prototype,PenMorph.prototype.init=function(){var t=4*MorphicPreferences.handleSize;this.isWarped=!1,this.heading=0,this.isDown=!0,this.size=1,this.wantsRedraw=!1,this.penPoint="tip",this.penBounds=null,HandleMorph.uber.init.call(this),this.setExtent(new Point(t,t))},PenMorph.prototype.changed=function(){if(!1===this.isWarped){var t=this.root();t instanceof WorldMorph&&t.broken.push(this.visibleBounds().spread()),this.parent&&this.parent.childChanged(this)}},PenMorph.prototype.drawNew=function(t){var e,r,i,n,o,s,a=t||this.heading;this.isWarped?this.wantsRedraw=!0:(this.image=newCanvas(this.extent()),e=this.image.getContext("2d"),s=this.width()/2,r=this.center().subtract(this.bounds.origin),"tip"===this.penPoint?(i=r.distanceAngle(.75*s,a-180),n=r.distanceAngle(s,a+195),o=r.distanceAngle(s,a-195)):(i=r.distanceAngle(.75*s,a),n=r.distanceAngle(.33*s,a+230),o=r.distanceAngle(.33*s,a-230)),this.penBounds=new Rectangle(Math.min(r.x,i.x,n.x,o.x),Math.min(r.y,i.y,n.y,o.y),Math.max(r.x,i.x,n.x,o.x),Math.max(r.y,i.y,n.y,o.y)),e.fillStyle=this.color.toString(),e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(n.x,n.y),e.lineTo(i.x,i.y),e.lineTo(o.x,o.y),e.closePath(),e.strokeStyle="white",e.lineWidth=3,e.stroke(),e.strokeStyle="black",e.lineWidth=1,e.stroke(),e.fill())},PenMorph.prototype.setHeading=function(t){this.heading=(+t%360+360)%360,this.drawNew(),this.changed()},PenMorph.prototype.numericalSetters=function(){return["setLeft","setTop","setWidth","setHeight","setAlphaScaled","setHeading"]},PenMorph.prototype.developersMenu=function(){var t=PenMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("set rotation","setRotation","interactively turn this morph.jsk\nusing a dial widget"),t},PenMorph.prototype.setRotation=function(){var t,e,r=this.name||this.constructor.name;r.length>10&&(r=r.slice(0,9)+"..."),t=new MenuMorph(this,r),(e=new DialMorph(null,null,this.heading)).rootForGrab=function(){return this},e.target=this,e.action="setHeading",t.items.push(e),t.addLine(),t.addItem("(90) right",(function(){this.setHeading(90)})),t.addItem("(-90) left",(function(){this.setHeading(-90)})),t.addItem("(0) up",(function(){this.setHeading(0)})),t.addItem("(180) down",(function(){this.setHeading(180)})),t.isDraggable=!0,t.popUpAtHand(this.world())},PenMorph.prototype.drawLine=function(t,e){var r=this.parent.penTrails().getContext("2d"),i=t.subtract(this.parent.bounds.origin),n=e.subtract(this.parent.bounds.origin);this.isDown&&(r.lineWidth=this.size,r.strokeStyle=this.color.toString(),r.lineCap="round",r.lineJoin="round",r.beginPath(),r.moveTo(i.x,i.y),r.lineTo(n.x,n.y),r.stroke(),!1===this.isWarped&&this.world().broken.push(t.rectangle(e).expandBy(Math.max(this.size/2,1)).intersect(this.parent.visibleBounds()).spread()))},PenMorph.prototype.turn=function(t){this.setHeading(this.heading+parseFloat(t))},PenMorph.prototype.forward=function(t){var e,r=this.center(),i=parseFloat(t);e=i>=0?this.position().distanceAngle(i,this.heading):this.position().distanceAngle(Math.abs(i),this.heading-180),this.setPosition(e),this.drawLine(r,this.center())},PenMorph.prototype.down=function(){this.isDown=!0},PenMorph.prototype.up=function(){this.isDown=!1},PenMorph.prototype.clear=function(){this.parent.drawNew(),this.parent.changed()},PenMorph.prototype.startWarp=function(){this.wantsRedraw=!1,this.isWarped=!0},PenMorph.prototype.endWarp=function(){this.isWarped=!1,this.wantsRedraw&&(this.drawNew(),this.wantsRedraw=!1),this.parent.changed()},PenMorph.prototype.warp=function(t){this.startWarp(),t.call(this),this.endWarp()},PenMorph.prototype.warpOp=function(t,e){this.startWarp(),this[t].apply(this,e),this.endWarp()},PenMorph.prototype.warpSierpinski=function(t,e){this.warpOp("sierpinski",[t,e])},PenMorph.prototype.sierpinski=function(t,e){var r;if(t>e)for(r=0;r<3;r+=1)this.sierpinski(.5*t,e),this.turn(120),this.forward(t)},PenMorph.prototype.warpTree=function(t,e,r){this.warpOp("tree",[t,e,r])},PenMorph.prototype.tree=function(t,e,r){t>0&&(this.size=t,this.forward(e),this.turn(r),this.tree(t-1,.75*e,r),this.turn(-2*r),this.tree(t-1,.75*e,r),this.turn(r),this.forward(-e))},ColorPaletteMorph.prototype=new Morph,ColorPaletteMorph.prototype.constructor=ColorPaletteMorph,ColorPaletteMorph.uber=Morph.prototype,ColorPaletteMorph.prototype.init=function(t,e){ColorPaletteMorph.uber.init.call(this),this.target=t,this.targetSetter="color",this.silentSetExtent(e),this.choice=null,this.drawNew()},ColorPaletteMorph.prototype.drawNew=function(){var t,e,r,i,n,o;for(e=this.extent(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.choice=new Color,r=0;r<=e.x;r+=1)for(n=360*r/e.x,i=0;i<=e.y;i+=1)o=100-i/e.y*100,t.fillStyle="hsl("+n+",100%,"+o+"%)",t.fillRect(r,i,1,1)},ColorPaletteMorph.prototype.mouseMove=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.mouseDownLeft=function(t){this.choice=this.getPixelColor(t),this.updateTarget()},ColorPaletteMorph.prototype.updateTarget=function(){this.target instanceof Morph&&null!==this.choice&&(this.target[this.targetSetter]instanceof Function?this.target[this.targetSetter](this.choice):(this.target[this.targetSetter]=this.choice,this.target.drawNew(),this.target.changed()))},ColorPaletteMorph.prototype.developersMenu=function(){var t=ColorPaletteMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("set target","setTarget","choose another morph.jsk\nwhose color property\n will be controlled by this one"),t},ColorPaletteMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),r=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){r.target=t,r.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},ColorPaletteMorph.prototype.setTargetSetter=function(){var t=this.target.colorSetters(),e=new MenuMorph(this,"choose target property:"),r=this;t.forEach((function(t){e.addItem(t,(function(){r.targetSetter=t}))})),1===t.length?this.targetSetter=t[0]:t.length>0&&e.popUpAtHand(this.world())},GrayPaletteMorph.prototype=new ColorPaletteMorph,GrayPaletteMorph.prototype.constructor=GrayPaletteMorph,GrayPaletteMorph.uber=ColorPaletteMorph.prototype,GrayPaletteMorph.prototype.drawNew=function(){var t,e,r;e=this.extent(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.choice=new Color,(r=t.createLinearGradient(0,0,e.x,e.y)).addColorStop(0,"black"),r.addColorStop(1,"white"),t.fillStyle=r,t.fillRect(0,0,e.x,e.y)},ColorPickerMorph.prototype=new Morph,ColorPickerMorph.prototype.constructor=ColorPickerMorph,ColorPickerMorph.uber=Morph.prototype,ColorPickerMorph.prototype.init=function(t){this.choice=t,ColorPickerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.silentSetExtent(new Point(80,80)),this.drawNew()},ColorPickerMorph.prototype.drawNew=function(){ColorPickerMorph.uber.drawNew.call(this),this.buildSubmorphs()},ColorPickerMorph.prototype.buildSubmorphs=function(){var t,e,r,i;this.children.forEach((function(t){t.destroy()})),this.children=[],this.feedback=new Morph,this.feedback.color=this.choice,this.feedback.setExtent(new Point(20,20)),t=new ColorPaletteMorph(this.feedback,new Point(this.width(),50)),e=new GrayPaletteMorph(this.feedback,new Point(this.width(),5)),t.setPosition(this.bounds.origin),this.add(t),e.setPosition(t.bottomLeft()),this.add(e),r=e.left()+Math.floor((e.width()-this.feedback.width())/2),i=e.bottom()+Math.floor((this.bottom()-e.bottom()-this.feedback.height())/2),this.feedback.setPosition(new Point(r,i)),this.add(this.feedback)},ColorPickerMorph.prototype.getChoice=function(){return this.feedback.color},ColorPickerMorph.prototype.rootForGrab=function(){return this},BlinkerMorph.prototype=new Morph,BlinkerMorph.prototype.constructor=BlinkerMorph,BlinkerMorph.uber=Morph.prototype,BlinkerMorph.prototype.init=function(t){BlinkerMorph.uber.init.call(this),this.color=new Color(0,0,0),this.fps=t||2,this.drawNew()},BlinkerMorph.prototype.step=function(){this.toggleVisibility()},CursorMorph.prototype=new BlinkerMorph,CursorMorph.prototype.constructor=CursorMorph,CursorMorph.uber=BlinkerMorph.prototype,CursorMorph.prototype.viewPadding=1,CursorMorph.prototype.init=function(t){var e;this.keyDownEventUsed=!1,this.target=t,this.originalContents=this.target.text,this.originalAlignment=this.target.alignment,this.slot=this.target.text.length,CursorMorph.uber.init.call(this),e=fontHeight(this.target.fontSize),this.setExtent(new Point(Math.max(Math.floor(e/20),1),e)),this.drawNew(),this.image.getContext("2d").font=this.target.font(),this.target instanceof TextMorph&&"left"!==this.target.alignment&&this.target.setAlignmentToLeft(),this.gotoSlot(this.slot),this.initializeClipboardHandler()},CursorMorph.prototype.initializeClipboardHandler=function(){var t=this,e=this.target.world();this.clipboardHandler=document.createElement("textarea"),this.clipboardHandler.style.position="absolute",this.clipboardHandler.style.top=window.outerHeight,this.clipboardHandler.style.right="101%",document.body.appendChild(this.clipboardHandler),this.clipboardHandler.value=this.target.selection(),this.clipboardHandler.focus(),this.clipboardHandler.select(),this.clipboardHandler.addEventListener("keypress",(function(e){t.processKeyPress(e),this.value=t.target.selection(),this.select()}),!1),this.clipboardHandler.addEventListener("keydown",(function(r){t.processKeyDown(r),r.shiftKey&&(e.currentKey=16),this.value=t.target.selection(),this.select(),"U+0009"!==r.key&&"Tab"!==r.key||(t.processKeyPress(r),r.preventDefault())}),!1),this.clipboardHandler.addEventListener("keyup",(function(t){e.currentKey=null}),!1),this.clipboardHandler.addEventListener("input",(function(e){""===this.value&&(t.gotoSlot(t.target.selectionStartSlot()),t.target.deleteSelection())}),!1)},CursorMorph.prototype.processKeyPress=function(t){return this.keyDownEventUsed?(this.keyDownEventUsed=!1,null):40===t.keyCode||40===t.charCode?(this.insert("("),null):37===t.keyCode||37===t.charCode?(this.insert("%"),null):(t.keyCode?t.ctrlKey&&!t.altKey?this.ctrl(t.keyCode,t.shiftKey):t.metaKey?this.cmd(t.keyCode,t.shiftKey):this.insert(String.fromCharCode(t.keyCode),t.shiftKey):t.charCode&&(t.ctrlKey&&!t.altKey?this.ctrl(t.charCode,t.shiftKey):t.metaKey?this.cmd(t.charCode,t.shiftKey):this.insert(String.fromCharCode(t.charCode),t.shiftKey)),void this.target.escalateEvent("reactToKeystroke",t))},CursorMorph.prototype.processKeyDown=function(t){var e=t.shiftKey,r=t.ctrlKey||t.altKey,i=this.target.selection().length>0;switch(this.keyDownEventUsed=!1,t.ctrlKey&&!t.altKey&&(this.ctrl(t.keyCode,t.shiftKey),this.target.escalateEvent("reactToKeystroke",t)),t.metaKey&&(this.cmd(t.keyCode,t.shiftKey),this.target.escalateEvent("reactToKeystroke",t)),t.keyCode){case 37:!i||e||r?this.goLeft(e,r?this.slot-this.target.previousWordFrom(this.slot):1):(this.gotoSlot(Math.min(this.target.startMark,this.target.endMark)),this.target.clearSelection()),this.keyDownEventUsed=!0;break;case 39:!i||e||r?this.goRight(e,r?this.target.nextWordFrom(this.slot)-this.slot:1):(this.gotoSlot(Math.max(this.target.startMark,this.target.endMark)),this.target.clearSelection()),this.keyDownEventUsed=!0;break;case 38:this.goUp(e),this.keyDownEventUsed=!0;break;case 40:this.goDown(e),this.keyDownEventUsed=!0;break;case 36:this.goHome(e),this.keyDownEventUsed=!0;break;case 35:this.goEnd(e),this.keyDownEventUsed=!0;break;case 46:this.deleteRight(),this.keyDownEventUsed=!0;break;case 8:this.deleteLeft(),this.keyDownEventUsed=!0;break;case 13:this.target instanceof StringMorph||e?this.accept():this.insert("\n"),this.keyDownEventUsed=!0;break;case 27:this.cancel(),this.keyDownEventUsed=!0;break;default:nop()}this.target.escalateEvent("reactToKeystroke",t)},CursorMorph.prototype.gotoSlot=function(t){var e,r,i=this.target.text.length,n=this.target.slotPosition(t);this.slot=t<0?0:t>i?i:t,this.parent&&this.target.isScrollable&&(e=this.parent.right()-this.viewPadding,r=this.parent.left()+this.viewPadding,n.x>e&&(this.target.setLeft(this.target.left()+e-n.x),n.x=e),n.x<r&&(r=Math.min(this.parent.left(),r),this.target.setLeft(this.target.left()+r-n.x),n.x=r),this.target.right()<e&&e-this.target.width()<r&&(n.x+=e-this.target.right(),this.target.setRight(e))),this.show(),this.setPosition(n),this.parent&&this.parent.parent instanceof ScrollFrameMorph&&this.target.isScrollable&&this.parent.parent.scrollCursorIntoView(this)},CursorMorph.prototype.goLeft=function(t,e){this.updateSelection(t),this.gotoSlot(this.slot-(e||1)),this.updateSelection(t)},CursorMorph.prototype.goRight=function(t,e){this.updateSelection(t),this.gotoSlot(this.slot+(e||1)),this.updateSelection(t)},CursorMorph.prototype.goUp=function(t){this.updateSelection(t),this.gotoSlot(this.target.upFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goDown=function(t){this.updateSelection(t),this.gotoSlot(this.target.downFrom(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goHome=function(t){this.updateSelection(t),this.gotoSlot(this.target.startOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.goEnd=function(t){this.updateSelection(t),this.gotoSlot(this.target.endOfLine(this.slot)),this.updateSelection(t)},CursorMorph.prototype.gotoPos=function(t){this.gotoSlot(this.target.slotAt(t)),this.show()},CursorMorph.prototype.updateSelection=function(t){t?isNil(this.target.endMark)&&isNil(this.target.startMark)?(this.target.startMark=this.slot,this.target.endMark=this.slot):this.target.endMark!==this.slot&&(this.target.endMark=this.slot,this.target.drawNew(),this.target.changed()):this.target.clearSelection()},CursorMorph.prototype.accept=function(){var t=this.root();t&&t.stopEditing(),this.escalateEvent("accept",this)},CursorMorph.prototype.cancel=function(){var t=this.root();this.undo(),t&&t.stopEditing(),this.escalateEvent("cancel",this)},CursorMorph.prototype.undo=function(){this.target.text=this.originalContents,this.target.changed(),this.target.drawNew(),this.target.changed(),this.gotoSlot(0)},CursorMorph.prototype.insert=function(t,e){var r;if("\t"===t)return this.target.escalateEvent("reactToEdit",this.target),e?this.target.backTab(this.target):this.target.tab(this.target);this.target.isNumeric&&isNaN(parseFloat(t))&&!contains(["-","."],t)||(""!==this.target.selection()&&(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()),r=(r=this.target.text).slice(0,this.slot)+t+r.slice(this.slot),this.target.text=r,this.target.drawNew(),this.target.changed(),this.goRight(!1,t.length))},CursorMorph.prototype.ctrl=function(t,e){64===t||65===t&&e?this.insert("@"):65===t?this.target.selectAll():90===t?this.undo():123===t?this.insert("{"):125===t?this.insert("}"):91===t?this.insert("["):93===t?this.insert("]"):isNil(this.target.receiver)||(68===t?this.target.doIt():73===t?this.target.inspectIt():80===t&&this.target.showIt())},CursorMorph.prototype.cmd=function(t,e){64===t||65===t&&e?this.insert("@"):65===t?this.target.selectAll():90===t?this.undo():isNil(this.target.receiver)||(68===t?this.target.doIt():73===t?this.target.inspectIt():80===t&&this.target.showIt())},CursorMorph.prototype.deleteRight=function(){var t;""!==this.target.selection()?(this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection()):(t=this.target.text,this.target.changed(),t=t.slice(0,this.slot)+t.slice(this.slot+1),this.target.text=t,this.target.drawNew())},CursorMorph.prototype.deleteLeft=function(){var t;if(this.target.selection())return this.gotoSlot(this.target.selectionStartSlot()),this.target.deleteSelection();t=this.target.text,this.target.changed(),this.target.text=t.substring(0,this.slot-1)+t.substr(this.slot),this.target.drawNew(),this.goLeft()},CursorMorph.prototype.destroy=function(){this.target.alignment!==this.originalAlignment&&(this.target.alignment=this.originalAlignment,this.target.drawNew(),this.target.changed()),this.destroyClipboardHandler(),CursorMorph.uber.destroy.call(this)},CursorMorph.prototype.destroyClipboardHandler=function(){var t,e=document.body.children;if(this.clipboardHandler)for(t=0;t<e.length;t+=1)e[t]===this.clipboardHandler&&(document.body.removeChild(this.clipboardHandler),this.clipboardHandler=null)},CursorMorph.prototype.inspectKeyEvent=function(t){this.inform("Key pressed: "+String.fromCharCode(t.charCode)+"\n------------------------\ncharCode: "+t.charCode.toString()+"\nkeyCode: "+t.keyCode.toString()+"\nshiftKey: "+t.shiftKey.toString()+"\naltKey: "+t.altKey.toString()+"\nctrlKey: "+t.ctrlKey.toString()+"\ncmdKey: "+t.metaKey.toString())},BoxMorph.prototype=new Morph,BoxMorph.prototype.constructor=BoxMorph,BoxMorph.uber=Morph.prototype,BoxMorph.prototype.init=function(t,e,r){this.edge=t||4,this.border=e||(0===e?0:2),this.borderColor=r||new Color,BoxMorph.uber.init.call(this)},BoxMorph.prototype.drawNew=function(){var t;if(this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),0===this.edge&&0===this.border)return BoxMorph.uber.drawNew.call(this),null;t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePath(t,Math.max(this.edge-this.border,0),this.border),t.closePath(),t.fill(),this.border>0&&(t.lineWidth=this.border,t.strokeStyle=this.borderColor.toString(),t.beginPath(),this.outlinePath(t,this.edge,this.border/2),t.closePath(),t.stroke())},BoxMorph.prototype.outlinePath=function(t,e,r){var i=e+r,n=this.width(),o=this.height();t.arc(i,i,e,radians(-180),radians(-90),!1),t.arc(n-i,i,e,radians(-90),radians(-0),!1),t.arc(n-i,o-i,e,radians(0),radians(90),!1),t.arc(i,o-i,e,radians(90),radians(180),!1)},BoxMorph.prototype.developersMenu=function(){var t=BoxMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("border width...",(function(){this.prompt(t.title+"\nborder\nwidth:",this.setBorderWidth,this,this.border.toString(),null,0,100,!0)}),"set the border's\nline size"),t.addItem("border color...",(function(){this.pickColor(t.title+"\nborder color:",this.setBorderColor,this,this.borderColor)}),"set the border's\nline color"),t.addItem("corner size...",(function(){this.prompt(t.title+"\ncorner\nsize:",this.setCornerSize,this,this.edge.toString(),null,0,100,!0)}),"set the corner's\nradius"),t},BoxMorph.prototype.setBorderWidth=function(t){var e;"number"==typeof t?this.border=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.border=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.setBorderColor=function(t){t&&(this.borderColor=t,this.drawNew(),this.changed())},BoxMorph.prototype.setCornerSize=function(t){var e;"number"==typeof t?this.edge=Math.max(t,0):(e=parseFloat(t),isNaN(e)||(this.edge=Math.max(e,0))),this.drawNew(),this.changed()},BoxMorph.prototype.colorSetters=function(){return["color","borderColor"]},BoxMorph.prototype.numericalSetters=function(){var t=BoxMorph.uber.numericalSetters.call(this);return t.push("setBorderWidth","setCornerSize"),t},SpeechBubbleMorph.prototype=new BoxMorph,SpeechBubbleMorph.prototype.constructor=SpeechBubbleMorph,SpeechBubbleMorph.uber=BoxMorph.prototype,SpeechBubbleMorph.prototype.init=function(t,e,r,i,n,o,s){this.isPointingRight=!0,this.contents=t||"",this.padding=o||0,this.isThought=s||!1,this.isClickable=!1,SpeechBubbleMorph.uber.init.call(this,r||6,i||(0===i?0:1),n||new Color(140,140,140)),this.color=e||new Color(230,230,230),this.drawNew()},SpeechBubbleMorph.prototype.popUp=function(t,e,r){this.drawNew(),this.setPosition(e.subtract(new Point(0,this.height()))),this.addShadow(new Point(2,2),80),this.keepWithin(t),t.add(this),this.fullChanged(),t.hand.destroyTemporaries(),t.hand.temporaries.push(this),r?this.isClickable=!0:this.mouseEnter=function(){this.destroy()}},SpeechBubbleMorph.prototype.drawNew=function(){this.contentsMorph&&this.contentsMorph.destroy(),this.contents instanceof Morph?this.contentsMorph=this.contents:isString(this.contents)?this.contentsMorph=new TextMorph(this.contents,MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center"):this.contents instanceof HTMLCanvasElement?(this.contentsMorph=new Morph,this.contentsMorph.silentSetWidth(this.contents.width),this.contentsMorph.silentSetHeight(this.contents.height),this.contentsMorph.image=this.contents):this.contentsMorph=new TextMorph(this.contents.toString(),MorphicPreferences.bubbleHelpFontSize,null,!1,!0,"center"),this.add(this.contentsMorph),this.silentSetWidth(this.contentsMorph.width()+(this.padding?2*this.padding:2*this.edge)),this.silentSetHeight(this.contentsMorph.height()+this.edge+2*this.border+2*this.padding+2),SpeechBubbleMorph.uber.drawNew.call(this),this.contentsMorph.setPosition(this.position().add(new Point(this.padding||this.edge,this.border+this.padding+1)))},SpeechBubbleMorph.prototype.outlinePath=function(t,e,r){var i,n=e+r,o=this.width(),s=this.height();function a(e,r,i){t.moveTo(e+i,r),t.arc(e,r,i,radians(0),radians(360))}t.arc(n,n,e,radians(-180),radians(-90),!1),t.arc(o-n,n,e,radians(-90),radians(-0),!1),t.arc(o-n,s-n-e,e,radians(0),radians(90),!1),this.isThought||(this.isPointingRight?(t.lineTo(n+e,s-n),t.lineTo(e/2+r,s-r)):(t.lineTo(o-(e/2+r),s-r),t.lineTo(o-(n+e),s-n))),t.arc(n,s-n-e,e,radians(90),radians(180),!1),!0===this.isThought&&(t.lineTo(r,n),this.isPointingRight?(a((i=e/4)+r,s-i-r,i),a(2*(i=e/3.2)+r,s-i-2*r,i),a(3*(i=e/2.8)+2*r,s-i-4*r,i)):(a(o-((i=e/4)+r),s-i-r,i),a(o-(2*(i=e/3.2)+r),s-i-2*r,i),a(o-(3*(i=e/2.8)+2*r),s-i-4*r,i)))},SpeechBubbleMorph.prototype.shadowImage=function(t,e){var r,i,n,o,s,a=t||new Point(7,7),h=e||new Color(0,0,0);return r=this.extent(),i=this.image,(s=(n=newCanvas(r)).getContext("2d")).drawImage(i,0,0),s.globalCompositeOperation="destination-out",s.drawImage(i,-a.x,-a.y),(s=(o=newCanvas(r)).getContext("2d")).drawImage(n,0,0),s.globalCompositeOperation="source-atop",s.fillStyle=h.toString(),s.fillRect(0,0,r.x,r.y),o},SpeechBubbleMorph.prototype.shadowImageBlurred=function(t,e){var r,i,n,o,s=t||new Point(7,7),a=this.shadowBlur,h=e||new Color(0,0,0);return r=this.extent().add(2*a),i=this.image,(o=(n=newCanvas(r)).getContext("2d")).shadowOffsetX=s.x,o.shadowOffsetY=s.y,o.shadowBlur=a,o.shadowColor=h.toString(),o.drawImage(i,a-s.x,a-s.y),o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=0,o.globalCompositeOperation="destination-out",o.drawImage(i,a-s.x,a-s.y),n},SpeechBubbleMorph.prototype.fixLayout=function(){this.removeShadow(),this.drawNew(),this.addShadow(new Point(2,2),80)},DialMorph.prototype=new Morph,DialMorph.prototype.constructor=DialMorph,DialMorph.uber=Morph.prototype,DialMorph.prototype.init=function(t,e,r,i,n){this.target=null,this.action=null,this.min=t||0,this.max=e||360,this.value=Math.max(this.min,(r||0)%this.max),this.tick=i||15,this.fillColor=null,DialMorph.uber.init.call(this),this.color=new Color(230,230,230),this.noticesTransparentClick=!0,this.setRadius(n||4*MorphicPreferences.menuFontSize)},DialMorph.prototype.setRadius=function(t){this.radius=t,this.setExtent(new Point(2*this.radius,2*this.radius))},DialMorph.prototype.setValue=function(t,e,r){var i=this.max-this.min;t=t||0,this.value=this.min+(+t%i+i)%i,e&&(this.value<this.tick?this.value=this.min:this.value-=this.value%this.tick%this.value),this.drawNew(),this.changed(),r||this.updateTarget()},DialMorph.prototype.getValueOf=function(t){var e=this.max-this.min,r=this.center(),i=t.x-r.x,n=r.y-t.y;return e*(((Math.abs(i)<.001?n<0?90:270:Math.round((i>=0?0:180)-57.2957795131*Math.atan(n/i)))+90)/360)+this.min},DialMorph.prototype.setExtent=function(t){var e=Math.min(t.x,t.y);this.radius=e/2,DialMorph.uber.setExtent.call(this,new Point(e,e))},DialMorph.prototype.drawNew=function(){var t,e,r,i,n,o,s,a=this.color.lighter().toString(),h=this.max-this.min,c=h/this.tick,l=.75*this.radius,u=.85*l,p=.95*l;for(this.image=newCanvas(this.extent()),(t=this.image.getContext("2d")).fillStyle=a,t.beginPath(),t.arc(this.radius,this.radius,l+Math.min(1,this.radius-l),0,2*Math.PI,!1),t.closePath(),t.fill(),t.fillStyle=this.color.toString(),t.beginPath(),t.arc(this.radius,this.radius,l,0,2*Math.PI,!1),t.closePath(),t.fill(),r=(this.value-this.min)*(2*Math.PI)/h-Math.PI/2,t.fillStyle=(this.fillColor||this.color.darker()).toString(),t.beginPath(),t.arc(this.radius,this.radius,l,Math.PI/-2,r,!1),t.lineTo(this.radius,this.radius),t.closePath(),t.fill(),t.strokeStyle=new Color(35,35,35).toString(),t.lineWidth=1,e=0;e<c;e+=1)r=(e-3)*(2*Math.PI)/c-Math.PI/2,t.beginPath(),i=this.radius+Math.cos(r)*u,n=this.radius+Math.sin(r)*u,o=this.radius+Math.cos(r)*p,s=this.radius+Math.sin(r)*p,t.moveTo(i,n),t.lineTo(o,s),t.stroke();u=.05*l,t.fillStyle="black",t.beginPath(),t.arc(this.radius,this.radius,u,0,2*Math.PI,!1),t.closePath(),t.fill(),t.strokeStyle="black",t.lineWidth=1,r=(this.value-this.min)*(2*Math.PI)/h-Math.PI/2,p=.8*l,i=this.radius+Math.cos(r)*u,n=this.radius+Math.sin(r)*u,o=this.radius+Math.cos(r)*p,s=this.radius+Math.sin(r)*p,t.beginPath(),t.moveTo(i,n),t.lineTo(o,s),t.stroke(),u*=2,o=this.radius+Math.cos(r)*(p+u),s=this.radius+Math.sin(r)*(p+u),t.fillStyle="black",t.beginPath(),t.arc(o,s,u,0,2*Math.PI,!1),t.closePath(),t.stroke(),r=(this.value-this.min)*(2*Math.PI)/h-Math.PI/2,i=this.radius+Math.cos(r)*l,n=this.radius+Math.sin(r)*l,o=this.radius+Math.cos(r)*(this.radius-1),s=this.radius+Math.sin(r)*(this.radius-1),t.beginPath(),t.moveTo(i,n),t.lineTo(o,s),t.lineWidth=3,t.strokeStyle=a,t.stroke(),t.lineWidth=1,t.strokeStyle="black",t.stroke(),r=radians(degrees(r)-4),i=this.radius+Math.cos(r)*this.radius*.9,n=this.radius+Math.sin(r)*this.radius*.9,t.beginPath(),t.moveTo(i,n),r=radians(degrees(r)+8),i=this.radius+Math.cos(r)*this.radius*.9,n=this.radius+Math.sin(r)*this.radius*.9,t.lineTo(i,n),t.lineTo(o,s),t.closePath(),t.lineWidth=3,t.strokeStyle=a,t.stroke(),t.lineWidth=1,t.strokeStyle="black",t.stroke(),t.fill()},DialMorph.prototype.step=null,DialMorph.prototype.mouseDownLeft=function(t){var e,r=this;e=this.root(),this.step=function(){e.hand.mouseButton?r.setValue(r.getValueOf(e.hand.bounds.origin),16!==e.currentKey):this.step=null}},DialMorph.prototype.developersMenu=function(){var t=DialMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("set target","setTarget","select another morph.jsk\nwhose numerical property\nwill be controlled by this one"),t},DialMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),r=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){r.target=t,r.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},DialMorph.prototype.setTargetSetter=function(){var t=this.target.numericalSetters(),e=new MenuMorph(this,"choose target property:"),r=this;t.forEach((function(t){e.addItem(t,(function(){r.action=t}))})),1===t.length?this.action=t[0]:t.length>0&&e.popUpAtHand(this.world())},DialMorph.prototype.updateTarget=function(){this.action&&("function"==typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value))},CircleBoxMorph.prototype=new Morph,CircleBoxMorph.prototype.constructor=CircleBoxMorph,CircleBoxMorph.uber=Morph.prototype,CircleBoxMorph.prototype.init=function(t){CircleBoxMorph.uber.init.call(this),this.orientation=t,this.autoOrient=!0,this.setExtent(new Point(20,100))},CircleBoxMorph.prototype.autoOrientation=function(){this.height()>this.width()?this.orientation="vertical":this.orientation="horizontal"},CircleBoxMorph.prototype.drawNew=function(){var t,e,r,i,n,o,s,a,h=this;this.autoOrient&&this.autoOrientation(),this.image=newCanvas(this.extent()),s=this.image.getContext("2d"),"vertical"===this.orientation?(t=this.width()/2,e=new Point(n=this.center().x,this.top()+t),r=new Point(n,this.bottom()-t),i=this.bounds.origin.add(new Point(0,t)).corner(this.bounds.corner.subtract(new Point(0,t)))):(t=this.height()/2,o=this.center().y,e=new Point(this.left()+t,o),r=new Point(this.right()-t,o),i=this.bounds.origin.add(new Point(t,0)).corner(this.bounds.corner.subtract(new Point(t,0)))),[e.subtract(this.bounds.origin),r.subtract(this.bounds.origin)].forEach((function(e){s.fillStyle=h.color.toString(),s.beginPath(),s.arc(e.x,e.y,t,0,2*Math.PI,!1),s.closePath(),s.fill()})),(a=(i=i.translateBy(this.bounds.origin.neg())).extent()).x>0&&a.y>0&&s.fillRect(i.origin.x,i.origin.y,i.width(),i.height())},CircleBoxMorph.prototype.developersMenu=function(){var t=CircleBoxMorph.uber.developersMenu.call(this);return t.addLine(),"vertical"===this.orientation?t.addItem("horizontal...","toggleOrientation","toggle the\norientation"):t.addItem("vertical...","toggleOrientation","toggle the\norientation"),t},CircleBoxMorph.prototype.toggleOrientation=function(){var t=this.center();this.changed(),"vertical"===this.orientation?this.orientation="horizontal":this.orientation="vertical",this.silentSetExtent(new Point(this.height(),this.width())),this.setCenter(t),this.drawNew(),this.changed()},SliderButtonMorph.prototype=new CircleBoxMorph,SliderButtonMorph.prototype.constructor=SliderButtonMorph,SliderButtonMorph.uber=CircleBoxMorph.prototype,SliderButtonMorph.prototype.init=function(t){this.color=new Color(80,80,80),this.highlightColor=new Color(90,90,140),this.pressColor=new Color(80,80,160),this.is3D=!1,this.hasMiddleDip=!0,SliderButtonMorph.uber.init.call(this,t)},SliderButtonMorph.prototype.autoOrientation=nop,SliderButtonMorph.prototype.drawNew=function(){var t=this.color.copy();SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.normalImage=this.image,this.color=this.highlightColor.copy(),SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.highlightImage=this.image,this.color=this.pressColor.copy(),SliderButtonMorph.uber.drawNew.call(this),!this.is3D&&MorphicPreferences.isFlat||this.drawEdges(),this.pressImage=this.image,this.color=t,this.image=this.normalImage},SliderButtonMorph.prototype.drawEdges=function(){var t,e,r=this.image.getContext("2d"),i=this.width(),n=this.height();r.lineJoin="round",r.lineCap="round","vertical"===this.orientation?(r.lineWidth=i/3,(t=r.createLinearGradient(0,0,r.lineWidth,0)).addColorStop(0,"white"),t.addColorStop(1,this.color.toString()),r.strokeStyle=t,r.beginPath(),r.moveTo(.5*r.lineWidth,i/2),r.lineTo(.5*r.lineWidth,n-i/2),r.stroke(),(t=r.createLinearGradient(i-r.lineWidth,0,i,0)).addColorStop(0,this.color.toString()),t.addColorStop(1,"black"),r.strokeStyle=t,r.beginPath(),r.moveTo(i-.5*r.lineWidth,i/2),r.lineTo(i-.5*r.lineWidth,n-i/2),r.stroke(),this.hasMiddleDip&&(e=i/4,(t=r.createLinearGradient(r.lineWidth,0,i-r.lineWidth,0)).addColorStop(0,"black"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,"white"),r.fillStyle=t,r.beginPath(),r.arc(i/2,n/2,e,radians(0),radians(360),!1),r.closePath(),r.fill())):"horizontal"===this.orientation&&(r.lineWidth=n/3,(t=r.createLinearGradient(0,0,0,r.lineWidth)).addColorStop(0,"white"),t.addColorStop(1,this.color.toString()),r.strokeStyle=t,r.beginPath(),r.moveTo(n/2,.5*r.lineWidth),r.lineTo(i-n/2,.5*r.lineWidth),r.stroke(),(t=r.createLinearGradient(0,n-r.lineWidth,0,n)).addColorStop(0,this.color.toString()),t.addColorStop(1,"black"),r.strokeStyle=t,r.beginPath(),r.moveTo(n/2,n-.5*r.lineWidth),r.lineTo(i-n/2,n-.5*r.lineWidth),r.stroke(),this.hasMiddleDip&&(e=n/4,(t=r.createLinearGradient(0,r.lineWidth,0,n-r.lineWidth)).addColorStop(0,"black"),t.addColorStop(.35,this.color.toString()),t.addColorStop(.65,this.color.toString()),t.addColorStop(1,"white"),r.fillStyle=t,r.beginPath(),r.arc(this.width()/2,this.height()/2,e,radians(0),radians(360),!1),r.closePath(),r.fill()))},SliderButtonMorph.prototype.mouseEnter=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed()},SliderButtonMorph.prototype.mouseDownLeft=function(t){this.image=this.pressImage,this.changed(),this.escalateEvent("mouseDownLeft",t)},SliderButtonMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed()},SliderButtonMorph.prototype.mouseMove=function(){nop()},SliderMorph.prototype=new CircleBoxMorph,SliderMorph.prototype.constructor=SliderMorph,SliderMorph.uber=CircleBoxMorph.prototype,SliderMorph.prototype.init=function(t,e,r,i,n,o){this.target=null,this.action=null,this.start=t,this.stop=e,this.value=r,this.size=i,this.offset=null,this.button=new SliderButtonMorph,this.button.isDraggable=!1,this.button.color=new Color(200,200,200),this.button.highlightColor=new Color(210,210,255),this.button.pressColor=new Color(180,180,255),SliderMorph.uber.init.call(this,n),this.add(this.button),this.alpha=.3,this.color=o||new Color(0,0,0),this.setExtent(new Point(20,100))},SliderMorph.prototype.autoOrientation=nop,SliderMorph.prototype.rangeSize=function(){return this.stop-this.start},SliderMorph.prototype.ratio=function(){return this.size/(this.rangeSize()+1)},SliderMorph.prototype.unitSize=function(){return"vertical"===this.orientation?(this.height()-this.button.height())/this.rangeSize():(this.width()-this.button.width())/this.rangeSize()},SliderMorph.prototype.drawNew=function(){var t,e,r,i;SliderMorph.uber.drawNew.call(this),this.button.orientation=this.orientation,"vertical"===this.orientation?(t=this.width()-2,e=Math.max(t,Math.round(this.height()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),r=1,i=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.height()-this.button.height())):(e=this.height()-2,t=Math.max(e,Math.round(this.width()*this.ratio())),this.button.silentSetExtent(new Point(t,e)),i=1,r=Math.min(Math.round((this.value-this.start)*this.unitSize()),this.width()-this.button.width())),this.button.setPosition(new Point(r,i).add(this.bounds.origin)),this.button.drawNew(),this.button.changed()},SliderMorph.prototype.updateValue=function(){var t;t="vertical"===this.orientation?this.button.top()-this.top():this.button.left()-this.left(),this.value=Math.round(t/this.unitSize()+this.start),this.updateTarget()},SliderMorph.prototype.updateTarget=function(){this.action&&("function"==typeof this.action?this.action.call(this.target,this.value):this.target[this.action](this.value))},SliderMorph.prototype.developersMenu=function(){var t=SliderMorph.uber.developersMenu.call(this);return t.addItem("show value...","showValue","display a dialog box\nshowing the selected number"),t.addItem("floor...",(function(){this.prompt(t.title+"\nfloor:",this.setStart,this,this.start.toString(),null,0,this.stop-this.size,!0)}),"set the minimum value\nwhich can be selected"),t.addItem("ceiling...",(function(){this.prompt(t.title+"\nceiling:",this.setStop,this,this.stop.toString(),null,this.start+this.size,100*this.size,!0)}),"set the maximum value\nwhich can be selected"),t.addItem("button size...",(function(){this.prompt(t.title+"\nbutton size:",this.setSize,this,this.size.toString(),null,1,this.stop-this.start,!0)}),"set the range\ncovered by\nthe slider button"),t.addLine(),t.addItem("set target","setTarget","select another morph.jsk\nwhose numerical property\nwill be controlled by this one"),t},SliderMorph.prototype.showValue=function(){this.inform(this.value)},SliderMorph.prototype.userSetStart=function(t){this.start=Math.max(t,this.stop)},SliderMorph.prototype.setStart=function(t,e){var r;"number"==typeof t?this.start=Math.min(t,this.stop-this.size):(r=parseFloat(t),isNaN(r)||(this.start=Math.min(r,this.stop-this.size))),this.value=Math.max(this.value,this.start),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setStop=function(t,e){var r;"number"==typeof t?this.stop=Math.max(t,this.start+this.size):(r=parseFloat(t),isNaN(r)||(this.stop=Math.max(r,this.start+this.size))),this.value=Math.min(this.value,this.stop),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setSize=function(t,e){var r;"number"==typeof t?this.size=Math.min(Math.max(t,1),this.stop-this.start):(r=parseFloat(t),isNaN(r)||(this.size=Math.min(Math.max(r,1),this.stop-this.start))),this.value=Math.min(this.value,this.stop-this.size),e||this.updateTarget(),this.drawNew(),this.changed()},SliderMorph.prototype.setTarget=function(){var t=this.overlappedMorphs(),e=new MenuMorph(this,"choose target:"),r=this;t.push(this.world()),t.forEach((function(t){e.addItem(t.toString().slice(0,50),(function(){r.target=t,r.setTargetSetter()}))})),1===t.length?(this.target=t[0],this.setTargetSetter()):t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.setTargetSetter=function(){var t=this.target.numericalSetters(),e=new MenuMorph(this,"choose target property:"),r=this;t.forEach((function(t){e.addItem(t,(function(){r.action=t}))})),1===t.length?this.action=t[0]:t.length>0&&e.popUpAtHand(this.world())},SliderMorph.prototype.numericalSetters=function(){var t=SliderMorph.uber.numericalSetters.call(this);return t.push("setStart","setStop","setSize"),t},SliderMorph.prototype.step=null,SliderMorph.prototype.mouseDownLeft=function(t){var e,r=this;this.button.bounds.containsPoint(t)?this.offset=t.subtract(this.button.bounds.origin):this.offset=new Point,e=this.root(),this.step=function(){var t,i,n;e.hand.mouseButton?(t=e.hand.bounds.origin,"vertical"===r.orientation?(i=r.button.bounds.origin.x,n=Math.max(Math.min(t.y-r.offset.y,r.bottom()-r.button.height()),r.top())):(n=r.button.bounds.origin.y,i=Math.max(Math.min(t.x-r.offset.x,r.right()-r.button.width()),r.left())),r.button.setPosition(new Point(i,n)),r.updateValue()):this.step=null}},MouseSensorMorph.prototype=new BoxMorph,MouseSensorMorph.prototype.constructor=MouseSensorMorph,MouseSensorMorph.uber=BoxMorph.prototype,MouseSensorMorph.prototype.init=function(t,e,r){MouseSensorMorph.uber.init.call(this),this.edge=t||4,this.border=e||2,this.color=new Color(255,255,255),this.borderColor=r||new Color,this.isTouched=!1,this.upStep=.05,this.downStep=.02,this.noticesTransparentClick=!1,this.drawNew()},MouseSensorMorph.prototype.touch=function(){var t=this;this.isTouched||(this.isTouched=!0,this.alpha=.6,this.step=function(){t.isTouched?t.alpha<1&&(t.alpha=t.alpha+t.upStep):t.alpha>t.downStep?t.alpha=t.alpha-t.downStep:(t.alpha=0,t.step=null),t.changed()})},MouseSensorMorph.prototype.unTouch=function(){this.isTouched=!1},MouseSensorMorph.prototype.mouseEnter=function(){this.touch()},MouseSensorMorph.prototype.mouseLeave=function(){this.unTouch()},MouseSensorMorph.prototype.mouseDownLeft=function(){this.touch()},MouseSensorMorph.prototype.mouseClickLeft=function(){this.unTouch()},InspectorMorph.prototype=new BoxMorph,InspectorMorph.prototype.constructor=InspectorMorph,InspectorMorph.uber=BoxMorph.prototype,InspectorMorph.prototype.init=function(t){this.target=t,this.currentProperty=null,this.showing="attributes",this.markOwnProperties=!1,this.hasUserEditedDetails=!1,InspectorMorph.uber.init.call(this),this.silentSetExtent(new Point(20*MorphicPreferences.handleSize,20*MorphicPreferences.handleSize*2/3)),this.isDraggable=!0,this.border=1,this.edge=MorphicPreferences.isFlat?1:5,this.color=new Color(60,60,60),this.borderColor=new Color(95,95,95),this.fps=25,this.drawNew(),this.label=null,this.list=null,this.detail=null,this.work=null,this.buttonInspect=null,this.buttonClose=null,this.buttonSubset=null,this.buttonEdit=null,this.resizer=null,this.target&&this.buildPanes()},InspectorMorph.prototype.setTarget=function(t){this.target=t,this.currentProperty=null,this.buildPanes()},InspectorMorph.prototype.updateCurrentSelection=function(){var t,e,r,i=this.list.selected,n=this.detail.contents.children[0],o=this.root();o&&o.keyboardReceiver instanceof CursorMorph&&o.keyboardReceiver.target===n?this.hasUserEditedDetails=!0:isNil(i)||this.hasUserEditedDetails||(t=this.target[i],this.currentProperty=t,e=isNil(t)?"NULL":isString(t)?t:t.toString(),n.text!==e&&((r=new TextMorph(e)).isEditable=!0,r.enableSelecting(),r.setReceiver(this.target),this.detail.setContents(r)))},InspectorMorph.prototype.buildPanes=function(){var t,e,r,i,n=[],o=this;for(t in this.children.forEach((function(t){t!==this.work&&t.destroy()})),this.children=[],this.label=new TextMorph(this.target.toString()),this.label.fontSize=MorphicPreferences.menuFontSize,this.label.isBold=!0,this.label.color=new Color(255,255,255),this.label.drawNew(),this.add(this.label),this.target)t&&n.push(t);"attributes"===this.showing?n=n.filter((function(t){return"function"!=typeof o.target[t]})):"methods"===this.showing&&(n=n.filter((function(t){return"function"==typeof o.target[t]}))),i=function(){var t,e;isObject(o.currentProperty)&&(t=o.world(),(e=new InspectorMorph(o.currentProperty)).setPosition(t.hand.position()),e.keepWithin(t),t.add(e),e.changed())},this.list=new ListMorph(this.target instanceof Array?n:n.sort(),null,this.markOwnProperties?[[new Color(0,0,180),function(t){return Object.prototype.hasOwnProperty.call(o.target,t)}]]:null,i),this.list.action=function(){o.hasUserEditedDetails=!1,o.updateCurrentSelection()},this.list.hBar.alpha=.6,this.list.vBar.alpha=.6,this.list.contents.step=null,this.add(this.list),this.detail=new ScrollFrameMorph,this.detail.acceptsDrops=!1,this.detail.contents.acceptsDrops=!1,this.detail.isTextLineWrapping=!0,this.detail.color=new Color(255,255,255),this.detail.hBar.alpha=.6,this.detail.vBar.alpha=.6,(e=new TextMorph("")).isEditable=!0,e.enableSelecting(),e.setReceiver(this.target),this.detail.setContents(e),this.add(this.detail),null===this.work&&(this.work=new ScrollFrameMorph,this.work.acceptsDrops=!1,this.work.contents.acceptsDrops=!1,this.work.isTextLineWrapping=!0,this.work.color=new Color(255,255,255),this.work.hBar.alpha=.6,this.work.vBar.alpha=.6,(r=new TextMorph("")).isEditable=!0,r.enableSelecting(),r.setReceiver(this.target),this.work.setContents(r)),this.add(this.work),this.buttonSubset=new TriggerMorph,this.buttonSubset.labelString="show...",this.buttonSubset.action=function(){var t;(t=new MenuMorph).addItem("attributes",(function(){o.showing="attributes",o.buildPanes()})),t.addItem("methods",(function(){o.showing="methods",o.buildPanes()})),t.addItem("all",(function(){o.showing="all",o.buildPanes()})),t.addLine(),t.addItem(o.markOwnProperties?"un-mark own":"mark own",(function(){o.markOwnProperties=!o.markOwnProperties,o.buildPanes()}),"highlight\n'own' properties"),t.popUpAtHand(o.world())},this.add(this.buttonSubset),this.buttonInspect=new TriggerMorph,this.buttonInspect.labelString="inspect...",this.buttonInspect.action=function(){var t,e,r;isObject(o.currentProperty)?((t=new MenuMorph).addItem("in new inspector...",(function(){e=o.world(),(r=new InspectorMorph(o.currentProperty)).setPosition(e.hand.position()),r.keepWithin(e),e.add(r),r.changed()})),t.addItem("here...",(function(){o.setTarget(o.currentProperty)})),t.popUpAtHand(o.world())):o.inform((null===o.currentProperty?"null":typeof o.currentProperty)+"\nis not inspectable")},this.add(this.buttonInspect),this.buttonEdit=new TriggerMorph,this.buttonEdit.labelString="edit...",this.buttonEdit.action=function(){var t;(t=new MenuMorph(o)).addItem("save","save","accept changes"),t.addLine(),t.addItem("add property...","addProperty"),t.addItem("rename...","renameProperty"),t.addItem("remove...","removeProperty"),t.popUpAtHand(o.world())},this.add(this.buttonEdit),this.buttonClose=new TriggerMorph,this.buttonClose.labelString="close",this.buttonClose.action=function(){o.destroy()},this.add(this.buttonClose),this.resizer=new HandleMorph(this,150,100,this.edge,this.edge),this.fixLayout()},InspectorMorph.prototype.fixLayout=function(){var t,e,r,i;Morph.prototype.trackChanges=!1,t=this.left()+this.edge,e=this.top()+this.edge,r=this.right()-this.edge-t,this.label.setPosition(new Point(t,e)),this.label.setWidth(r),this.label.height()>this.height()-50&&(this.silentSetHeight(this.label.height()+50),this.drawNew(),this.changed(),this.resizer.drawNew()),e=this.label.bottom()+2,r=Math.min(Math.floor(this.width()/3),this.list.listContents.width()),r-=this.edge,i=this.bottom()-2*this.edge-MorphicPreferences.handleSize-e,this.list.setPosition(new Point(t,e)),this.list.setExtent(new Point(r,i)),t=this.list.right()+this.edge,r=this.right()-this.edge-t,this.detail.setPosition(new Point(t,e)),this.detail.setExtent(new Point(r,2*i/3-this.edge)),e=this.detail.bottom()+this.edge,this.work.setPosition(new Point(t,e)),this.work.setExtent(new Point(r,i/3)),t=this.list.left(),e=this.list.bottom()+this.edge,r=this.list.width(),i=MorphicPreferences.handleSize,this.buttonSubset.setPosition(new Point(t,e)),this.buttonSubset.setExtent(new Point(r,i)),t=this.detail.left(),r=(r=this.detail.width()-this.edge-MorphicPreferences.handleSize)/3-this.edge/3,this.buttonInspect.setPosition(new Point(t,e)),this.buttonInspect.setExtent(new Point(r,i)),t=this.buttonInspect.right()+this.edge,this.buttonEdit.setPosition(new Point(t,e)),this.buttonEdit.setExtent(new Point(r,i)),t=this.buttonEdit.right()+this.edge,r=this.detail.right()-this.edge-MorphicPreferences.handleSize-t,this.buttonClose.setPosition(new Point(t,e)),this.buttonClose.setExtent(new Point(r,i)),Morph.prototype.trackChanges=!0,this.changed()},InspectorMorph.prototype.setExtent=function(t){InspectorMorph.uber.setExtent.call(this,t),this.fixLayout()},InspectorMorph.prototype.save=function(){var t=this.detail.contents.children[0].text.toString(),e=this.list.selected;try{this.target.evaluateString("this."+e+" = "+t),this.hasUserEditedDetails=!1,this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(t){this.inform(t)}},InspectorMorph.prototype.addProperty=function(){var t=this;this.prompt("new property name:",(function(e){e&&(t.target[e]=null,t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed()))}),this,"property")},InspectorMorph.prototype.renameProperty=function(){var t=this,e=this.list.selected;this.prompt("property name:",(function(r){try{delete t.target[e],t.target[r]=t.currentProperty}catch(e){t.inform(e)}t.buildPanes(),t.target.drawNew&&(t.target.changed(),t.target.drawNew(),t.target.changed())}),this,e)},InspectorMorph.prototype.removeProperty=function(){var t=this.list.selected;try{delete this.target[t],this.currentProperty=null,this.buildPanes(),this.target.drawNew&&(this.target.changed(),this.target.drawNew(),this.target.changed())}catch(t){this.inform(t)}},InspectorMorph.prototype.step=function(){this.updateCurrentSelection();var t=this.target.toString();this.label.text!==t&&(this.label.text=t,this.label.drawNew(),this.fixLayout())},InspectorMorph.prototype.updateReferences=function(t){var e=this.list.activeIndex();InspectorMorph.uber.updateReferences.call(this,t),this.buildPanes(),this.list.activateIndex(e)},MenuMorph.prototype=new BoxMorph,MenuMorph.prototype.constructor=MenuMorph,MenuMorph.uber=BoxMorph.prototype,MenuMorph.prototype.init=function(t,e,r,i){this.target=t,this.title=e||null,this.environment=r||null,this.fontSize=i||null,this.items=[],this.label=null,this.world=null,this.isListContents=!1,this.hasFocus=!1,this.selection=null,this.submenu=null,MenuMorph.uber.init.call(this),this.isDraggable=!1,this.border=null,this.edge=null},MenuMorph.prototype.addItem=function(t,e,r,i,n,o,s,a){this.items.push([localize(t||"close"),e||nop,r,i,n||!1,o||!1,s,a])},MenuMorph.prototype.addMenu=function(t,e,r){this.addPair(t,e,isNil(r)?"►":r)},MenuMorph.prototype.addPair=function(t,e,r,i){this.addItem(t,e,i,null,null,null,null,r)},MenuMorph.prototype.addLine=function(t){this.items.push([0,t||1])},MenuMorph.prototype.createLabel=function(){var t;null!==this.label&&this.label.destroy(),(t=new TextMorph(localize(this.title),this.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,!0,!1,"center")).alignment="center",t.color=new Color(255,255,255),t.backgroundColor=this.borderColor,t.drawNew(),this.label=new BoxMorph(3,0),MorphicPreferences.isFlat&&(this.label.edge=0),this.label.color=this.borderColor,this.label.borderColor=this.borderColor,this.label.setExtent(t.extent().add(4)),this.label.drawNew(),this.label.add(t),this.label.text=t},MenuMorph.prototype.drawNew=function(){var t,e,r,i,n=this,o=!1;this.children.forEach((function(t){t.destroy()})),this.children=[],this.isListContents||(this.edge=MorphicPreferences.isFlat?0:5,this.border=MorphicPreferences.isFlat?1:2),this.color=new Color(255,255,255),this.borderColor=new Color(60,60,60),this.silentSetExtent(new Point(0,0)),i=2,r=this.left()+4,this.isListContents||(this.title?(this.createLabel(),this.label.setPosition(this.bounds.origin.add(4)),this.add(this.label),i=this.label.bottom()):i=this.top()+4),i+=1,this.items.forEach((function(e){o=!1,e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph||e instanceof DialMorph?t=e:0===e[0]?(o=!0,(t=new Morph).color=n.borderColor,t.setHeight(e[1])):t=new MenuItemMorph(n.target,e[1],e[0],n.fontSize||MorphicPreferences.menuFontSize,MorphicPreferences.menuFontName,n.environment,e[2],e[3],e[4],e[5],e[6],e[7]),o&&(i+=1),t.setPosition(new Point(r,i)),n.add(t),i+=t.height(),o&&(i+=1)})),e=this.fullBounds(),this.silentSetExtent(e.extent().add(4)),this.adjustWidths(),MenuMorph.uber.drawNew.call(this)},MenuMorph.prototype.maxWidth=function(){var t=0;return this.parent instanceof FrameMorph&&this.parent.scrollFrame instanceof ScrollFrameMorph&&(t=this.parent.scrollFrame.width()),this.children.forEach((function(e){e instanceof MenuItemMorph?t=Math.max(t,e.label.width()+8+(e.shortcut?e.shortcut.width()+4:0)):(e instanceof StringFieldMorph||e instanceof ColorPickerMorph||e instanceof SliderMorph||e instanceof DialMorph)&&(t=Math.max(t,e.width()))})),this.label&&(t=Math.max(t,this.label.width())),t},MenuMorph.prototype.adjustWidths=function(){var t,e=this.maxWidth(),r=this;this.children.forEach((function(i){i instanceof DialMorph||i.silentSetWidth(e),i instanceof MenuItemMorph?(i.fixLayout(),t=i.image===i.pressImage,i.createBackgrounds(),t&&(i.image=i.pressImage)):(i.drawNew(),i===r.label&&i.text.setPosition(i.center().subtract(i.text.extent().floorDivideBy(2))))}))},MenuMorph.prototype.unselectAllItems=function(){this.children.forEach((function(t){t instanceof MenuItemMorph?t.image=t.normalImage:t instanceof ScrollFrameMorph&&t.contents.children.forEach((function(t){t instanceof MenuItemMorph&&(t.image=t.normalImage)}))})),this.changed()},MenuMorph.prototype.popup=function(t,e){var r;this.drawNew(),this.setPosition(e),this.addShadow(new Point(2,2),80),this.keepWithin(t),this.bottom()>t.bottom()&&(this.removeShadow(),r=this.scroll(),this.bounds.corner.y=t.bottom()-2,MenuMorph.uber.drawNew.call(this),this.addShadow(new Point(2,2),80),r.setHeight(t.bottom()-r.top()-6),r.adjustScrollBars()),t.activeMenu&&t.activeMenu.destroy(),this.items.length<1&&!this.title||(t.add(this),t.activeMenu=this,this.world=t,this.fullChanged())},MenuMorph.prototype.scroll=function(){var t=new ScrollFrameMorph,e=this.label?1:0,r=this.children[e];return t.setPosition(r.position()),this.children.slice(e).forEach((function(e){t.addContents(e)})),this.add(t),t.setWidth(r.width()),t},MenuMorph.prototype.popUpAtHand=function(t){var e=t||this.world;this.popup(e,e.hand.position())},MenuMorph.prototype.popUpCenteredAtHand=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.hand.position().subtract(this.extent().floorDivideBy(2)))},MenuMorph.prototype.popUpCenteredInWorld=function(t){var e=t||this.world;this.drawNew(),this.popup(e,e.center().subtract(this.extent().floorDivideBy(2)))},MenuMorph.prototype.closeRootMenu=function(){this.parent instanceof MenuMorph?this.parent.closeRootMenu():this.destroy()},MenuMorph.prototype.closeSubmenu=function(){this.submenu&&(this.submenu.destroy(),this.submenu=null,this.unselectAllItems())},MenuMorph.prototype.getFocus=function(){this.world.keyboardReceiver=this,this.selection=null,this.selectFirst(),this.hasFocus=!0},MenuMorph.prototype.processKeyDown=function(t){switch(t.keyCode){case 13:case 32:return void(this.selection&&(this.selection.mouseClickLeft(),this.submenu&&this.submenu.getFocus()));case 27:return this.destroy();case 37:return this.leaveSubmenu();case 38:return this.selectUp();case 39:return this.enterSubmenu();case 40:return this.selectDown();default:nop()}},MenuMorph.prototype.processKeyUp=function(t){nop(t)},MenuMorph.prototype.processKeyPress=function(t){nop(t)},MenuMorph.prototype.selectFirst=function(){var t,e,r;for(e=(t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children,r=0;r<e.length;r+=1)if(e[r]instanceof MenuItemMorph)return void this.select(e[r])},MenuMorph.prototype.selectUp=function(){var t,e,r;e=((t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children).filter((function(t){return t instanceof MenuItemMorph})),this.selection?((r=e.indexOf(this.selection)-1)<0&&(r=e.length-1),this.select(e[r])):e.length&&this.select(e[0])},MenuMorph.prototype.selectDown=function(){var t,e,r;e=((t=detect(this.children,(function(t){return t instanceof ScrollFrameMorph})))?t.contents.children:this.children).filter((function(t){return t instanceof MenuItemMorph})),this.selection?((r=e.indexOf(this.selection)+1)>=e.length&&(r=0),this.select(e[r])):e.length&&this.select(e[0])},MenuMorph.prototype.enterSubmenu=function(){this.selection&&this.selection.action instanceof MenuMorph&&(this.selection.popUpSubmenu(),this.submenu&&this.submenu.getFocus())},MenuMorph.prototype.leaveSubmenu=function(){var t=this.parent;this.parent instanceof MenuMorph&&(t.submenu=null,t.hasFocus=!0,this.destroy(),t.world.keyboardReceiver=t)},MenuMorph.prototype.select=function(t){this.unselectAllItems(),t.image=t.highlightImage,t.changed(),t.scrollIntoView(),this.selection=t},MenuMorph.prototype.destroy=function(){this.hasFocus&&(this.world.keyboardReceiver=null),MenuMorph.uber.destroy.call(this)},StringMorph.prototype=new Morph,StringMorph.prototype.constructor=StringMorph,StringMorph.uber=Morph.prototype,StringMorph.prototype.init=function(t,e,r,i,n,o,s,a,h,c){this.text=t||(""===t?"":"StringMorph"),this.fontSize=e||12,this.fontName=c||MorphicPreferences.globalFontFamily,this.fontStyle=r||"sans-serif",this.isBold=i||!1,this.isItalic=n||!1,this.isEditable=!1,this.isNumeric=o||!1,this.isPassword=!1,this.shadowOffset=s||new Point(0,0),this.shadowColor=a||null,this.isShowingBlanks=!1,this.blanksColor=new Color(180,140,140),this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),StringMorph.uber.init.call(this,!0),this.color=h||new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},StringMorph.prototype.toString=function(){return"a "+(this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0])+'("'+this.text.slice(0,30)+'...")'},StringMorph.prototype.password=function(t,e){var r,i="";for(r=0;r<e;r+=1)i+=t;return i},StringMorph.prototype.font=function(){var t="";return this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+this.fontSize+"px "+(this.fontName?this.fontName+", ":"")+this.fontStyle},StringMorph.prototype.drawNew=function(){var t,e,r,i,n,o,s,a,h,c=this.shadowOffset||new Point,l=this.isPassword?this.password("*",this.text.length):this.text;for(this.image=newCanvas(),(t=this.image.getContext("2d")).font=this.font(),e=Math.max(t.measureText(l).width+Math.abs(c.x),1),this.bounds.corner=this.bounds.origin.add(new Point(e,fontHeight(this.fontSize)+Math.abs(c.y))),this.image.width=e,this.image.height=this.height(),t.font=this.font(),t.textAlign="left",t.textBaseline="bottom",this.shadowColor&&(a=Math.max(c.x,0),h=Math.max(c.y,0),t.fillStyle=this.shadowColor.toString(),t.fillText(l,a,fontHeight(this.fontSize)+h)),a=Math.abs(Math.min(c.x,0)),h=Math.abs(Math.min(c.y,0)),t.fillStyle=this.color.toString(),this.isShowingBlanks?this.renderWithBlanks(t,a,fontHeight(this.fontSize)+h):t.fillText(l,a,fontHeight(this.fontSize)+h),r=Math.min(this.startMark,this.endMark),i=Math.max(this.startMark,this.endMark),n=r;n<i;n+=1)o=this.slotPosition(n).subtract(this.position()),s=l.charAt(n),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(o.x,o.y,t.measureText(s).width+1+a,fontHeight(this.fontSize)+h),t.fillStyle=this.markedTextColor.toString(),t.fillText(s,o.x+a,fontHeight(this.fontSize)+h);this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},StringMorph.prototype.renderWithBlanks=function(t,e,r){var i=t.measureText(" ").width,n=newCanvas(new Point(i,this.height())),o=n.getContext("2d"),s=this.text.split(" "),a=e||0,h=!0;o.fillStyle=this.blanksColor.toString(),o.arc(i/2,n.height/2,i/2,radians(0),radians(360)),o.fill(),s.forEach((function(e){h||(t.drawImage(n,a,0),a+=i),h=!1,""!==e&&(t.fillText(e,a,r),a+=t.measureText(e).width)}))},StringMorph.prototype.slotPosition=function(t){var e,r,i=this.isPassword?this.password("*",this.text.length):this.text,n=Math.min(Math.max(t,0),i.length),o=this.image.getContext("2d");for(e=0,r=0;r<n;r+=1)e+=o.measureText(i[r]).width;return this.pos=n,new Point(this.left()+e,this.top())},StringMorph.prototype.slotAt=function(t){for(var e=this.isPassword?this.password("*",this.text.length):this.text,r=0,i=0,n=this.image.getContext("2d");t.x-this.left()>i;)if(i+=n.measureText(e[r]).width,(r+=1)===e.length&&n.measureText(e).width-n.measureText(e[r-1]).width/2<t.x-this.left())return r;return t.x-this.left()>i-n.measureText(e[r-1]).width/2?r:r-1},StringMorph.prototype.upFrom=function(t){return t},StringMorph.prototype.downFrom=function(t){return t},StringMorph.prototype.startOfLine=function(){return 0},StringMorph.prototype.endOfLine=function(){return this.text.length},StringMorph.prototype.previousWordFrom=function(t){for(var e=t-1;e>0&&!isWordChar(this.text[e]);)e-=1;for(;e>0&&isWordChar(this.text[e-1]);)e-=1;return e},StringMorph.prototype.nextWordFrom=function(t){for(var e=t;e<this.endOfLine()&&!isWordChar(this.text[e]);)e+=1;for(;e<this.endOfLine()&&isWordChar(this.text[e]);)e+=1;return e},StringMorph.prototype.rawHeight=function(){return this.height()/1.2},StringMorph.prototype.developersMenu=function(){var t=StringMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("edit","edit"),t.addItem("font size...",(function(){this.prompt(t.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,500,!0)}),"set this String's\nfont point size"),"serif"!==this.fontStyle&&t.addItem("serif","setSerif"),"sans-serif"!==this.fontStyle&&t.addItem("sans-serif","setSansSerif"),this.isBold?t.addItem("normal weight","toggleWeight"):t.addItem("bold","toggleWeight"),this.isItalic?t.addItem("normal style","toggleItalic"):t.addItem("italic","toggleItalic"),this.isShowingBlanks?t.addItem("hide blanks","toggleShowBlanks"):t.addItem("show blanks","toggleShowBlanks"),this.isPassword?t.addItem("show characters","toggleIsPassword"):t.addItem("hide characters","toggleIsPassword"),t},StringMorph.prototype.toggleIsDraggable=function(){this.isDraggable=!this.isDraggable,this.isDraggable?this.disableSelecting():this.enableSelecting()},StringMorph.prototype.toggleShowBlanks=function(){this.isShowingBlanks=!this.isShowingBlanks,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleWeight=function(){this.isBold=!this.isBold,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleItalic=function(){this.isItalic=!this.isItalic,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.toggleIsPassword=function(){this.isPassword=!this.isPassword,this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSerif=function(){this.fontStyle="serif",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setSansSerif=function(){this.fontStyle="sans-serif",this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setFontSize=function(t){var e;"number"==typeof t?this.fontSize=Math.round(Math.min(Math.max(t,4),500)):(e=parseFloat(t),isNaN(e)||(this.fontSize=Math.round(Math.min(Math.max(e,4),500)))),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.setText=function(t){this.text=Math.round(t).toString(),this.changed(),this.drawNew(),this.changed()},StringMorph.prototype.numericalSetters=function(){return["setLeft","setTop","setAlphaScaled","setFontSize","setText"]},StringMorph.prototype.edit=function(){this.root().edit(this)},StringMorph.prototype.selection=function(){var t,e;return t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text.slice(t,e)},StringMorph.prototype.selectionStartSlot=function(){return Math.min(this.startMark,this.endMark)},StringMorph.prototype.clearSelection=function(){!this.currentlySelecting&&isNil(this.startMark)&&isNil(this.endMark)||(this.currentlySelecting=!1,this.startMark=null,this.endMark=null,this.drawNew(),this.changed())},StringMorph.prototype.deleteSelection=function(){var t,e,r;r=this.text,t=Math.min(this.startMark,this.endMark),e=Math.max(this.startMark,this.endMark),this.text=r.slice(0,t)+r.slice(e),this.changed(),this.clearSelection()},StringMorph.prototype.selectAll=function(){var t;this.isEditable&&(this.startMark=0,(t=this.root().cursor)&&t.gotoSlot(this.text.length),this.endMark=this.text.length,this.drawNew(),this.changed())},StringMorph.prototype.mouseDownLeft=function(t){16===this.world().currentKey?this.shiftClick(t):this.isEditable?this.clearSelection():this.escalateEvent("mouseDownLeft",t)},StringMorph.prototype.shiftClick=function(t){var e=this.root().cursor;e&&(this.startMark||(this.startMark=e.slot),e.gotoPos(t),this.endMark=e.slot,this.drawNew(),this.changed()),this.currentlySelecting=!1,this.escalateEvent("mouseDownLeft",t)},StringMorph.prototype.mouseClickLeft=function(t){var e;this.isEditable?(this.currentlySelecting||this.edit(),(e=this.root().cursor)&&e.gotoPos(t),this.currentlySelecting=!0):this.escalateEvent("mouseClickLeft",t)},StringMorph.prototype.mouseDoubleClick=function(t){var e=this.slotAt(t);this.isEditable?(this.edit(),e===this.text.length&&(e-=1),this.text[e]&&isWordChar(this.text[e])?this.selectWordAt(e):this.text[e]?this.selectBetweenWordsAt(e):this.selectAll()):this.escalateEvent("mouseDoubleClick",t)},StringMorph.prototype.selectWordAt=function(t){var e=this.root().cursor;0===t||isWordChar(this.text[t-1])?(e.gotoSlot(this.previousWordFrom(t)),this.startMark=e.slot,this.endMark=this.nextWordFrom(e.slot)):(e.gotoSlot(t),this.startMark=t,this.endMark=this.nextWordFrom(t)),this.drawNew(),this.changed()},StringMorph.prototype.selectBetweenWordsAt=function(t){var e=this.root().cursor;for(e.gotoSlot(this.nextWordFrom(this.previousWordFrom(t))),this.startMark=e.slot,this.endMark=e.slot;this.endMark<this.text.length&&!isWordChar(this.text[this.endMark]);)this.endMark+=1;this.drawNew(),this.changed()},StringMorph.prototype.enableSelecting=function(){this.mouseDownLeft=function(t){var e=this.root().cursor,r=!!e&&e.target===this;16===this.world().currentKey?this.shiftClick(t):(this.clearSelection(),this.isEditable&&!this.isDraggable&&(this.edit(),this.root().cursor.gotoPos(t),this.startMark=this.slotAt(t),this.endMark=this.startMark,this.currentlySelecting=!0,r||this.escalateEvent("mouseDownLeft",t)))},this.mouseMove=function(t){if(this.isEditable&&this.currentlySelecting&&!this.isDraggable){var e=this.slotAt(t);e!==this.endMark&&(this.endMark=e,this.drawNew(),this.changed())}}},StringMorph.prototype.disableSelecting=function(){this.mouseDownLeft=StringMorph.prototype.mouseDownLeft,delete this.mouseMove},TextMorph.prototype=new Morph,TextMorph.prototype.constructor=TextMorph,TextMorph.uber=Morph.prototype,TextMorph.prototype.init=function(t,e,r,i,n,o,s,a,h,c){this.text=t||(""===t?t:"TextMorph"),this.words=[],this.lines=[],this.lineSlots=[],this.fontSize=e||12,this.fontName=a||MorphicPreferences.globalFontFamily,this.fontStyle=r||"sans-serif",this.isBold=i||!1,this.isItalic=n||!1,this.alignment=o||"left",this.shadowOffset=h||new Point(0,0),this.shadowColor=c||null,this.maxWidth=s||0,this.maxLineWidth=0,this.backgroundColor=null,this.isEditable=!1,this.receiver=null,this.isScrollable=!0,this.currentlySelecting=!1,this.startMark=0,this.endMark=0,this.markedTextColor=new Color(255,255,255),this.markedBackgoundColor=new Color(60,60,120),TextMorph.uber.init.call(this),this.color=new Color(0,0,0),this.noticesTransparentClick=!0,this.drawNew()},TextMorph.prototype.toString=function(){return'a TextMorph("'+this.text.slice(0,30)+'...")'},TextMorph.prototype.font=StringMorph.prototype.font,TextMorph.prototype.parse=function(){var t,e=this,r=this.text.split("\n"),i=newCanvas().getContext("2d"),n="",o=0;i.font=this.font(),this.maxLineWidth=0,this.lines=[],this.lineSlots=[0],this.words=[],r.forEach((function(t){e.words=e.words.concat(t.split(" ")),e.words.push("\n")})),this.words.forEach((function(r){"\n"===r?(e.lines.push(n),e.lineSlots.push(o),e.maxLineWidth=Math.max(e.maxLineWidth,i.measureText(n).width),n=""):(e.maxWidth>0?(t=n+r+" ",i.measureText(t).width>e.maxWidth?(e.lines.push(n),e.lineSlots.push(o),e.maxLineWidth=Math.max(e.maxLineWidth,i.measureText(n).width),n=r+" "):n=t):n=n+r+" ",o+=r.length+1)}))},TextMorph.prototype.drawNew=function(){var t,e,r,i,n,o,s,a,h,c,l,u,p,d,f;if(this.image=newCanvas(),(t=this.image.getContext("2d")).font=this.font(),this.parse(),s=Math.abs(this.shadowOffset.x),o=Math.abs(this.shadowOffset.y),e=this.lines.length*(fontHeight(this.fontSize)+o),0===this.maxWidth?this.bounds=this.bounds.origin.extent(new Point(this.maxLineWidth+s,e)):this.bounds=this.bounds.origin.extent(new Point(this.maxWidth+s,e)),this.image.width=this.width(),this.image.height=this.height(),(t=this.image.getContext("2d")).font=this.font(),t.textAlign="left",t.textBaseline="bottom",this.backgroundColor&&(t.fillStyle=this.backgroundColor.toString(),t.fillRect(0,0,this.width(),this.height())),this.shadowColor)for(a=Math.max(this.shadowOffset.x,0),h=Math.max(this.shadowOffset.y,0),t.fillStyle=this.shadowColor.toString(),r=0;r<this.lines.length;r+=1)i=this.lines[r],n=t.measureText(i).width+s,c="right"===this.alignment?this.width()-n:"center"===this.alignment?(this.width()-n)/2:0,l=(r+1)*(fontHeight(this.fontSize)+o)-o,t.fillText(i,c+a,l+h);for(a=Math.abs(Math.min(this.shadowOffset.x,0)),h=Math.abs(Math.min(this.shadowOffset.y,0)),t.fillStyle=this.color.toString(),r=0;r<this.lines.length;r+=1)i=this.lines[r],n=t.measureText(i).width+s,c="right"===this.alignment?this.width()-n:"center"===this.alignment?(this.width()-n)/2:0,l=(r+1)*(fontHeight(this.fontSize)+o)-o,t.fillText(i,c+a,l+h);for(u=Math.min(this.startMark,this.endMark),p=Math.max(this.startMark,this.endMark),r=u;r<p;r+=1)d=this.slotPosition(r).subtract(this.position()),f=this.text.charAt(r),t.fillStyle=this.markedBackgoundColor.toString(),t.fillRect(d.x,d.y,t.measureText(f).width+1,fontHeight(this.fontSize)),t.fillStyle=this.markedTextColor.toString(),t.fillText(f,d.x,d.y+fontHeight(this.fontSize));this.parent&&this.parent.layoutChanged&&this.parent.layoutChanged()},TextMorph.prototype.setExtent=function(t){this.maxWidth=Math.max(t.x,0),this.changed(),this.drawNew()},TextMorph.prototype.columnRow=function(t){var e,r,i=0;for(e=0;e<this.lines.length;e+=1)for(i=this.lineSlots[e],r=0;r<this.lines[e].length;r+=1){if(i===t)return new Point(r,e);i+=1}return new Point(this.lines[this.lines.length-1].length-1,this.lines.length-1)},TextMorph.prototype.slotPosition=function(t){var e,r,i=this.columnRow(t),n=this.image.getContext("2d"),o=Math.abs(this.shadowOffset.y),s=0;for(e=i.y*(fontHeight(this.fontSize)+o),r=0;r<i.x;r+=1)s+=n.measureText(this.lines[i.y][r]).width;return new Point(this.left()+s,this.top()+e)},TextMorph.prototype.slotAt=function(t){for(var e=0,r=0,i=0,n=Math.abs(this.shadowOffset.y),o=this.image.getContext("2d");t.y-this.top()>(fontHeight(this.fontSize)+n)*r;)r+=1;for(r=Math.max(r,1);t.x-this.left()>e;)e+=o.measureText(this.lines[r-1][i]).width,i+=1;return t.x-this.left()>e-o.measureText(this.lines[r-1][i]).width/2?this.lineSlots[Math.max(r-1,0)]+i:this.lineSlots[Math.max(r-1,0)]+i-1},TextMorph.prototype.upFrom=function(t){var e,r=this.columnRow(t);return r.y<1?t:(e=this.lines[r.y-1]).length<r.x-1?this.lineSlots[r.y-1]+e.length:this.lineSlots[r.y-1]+r.x},TextMorph.prototype.downFrom=function(t){var e,r=this.columnRow(t);return r.y>this.lines.length-2?t:(e=this.lines[r.y+1]).length<r.x-1?this.lineSlots[r.y+1]+e.length:this.lineSlots[r.y+1]+r.x},TextMorph.prototype.startOfLine=function(t){return this.lineSlots[this.columnRow(t).y]},TextMorph.prototype.endOfLine=function(t){return this.startOfLine(t)+this.lines[this.columnRow(t).y].length-1},TextMorph.prototype.previousWordFrom=StringMorph.prototype.previousWordFrom,TextMorph.prototype.nextWordFrom=StringMorph.prototype.nextWordFrom,TextMorph.prototype.edit=StringMorph.prototype.edit,TextMorph.prototype.selection=StringMorph.prototype.selection,TextMorph.prototype.selectionStartSlot=StringMorph.prototype.selectionStartSlot,TextMorph.prototype.clearSelection=StringMorph.prototype.clearSelection,TextMorph.prototype.deleteSelection=StringMorph.prototype.deleteSelection,TextMorph.prototype.selectAll=StringMorph.prototype.selectAll,TextMorph.prototype.mouseDownLeft=StringMorph.prototype.mouseDownLeft,TextMorph.prototype.shiftClick=StringMorph.prototype.shiftClick,TextMorph.prototype.mouseClickLeft=StringMorph.prototype.mouseClickLeft,TextMorph.prototype.mouseDoubleClick=StringMorph.prototype.mouseDoubleClick,TextMorph.prototype.selectWordAt=StringMorph.prototype.selectWordAt,TextMorph.prototype.selectBetweenWordsAt=StringMorph.prototype.selectBetweenWordsAt,TextMorph.prototype.enableSelecting=StringMorph.prototype.enableSelecting,TextMorph.prototype.disableSelecting=StringMorph.prototype.disableSelecting,TextMorph.prototype.selectAllAndEdit=function(){this.edit(),this.selectAll()},TextMorph.prototype.developersMenu=function(){var t=TextMorph.uber.developersMenu.call(this);return t.addLine(),t.addItem("edit","edit"),t.addItem("font size...",(function(){this.prompt(t.title+"\nfont\nsize:",this.setFontSize,this,this.fontSize.toString(),null,6,100,!0)}),"set this Text's\nfont point size"),"left"!==this.alignment&&t.addItem("align left","setAlignmentToLeft"),"right"!==this.alignment&&t.addItem("align right","setAlignmentToRight"),"center"!==this.alignment&&t.addItem("align center","setAlignmentToCenter"),t.addLine(),"serif"!==this.fontStyle&&t.addItem("serif","setSerif"),"sans-serif"!==this.fontStyle&&t.addItem("sans-serif","setSansSerif"),this.isBold?t.addItem("normal weight","toggleWeight"):t.addItem("bold","toggleWeight"),this.isItalic?t.addItem("normal style","toggleItalic"):t.addItem("italic","toggleItalic"),t},TextMorph.prototype.setAlignmentToLeft=function(){this.alignment="left",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToRight=function(){this.alignment="right",this.drawNew(),this.changed()},TextMorph.prototype.setAlignmentToCenter=function(){this.alignment="center",this.drawNew(),this.changed()},TextMorph.prototype.toggleIsDraggable=StringMorph.prototype.toggleIsDraggable,TextMorph.prototype.toggleWeight=StringMorph.prototype.toggleWeight,TextMorph.prototype.toggleItalic=StringMorph.prototype.toggleItalic,TextMorph.prototype.setSerif=StringMorph.prototype.setSerif,TextMorph.prototype.setSansSerif=StringMorph.prototype.setSansSerif,TextMorph.prototype.setText=StringMorph.prototype.setText,TextMorph.prototype.setFontSize=StringMorph.prototype.setFontSize,TextMorph.prototype.numericalSetters=StringMorph.prototype.numericalSetters,TextMorph.prototype.evaluationMenu=function(){var t=new MenuMorph(this,null);return t.addItem("do it","doIt","evaluate the\nselected expression"),t.addItem("show it","showIt","evaluate the\nselected expression\nand show the result"),t.addItem("inspect it","inspectIt","evaluate the\nselected expression\nand inspect the result"),t.addLine(),t.addItem("select all","selectAllAndEdit"),t},TextMorph.prototype.setReceiver=function(t){this.receiver=t,this.customContextMenu=this.evaluationMenu()},TextMorph.prototype.doIt=function(){this.receiver.evaluateString(this.selection()),this.edit()},TextMorph.prototype.showIt=function(){var t=this.receiver.evaluateString(this.selection());null!==t&&this.inform(t)},TextMorph.prototype.inspectIt=function(){var t,e=this.receiver.evaluateString(this.selection()),r=this.world();isObject(e)&&((t=new InspectorMorph(e)).setPosition(r.hand.position()),t.keepWithin(r),r.add(t),t.changed())},TriggerMorph.prototype=new Morph,TriggerMorph.prototype.constructor=TriggerMorph,TriggerMorph.uber=Morph.prototype,TriggerMorph.prototype.init=function(t,e,r,i,n,o,s,a,h,c,l){this.target=t||null,this.action=e||null,this.doubleClickAction=l||null,this.environment=o||null,this.labelString=r||null,this.label=null,this.hint=s||null,this.schedule=null,this.fontSize=i||MorphicPreferences.menuFontSize,this.fontStyle=n||"sans-serif",this.highlightColor=new Color(192,192,192),this.pressColor=new Color(128,128,128),this.labelColor=a||new Color(0,0,0),this.labelBold=h||!1,this.labelItalic=c||!1,TriggerMorph.uber.init.call(this),this.color=new Color(255,255,255),this.drawNew()},TriggerMorph.prototype.drawNew=function(){this.createBackgrounds(),null!==this.labelString&&this.createLabel()},TriggerMorph.prototype.createBackgrounds=function(){var t,e=this.extent();this.normalImage=newCanvas(e),(t=this.normalImage.getContext("2d")).fillStyle=this.color.toString(),t.fillRect(0,0,e.x,e.y),this.highlightImage=newCanvas(e),(t=this.highlightImage.getContext("2d")).fillStyle=this.highlightColor.toString(),t.fillRect(0,0,e.x,e.y),this.pressImage=newCanvas(e),(t=this.pressImage.getContext("2d")).fillStyle=this.pressColor.toString(),t.fillRect(0,0,e.x,e.y),this.image=this.normalImage},TriggerMorph.prototype.createLabel=function(){null!==this.label&&this.label.destroy(),this.label=new StringMorph(this.labelString,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic,!1,null,null,this.labelColor),this.label.setPosition(this.center().subtract(this.label.extent().floorDivideBy(2))),this.add(this.label)},TriggerMorph.prototype.trigger=function(){this.schedule&&(this.schedule.isActive=!1),"function"==typeof this.target?"function"==typeof this.action?this.target.call(this.environment,this.action.call(),this):this.target.call(this.environment,this.action,this):"function"==typeof this.action?this.action.call(this.target):this.target[this.action]()},TriggerMorph.prototype.triggerDoubleClick=function(){this.doubleClickAction&&(this.schedule&&(this.schedule.isActive=!1),"function"==typeof this.target?"function"==typeof this.doubleClickAction?this.target.call(this.environment,this.doubleClickAction.call(),this):this.target.call(this.environment,this.doubleClickAction,this):"function"==typeof this.doubleClickAction?this.doubleClickAction.call(this.target):this.target[this.doubleClickAction]())},TriggerMorph.prototype.mouseEnter=function(){var t=this.hint instanceof Function?this.hint():this.hint;this.image=this.highlightImage,this.changed(),t&&this.bubbleHelp(t)},TriggerMorph.prototype.mouseLeave=function(){this.image=this.normalImage,this.changed(),this.schedule&&(this.schedule.isActive=!1),this.hint&&this.world().hand.destroyTemporaries()},TriggerMorph.prototype.mouseDownLeft=function(){this.image=this.pressImage,this.changed()},TriggerMorph.prototype.mouseClickLeft=function(){this.image=this.highlightImage,this.changed(),this.trigger()},TriggerMorph.prototype.mouseDoubleClick=function(){this.triggerDoubleClick()},TriggerMorph.prototype.rootForGrab=function(){return this.isDraggable?TriggerMorph.uber.rootForGrab.call(this):null},TriggerMorph.prototype.bubbleHelp=function(t){var e=this.world(),r=this;this.schedule=new Animation(nop,nop,0,500,nop,(function(){r.popUpbubbleHelp(t)})),e.animations.push(this.schedule)},TriggerMorph.prototype.popUpbubbleHelp=function(t){new SpeechBubbleMorph(localize(t),null,null,1).popUp(this.world(),this.rightCenter().add(new Point(-8,0)))},MenuItemMorph.prototype=new TriggerMorph,MenuItemMorph.prototype.constructor=MenuItemMorph,MenuItemMorph.uber=TriggerMorph.prototype,MenuItemMorph.prototype.createLabel=function(){var t,e;this.label&&this.label.destroy(),this.label=this.createLabelPart(this.labelString),this.add(this.label),t=this.label.width(),e=this.label.height(),this.shortcut&&this.shortcut.destroy(),this.shortcutString&&(this.shortcut=this.createLabelPart(this.shortcutString),t+=this.shortcut.width()+4,e=Math.max(e,this.shortcut.height()),this.add(this.shortcut)),this.silentSetExtent(new Point(t+8,e)),this.fixLayout()},MenuItemMorph.prototype.fixLayout=function(){var t=this.center();this.label.setCenter(t),this.label.setLeft(this.left()+4),this.shortcut&&(this.shortcut.setCenter(t),this.shortcut.setRight(this.right()-4))},MenuItemMorph.prototype.createLabelPart=function(t){var e,r,i;return isString(t)?this.createLabelString(t):t instanceof Array?((e=new Morph).alpha=0,r=this.createIcon(t[0]),e.add(r),i=this.createLabelString(t[1]),e.add(i),i.setCenter(r.center()),i.setLeft(r.right()+4),e.bounds=r.bounds.merge(i.bounds),e.drawNew(),e):this.createIcon(t)},MenuItemMorph.prototype.createIcon=function(t){var e,r=new Morph;return r.image=t instanceof Morph?t.fullImage():t,t instanceof Morph&&t.getShadow()&&(e=r.image,r.image=newCanvas(t.fullBounds().extent().subtract(this.shadowBlur*(useBlurredShadows?1:2))),r.image.getContext("2d").drawImage(e,0,0)),r.silentSetWidth(r.image.width),r.silentSetHeight(r.image.height),r},MenuItemMorph.prototype.createLabelString=function(t){var e=new TextMorph(t,this.fontSize,this.fontStyle,this.labelBold,this.labelItalic);return e.setColor(this.labelColor),e},MenuItemMorph.prototype.mouseEnter=function(){var t=this.parentThatIsA(MenuMorph);this.isShowingSubmenu()||(t&&t.closeSubmenu(),this.isListItem()||(this.image=this.highlightImage,this.changed()),this.action instanceof MenuMorph?this.delaySubmenu():this.hint&&this.bubbleHelp(this.hint))},MenuItemMorph.prototype.mouseLeave=function(){this.isListItem()||(this.isShowingSubmenu()?this.image=this.highlightImage:this.image=this.normalImage,this.changed()),this.schedule&&(this.schedule.isActive=!1),this.hint&&this.world().hand.destroyTemporaries()},MenuItemMorph.prototype.mouseDownLeft=function(t){this.isListItem()&&(this.parentThatIsA(MenuMorph).unselectAllItems(),this.escalateEvent("mouseDownLeft",t)),this.image=this.pressImage,this.changed()},MenuItemMorph.prototype.mouseMove=function(){this.isListItem()&&this.escalateEvent("mouseMove")},MenuItemMorph.prototype.mouseClickLeft=function(){this.action instanceof MenuMorph?this.popUpSubmenu():(this.isListItem()||(this.parentThatIsA(MenuMorph).closeRootMenu(),this.world().activeMenu=null),this.trigger())},MenuItemMorph.prototype.isListItem=function(){var t=this.parentThatIsA(MenuMorph);return!!t&&t.isListContents},MenuItemMorph.prototype.isSelectedListItem=function(){return!!this.isListItem()&&this.image===this.pressImage},MenuItemMorph.prototype.isShowingSubmenu=function(){var t=this.parentThatIsA(MenuMorph);return!!(t&&this.action instanceof MenuMorph)&&t.submenu===this.action},MenuItemMorph.prototype.delaySubmenu=function(){var t=this.world(),e=this;this.schedule=new Animation(nop,nop,0,500,nop,(function(){e.popUpSubmenu()})),t.animations.push(this.schedule)},MenuItemMorph.prototype.popUpSubmenu=function(){var t=this.parentThatIsA(MenuMorph);this.action instanceof MenuMorph&&(this.action.drawNew(),this.action.setPosition(this.topRight().subtract(new Point(0,5))),this.action.addShadow(new Point(2,2),80),this.action.keepWithin(this.world()),this.action.items.length<1&&!this.action.title||(t.add(this.action),t.submenu=this.action,t.submenu.world=t.world,this.action.fullChanged()))},FrameMorph.prototype=new Morph,FrameMorph.prototype.constructor=FrameMorph,FrameMorph.uber=Morph.prototype,FrameMorph.prototype.init=function(t){this.scrollFrame=t||null,FrameMorph.uber.init.call(this),this.color=new Color(255,250,245),this.drawNew(),this.acceptsDrops=!0,this.scrollFrame&&(this.isDraggable=!1,this.noticesTransparentClick=!1,this.alpha=0)},FrameMorph.prototype.fullBounds=function(){var t=this.getShadow();return null!==t?this.bounds.merge(t.bounds):this.bounds},FrameMorph.prototype.fullImage=function(){return this.image},FrameMorph.prototype.fullDrawOn=function(t,e){var r,i;return this.isVisible?(r=e||this.fullBounds(),(i=this.bounds.intersect(r)).extent().gt(new Point(0,0))?(this.drawOn(t,i),void this.children.forEach((function(e){e instanceof ShadowMorph?e.fullDrawOn(t,r):e.fullDrawOn(t,i)}))):null):null},FrameMorph.prototype.topMorphAt=function(t){var e,r;if(!this.isVisible||!this.bounds.containsPoint(t))return null;for(e=this.children.length-1;e>=0;e-=1)if(r=this.children[e].topMorphAt(t))return r;return this.noticesTransparentClick||!this.isTransparentAt(t)?this:null},FrameMorph.prototype.submorphBounds=function(){var t=null;return this.children.length>0&&(t=this.children[0].bounds,this.children.forEach((function(e){t=t.merge(e.fullBounds())}))),t},FrameMorph.prototype.keepInScrollFrame=function(){if(null===this.scrollFrame)return null;this.left()>this.scrollFrame.left()&&this.moveBy(new Point(this.scrollFrame.left()-this.left(),0)),this.right()<this.scrollFrame.right()&&this.moveBy(new Point(this.scrollFrame.right()-this.right(),0)),this.top()>this.scrollFrame.top()&&this.moveBy(new Point(0,this.scrollFrame.top()-this.top())),this.bottom()<this.scrollFrame.bottom()&&this.moveBy(0,new Point(this.scrollFrame.bottom()-this.bottom(),0))},FrameMorph.prototype.adjustBounds=function(){var t,e,r=this;if(null===this.scrollFrame)return null;e=(t=this.submorphBounds())&&!this.scrollFrame.isTextLineWrapping?t.expandBy(this.scrollFrame.padding).growBy(this.scrollFrame.growth).merge(this.scrollFrame.bounds):this.scrollFrame.bounds.copy(),this.bounds.eq(e)||(this.bounds=e,this.drawNew(),this.keepInScrollFrame()),this.scrollFrame.isTextLineWrapping&&this.children.forEach((function(t){t instanceof TextMorph&&(t.setWidth(r.width()),r.setHeight(Math.max(t.height(),r.scrollFrame.height())))})),this.scrollFrame.adjustScrollBars()},FrameMorph.prototype.reactToDropOf=function(){this.adjustBounds()},FrameMorph.prototype.reactToGrabOf=function(){this.adjustBounds()},FrameMorph.prototype.developersMenu=function(){var t=FrameMorph.uber.developersMenu.call(this);return this.children.length>0&&(t.addLine(),t.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible")),t},FrameMorph.prototype.keepAllSubmorphsWithin=function(){var t=this;this.children.forEach((function(e){e.keepWithin(t)}))},ScrollFrameMorph.prototype=new FrameMorph,ScrollFrameMorph.prototype.constructor=ScrollFrameMorph,ScrollFrameMorph.uber=FrameMorph.prototype,ScrollFrameMorph.prototype.init=function(t,e,r){var i=this;ScrollFrameMorph.uber.init.call(this),this.scrollBarSize=e||MorphicPreferences.scrollBarSize,this.autoScrollTrigger=null,this.enableAutoScrolling=!0,this.isScrollingByDragging=!0,this.hasVelocity=!0,this.padding=0,this.growth=0,this.isTextLineWrapping=!1,this.contents=t||new FrameMorph(this),this.add(this.contents),this.hBar=new SliderMorph(null,null,null,null,"horizontal",r),this.hBar.setHeight(this.scrollBarSize),this.hBar.action=function(t){i.contents.setPosition(new Point(i.left()-t,i.contents.position().y))},this.hBar.isDraggable=!1,this.add(this.hBar),this.vBar=new SliderMorph(null,null,null,null,"vertical",r),this.vBar.setWidth(this.scrollBarSize),this.vBar.action=function(t){i.contents.setPosition(new Point(i.contents.position().x,i.top()-t))},this.vBar.isDraggable=!1,this.add(this.vBar),this.toolBar=null},ScrollFrameMorph.prototype.adjustScrollBars=function(){var t=this.width()-this.scrollBarSize,e=this.height()-this.scrollBarSize;this.changed(),this.contents.width()>this.width()+MorphicPreferences.scrollBarSize?(this.hBar.show(),this.hBar.width()!==t&&this.hBar.setWidth(t),this.hBar.setPosition(new Point(this.left(),this.bottom()-this.hBar.height())),this.hBar.start=0,this.hBar.stop=this.contents.width()-this.width(),this.hBar.size=this.width()/this.contents.width()*this.hBar.stop,this.hBar.value=this.left()-this.contents.left(),this.hBar.drawNew()):this.hBar.hide(),this.contents.height()>this.height()+this.scrollBarSize?(this.vBar.show(),this.vBar.height()!==e&&this.vBar.setHeight(e),this.vBar.setPosition(new Point(this.right()-this.vBar.width(),this.top())),this.vBar.start=0,this.vBar.stop=this.contents.height()-this.height(),this.vBar.size=this.height()/this.contents.height()*this.vBar.stop,this.vBar.value=this.top()-this.contents.top(),this.vBar.drawNew()):this.vBar.hide(),this.adjustToolBar()},ScrollFrameMorph.prototype.adjustToolBar=function(){this.toolBar&&(this.toolBar.setTop(this.top()+3),this.toolBar.setRight((this.vBar.isVisible?this.vBar.left():this.right())-3))},ScrollFrameMorph.prototype.addContents=function(t){this.contents.add(t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.setContents=function(t){this.contents.children.forEach((function(t){t.destroy()})),this.contents.children=[],t.setPosition(this.position().add(this.padding+2)),this.addContents(t)},ScrollFrameMorph.prototype.setExtent=function(t){this.isTextLineWrapping&&this.contents.setPosition(this.position().copy()),ScrollFrameMorph.uber.setExtent.call(this,t),this.contents.adjustBounds()},ScrollFrameMorph.prototype.scrollX=function(t){var e,r=this.contents.left(),i=this.left(),n=this.contents.width(),o=this.right();(e=r+t)+n<o&&(e=o-n),e>i&&(e=i),e!==r&&this.contents.setLeft(e)},ScrollFrameMorph.prototype.scrollY=function(t){var e,r=this.contents.top(),i=this.top(),n=this.contents.height(),o=this.bottom();(e=r+t)+n<o&&(e=o-n),e>i&&(e=i),e!==r&&this.contents.setTop(e)},ScrollFrameMorph.prototype.step=nop,ScrollFrameMorph.prototype.mouseDownLeft=function(t){if(!this.isScrollingByDragging)return null;var e=this.root().hand,r=t,i=this,n=0,o=0;this.step=function(){var t;if(e.mouseButton&&0===e.children.length&&i.bounds.containsPoint(e.bounds.origin)){if(e.grabPosition&&e.grabPosition.distanceTo(e.position())<=MorphicPreferences.grabThreshold)return null;t=e.bounds.origin,0!==(n=t.x-r.x)&&i.scrollX(n),0!==(o=t.y-r.y)&&i.scrollY(o),r=t}else i.hasVelocity?Math.abs(n)<.5&&Math.abs(o)<.5?i.step=function(){nop()}:(n*=.8,i.scrollX(Math.round(n)),o*=.8,i.scrollY(Math.round(o))):i.step=function(){nop()};this.adjustScrollBars()}},ScrollFrameMorph.prototype.startAutoScrolling=function(){var t,e,r,i=this,n=3*MorphicPreferences.scrollBarSize,o=this.world();if(!o)return null;t=o.hand,this.autoScrollTrigger||(this.autoScrollTrigger=Date.now()),this.step=function(){r=t.bounds.origin,e=i.bounds.insetBy(n),i.bounds.containsPoint(r)&&!e.containsPoint(r)&&t.children.length>0?i.autoScroll(r):(i.step=function(){nop()},i.autoScrollTrigger=null)}},ScrollFrameMorph.prototype.autoScroll=function(t){var e;if(Date.now()-this.autoScrollTrigger<500)return null;e=3*MorphicPreferences.scrollBarSize,this.topLeft().extent(new Point(this.width(),e)).containsPoint(t)&&this.scrollY(e-(t.y-this.top())),this.topLeft().extent(new Point(e,this.height())).containsPoint(t)&&this.scrollX(e-(t.x-this.left())),new Point(this.right()-e,this.top()).extent(new Point(e,this.height())).containsPoint(t)&&this.scrollX(-(e-(this.right()-t.x))),new Point(this.left(),this.bottom()-e).extent(new Point(this.width(),e)).containsPoint(t)&&this.scrollY(-(e-(this.bottom()-t.y))),this.adjustScrollBars()},ScrollFrameMorph.prototype.scrollCursorIntoView=function(t){var e=t.target,r=e.position().subtract(this.contents.position()),i=this.top()+this.padding,n=this.bottom()-this.padding;this.contents.setExtent(e.extent().add(r).add(this.padding)),t.top()<i?(this.contents.setTop(this.contents.top()+i-t.top()),t.setTop(i)):t.bottom()>n&&(this.contents.setBottom(this.contents.bottom()+n-t.bottom()),t.setBottom(n)),this.adjustScrollBars()},ScrollFrameMorph.prototype.mouseScroll=function(t,e){t&&this.scrollY(t*MorphicPreferences.mouseScrollAmount),e&&this.scrollX(e*MorphicPreferences.mouseScrollAmount),this.adjustScrollBars()},ScrollFrameMorph.prototype.updateReferences=function(t){var e=this;ScrollFrameMorph.uber.updateReferences.call(this,t),this.hBar&&(this.hBar.action=function(t){e.contents.setPosition(new Point(e.left()-t,e.contents.position().y))}),this.vBar&&(this.vBar.action=function(t){e.contents.setPosition(new Point(e.contents.position().x,e.top()-t))})},ScrollFrameMorph.prototype.developersMenu=function(){var t=ScrollFrameMorph.uber.developersMenu.call(this);return this.isTextLineWrapping?t.addItem("auto line wrap off...","toggleTextLineWrapping","turn automatic\nline wrapping\noff"):t.addItem("auto line wrap on...","toggleTextLineWrapping","enable automatic\nline wrapping"),t},ScrollFrameMorph.prototype.toggleTextLineWrapping=function(){this.isTextLineWrapping=!this.isTextLineWrapping},ListMorph.prototype=new ScrollFrameMorph,ListMorph.prototype.constructor=ListMorph,ListMorph.uber=ScrollFrameMorph.prototype,ListMorph.prototype.init=function(t,e,r,i){ListMorph.uber.init.call(this),this.contents.acceptsDrops=!1,this.color=new Color(255,255,255),this.hBar.alpha=.6,this.vBar.alpha=.6,this.elements=t||[],this.labelGetter=e,this.format=r,this.listContents=null,this.selected=null,this.active=null,this.action=null,this.doubleClickAction=i||null,this.acceptsDrops=!1,this.buildListContents()},ListMorph.prototype.buildListContents=function(){var t=this;this.listContents&&this.listContents.destroy(),this.listContents=new MenuMorph(this.select,null,this),0===this.elements.length&&(this.elements=["(empty)"]),this.elements.forEach((function(e){var r=null,i=!1,n=!1;t.format.forEach((function(t){t[1].call(null,e)&&("bold"===t[0]?i=!0:"italic"===t[0]?n=!0:r=t[0])})),t.listContents.addItem(t.labelGetter(e),e,null,r,i,n,t.doubleClickAction)})),this.listContents.isListContents=!0,this.listContents.drawNew(),this.listContents.setPosition(this.contents.position()),this.addContents(this.listContents)},ListMorph.prototype.select=function(t,e){isNil(t)||(this.selected=t,this.active=e,this.action&&this.action.call(null,t))},ListMorph.prototype.setExtent=function(t){var e=this.listContents.bounds,r=this.bounds.origin.copy().corner(this.bounds.origin.add(t));r.right()>e.right()&&r.width()<=e.width()&&this.listContents.setRight(r.right()),r.bottom()>e.bottom()&&r.height()<=e.height()&&this.listContents.setBottom(r.bottom()),ListMorph.uber.setExtent.call(this,t)},ListMorph.prototype.activeIndex=function(){return this.listContents.children.indexOf(this.active)},ListMorph.prototype.activateIndex=function(t){var e=this.listContents.children[t];e&&(e.image=e.pressImage,e.changed(),e.trigger())},StringFieldMorph.prototype=new FrameMorph,StringFieldMorph.prototype.constructor=StringFieldMorph,StringFieldMorph.uber=FrameMorph.prototype,StringFieldMorph.prototype.init=function(t,e,r,i,n,o,s){this.defaultContents=t,this.minWidth=e,this.fontSize=r,this.fontStyle=i,this.isBold=n,this.isItalic=o,this.isNumeric=s||!1,this.text=null,StringFieldMorph.uber.init.call(this),this.color=new Color(255,255,255),this.isEditable=!0,this.acceptsDrops=!1,this.drawNew()},StringFieldMorph.prototype.drawNew=function(){var t;t=this.text?this.string():this.defaultContents,this.text=null,this.children.forEach((function(t){t.destroy()})),this.children=[],this.text=new StringMorph(t,this.fontSize,this.fontStyle,this.isBold,this.isItalic,this.isNumeric),this.text.isNumeric=this.isNumeric,this.text.setPosition(this.bounds.origin.copy()),this.text.isEditable=this.isEditable,this.text.isDraggable=!1,this.text.enableSelecting(),this.silentSetExtent(new Point(Math.max(this.width(),this.minWidth),this.text.height())),StringFieldMorph.uber.drawNew.call(this),this.add(this.text)},StringFieldMorph.prototype.string=function(){return this.text.text},StringFieldMorph.prototype.mouseClickLeft=function(t){this.isEditable?this.text.edit():this.escalateEvent("mouseClickLeft",t)},BouncerMorph.prototype=new Morph,BouncerMorph.prototype.constructor=BouncerMorph,BouncerMorph.uber=Morph.prototype,BouncerMorph.prototype.init=function(t,e){BouncerMorph.uber.init.call(this),this.fps=50,this.isStopped=!1,this.type=t||"vertical","vertical"===this.type?this.direction="down":this.direction="right",this.speed=e||1},BouncerMorph.prototype.moveUp=function(){this.moveBy(new Point(0,-this.speed))},BouncerMorph.prototype.moveDown=function(){this.moveBy(new Point(0,this.speed))},BouncerMorph.prototype.moveRight=function(){this.moveBy(new Point(this.speed,0))},BouncerMorph.prototype.moveLeft=function(){this.moveBy(new Point(-this.speed,0))},BouncerMorph.prototype.step=function(){this.isStopped||("vertical"===this.type?("down"===this.direction?this.moveDown():this.moveUp(),this.fullBounds().top()<this.parent.top()&&"up"===this.direction&&(this.direction="down"),this.fullBounds().bottom()>this.parent.bottom()&&"down"===this.direction&&(this.direction="up")):"horizontal"===this.type&&("right"===this.direction?this.moveRight():this.moveLeft(),this.fullBounds().left()<this.parent.left()&&"left"===this.direction&&(this.direction="right"),this.fullBounds().right()>this.parent.right()&&"right"===this.direction&&(this.direction="left")))},HandMorph.prototype=new Morph,HandMorph.prototype.constructor=HandMorph,HandMorph.uber=Morph.prototype,HandMorph.prototype.init=function(t){HandMorph.uber.init.call(this,!0),this.bounds=new Rectangle,this.world=t,this.mouseButton=null,this.mouseOverList=[],this.morphToGrab=null,this.grabPosition=null,this.grabOrigin=null,this.temporaries=[],this.touchHoldTimeout=null,this.contextMenuEnabled=!1},HandMorph.prototype.changed=function(){var t;null!==this.world&&((t=this.fullBounds()).extent().eq(new Point)||this.world.broken.push(t.spread()))},HandMorph.prototype.fullChanged=HandMorph.prototype.changed,HandMorph.prototype.morphAtPointer=function(){return this.world.topMorphAt(this.bounds.origin)||this.world},HandMorph.prototype.allMorphsAtPointer=function(){var t=this.world.allChildren(),e=this;return t.filter((function(t){return t.isVisible&&t.visibleBounds().containsPoint(e.bounds.origin)}))},HandMorph.prototype.dropTargetFor=function(t){for(var e=this.morphAtPointer();!e.wantsDropOf(t);)e=e.parent;return e},HandMorph.prototype.grab=function(t){var e=t.parent;if(t instanceof WorldMorph)return null;0===this.children.length&&(this.world.stopEditing(),this.grabOrigin=t.situation(),t instanceof MenuMorph||t.addShadow(),t.prepareToBeGrabbed&&t.prepareToBeGrabbed(this),t.cachedFullImage=t.fullImageClassic(),t.cachedFullBounds=t.fullBounds(),this.add(t),this.changed(),e&&e.reactToGrabOf&&e.reactToGrabOf(t))},HandMorph.prototype.drop=function(){var t,e;0!==this.children.length&&(e=this.children[0],t=(t=this.dropTargetFor(e)).selectForEdit?t.selectForEdit():t,this.changed(),t.add(e),e.cachedFullImage=null,e.cachedFullBounds=null,e.changed(),e instanceof MenuMorph||e.removeShadow(),this.children=[],this.setExtent(new Point),e.justDropped&&e.justDropped(this),t.reactToDropOf&&t.reactToDropOf(e,this))},HandMorph.prototype.processMouseDown=function(t){var e,r;if(this.destroyTemporaries(),this.contextMenuEnabled=!0,this.morphToGrab=null,this.grabPosition=null,0!==this.children.length)this.drop(),this.mouseButton=null;else{for(e=this.morphAtPointer(),this.world.activeMenu&&(contains(e.allParents(),this.world.activeMenu)?clearInterval(this.touchHoldTimeout):this.world.activeMenu.destroy()),this.world.activeHandle&&e!==this.world.activeHandle&&this.world.activeHandle.destroy(),this.world.cursor&&e!==this.world.cursor.target&&this.world.stopEditing(),e.mouseMove||(this.morphToGrab=e.rootForGrab(),this.grabPosition=this.bounds.origin.copy()),2===t.button||t.ctrlKey?(this.mouseButton="right",r="mouseDownRight"):(this.mouseButton="left",r="mouseDownLeft");!e[r];)e=e.parent;e[r](this.bounds.origin)}},HandMorph.prototype.processTouchStart=function(t){var e=this;MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),1===t.touches.length&&(this.touchHoldTimeout=setInterval((function(){e.processMouseDown({button:2}),e.processMouseUp({button:2}),t.preventDefault(),clearInterval(e.touchHoldTimeout)}),400),this.processMouseMove(t.touches[0]),this.processMouseDown({button:0}),t.preventDefault())},HandMorph.prototype.processTouchMove=function(t){if(MorphicPreferences.isTouchDevice=!0,1===t.touches.length){var e=t.touches[0];this.processMouseMove(e),clearInterval(this.touchHoldTimeout)}},HandMorph.prototype.processTouchEnd=function(t){MorphicPreferences.isTouchDevice=!0,clearInterval(this.touchHoldTimeout),nop(t),this.processMouseUp({button:0})},HandMorph.prototype.processMouseUp=function(){var t,e,r,i=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{if("left"===this.mouseButton)r="mouseClickLeft";else if(r="mouseClickRight",this.mouseButton&&this.contextMenuEnabled){for(e=(t=i).contextMenu();!e&&t.parent;)e=(t=t.parent).contextMenu();e&&e.popUpAtHand(this.world)}for(;!i[r];)i=i.parent;i[r](this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processDoubleClick=function(){var t=this.morphAtPointer();if(this.destroyTemporaries(),0!==this.children.length)this.drop();else{for(;t&&!t.mouseDoubleClick;)t=t.parent;t&&t.mouseDoubleClick(this.bounds.origin)}this.mouseButton=null},HandMorph.prototype.processMouseMove=function(t){var e,r,i,n,o=getDocumentPositionOf(this.world.worldCanvas),s=this;e=new Point(t.pageX-o.x,t.pageY-o.y),this.setPosition(e),r=this.morphAtPointer().allParents(),!this.children.length&&this.mouseButton&&(i=(n=this.morphAtPointer()).rootForGrab(),n.mouseMove&&(n.mouseMove(e,this.mouseButton),"right"===this.mouseButton&&(this.contextMenuEnabled=!1)),"left"===this.mouseButton&&this.morphToGrab&&this.grabPosition.distanceTo(this.bounds.origin)>MorphicPreferences.grabThreshold&&(this.setPosition(this.grabPosition),this.morphToGrab.isDraggable?(i=this.morphToGrab.selectForEdit?this.morphToGrab.selectForEdit():this.morphToGrab,this.grab(i)):this.morphToGrab.isTemplate&&(this.world.stopEditing(),(i=this.morphToGrab.fullCopy()).isTemplate=!1,i.isDraggable=!0,i.reactToTemplateCopy&&i.reactToTemplateCopy(),this.grab(i),this.grabOrigin=this.morphToGrab.situation()),this.setPosition(e))),this.mouseOverList.forEach((function(t){contains(r,t)||(t.mouseLeave&&t.mouseLeave(),t.mouseLeaveDragging&&s.mouseButton&&t.mouseLeaveDragging())})),r.forEach((function(t){contains(s.mouseOverList,t)||(t.mouseEnter&&t.mouseEnter(),t.mouseEnterDragging&&s.mouseButton&&t.mouseEnterDragging()),s.children.length>0&&t instanceof ScrollFrameMorph&&t.enableAutoScrolling&&t.contents.allChildren().some((function(t){return t.wantsDropOf(s.children[0])}))&&(t.bounds.insetBy(3*MorphicPreferences.scrollBarSize).containsPoint(s.bounds.origin)||t.startAutoScrolling())})),this.mouseOverList=r},HandMorph.prototype.processMouseScroll=function(t){for(var e=this.morphAtPointer();e&&!e.mouseScroll;)e=e.parent;e&&e.mouseScroll(t.detail/-3||(Object.prototype.hasOwnProperty.call(t,"wheelDeltaY")?t.wheelDeltaY/120:t.wheelDelta/120),t.wheelDeltaX/120||0)},HandMorph.prototype.processDrop=function(t){var e,r,i,n,o,s=t instanceof FileList?t:t.target.files||t.dataTransfer.files,a=t.dataTransfer?t.dataTransfer.getData("URL"):null,h=t.dataTransfer?t.dataTransfer.getData("Text/HTML"):null,c=this.morphAtPointer(),l=new Image;function u(t){for(var e=new Image,r=new FileReader;!c.droppedSVG;)c=c.parent;e.onload=function(){c.droppedSVG(e,t.name)},(r=new FileReader).onloadend=function(t){e.src=t.target.result},r.readAsDataURL(t)}function p(t){for(var e=new Image,r=new FileReader;!c.droppedImage;)c=c.parent;e.onload=function(){(n=newCanvas(new Point(e.width,e.height),!0)).getContext("2d").drawImage(e,0,0),c.droppedImage(n,t.name)},(r=new FileReader).onloadend=function(t){e.src=t.target.result},r.readAsDataURL(t)}function d(t){for(var e=new Audio,r=new FileReader;!c.droppedAudio;)c=c.parent;r.onloadend=function(r){e.src=r.target.result,c.droppedAudio(e,t.name)},r.readAsDataURL(t)}function f(t){for(var e=new FileReader;!c.droppedText;)c=c.parent;e.onloadend=function(e){c.droppedText(e.target.result,t.name)},e.readAsText(t)}function g(t){for(var e=new FileReader;!c.droppedBinary;)c=c.parent;e.onloadend=function(e){c.droppedBinary(e.target.result,t.name)},e.readAsArrayBuffer(t)}if(s.length>0)for(o=0;o<s.length;o+=1)-1===(e=s[o]).type.indexOf("svg")||MorphicPreferences.rasterizeSVGs?0===e.type.indexOf("image")?p(e):0===e.type.indexOf("audio")?d(e):0===e.type.indexOf("text")?f(e):g(e):u(e);else if(a){if(contains(["gif","png","jpg","jpeg","bmp"],r=a.slice(a.lastIndexOf(".")+1).toLowerCase())){for(;!c.droppedImage;)c=c.parent;(l=new Image).onload=function(){(n=newCanvas(new Point(l.width,l.height),!0)).getContext("2d").drawImage(l,0,0),c.droppedImage(n)},l.src=a}else if("svg"===r&&!MorphicPreferences.rasterizeSVGs){for(;!c.droppedSVG;)c=c.parent;!function(t,e){var r=new XMLHttpRequest;r.open("GET",t),r.onreadystatechange=function(){if(4===r.readyState){if(!r.responseText)throw new Error("unable to retrieve "+t);e(r.responseText)}},r.send()}(a,(function(t){var e=new Image;e.onload=function(){c.droppedSVG(e,a.slice(a.lastIndexOf("/")+1,a.lastIndexOf(".")))},e.src="data:image/svg+xml;utf8,"+encodeURIComponent(t)}))}}else if(h){for(;!c.droppedImage;)c=c.parent;(l=new Image).onload=function(){(n=newCanvas(new Point(l.width,l.height),!0)).getContext("2d").drawImage(l,0,0),c.droppedImage(n)},(i=function(t){var e,r,i="",n=t.indexOf('<img src="');if(-1===n)return null;for(e=n+=10;e<t.length;e+=1){if('"'===(r=t[e]))return i;i=i.concat(r)}return null}(h))&&(l.src=i)}},HandMorph.prototype.destroyTemporaries=function(){var t=this;this.temporaries.forEach((function(e){e.isClickable&&e.bounds.containsPoint(t.position())||(e.destroy(),t.temporaries.splice(t.temporaries.indexOf(e),1))}))},WorldMorph.prototype=new FrameMorph,WorldMorph.prototype.constructor=WorldMorph,WorldMorph.uber=FrameMorph.prototype,WorldMorph.prototype.init=function(t,e){for(WorldMorph.uber.init.call(this),this.color=new Color(205,205,205),this.alpha=1,this.bounds=new Rectangle(0,0,t.width,t.height),this.drawNew(),this.isVisible=!0,this.isDraggable=!1,this.currentKey=null,this.worldCanvas=t,this.noticesTransparentClick=!0,this.stamp=Date.now();this.stamp===Date.now();)nop();this.stamp=Date.now(),this.useFillPage=e,void 0===this.useFillPage&&(this.useFillPage=!0),this.isDevMode=!1,this.broken=[],this.animations=[],this.hand=new HandMorph(this),this.keyboardReceiver=null,this.cursor=null,this.lastEditedText=null,this.activeMenu=null,this.activeHandle=null,this.virtualKeyboard=null,this.initEventListeners()},WorldMorph.prototype.brokenFor=function(t){var e=t.fullBounds();return this.broken.filter((function(t){return t.intersects(e)}))},WorldMorph.prototype.fullDrawOn=function(t,e){WorldMorph.uber.fullDrawOn.call(this,t,e),this.hand.fullDrawOn(t,e)},WorldMorph.prototype.updateBroken=function(){var t=this;this.condenseDamages(),this.broken.forEach((function(e){e.extent().gt(new Point(0,0))&&t.fullDrawOn(t.worldCanvas,e)})),this.broken=[]},WorldMorph.prototype.stepAnimations=function(){this.animations.forEach((function(t){t.step()})),this.animations=this.animations.filter((function(t){return t.isActive}))},WorldMorph.prototype.condenseDamages=function(){function t(t){var e,r=[];return t.forEach((function(t){(e=detect(r,(function(e){return e.isNearTo(t,20)})))?e.mergeWith(t):r.push(t)})),r}for(var e=!0,r=this.broken.length;e;)this.broken=t(this.broken),e=this.broken.length<r,r=this.broken.length},WorldMorph.prototype.doOneCycle=function(){this.stepFrame(),this.stepAnimations(),this.updateBroken()},WorldMorph.prototype.fillPage=function(){var t=window.innerHeight,e=window.innerWidth,r=this;this.worldCanvas.style.position="absolute",this.worldCanvas.style.left="0px",this.worldCanvas.style.right="0px",this.worldCanvas.style.width="100%",this.worldCanvas.style.height="100%",document.documentElement.scrollTop&&(t=document.documentElement.clientHeight),document.documentElement.scrollLeft&&(e=document.documentElement.clientWidth),this.worldCanvas.width!==e&&(this.worldCanvas.width=e,this.setWidth(e)),this.worldCanvas.height!==t&&(this.worldCanvas.height=t,this.setHeight(t)),this.children.forEach((function(t){t.reactToWorldResize&&t.reactToWorldResize(r.bounds.copy())}))},WorldMorph.prototype.getGlobalPixelColor=function(t){return this.hand.morphAtPointer().getPixelColor(this.hand.position())},WorldMorph.prototype.initVirtualKeyboard=function(){var t=this;this.virtualKeyboard&&(document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard=document.createElement("input"),this.virtualKeyboard.type="text",this.virtualKeyboard.style.color="transparent",this.virtualKeyboard.style.backgroundColor="transparent",this.virtualKeyboard.style.border="none",this.virtualKeyboard.style.outline="none",this.virtualKeyboard.style.position="absolute",this.virtualKeyboard.style.top="0px",this.virtualKeyboard.style.left="0px",this.virtualKeyboard.style.width="0px",this.virtualKeyboard.style.height="0px",this.virtualKeyboard.autocapitalize="none",document.body.appendChild(this.virtualKeyboard),this.virtualKeyboard.addEventListener("keydown",(function(e){t.currentKey=e.keyCode,t.keyboardReceiver&&t.keyboardReceiver.processKeyDown(e),8===e.keyCode&&e.preventDefault(),9===e.keyCode&&(t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault())}),!1),this.virtualKeyboard.addEventListener("keyup",(function(e){t.currentKey=null,t.keyboardReceiver&&t.keyboardReceiver.processKeyUp&&t.keyboardReceiver.processKeyUp(e),e.preventDefault()}),!1),this.virtualKeyboard.addEventListener("keypress",(function(e){t.keyboardReceiver&&t.keyboardReceiver.processKeyPress(e),e.preventDefault()}),!1))},WorldMorph.prototype.initEventListeners=function(){var t=this.worldCanvas,e=this;e.useFillPage?e.fillPage():this.changed(),t.addEventListener("mousedown",(function(r){r.preventDefault(),t.focus(),e.hand.processMouseDown(r)}),!1),t.addEventListener("touchstart",(function(t){e.hand.processTouchStart(t)}),!1),t.addEventListener("mouseup",(function(t){t.preventDefault(),e.hand.processMouseUp(t)}),!1),t.addEventListener("dblclick",(function(t){t.preventDefault(),e.hand.processDoubleClick(t)}),!1),t.addEventListener("touchend",(function(t){e.hand.processTouchEnd(t)}),!1),t.addEventListener("mousemove",(function(t){e.hand.processMouseMove(t)}),!1),t.addEventListener("touchmove",(function(t){e.hand.processTouchMove(t)}),!1),t.addEventListener("contextmenu",(function(t){t.preventDefault()}),!1),t.addEventListener("keydown",(function(t){e.currentKey=t.keyCode,e.keyboardReceiver&&e.keyboardReceiver.processKeyDown(t),8===t.keyCode&&t.preventDefault(),9===t.keyCode&&(e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault()),(t.ctrlKey&&!t.altKey||t.metaKey)&&86!==t.keyCode&&t.preventDefault()}),!1),t.addEventListener("keyup",(function(t){e.currentKey=null,e.keyboardReceiver&&e.keyboardReceiver.processKeyUp&&e.keyboardReceiver.processKeyUp(t),t.preventDefault()}),!1),t.addEventListener("keypress",(function(t){e.keyboardReceiver&&e.keyboardReceiver.processKeyPress(t),t.preventDefault()}),!1),t.addEventListener("mousewheel",(function(t){e.hand.processMouseScroll(t),t.preventDefault()}),!1),t.addEventListener("DOMMouseScroll",(function(t){e.hand.processMouseScroll(t),t.preventDefault()}),!1),document.body.addEventListener("paste",(function(t){var r=t.clipboardData.getData("Text");r&&e.cursor&&e.cursor.insert(r)}),!1),window.addEventListener("dragover",(function(t){t.preventDefault()}),!1),window.addEventListener("drop",(function(t){e.hand.processDrop(t),t.preventDefault()}),!1),window.addEventListener("resize",(function(){e.useFillPage&&e.fillPage()}),!1),window.onbeforeunload=function(t){var e=t||window.event,r="Are you sure you want to leave?";return e&&(e.returnValue=r),r}},WorldMorph.prototype.mouseDownLeft=nop,WorldMorph.prototype.mouseClickLeft=nop,WorldMorph.prototype.mouseDownRight=nop,WorldMorph.prototype.mouseClickRight=nop,WorldMorph.prototype.wantsDropOf=function(){return this.acceptsDrops},WorldMorph.prototype.droppedImage=function(){return null},WorldMorph.prototype.droppedSVG=function(){return null},WorldMorph.prototype.nextTab=function(t){var e=this.nextEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.previousTab=function(t){var e=this.previousEntryField(t);e&&(t.clearSelection(),e.selectAll(),e.edit())},WorldMorph.prototype.contextMenu=function(){var t;return t=this.isDevMode?new MenuMorph(this,this.constructor.name||this.constructor.toString().split(" ")[1].split("(")[0]):new MenuMorph(this,"Morphic"),this.isDevMode&&(t.addItem("demo...","userCreateMorph","sample morphs"),t.addLine(),t.addItem("hide all...","hideAll"),t.addItem("show all...","showAllHiddens"),t.addItem("move all inside...","keepAllSubmorphsWithin","keep all submorphs\nwithin and visible"),t.addItem("inspect...","inspect","open a window on\nall properties"),t.addItem("screenshot...",(function(){window.open(this.fullImageClassic().toDataURL())}),"open a new window\nwith a picture of this morph.jsk"),t.addLine(),t.addItem("restore display","changed","redraw the\nscreen once"),t.addItem("fill page...","fillPage","let the World automatically\nadjust to browser resizing"),useBlurredShadows?t.addItem("sharp shadows...","toggleBlurredShadows","sharp drop shadows\nuse for old browsers"):t.addItem("blurred shadows...","toggleBlurredShadows","blurry shades,\n use for new browsers"),t.addItem("color...",(function(){this.pickColor(t.title+localize("\ncolor:"),this.setColor,this,this.color)}),"choose the World's\nbackground color"),MorphicPreferences===standardSettings?t.addItem("touch screen settings","togglePreferences","bigger menu fonts\nand sliders"):t.addItem("standard settings","togglePreferences","smaller menu fonts\nand sliders"),t.addLine()),this.isDevMode?t.addItem("user mode...","toggleDevMode","disable developers'\ncontext menus"):t.addItem("development mode...","toggleDevMode"),t.addItem("about morphic.js...","about"),t},WorldMorph.prototype.userCreateMorph=function(){var t,e,r=this;function i(t){t.isDraggable=!0,t.pickUp(r)}(t=new MenuMorph(this,"make a morph.jsk")).addItem("rectangle",(function(){i(new Morph)})),t.addItem("box",(function(){i(new BoxMorph)})),t.addItem("circle box",(function(){i(new CircleBoxMorph)})),t.addLine(),t.addItem("slider",(function(){i(new SliderMorph)})),t.addItem("dial",(function(){(e=new DialMorph).pickUp(this)})),t.addItem("frame",(function(){(e=new FrameMorph).setExtent(new Point(350,250)),i(e)})),t.addItem("scroll frame",(function(){(e=new ScrollFrameMorph).contents.acceptsDrops=!0,e.contents.adjustBounds(),e.setExtent(new Point(350,250)),i(e)})),t.addItem("handle",(function(){i(new HandleMorph)})),t.addLine(),t.addItem("string",(function(){(e=new StringMorph("Hello, World!")).isEditable=!0,i(e)})),t.addItem("text",(function(){(e=new TextMorph("Ich weiß nicht, was soll es bedeuten, dass ich so traurig bin, ein Märchen aus uralten Zeiten, das kommt mir nicht aus dem Sinn. Die Luft ist kühl und es dunkelt, und ruhig fließt der Rhein; der Gipfel des Berges funkelt im Abendsonnenschein. Die schönste Jungfrau sitzet dort oben wunderbar, ihr gold'nes Geschmeide blitzet, sie kämmt ihr goldenes Haar, sie kämmt es mit goldenem Kamme, und singt ein Lied dabei; das hat eine wundersame, gewalt'ge Melodei. Den Schiffer im kleinen Schiffe, ergreift es mit wildem Weh; er schaut nicht die Felsenriffe, er schaut nur hinauf in die Höh'. Ich glaube, die Wellen verschlingen am Ende Schiffer und Kahn, und das hat mit ihrem Singen, die Loreley getan.")).isEditable=!0,e.maxWidth=300,e.drawNew(),i(e)})),t.addItem("speech bubble",(function(){i(e=new SpeechBubbleMorph("Hello, World!"))})),t.addLine(),t.addItem("gray scale palette",(function(){i(new GrayPaletteMorph)})),t.addItem("color palette",(function(){i(new ColorPaletteMorph)})),t.addItem("color picker",(function(){i(new ColorPickerMorph)})),t.addLine(),t.addItem("sensor demo",(function(){(e=new MouseSensorMorph).setColor(new Color(230,200,100)),e.edge=35,e.border=15,e.borderColor=new Color(200,100,50),e.alpha=.2,e.setExtent(new Point(100,100)),i(e)})),t.addItem("animation demo",(function(){var t,e,r,n,o;(t=new BouncerMorph).setPosition(new Point(50,20)),t.setExtent(new Point(300,200)),t.alpha=.9,t.speed=3,(e=new BouncerMorph).setColor(new Color(50,50,50)),e.setPosition(new Point(80,80)),e.setExtent(new Point(80,250)),e.type="horizontal",e.direction="right",e.alpha=.9,e.speed=5,(r=new BouncerMorph).setColor(new Color(20,20,20)),r.setPosition(new Point(90,140)),r.setExtent(new Point(40,30)),r.type="horizontal",r.direction="right",r.speed=3,(n=new BouncerMorph).setColor(new Color(200,20,20)),n.setPosition(new Point(90,140)),n.setExtent(new Point(20,20)),n.type="vertical",n.direction="up",n.speed=8,(o=new BouncerMorph).setColor(new Color(20,200,20)),o.setPosition(new Point(120,140)),o.setExtent(new Point(20,20)),o.type="vertical",o.direction="down",o.speed=4,e.add(n),e.add(r),t.add(o),t.add(e),i(t)})),t.addItem("pen",(function(){i(new PenMorph)})),r.customMorphs&&(t.addLine(),r.customMorphs().forEach((function(e){t.addItem(e.toString(),(function(){i(e)}))}))),t.popUpAtHand(this)},WorldMorph.prototype.toggleDevMode=function(){this.isDevMode=!this.isDevMode},WorldMorph.prototype.hideAll=function(){this.children.forEach((function(t){t.hide()}))},WorldMorph.prototype.showAllHiddens=function(){this.forAllChildren((function(t){t.isVisible||t.show()}))},WorldMorph.prototype.about=function(){var t,e="";for(t in modules)Object.prototype.hasOwnProperty.call(modules,t)&&(e+="\n"+t+" ("+modules[t]+")");""!==e&&(e="\n\nmodules:\n\nmorphic ("+morphicVersion+")"+e),this.inform("morphic.js\n\na lively Web GUI\ninspired by Squeak\n"+morphicVersion+"\n\nwritten by Jens Mönig\njens@moenig.org"+e)},WorldMorph.prototype.edit=function(t){var e=getDocumentPositionOf(this.worldCanvas);if(!t.isEditable)return null;this.cursor&&this.cursor.destroy(),this.cursor=new CursorMorph(t),t.parent.add(this.cursor),this.keyboardReceiver=this.cursor,this.initVirtualKeyboard(),MorphicPreferences.isTouchDevice&&MorphicPreferences.useVirtualKeyboard&&(this.virtualKeyboard.style.top=this.cursor.top()+e.y+"px",this.virtualKeyboard.style.left=this.cursor.left()+e.x+"px",this.virtualKeyboard.focus()),MorphicPreferences.useSliderForInput&&(t.parentThatIsA(MenuMorph)||this.slide(t)),this.lastEditedText!==t&&t.escalateEvent("freshTextEdit",t),this.lastEditedText=t},WorldMorph.prototype.slide=function(t){var e,r,i=parseFloat(t.text);isNaN(i)&&(i=0),e=new MenuMorph,(r=new SliderMorph(i-25,i+25,i,10,"horizontal")).alpha=1,r.color=new Color(225,225,225),r.button.color=e.borderColor,r.button.highlightColor=r.button.color.copy(),r.button.highlightColor.b+=100,r.button.pressColor=r.button.color.copy(),r.button.pressColor.b+=150,r.silentSetHeight(MorphicPreferences.scrollBarSize),r.silentSetWidth(10*MorphicPreferences.menuFontSize),r.drawNew(),r.action=function(e){t.changed(),t.text=Math.round(e).toString(),t.drawNew(),t.changed(),t.escalateEvent("reactToSliderEdit",t)},e.items.push(r),e.popup(this,t.bottomLeft().add(new Point(0,5)))},WorldMorph.prototype.stopEditing=function(){this.cursor&&(this.cursor.target.escalateEvent("reactToEdit",this.cursor.target),this.cursor.target.clearSelection(),this.cursor.destroy(),this.cursor=null),this.keyboardReceiver&&this.keyboardReceiver.stopEditing&&this.keyboardReceiver.stopEditing(),this.keyboardReceiver=null,this.virtualKeyboard&&(this.virtualKeyboard.blur(),document.body.removeChild(this.virtualKeyboard),this.virtualKeyboard=null),this.lastEditedText=null,this.worldCanvas.focus()},WorldMorph.prototype.toggleBlurredShadows=function(){useBlurredShadows=!useBlurredShadows},WorldMorph.prototype.togglePreferences=function(){MorphicPreferences=MorphicPreferences===standardSettings?touchScreenSettings:standardSettings}},function(t,e,r){"use strict";r.r(e),r.d(e,"vue",(function(){return n})),r.d(e,"react",(function(){return o}));var i=r(0);function n(t,e){return{render:e}}function o(t,e){return t.createClass({render:i.a(e,t.createElement)})}},function(t,e,r){"use strict";(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.a=r}).call(this,r(15))},function(t,e,r){t.exports=function(t){return r(60)('!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){e.exports=function(){return r(2)(\'!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){e.exports=function(){return r(0)(\\\'!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),t.default={}}]);\\\',r.p+"13830b9316d13de70e82.worker.js")}},function(e,t,r){e.exports=function(){return r(0)(\\\'!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){e.exports=function(){return r(2)(\\\\\\\'!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),self.addEventListener("message",(function(m){return eval(m.data)})),__webpack_exports__.default={}}]);\\\\\\\',r.p+"9ee672ea57dc8a61e4fa.worker.js")}},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n);self.addEventListener("message",(function(e){if("install"===e.data.type){(new o.a).postMessage(e.data.data)}})),t.default={}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}}]);\\\',r.p+"7d5f750cd10622cec285.worker.js")}},function(e,t,r){"use strict";r.r(t);var n=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=t.reduce((function(e,t){return function(r){return t(e(r))}}),(function(e){return e}));return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n(e.apply(void 0,t))}};var o,u=r(1),i=r.n(u),a=r(2),c=r.n(a),f=function(){return(f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},d=self,l=new Map;d.addEventListener("message",n(o=function(e){if("installAppTemp"===e.data.type&&fetch(e.data.data.script).then((function(e){return e.text()})).then((function(e){o({data:{type:"addJS",data:{}}}).postMessage({type:"install",data:e})})),"addWASM"===e.data.type){var t=Math.round(1e5*Math.random());return l.set(t,new i.a),{data:l.get(t)}}if("addJS"===e.data.type){t=Math.round(1e5*Math.random());return l.set(t,new c.a),{data:l.get(t)}}}));var p=d.postMessage.bind(self,{type:"ping"}),s=function(e){return new Promise((function(t){var r;d.postMessage(f(f({},e),{id:r=new Array(10).map((function(e){return String.fromCharCode(128*Math.random()+20)})).reduce((function(e,t){return e?e+t:t}))})),d.addEventListener("message",(function e(n){if(n.data.id===r)return d.removeEventListener("message",e),t()}))}))};new WritableStream({write:s});d.addEventListener("message",n((function(e){return e.data}),(function(e){return p(),e}),(function(e){return e}),d.postMessage.bind(d)));t.default={}}]);\',r.p+"6514a632989879a9d81a.worker.js")}},function(e,t,r){"use strict";r.r(t);var n=r(0),o=new(r.n(n).a);self.addEventListener("message",(function(e){o.postMessage(e.data,e.data.transferables)})),o.addEventListener("message",(function(e){self.postMessage(e.data,e.data.transferables)})),t.default={}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}}]);',r.p+"03a988ce22ada3415cb7.sharedworker.js",t)}},function(t,e,r){"use strict";var i,n=r(4),o=r.n(n),s=(r(30),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.contextMenu=function(){var e=t.prototype.contextMenu.call(this),r=this.world().contextMenu(),i=o()(this.world().canvas);r.items.forEach((function(t){return e.addItem.apply(e,t)}));var n=this.vms;return n&&n.forEach((function(t){return e.addMenu(t.appName,t.ol_menu.reduce((function(t,e){return t.addItem.apply(t,e),t}),new MenuMorph))})),e.addItem("Delete Canvas",i.detach.bind(i)),this.sys&&e.addMenu("System",this.sys.menu.call(this.sys,MenuMorph,i)),e},e}(Morph);e.a=a},function(t,e,r){"use strict";var i=r(5),n=r.n(i);e.a=n()("app_",(function(t,e,r){var i,n;return"ol_AppSetParam"===r.type?((i={})[r.data.appID]=Object.assign({},e[r.data.appID],((n={})[r.data.param]=r.data.value,n)),i):e}))},function(t,e,r){"use strict";var i=r(0);function n(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}e.a=function(){return new Array(3).map(i.a(n,12448,12543)).map(String.fromCodePoint.bind(String)).join("")}},function(t,e,r){"use strict";function i(t,e,r){void 0===e&&(e={});var i=t();if(!i)return e;var n=e.vms||[];e.p||Promise.resolve();if("addVMID"===r.type)return Object.assign({},e,{vms:e.vms.concat([r.data])});var o=n.map((function(t){return i.olVms[t.id]}));return Object.assign({},e,{p:o.map((function(t){return t.olRedux.reducer})).reduce((function(t,e){return t.then((function(t){return e(t,r)}))}),e.p)})}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";e.a=function(t,e,r,i){return void 0===e&&(e={p:Promise.resolve()}),"postPromise"===r.type?i(Object.assign({},e,{p:e.p.then((function(t){return r.data(t)}))}),r):i(e,r)}},function(t,e,r){"use strict";function i(t,e){Object.defineProperty(t,"argv",{get:function(){return e.get(t)},set:function(r){e.set(t,r)}})}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";function i(t,e){var r;t.primHandler.setWindowTitle=(r=t.primHandler.setWindowTitle&&t.primHandler.setWindowTitle.bind(t.primHandler),function(i){return e.ScratchSettings&&e.ScratchSettings.useNormalWindowTitle&&r?r(i):(t.parent.titleMap.set(t,t.pop().bytesAsString()),!0)})}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";function i(t){function e(e,r){var i=t.pop(),n=t.pop(),o=t.pop(),s=t.ports.get(t.pop());return"write"===e&&s.write(String.fromCharCode(o.bytes.slice(n-1))),"read"===e&&s.read(i).then((function(t){var e=t.split("").map((function(t){return t.charCodeAt(0)}));o.bytes=o.bytes.slice(n-1).concat(e)})),!0}var r={primitiveSerialPortWriteByName:e.bind(null,"write"),primitiveSerialPortWrite:e.bind(null,"write"),primitiveSerialPortReadByName:e.bind(null,"read"),primitiveSerialPortRead:e.bind(null,"read")};t.primHandler.builtinModules.SerialPlugin=new Proxy(t.primHandler.builtinModules.SerialPlugin||{},{get:function(t,e){return r[e]||t[e]}})}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";function i(t,e){return[new ReadableStream({start:function(e){return t(e.enqueue.bind(e))}}),new WritableStream({write:function(t){return e().write(t)}})]}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";(function(t){e.a=(window||t||self).driver&&(window||t||self).driver.eval}).call(this,r(15))},function(t,e,r){"use strict";e.a=function(t,e){return e.onData((function(e){return t.postMessage({type:"readTerm",data:e})})),t.addEventListener("message",(function(t){"termWrite"===t.type&&e.write(t.data)})),e}},function(t,e,r){"use strict";function i(t){var e,r=t.Symbol;return"function"==typeof r?r.observable?e=r.observable:(e=r("observable"),r.observable=e):e="@@observable",e}r.d(e,"a",(function(){return i}))},function(t,e,r){"use strict";function i(t,e){Array.prototype.filter.call(t.childNodes,(function(t){return t.classList.includes("ol-inject")})).length||e()}function n(t){t.classList.add("ol-inject")}var o=function(){function t(t,e){this._ui=t,this.options=e}return t.prototype.listen=function(t){var e=new MutationObserver(this.mutated.bind(this));return e.observe(t,{attributes:!0,childList:!0,subtree:!0}),e.disconnect.bind(e)},t.prototype.olStartup=function(t){},t.prototype.ol_m_click=function(t,e){},t.prototype.mutated=function(t,e){var r=this._ui.Current;t.forEach((function(t){t.target;t.addedNodes&&t.addedNodes.forEach((function(t){var e,o,s=this;if(t.classList){var a=void 0;[].includes.call(t.classList,"osjs-window-icon")&&function(t,e){i(t,(function(){if(e){var r=document.createElement("span");t.appendChild(r),r.addEventListener("click",e.titleClickNative.bind(e,t)),n(r)}}))}(t,r),[].includes.call(t.classList,"osjs-gui-box")&&(o=this,i(e=t,(function(){Array.prototype.filter.call(e.childNodes,(function(t){return t.classList.includes("osjs-gui-menubar")})).forEach((function(t){i(t,(function(){var e=document.createElement("span");e.innerText="ObjectLand",e.addEventListener("click",o.ol_m_click.bind(o,e)),t.appendChild(e),n(t)}))})),n(e)}))),[].includes.call(t.classList,"ol-rolly-injected")&&function(t,e){i(t,(function(){t.addEventListener("olStartup",e.olStartup.bind(e,t)),n(t)}))}(t,this),(a=[].filter.call(t.classList,(function(t){return t.startsWith("green-flag")}))).length&&a.forEach((function(t){return t.addEventListener("click",s.options.onFlagScratchClicked.bind(t,s))}))}}))}))},t}();e.a=o},function(t,e,r){"use strict";var i=r(11),n="Expected a function";var o=function(t,e){var r;if("function"!=typeof e)throw new TypeError(n);return t=Object(i.a)(t),function(){return--t>0&&(r=e.apply(this,arguments)),t<=1&&(e=void 0),r}};var s=function(t){return o(2,t)},a=r(0);function h(t){return new Promise((function(e,r){var i=t.Squeak||window.SqueakJS;if(i)return i.runImage(void 0,t.component.element,t,e)})).then((function(e){return t.then?t.then(e):e}))}var c=r(8);e.a=function(t,e,r){var i=r.win,n=r.kapi,o=r.s_canvas,l=r.argv,u=r.serialPrimLoader,p=r.scratchPrimLoader,d=r.initRequest,f=r.chrome,g=r.argvGlobalMap,_=r.services,v=r.ex;return s(a.a(h,{Squeak:t,url:i.location.protocol+"//"+i.location.hostname+"/squeak/squeak.image",component:{element:{getContext:function(t){return i.document&&c.a.Current?c.a.Current.getFramework().$rootComponent.SqueakDisplay.element.getContext(t):n.getSqueakContext?n.getSqueakContext(t):o.getContext(t)}}},then:function(t){return Promise.resolve(t).then((function(t){var e;return i.onRollyAdded=(e=i.onRollyAdded,function(r){return r.initSqueak(t),e(r)}),t})).then((function(t){return n.onSqueakLinked?n.onSqueakLinked(t).then((function(e){return t})):t})).then((function(t){var e;l(t.primHandler.display,g),t.titleMap=new Map,p(t,i),u(t),t.builtinModules.ObjectLandKernelWebPlugin={getBody:function(r){return t.pop(),t.push(t.primHandler.makeStObject(d&&d.body,e)),!0},setJSClass:function(r){return t.push(e=t.pop()),!0},addPrimitive:function(e){var r,i,n=t.pop(),o=n.jsObject;return o||(t.push(n),o=t),(o.primHandler.loadedModules[r=t.primHandler.js_fromStObject(t.pop())]||o.primHandler.builtinModules[r]||(o.primHandler.loadedModules[r]={}))[t.primHandler.js_fromStObject(t.pop())]=(i=t.js_fromStBlock(t.pop()),function(t){var e=o.freeze();return i(o).then(e),!0}),t.push(t.pop()),!0},addProperty:function(r){var i,n,o=t.pop()-1,s=t.primHandler.js_fromStObject(t.pop(),e),a=t.primHandler.js_fromStObject(t.pop(),e);Object.defineProperty((i=t.pop()).pointers||i.bytes||i.words,-1===o?"sqClass":o,{get:function(){return s().then((function(t){return n=t})),n},set:function(t){a(t)}})},onMessage:function(r){return window.addEventListener("message",t.primHandler.js_fromStObject(t.pop(),e).bind(window,window.postMessage.bind(window))),t.push(!0),!0},runVM:function(r){var n=new Array(1).map(t.pop.bind(t)),o=t.freeze();return h(t.fromStObject(n[0])).then((function(r){Object.defineProperty(r,"parent",{get:function(){return t}}),o(),u(r),p(r,i),t.push(t.primHandler.makeStObject(r,e))})),!0},sendChromeMessage:function(r){var i=t.primHandler.js_fromStObject(t.pop(),e);if(f){var n=t.freeze();f.runtime.postMessage(i,(function(e){t.push(e),n()}))}return!0},onChromeMessage:function(r){var i=t.primHandler.js_fromStObject(t.pop(),e);return f&&f.runtime.onMessage.addListener(i),!0},get getServices(){return _?function(r){return t.pop(),t.push(t.push(t.primHandler.makeStObject(_,e))),!0}:function(t){return!1}},get kapiPrimitive(){return n.primitive.bind(n,t)}},t.on("load",(function(t){v()&&v().onSqueakLinked(t.sProxy)}))})).catch(console.log.bind(console)),Object.defineProperty(t,"stdout",{get:function(){return e.stdout.write.bind(e.stdout)}}),Object.defineProperty(t,"stdin",{get:function(){return e.stdin.read.bind(e.stdin)}}),t}}))}},function(t,e,r){"use strict";var i=r(2),n=r(1),o=function(){return n.a.Date.now()},s=r(12),a="Expected a function",h=Math.max,c=Math.min;var l=function(t,e,r){var n,l,u,p,d,f,g=0,_=!1,v=!1,y=!0;if("function"!=typeof t)throw new TypeError(a);function m(e){var r=n,i=l;return n=l=void 0,g=e,p=t.apply(i,r)}function b(t){var r=t-f;return void 0===f||r>=e||r<0||v&&t-g>=u}function S(){var t=o();if(b(t))return w(t);d=setTimeout(S,function(t){var r=e-(t-f);return v?c(r,u-(t-g)):r}(t))}function w(t){return d=void 0,y&&n?m(t):(n=l=void 0,p)}function C(){var t=o(),r=b(t);if(n=arguments,l=this,f=t,r){if(void 0===d)return function(t){return g=t,d=setTimeout(S,e),_?m(t):p}(f);if(v)return clearTimeout(d),d=setTimeout(S,e),m(f)}return void 0===d&&(d=setTimeout(S,e)),p}return e=Object(s.a)(e)||0,Object(i.a)(r)&&(_=!!r.leading,u=(v="maxWait"in r)?h(Object(s.a)(r.maxWait)||0,e):u,y="trailing"in r?!!r.trailing:y),C.cancel=function(){void 0!==d&&clearTimeout(d),g=0,n=f=l=d=void 0},C.flush=function(){return void 0===d?p:w(o())},C};function u(t,e,r,i){var n=new MessageChannel,o=new MessageChannel;t.postMessage({type:"initPorts",alertPort:n.port2,consolePorts:o.port2},"*",[n.port2,o.port2]),n.port1.addEventListener("message",l(e.alertPort.postMessage.bind(e.alertPort),500)),e.alertPort.addEventListener("message",l(n.port1.postMessage.bind(n.port1),500)),o.port1.addEventListener("message",(function(t){return r(t.data)})),i.push(new WritableStream({write:o.port1.postMessage.bind(o.port1)}))}r.d(e,"a",(function(){return u}))},function(t,e,r){"use strict";var i=r(43);function n(t,e,r,n){var o={};return function(s,a){n(s,(function(t){s.value=o[a]}),(function(t){o[a]=s.value}));var h=function(){var n=o[a]||"";return"="==n.charAt(0)?Object(i.a)(function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.forEach((function(e){var r=Object.keys(e).reduce((function(t,r){return t[r]=Object.getOwnPropertyDescriptor(e,r),t}),{});Object.getOwnPropertySymbols(e).forEach((function(t){var i=Object.getOwnPropertyDescriptor(e,t);i.enumerable&&(r[t]=i)})),Object.defineProperties(t,r)})),t}({},r,{log:t,chrome:void 0,get alert(){return e.olAlerter.alert},get prompt(){return e.olAlerter.prompt}}),n.substring(1)):isNaN(parseFloat(n))?n:parseFloat(n)};Object.defineProperty(r,a,{get:h}),Object.defineProperty(r,a.toLowerCase(),{get:h})}}r.d(e,"a",(function(){return n}))},function(t,e,r){"use strict";var i=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))},n=function(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=function(){function t(t,e,r){this._chrome=t,this._ui=e,this.opts=r}return t.prototype.initServices=function(){var t=this;return new Promise((function(e){t._chrome.storage.sync.get(["use"],(function(r){r.use||t._chrome.storage.sync.set({use:r.use=[]}),Promise.all(r.use.map((function(e){return new Promise((function(r){return t._chrome.runtime.connect(e,r)})).then((function(t){return{id:e,port:t}}))}))).then((function(t){e(t)}))}))}))},t.prototype.onSqueakLinked=function(t){return i(this,void 0,void 0,(function(){var e;return n(this,(function(r){switch(r.label){case 0:return e=this._chrome,[4,t.call("when:send:to:","jsCMessage","call:with:",(function(t){return i(this,void 0,void 0,(function(){var r,i;return n(this,(function(n){switch(n.label){case 0:return[4,t.call("data")];case 1:return r=n.sent(),[4,new Promise((function(t){return e.runtime.postMessage(r,t)}))];case 2:return i=n.sent(),[4,t.call("reply:",i)];case 3:return[2,n.sent()]}}))}))}))];case 1:return r.sent(),[2]}}))}))},t}();e.a=o},function(t,e,r){"use strict";var i=r(18);function n(t,e,r){t.data.port.postMessage({postToWindow:{workerID:e,data:r}})}function o(t){var e=t.win,r=(t.workerMap,t.libs,t.chrome,t.callback);if(e.inGadgetHelper){new Map;e.addEventListener("message",(function(t){if("init"===t.data.type){n.bind(void 0,t);t.data.port.addEventListener("message",(function(e){if("addGadget"===e.data.type){var r=Object(i.a)();t.data.port.postMessage({postToWindow:{workerID:r,create:!0,url:e.data.data}});var n=new OffscreenCanvas(400,400),o=new MessageChannel;!function(t,e,r,i){e.addEventListener("message",(function(t){}))}(0,o.port1,0,t.data.port),t.data.port.postMessage({postToWindow:{workerID:r,data:{canvas:n,port:o.port2},transferables:[n,o.port2]},postToWindow_transferables:[n,o.port2]})}}))}}))}else{var o=new MessageChannel;e.postMessage({workerID:"GadgetHelper",data:{type:"init",port:o.port2},transferrables:[o.port2]},"*",[o.port2]),o.port1.addEventListener("message",(function(t){t.data.postToWindow&&e.postMessage(Object.assign({},t.data.postToWindow,{transferables:t.data.postToWindow_transferables}),"*",t.data.postToWindow_transferrables||[]),t.data.callBackLink&&r((function(e,r){return o.port1.postMessage({winCallback:t.data.callBackTag,data:e,transferables:r},r)}))})),e.addEventListener("message",(function(t){o.port1.postMessage({messageFromWindow:t.data},t.data.transferables)}))}}r.d(e,"a",(function(){return o}))},function(t,e,r){"use strict";var i=r(23),n=r(19),o=r(7),s=r(3),a=Object(i.a)((function(t,e){var r=Object(s.a)(e,Object(o.a)(a));return Object(n.a)(t,64,void 0,e,r)}));a.placeholder={},e.a=a},function(t,e,r){"use strict";r.r(e),function(t){r(54);var e,i,n,o=r(0),s=r(52),a=r(24),h=r.n(a),c=r(4),l=r.n(c),u=r(26),p=(r(30),r(6)),d=r(5),f=r.n(d),g=r(13),_=r(31),v=(r(59),r(25)),y=r(33),m=r.n(y),b=r(50),S=r(29),w=r(34),C=r(35),M=r(36),E=r(37),x=r(38),P=r(8),k=r(47),T=r(46),L=r(39),I=r(51),A=r(40),D=r(41),R=r(42),O=r(27),B=r(49),H=r(48),F=r(18),j=r(44),N=function(){return(N=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},W=new m.a,U=Object(v.a)((function(t){return new u.Terminal(t)}),o.a(j.a,W)),z=function(t){return new Promise((function(e){var r;W.postMessage(N(N({},t),{id:r=Object(F.a)()})),window.addEventListener("message",(function t(i){if(i.data.id===r)return window.removeEventListener("message",t),e()}))}))},q=window||self||t,K=function(t){return new Promise((function(e,r){var i=document.createElement("script");i.onload=e,i.onerror=r,i.src=t,document.head.appendChild(i)}))};l()("#brave, .window-boot, #sn_world").each((function(){Object(S.a)(this,{decoration:function(t){},title:l()(this).find(".title").appendTo(l()("body")).get(0)})})),K("../../Snap/src/symbols.js").then(o.a(K,"../../Snap/src/blocks.js")).then(o.a(K,"../../Snap/src/threads.js")).then(o.a(K,"../../Snap/src/objects.js")).then(o.a(K,"../../Snap/src/cloud.js")).then(o.a(K,"../../Snap/src/lists.js")).then(o.a(K,"../../Snap/src/byob.js")).then(o.a(K,"../../Snap/src/sketch.js")).then(o.a(K,"../../Snap/src/video.js")).then(o.a(K,"../../Snap/src/maps.js")).then(o.a(K,"../../Snap/src/xml.js")).then(o.a(K,"../../Snap/src/store.js")).then(o.a(K,"../../Snap/src/locale.js")).then(o.a(K,"../../Snap/src/api.js")).then(o.a(K,"../../Snap/src/FileSaver.min.js")).then((function(){var t;function e(){requestAnimationFrame(e),t.doOneCycle()}document.addEventListener("load",(function(){t=new WorldMorph(document.getElementById("sn_world")),new IDE_Morph(!1,kernel).openIn(t),e()}))})).catch((function(t){})),K("../../ObjectLand.SqueakJS/squeak.js").then((function(){return new Promise((function(t){return sq_module("ObjectLand").requires("SqueakJS").toRun(t)}))})).then((function(){return q.SqueakJS})).then((function(t){return Object(k.a)(t,{stdin:e[1],stdout:e[0]},{win:q,kapi:et,s_canvas:lt,argv:L.a,serialPrimLoader:D.a,scratchPrimLoader:A.a,initRequest:void 0,chrome:tt,argvGlobalMap:ct,services:ot,ex:it})})).catch((function(t){})),q.addEventListener("message",(function(t){"installAppTemp"===t.type&&z({type:"installAppTemp",data:t.data})})),h.a.enable((function(t){t||(i=h.a.inputs,n=h.a.outputs,i[0]&&i[0].addListener("noteoff","all",Object(v.a)((function(t){return{type:"midi",data:t}}),z,(function(t){return t.then((function(t){var e;return t.data[0]&&(e=n[0]).playNote.apply(e,t.data)}))}))))}));var G={};q.addEventListener=q.addEventListener||function(t,e){(G[t]||(G[t]=[])).push(e)},q.removeEventListener=q.removeEventListener||function(t,e){G[t]=G[t]&&G[t].filter((function(t){return t!==e}))},q.kernel={},kernel.theWorker=W,kernel.OMainTerminal=U,kernel.OTerminal=u.Terminal,kernel.snap=function(t,e){t.$=Object(v.a)(l.a,s.a(l.a.fn.filter.call.bind(l.a.fn.filter),".sn_sandboxed")),e()},kernel.onRanVM=function(t,e){Object.defineProperty(t.image.specialObjectsArray,"vm",{get:function(){return t}})},kernel.vort=_,kernel.BaseWindow=S.a,kernel.auth=function(t){return new Promise((function(e,r){kernel.store.getState().sys.usr.filter((function(e){return e.token===t||e.token.OLCacheEndpointPassword===t})).forEach(e),r()}))},kernel.prefs=function(t){return new Promise((function(e){fetch(t.domain||"ol.co/"+t.name).then((function(t){return t.json()})).then(e)}))},q.OlBridgeMorph=w.a,q.isSugar=!1;var V=void 0,Y=[],X=kernel.store=Object(p.b)(kernel.reducer=Object(g.a)({sys:{k:{},app:void 0,terminal:void 0,memeOkBoomer:!1,memeFlatEarth:!1}},Object(p.a)({sys:Object(g.a)(null,Object(p.a)({k:Object(g.a)(null,(function(t,e){return t})),usr:f()("usr_",(function(t,e){return"user-create"===e.type?Object.assign({},t,{users:t.users.concat([e.data])}):"user_remove"===e.type?Object.assign({},t,{users:t.users.filter((function(t){return t.name===e.data.name&&t.passToken===e.data.token}))}):t}))}))}),Object(p.a)({dt:Object(g.a)({toolSlices:[]}),st:f()("squeak_",o.a(E.a,(function(){return q.SqueakJS}))),rolly:Object(p.a)({rIntegration:f()("r-integration_",s.a(o.a(x.a,q),Object(p.a)({}))),rData:f()("r-data_",(function(t,e){var r;return void 0===t&&(t={}),"addLocalComponent"===e.type?Object.assign({},t,((r={})[e.id]=e.data,r)):"setComponentID"===e.type?Object.assign({},t,{id:e.data}):t}))}),sysExtras:f()("extras_",Object(p.a)({})),app:o.a(C.a,q),sys:function(t,e){return"setApp"===e.type?{app:e.data}:"setTApp"===e.type?{terminal:e.data}:"_changeData"===e.type?e.data:t}}),f()("dt_",o.a((function(t,e,r){return e.dt.toolSlices.reduce((function(e,i){var n;return Object.assign({},e,((n={})[i]=Object.assign({},e[i],t(e[i],r)),n))}),e)}),(function(t,e){return t}))),Object(p.a)({auth:f()("auth_",(function(t,e){return"createID"===e.type?Object.assign({},t,{id:e.data||Object(M.a)()}):t}))})));q.addEventListener("message",(function(t){X.dispatch(N(N({},t.data),{source:t.source,origin:t.origin}))})),e=Object(R.a)((function(t){return V=t}),(function(){return X.getState().sys.terminal}));new O.a([],{getCurrent:function(){return X.getState().sys.terminal},setCurrent:function(t){X.dispatch({type:"setTApp",data:t})}}),new O.a(Y,{getCurrent:function(){return X.getState().sys.app},setCurrent:function(t){X.dispatch({type:"setApp",data:t})}});var J,Z,$,Q=new T.a(P.a,{onFlagScratchClicked:function(t,e){var r=q.document.getElementsByClassName("project-title"),i=[].filter.call(r,(function(t){return t.innerHTML.includes("Pangea")}));i.length&&i.forEach((function(t){return t.addEventListener("click",(function(t){var e=window.open("https://snap.berkeley.edu/embed?project=Pangea%20OS%20NT&user=gkgoat&showTitle=true&showAuthor=true&editButton=true&pauseButton=true");Object(H.a)(e,q,V,Y)}))}))}});q._$console=e,q._$allApps=Y,q.Sheet=B.a.bind(void 0,V),q.addEventListener("message",(function(t){if("createConsole"===t.data.type){var r=new MessageChannel;t.source.postMessage({port:r.port2},"*",[r.port2]),Y.push(new WritableStream({write:r.port2.postMessage.bind(r.port2)})),r.port1.addEventListener("message",(function(t){return V(t.data)}))}var i;"linkConsole"===t.data.type&&(t.data.port.addEventListener("message",e[1].write.bind(e[1])),(i=e[0].tee())[0].pipeTo(new WritableStream({write:t.data.port.postMessage.bind(t.data.port)})).then((function(){e[0]=i[1]})))})),q.console.log=($=q.console.log,function(t){return V(t),$(t)}),q.prompt=function(t){return function(e){return t(e)}}(q.prompt);var tt=q.chrome;tt&&tt.app&&void 0!==tt.app.window&&tt.app.window.create("/dist/embed.html#/main.js",{},(function(t){t,t.contentWindow.addEventListener("message",(function(t){return q.postMessage(t.data,"*",t.data.transferables)})),q.addEventListener("message",(function(e){"comToMainWindow"==e.data.type&&t.postMesage(e.data.data,"*",e.data.transferables)}))}));var et=q.olKAPI||(q.olKAPI={});et.addUI=function(t){P.a.Current=new P.a(t)};var rt,it,nt,ot,st=!0,at=new Map,ht=new Map,ct=new Map,lt=new OffscreenCanvas(1e3,1e3);if(q.workerMap&&(at=q.workerMap,st=!1,delete q.workerMap,q.addEventListener("message",(function(t){if(t.data.workerID&&t.data.create){q.ol_w_set(t.data.workerID,new Worker(t.data.url))}else t.data.workerID&&at.get(t.data.workerID).postMessage(Object.assign({},t.data.data,{transferables:t.data.transferables}),t.data.transferrables)})),q.ol_w_set=function(t,e){at.set(t,e),e.addEventListener("message",(function(e){q.postMessage({responseID:t,data:e.data,transferables:e.data.transferables},"*",e.data.transferables)}))}),q.define||q.System&&q.System.amdDefine){var ut=q.define||q.System&&q.System.amdDefine;ut("activity/activity",["sugar-web/activity/activity","sugar-web/env","olPalette"],(function(t,e,r){q.isSugar=!0,q.rollyChain&&q.rollyChain.forEach((function(t){return t.setIsSugar(!0)})),J=t,e.getEnvironment((function(t,e){e.user.name,q.addEventListener("DOMContentLoaded",(function(t){J.start(),Z=new r.OLPallette(document.getElementById("olPalleteBarItem"),"ObjectLand")}))}))})),ut("ol.bridge",["exports"],(function(t){Object.defineProperty(t,"enq",{get:function(){return V}}),Object.defineProperty(t,"pallette",{get:function(){return Z}})}))}if(tt&&(it=new b.a(tt,P.a,{getSqueakProxy:function(){},getLink:function(){return Q}})),!tt&&q.document&&(Object(I.a)({win:q,workerMap:at,libs:ht,chrome:void 0,callback:function(t){rt=t}}),st=st&&q.isGadgetHelper),q.ServiceWorkerWare&&(nt=new q.ServiceWorkerWare),q.require&&!nt)try{nt=q.require("express")()}catch(t){}q.document&&Q.listen(document.body),q.location&&(q.location.hostname.includes("ol")||"chrome-extension"===q.location.protocol)&&(st=!0),it&&it.initServices().then((function(t){ot=t})),q.addEventListener("message",(function(t){"exlinkgadget"===t.data.type&&rt(Object.assign({},t.data.data,{transferables:t.data.transferables}),t.data.transferables),tt&&t.data.id&&t.data.data&&"chrome"===t.data.type&&tt.runtime.postMessage(Object.assign({},t.data.data,{isFromWebpage:!0,id:t.data.id}),(function(e){q.postMessage({chromeResponseID:t.data.id,chromeResponseData:e})})),rt&&"gadget"===t.data.type&&rt(t.data.data,t.data.transferables)})),q.open&&new Promise((function(t,e){if(!tt)return e();tt.storage.sync.get(["ol-deskEnv"],(function(t){e(t["ol-deskEnv"])}))})).catch((function(t){return t||Promise.resolve((q.prompt.default||q.prompt).call(q,"Desk Env URL"))})).then((function(t){return q.open(t)})).then((function(t){return q.addEventListener("message",(function(e){e.source===t&&q.postMessage(e.data,"*",e.data.transferables),"comToDeskEnv"===e.data.type&&t.postMessage({type:"fromWin",data:e.data},"*",e.data.transferables)})),t}))}.call(this,r(15))},function(t,e,r){var i=r(55),n=r(56);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);var o={insert:"head",singleton:!1},s=(i("!!../../node_modules/css-loader/dist/cjs.js!./main.css",n,o),n.locals?n.locals:{});t.exports=s},function(t,e,r){"use strict";var i,n={},o=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},s=function(){var t={};return function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}t[e]=r}return t[e]}}();function a(t,e,r){t=r.base?t+r.base:t,n[t]||(n[t]=[]);for(var i=0;i<e.length;i++){var o=e[i],s={css:o[1],media:o[2],sourceMap:o[3]},a=n[t];a[i]?a[i].updater(s):a.push({updater:g(s,r)})}for(var h=e.length;h<n[t].length;h++)n[t][h].updater();n[t].length=e.length,0===n[t].length&&delete n[t]}function h(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var n=r.nc;n&&(i.nonce=n)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var o=s(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var c,l=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function u(t,e,r,i){var n=r?"":i.css;if(t.styleSheet)t.styleSheet.cssText=l(e,n);else{var o=document.createTextNode(n),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function p(t,e,r){var i=r.css,n=r.media,o=r.sourceMap;if(n?t.setAttribute("media",n):t.removeAttribute("media"),o&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var d=null,f=0;function g(t,e){var r,i,n;if(e.singleton){var o=f++;r=d||(d=h(e)),i=u.bind(null,r,o,!1),n=u.bind(null,r,o,!0)}else r=h(e),i=p.bind(null,r,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(r)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else n()}}t.exports=function(t,e,r){return(r=r||{}).singleton||"boolean"==typeof r.singleton||(r.singleton=o()),a(t,e,r),function(e){a(t,e||[],r)}}},function(t,e,r){(e=r(57)(!1)).push([t.i,"",""]),t.exports=e},function(t,e,r){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r=t[1]||"",i=t[3];if(!i)return r;if(e&&"function"==typeof btoa){var n=(s=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(h," */")),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot).concat(t," */")}));return[r].concat(o).concat([n]).join("\n")}var s,a,h;return[r].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var i=0;i<t.length;i++){var n=[].concat(t[i]);r&&(n[2]?n[2]="".concat(r," and ").concat(n[2]):n[2]=r),e.push(n)}},e}},function(t,e,r){"use strict";function i(t,e){for(var r in e)t[r]=e[r];return t}t.exports=function(t,e){return i(i({},t),e)}},function(t,e){if(!completeAssign)try{completeAssign=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.forEach((function(e){var r=Object.keys(e).reduce((function(t,r){return t[r]=Object.getOwnPropertyDescriptor(e,r),t}),{});Object.getOwnPropertySymbols(e).forEach((function(t){var i=Object.getOwnPropertyDescriptor(e,t);i.enumerable&&(r[t]=i)})),Object.defineProperties(t,r)})),t}}catch(t){}},function(t,e){var r=window.URL||window.webkitURL;t.exports=function(t,e,i){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(t),n=n.getBlob()}catch(e){n=new Blob([t])}return new SharedWorker(r.createObjectURL(n),i)}catch(e){return new SharedWorker("data:application/javascript,"+encodeURIComponent(t),i)}}catch(t){return new SharedWorker(e,i)}}},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}}]);